/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={6968:(e,t,n)=>{n.r(t),n.d(t,{DATA_CONSTANTS:()=>r});const r={SET_LINK_TYPE:"SET_LINK_TYPE",SET_DEMOGRAPHIC_ID:"SET_DEMOGRAPHIC_ID",SET_PATIENT_NAME:"SET_PATIENT_NAME",SET_CURRENT_WINDOW:"SET_CURRENT_WINDOW",SET_PHONE_NUMBER:"SET_PHONE_NUMBER",SET_APPOINTMENT_NUMBER:"SET_APPOINTMENT_NUMBER",SET_EMAIL:"SET_EMAIL",SET_DOB:"SET_DOB",SET_PHN:"SET_PHN",SET_IN_PROGRESS:"SET_IN_PROGRESS",CLEAR_STATES:"CLEAR_STATES",SET_SCREEN:"SET_SCREEN",SET_DOCTOR:"SET_DOCTOR",SET_PREVIOUS_DATA:"SET_PREVIOUS_DATA"}},6591:(e,t,n)=>{n.r(t),n.d(t,{BaseClass:()=>i});var r=n(9966);class i{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{logging:!0,streaSize:500,mimeType:"audio/webm"};this.cb=n,this.wsUrl=e,this.baseURL=t,this.config=i,this.ws=null,this.connectionActive=!1,this.isServerReady=!1,this.speechSegments={},this.audioChunks=[],this.audioFile=null,this.mediaOption={},this.mediaRecorder=null,this.wsOnOpen=this.wsOnOpen.bind(this),this.wsOnClose=this.wsOnClose.bind(this),this.wsOnError=this.wsOnError.bind(this),this.wsOnMessage=this.wsOnMessage.bind(this),this.mediaRecorderOnDataAvailable=this.mediaRecorderOnDataAvailable.bind(this),this.mediaRecorderOnStop=this.mediaRecorderOnStop.bind(this),this.mediaRecorderOnError=this.mediaRecorderOnError.bind(this),this.appointmentNumber=r}logData(){var e;if("development"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_OSCAR_URL:"https://oscaremr.quipohealth.com/oscar",REACT_APP_WS_URL:"wss://api.aiscribe.quipohealth.com/ws",REACT_APP_SERVER_URL:"https://api.aiscribe.quipohealth.com/api",REACT_APP_PROVIDER_WINDOW:"https://oscaremr.quipohealth.com/oscar/provider",REACT_APP_ENCOUNTER_WINDOW:"https://oscaremr.quipohealth.com/oscar/casemgmt",REACT_APP_BACKEND_URL:"https://api.aiscribe.quipohealth.com/api/twilio",REACT_APP_WSS_URL:"wss://api.aiscribe.quipohealth.com/ws/twilio/call/",REACT_APP_QUIPO_BASE_URL:"https://api-dev.quipohealth.com/integration/service-integrations-api/extension",REACT_APP_AGORA_APP_ID:"4a186723661348bbb917bf41c12e1ed1"}.REACT_APP_MODE&&null!==(e=this.config)&&void 0!==e&&e.logging){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];console.log("[scribe]: ",n)}}wsOnOpen(e){this.connectionActive=!0,this.logData("WebSocket connection established.",e)}wsOnClose(e){e.wasClean?this.logData("WebSocket closed cleanly, code=".concat(e.code,", reason=").concat(e.reason)):this.logData("WebSocket closed unexpectedly, code=".concat(e.code,", reason=").concat(e.reason)),this.connectionActive=!1}wsOnError(e){this.connectionActive=!1,this.logData("WebSocket error:",e)}wsOnMessage(e){this.logData("ws messages",e),this.cb(e)}initWSConnection(e){this.ws=new WebSocket(e),this.ws.binaryType="blob",this.ws.onopen=this.wsOnOpen,this.ws.onclose=this.wsOnClose,this.ws.onerror=this.wsOnError,this.ws.onmessage=this.wsOnMessage}closeWSConnection(){this.ws&&this.connectionActive&&(this.logData("Closing WebSocket connection..."),this.ws.close())}mediaRecorderOnDataAvailable(e){this.audioChunks.push(e.data)}mediaRecorderOnStop(e){this.mediaRecorder.stream&&(this.logData("Media recorder stoping...",e),this.mediaRecorder.stream.getTracks().forEach((e=>e.stop()))),this.logData("Media recorder stopped.",e)}mediaRecorderOnError(e){this.logData("Error while recording.",e)}initializeMediaRecorder(e){var t,n;const r=navigator.userAgent.indexOf("Mac")>-1;this.mediaOption=r?{}:{mimeType:null===(t=this.config)||void 0===t?void 0:t.mimeType},this.logData(r,this.mediaOption),this.mediaRecorder=new MediaRecorder(e,this.mediaOption),this.mediaRecorder.start(null===(n=this.config)||void 0===n?void 0:n.streaSize),this.mediaRecorder.ondataavailable=this.mediaRecorderOnDataAvailable,this.mediaRecorder.onstop=this.mediaRecorderOnStop,this.mediaRecorder.onerror=this.mediaRecorderOnError}async transcribeFullAudio(e,t){this.logData("Transcribing Full Audio:-"),e(null),t(!0)}async getMicrophoneAccess(e,t){try{if(navigator.permissions&&navigator.permissions.query)try{const n=await navigator.permissions.query({name:"microphone"});if("granted"===n.state)e();else if("prompt"===n.state)try{await navigator.mediaDevices.getUserMedia({audio:!0}),e()}catch(xi){t("Microphone access denied after prompt.")}else t("Microphone access denied.")}catch(xi){(0,r.O)("error","Permission query failed, falling back to getUserMedia",!1),await this.fallbackToGetUserMedia(e,t,xi.message)}else this.logData("Permissions API not supported, using getUserMedia directly."),await this.fallbackToGetUserMedia(e,t)}catch(xi){t("Unexpected error: "+xi.message)}}async fallbackToGetUserMedia(e,t,n){try{await navigator.mediaDevices.getUserMedia({audio:!0}),e()}catch(xi){t("Microphone access denied or error occurred: "+(n?n+"; ":"")+xi.message)}}}},7188:(e,t,n)=>{n.r(t),n.d(t,{DeepgramLive:()=>i});var r=n(9966);const i=e=>class extends e{constructor(){super(...arguments),this.heartbeatInterval=null}wsOnMessage(e){const t=null===e||void 0===e?void 0:e.data;t?this.cb(t):(0,r.O)("error","Invalid data received :: ".concat(e),!1)}mediaRecorderOnDataAvailable(e){this.audioChunks.push(e.data);e.data.arrayBuffer().then((async e=>{try{const t=await(async e=>{const t=new Uint8Array(e);return btoa(t.reduce(((e,t)=>e+String.fromCharCode(t)),""))})(e),n=JSON.stringify({appt_id:this.appointmentNumber,audio:t});this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(n)}catch(t){(0,r.O)("error","Error converting audio to base64: ".concat(t),!1)}}))}startHeartbeat(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval((()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=JSON.stringify({type:"KeepAlive"});this.ws.send(e),this.ws.send(e),this.logData("Sent heartbeat: KeepAlive x2")}else this.logData("WebSocket is not open. Stopping heartbeat."),clearInterval(this.heartbeatInterval),this.heartbeatInterval=null}),3e3)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null,this.logData("Stopped heartbeat."))}startRecording(){this.ws&&this.ws.readyState===WebSocket.OPEN?(this.logData("WebSocket is already open, starting recording..."),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((e=>{this.initializeMediaRecorder(e),this.mediaRecorder?this.logData("MediaRecorder initialized with state: ".concat(this.mediaRecorder.state," and id: ").concat(this.mediaRecorder.stream.id)):this.logData("MediaRecorder could not be initialized.")})).catch((e=>{this.logData("Error accessing microphone:",e)}))):(this.initWSConnection(this.wsUrl),this.ws.onopen=e=>{this.wsOnOpen(e),this.logData("WebSocket connected, starting recording..."),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((e=>{this.initializeMediaRecorder(e),this.mediaRecorder?this.logData("MediaRecorder initialized with state: ".concat(this.mediaRecorder.state," and id: ").concat(this.mediaRecorder.stream.id)):this.logData("MediaRecorder could not be initialized.")})).catch((e=>{this.logData("Error accessing microphone:",e)}))},this.ws.onclose=e=>{this.logData("=================[ CLOSING WEBSOCKET ]=================")})}pauseRecording(){this.mediaRecorder&&"recording"===this.mediaRecorder.state?(this.mediaRecorder.pause(),this.startHeartbeat(),this.logData("Recording paused")):(0,r.O)("error","Cannot pause recording - MediaRecorder is not recording or is null.",!1)}resumeRecording(){this.stopHeartbeat(),this.logData("Resuming recording..."),this.mediaRecorder&&"paused"===this.mediaRecorder.state?(this.mediaRecorder.resume(),this.logData("Recording resumed")):(0,r.O)("error","Cannot resume recording - MediaRecorder is not paused or is null.",!1)}async stopRecording(e,t){try{this.mediaRecorder.stop(),await new Promise((e=>{this.mediaRecorder.onstop=e})),this.logData("MediaRecorder stopped with state: ".concat(this.mediaRecorder.state)),this.mediaRecorder.stream&&this.mediaRecorder.stream.getTracks().forEach((e=>{"live"===e.readyState&&(this.logData("Stopping track: ".concat(e.kind,", track id: ").concat(e.id)),e.stop())})),this.stopHeartbeat(),this.ws&&this.ws.readyState!==WebSocket.CLOSED&&this.ws.readyState!==WebSocket.CLOSING?(this.logData("Closing WebSocket connection."),this.ws.close()):this.logData("WebSocket is already closed or in the process of closing.");return await this.transcribeFullAudio(e,t)}catch(n){throw this.logData("Error in stopRecording: ".concat(n.message)),n}}}},2642:(e,t,n)=>{n.r(t),n.d(t,{FullAudioTranscriber:()=>i});var r=n(9966);const i=e=>class extends e{processRecording(){var e,t;return this.audioBlob=new Blob(this.audioChunks,{type:null===(e=this.config)||void 0===e?void 0:e.mimeType}),this.audioFile=new File([this.audioBlob],"recording.webm",{type:null===(t=this.config)||void 0===t?void 0:t.mimeType}),this.audioChunks=[],this.audioFile}async transcribeFullAudio(){try{if(this.audioFile=this.processRecording(),!this.audioFile)throw new Error("No audio file to transcribe");const t=new FormData;t.append("file",this.audioFile);const n=3,i=1e3;let a=0,o=null;for(;a<n;){a++;try{const e=await fetch("".concat(this.baseURL,"/transcribe?appt_id=").concat(this.appointmentNumber),{method:"POST",body:t});if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));const n=await e.json();if(n.length>0&&null!==n&&void 0!==n&&n.text){o=null===n||void 0===n?void 0:n.text;break}o=(null===n||void 0===n?void 0:n.text)||null;break}catch(e){(0,r.O)("error","Attempt ".concat(a," failed: ").concat(e.message),!1),a<n&&await new Promise((e=>setTimeout(e,i)))}}return o}catch(e){throw this.logData("Transcription failed."),e}}}},7036:(e,t,n)=>{n.r(t),n.d(t,{WhisperLive:()=>r});const r=e=>class extends e{wsOnMessage(e){const t=JSON.parse(null===e||void 0===e?void 0:e.data);if("segments"in t)for(const n in t.segments)" Thanks for watching!"!==t.segments[n].text&&(this.speechSegments[t.segments[n].start]=t.segments[n].text);else"SERVER_READY"===t.message&&(this.isServerReady=!0);this.cb(this.speechSegments)}async transmitAudioToWS(e){await this.context.audioWorklet.addModule("/worklets/audioProcessor.js");const t=this.context.createMediaStreamSource(e),n=new AudioWorkletNode(this.context,"audio-processor");this.initializeMediaRecorder(e),n.port.onmessage=e=>{var t;const n=e.data;this.connectionActive&&(null===(t=this.ws)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&this.ws.send(n)},t.connect(n),n.connect(this.context.destination)}startRecording(){this.ws&&this.ws.readyState===WebSocket.OPEN||this.initWSConnection(this.wsUrl),this.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext);try{navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((e=>this.transmitAudioToWS(e)))}catch(e){this.logData("Error during recording initialization:",e)}}pauseRecording(){this.context&&"closed"!==this.context.state&&this.context.suspend().then((()=>{this.mediaRecorder.pause(),this.logData("Recording paused.")}))}resumeRecording(){this.context&&"closed"!==this.context.state&&this.context.resume().then((()=>{this.mediaRecorder.resume(),this.logData("Recording resumed.")}))}async stopRecording(e,t){try{var n;if(this.context&&"closed"!==this.context.state)return await this.context.close(),this.mediaRecorder.stop(),(null===(n=this.ws)||void 0===n?void 0:n.readyState)===WebSocket.OPEN&&(this.logData("Closing WebSocket connection."),this.ws.close()),await this.transcribeFullAudio(e,t),"Recording stopped and transcribed successfully.";{const e="No active context or context already closed.";throw this.logData(e),new Error(e)}}catch(r){throw this.logData("Error in stopRecording: ".concat(r.message)),r}}}},9966:(e,t,n)=>{n.d(t,{O:()=>s});var r=n(9379),i=n(2339),a=n(579);let o=!1;const s=function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if("development"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_OSCAR_URL:"https://oscaremr.quipohealth.com/oscar",REACT_APP_WS_URL:"wss://api.aiscribe.quipohealth.com/ws",REACT_APP_SERVER_URL:"https://api.aiscribe.quipohealth.com/api",REACT_APP_PROVIDER_WINDOW:"https://oscaremr.quipohealth.com/oscar/provider",REACT_APP_ENCOUNTER_WINDOW:"https://oscaremr.quipohealth.com/oscar/casemgmt",REACT_APP_BACKEND_URL:"https://api.aiscribe.quipohealth.com/api/twilio",REACT_APP_WSS_URL:"wss://api.aiscribe.quipohealth.com/ws/twilio/call/",REACT_APP_QUIPO_BASE_URL:"https://api-dev.quipohealth.com/integration/service-integrations-api/extension",REACT_APP_AGORA_APP_ID:"4a186723661348bbb917bf41c12e1ed1"}.REACT_APP_MODE){switch(e){case"error":console.error("".concat(t));break;case"warning":console.warn("".concat(t));break;case"info":console.info("".concat(t));break;default:console.log("".concat(t))}n&&((e,t)=>{if(o)return;const n=e=>{let{style:t}=e;return(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",style:(0,r.A)({fill:"#007bff",animation:"pulse 1s infinite"},t),children:(0,a.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"})})};o=!0,i.Ay.dismiss();const c={success:e=>i.Ay.success(e),error:e=>i.Ay.error(e),info:e=>i.Ay.custom((t=>(0,a.jsxs)("div",{className:"qpe-toast",style:{padding:"10px 20px",backgroundColor:"#f0f0f0",borderRadius:"8px",color:"#333",display:"flex",alignItems:"center",fontSize:"14px"},children:[(0,a.jsx)(n,{style:{marginRight:"10px",color:"#007bff",fontSize:"18px",animation:"pulse 1s infinite"}}),(0,a.jsx)("span",{children:e})]})))}[null===e||void 0===e?void 0:e.toLowerCase()];c?c(t):s("error",'Invalid Toast Type: "'.concat(e,'" '),!1),setTimeout((()=>{o=!1}),3e3)})(e,"".concat(t))}}},2730:(e,t,n)=>{var r=n(5043),i=n(8853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function c(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){_[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];_[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){_[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){_[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){_[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){_[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){_[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){_[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){_[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function E(e){return e[1].toUpperCase()}function v(e,t,n,r){var i=_.hasOwnProperty(t)?_[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!u.call(f,e)||!u.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,E);_[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,E);_[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,E);_[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){_[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),_.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){_[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,S=Symbol.for("react.element"),b=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),A=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),L=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var k=Symbol.iterator;function x(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=k&&e[k]||e["@@iterator"])?e:null}var M,U=Object.assign;function F(e){if(void 0===M)try{throw Error()}catch(sa){var t=sa.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var j=!1;function V(e,t){if(!e||j)return"";j=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(da){var r=da}Reflect.construct(e,[],t)}else{try{t.call()}catch(da){r=da}e.call(t.prototype)}else{try{throw Error()}catch(da){r=da}e()}}catch(da){if(da&&r&&"string"===typeof da.stack){for(var i=da.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s]){var c="\n"+i[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=o&&0<=s);break}}}finally{j=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function B(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case T:return"Fragment";case b:return"Portal";case w:return"Profiler";case C:return"StrictMode";case N:return"Suspense";case O:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case R:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case P:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case L:t=e._payload,e=e._init;try{return G(e(t))}catch(sa){}}return null}function W(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function z(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(ga){return e.body}}function J(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Z(e,t){Q(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ae(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,de=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction((function(){return e(t,n)}))}:e}((function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function ue(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=fe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(he).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]}))}));var _e=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ge(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function Ee(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function ye(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Se=null,be=null,Te=null;function Ce(e){if(e=Ei(e)){if("function"!==typeof Se)throw Error(a(280));var t=e.stateNode;t&&(t=yi(t),Se(e.stateNode,e.type,t))}}function we(e){be?Te?Te.push(e):Te=[e]:be=e}function Re(){if(be){var e=be,t=Te;if(Te=be=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Ae(e,t){return e(t)}function Ie(){}var Ne=!1;function Oe(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return Ae(e,t,n)}finally{Ne=!1,(null!==be||null!==Te)&&(Ie(),Re())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=yi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Le=!1;if(d)try{var De={};Object.defineProperty(De,"passive",{get:function(){Le=!0}}),window.addEventListener("test",De,De),window.removeEventListener("test",De,De)}catch(ia){Le=!1}function ke(e,t,n,r,i,a,o,s,c){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(ma){this.onError(ma)}}var xe=!1,Me=null,Ue=!1,Fe=null,je={onError:function(e){xe=!0,Me=e}};function Ve(e,t,n,r,i,a,o,s,c){xe=!1,Me=null,ke.apply(je,arguments)}function Be(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(Be(e)!==e)throw Error(a(188))}function He(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=Be(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return We(i),e;if(o===r)return We(i),t;o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,c=i.child;c;){if(c===n){s=!0,n=i,r=o;break}if(c===r){s=!0,r=i,n=o;break}c=c.sibling}if(!s){for(c=o.child;c;){if(c===n){s=!0,n=o,r=i;break}if(c===r){s=!0,r=o,n=i;break}c=c.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e),null!==e?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var ze=i.unstable_scheduleCallback,Ke=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,Je=i.unstable_requestPaint,Xe=i.unstable_now,Qe=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,$e=i.unstable_UserBlockingPriority,et=i.unstable_NormalPriority,tt=i.unstable_LowPriority,nt=i.unstable_IdlePriority,rt=null,it=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/st|0)|0},ot=Math.log,st=Math.LN2;var ct=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ut(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~i;0!==s?r=dt(s):0!==(a&=o)&&(r=dt(a))}else 0!==(o=n&~i)?r=dt(o):0!==a&&(r=dt(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(a=t&-t)||16===i&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-at(t)),r|=e[n],t&=~i;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ft(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _t(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function gt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var Et=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var yt,St,bt,Tt,Ct,wt=!1,Rt=[],At=null,It=null,Nt=null,Ot=new Map,Pt=new Map,Lt=[],Dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":Ot.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function xt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},null!==t&&(null!==(t=Ei(t))&&St(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Mt(e){var t=gi(e.target);if(null!==t){var n=Be(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void Ct(e.priority,(function(){bt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=Ei(n))&&St(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ve=r,n.target.dispatchEvent(r),ve=null,t.shift()}return!0}function Ft(e,t,n){Ut(e)&&n.delete(t)}function jt(){wt=!1,null!==At&&Ut(At)&&(At=null),null!==It&&Ut(It)&&(It=null),null!==Nt&&Ut(Nt)&&(Nt=null),Ot.forEach(Ft),Pt.forEach(Ft)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,wt||(wt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,jt)))}function Bt(e){function t(t){return Vt(t,e)}if(0<Rt.length){Vt(Rt[0],e);for(var n=1;n<Rt.length;n++){var r=Rt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==At&&Vt(At,e),null!==It&&Vt(It,e),null!==Nt&&Vt(Nt,e),Ot.forEach(t),Pt.forEach(t),n=0;n<Lt.length;n++)(r=Lt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Lt.length&&null===(n=Lt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Lt.shift()}var Gt=y.ReactCurrentBatchConfig,Wt=!0;function Ht(e,t,n,r){var i=Et,a=Gt.transition;Gt.transition=null;try{Et=1,zt(e,t,n,r)}finally{Et=i,Gt.transition=a}}function qt(e,t,n,r){var i=Et,a=Gt.transition;Gt.transition=null;try{Et=4,zt(e,t,n,r)}finally{Et=i,Gt.transition=a}}function zt(e,t,n,r){if(Wt){var i=Yt(e,t,n,r);if(null===i)Wr(e,t,r,Kt,n),kt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return At=xt(At,e,t,n,r,i),!0;case"dragenter":return It=xt(It,e,t,n,r,i),!0;case"mouseover":return Nt=xt(Nt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return Ot.set(a,xt(Ot.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,Pt.set(a,xt(Pt.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(kt(e,r),4&t&&-1<Dt.indexOf(e)){for(;null!==i;){var a=Ei(i);if(null!==a&&yt(a),null===(a=Yt(e,t,n,r))&&Wr(e,t,r,Kt,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Wr(e,t,r,null,n)}}var Kt=null;function Yt(e,t,n,r){if(Kt=null,null!==(e=gi(e=ye(r))))if(null===(t=Be(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case Ze:return 1;case $e:return 4;case et:case tt:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Xt=null,Qt=null,Zt=null;function $t(){if(Zt)return Zt;var e,t,n=Qt,r=n.length,i="value"in Xt?Xt.value:Xt.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function en(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function tn(){return!0}function nn(){return!1}function rn(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?tn:nn,this.isPropagationStopped=nn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=tn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=tn)},persist:function(){},isPersistent:tn}),t}var an,on,sn,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=rn(cn),dn=U({},cn,{view:0,detail:0}),un=rn(dn),hn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==sn&&(sn&&"mousemove"===e.type?(an=e.screenX-sn.screenX,on=e.screenY-sn.screenY):on=an=0,sn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=rn(hn),fn=rn(U({},hn,{dataTransfer:0})),mn=rn(U({},dn,{relatedTarget:0})),_n=rn(U({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),gn=U({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),En=rn(gn),vn=rn(U({},cn,{data:0})),yn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=bn[e])&&!!t[e]}function Cn(){return Tn}var wn=U({},dn,{key:function(e){if(e.key){var t=yn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=en(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?en(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?en(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=rn(wn),An=rn(U({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=rn(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Nn=rn(U({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),On=U({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=rn(On),Ln=[9,13,27,32],Dn=d&&"CompositionEvent"in window,kn=null;d&&"documentMode"in document&&(kn=document.documentMode);var xn=d&&"TextEvent"in window&&!kn,Mn=d&&(!Dn||kn&&8<kn&&11>=kn),Un=String.fromCharCode(32),Fn=!1;function jn(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Bn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function Hn(e,t,n,r){we(r),0<(t=qr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,zn=null;function Kn(e){Ur(e,0)}function Yn(e){if(K(vi(e)))return e}function Jn(e,t){if("change"===e)return t}var Xn=!1;if(d){var Qn;if(d){var Zn="oninput"in document;if(!Zn){var $n=document.createElement("div");$n.setAttribute("oninput","return;"),Zn="function"===typeof $n.oninput}Qn=Zn}else Qn=!1;Xn=Qn&&(!document.documentMode||9<document.documentMode)}function er(){qn&&(qn.detachEvent("onpropertychange",tr),zn=qn=null)}function tr(e){if("value"===e.propertyName&&Yn(zn)){var t=[];Hn(t,zn,e,ye(e)),Oe(Kn,t)}}function nr(e,t,n){"focusin"===e?(er(),zn=n,(qn=t).attachEvent("onpropertychange",tr)):"focusout"===e&&er()}function rr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(zn)}function ir(e,t){if("click"===e)return Yn(t)}function ar(e,t){if("input"===e||"change"===e)return Yn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function sr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!u.call(t,i)||!or(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ur(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(ha){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function hr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=ur(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&hr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=void 0===r.end?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=lr(n,a);var o=lr(n,r);i&&o&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=d&&"documentMode"in document&&11>=document.documentMode,mr=null,_r=null,gr=null,Er=!1;function vr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;Er||null==mr||mr!==Y(r)||("selectionStart"in(r=mr)&&hr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},gr&&sr(gr,r)||(gr=r,0<(r=qr(_r,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function yr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Sr={animationend:yr("Animation","AnimationEnd"),animationiteration:yr("Animation","AnimationIteration"),animationstart:yr("Animation","AnimationStart"),transitionend:yr("Transition","TransitionEnd")},br={},Tr={};function Cr(e){if(br[e])return br[e];if(!Sr[e])return e;var t,n=Sr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Tr)return br[e]=n[t];return e}d&&(Tr=document.createElement("div").style,"AnimationEvent"in window||(delete Sr.animationend.animation,delete Sr.animationiteration.animation,delete Sr.animationstart.animation),"TransitionEvent"in window||delete Sr.transitionend.transition);var wr=Cr("animationend"),Rr=Cr("animationiteration"),Ar=Cr("animationstart"),Ir=Cr("transitionend"),Nr=new Map,Or="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Nr.set(e,t),c(t,[e])}for(var Lr=0;Lr<Or.length;Lr++){var Dr=Or[Lr];Pr(Dr.toLowerCase(),"on"+(Dr[0].toUpperCase()+Dr.slice(1)))}Pr(wr,"onAnimationEnd"),Pr(Rr,"onAnimationIteration"),Pr(Ar,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Ir,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xr=new Set("cancel close invalid load scroll toggle".split(" ").concat(kr));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,s,c,l){if(Ve.apply(this,arguments),xe){if(!xe)throw Error(a(198));var d=Me;xe=!1,Me=null,Ue||(Ue=!0,Fe=d)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break e;Mr(i,s,l),a=c}else for(o=0;o<r.length;o++){if(c=(s=r[o]).instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break e;Mr(i,s,l),a=c}}}if(Ue)throw e=Fe,Ue=!1,Fe=null,e}function Fr(e,t){var n=t[fi];void 0===n&&(n=t[fi]=new Set);var r=e+"__bubble";n.has(r)||(Gr(t,e,2,!1),n.add(r))}function jr(e,t,n){var r=0;t&&(r|=4),Gr(n,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function Br(e){if(!e[Vr]){e[Vr]=!0,o.forEach((function(t){"selectionchange"!==t&&(xr.has(t)||jr(t,!1,e),jr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,jr("selectionchange",!1,t))}}function Gr(e,t,n,r){switch(Jt(t)){case 1:var i=Ht;break;case 4:i=qt;break;default:i=zt}n=i.bind(null,t,n,e),i=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Wr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var c=o.tag;if((3===c||4===c)&&((c=o.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=gi(s)))return;if(5===(c=o.tag)||6===c){r=a=o;continue e}s=s.parentNode}}r=r.return}Oe((function(){var r=a,i=ye(n),o=[];e:{var s=Nr.get(e);if(void 0!==s){var c=ln,l=e;switch(e){case"keypress":if(0===en(n))break e;case"keydown":case"keyup":c=Rn;break;case"focusin":l="focus",c=mn;break;case"focusout":l="blur",c=mn;break;case"beforeblur":case"afterblur":c=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=fn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=In;break;case wr:case Rr:case Ar:c=_n;break;case Ir:c=Nn;break;case"scroll":c=un;break;case"wheel":c=Pn;break;case"copy":case"cut":case"paste":c=En;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=An}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==s?s+"Capture":null:s;d=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Pe(f,h))&&d.push(Hr(f,m,p)))),u)break;f=f.return}0<d.length&&(s=new c(s,l,null,n,i),o.push({event:s,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===ve||!(l=n.relatedTarget||n.fromElement)||!gi(l)&&!l[pi])&&(c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(l=(l=n.relatedTarget||n.toElement)?gi(l):null)&&(l!==(u=Be(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(c=null,l=r),c!==l)){if(d=pn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=An,m="onPointerLeave",h="onPointerEnter",f="pointer"),u=null==c?s:vi(c),p=null==l?s:vi(l),(s=new d(m,f+"leave",c,n,i)).target=u,s.relatedTarget=p,m=null,gi(i)===r&&((d=new d(h,f+"enter",l,n,i)).target=p,d.relatedTarget=u,m=d),u=m,c&&l)e:{for(h=l,f=0,p=d=c;p;p=zr(p))f++;for(p=0,m=h;m;m=zr(m))p++;for(;0<f-p;)d=zr(d),f--;for(;0<p-f;)h=zr(h),p--;for(;f--;){if(d===h||null!==h&&d===h.alternate)break e;d=zr(d),h=zr(h)}d=null}else d=null;null!==c&&Kr(o,s,c,d,!1),null!==l&&null!==u&&Kr(o,u,l,d,!0)}if("select"===(c=(s=r?vi(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var _=Jn;else if(Wn(s))if(Xn)_=ar;else{_=rr;var g=nr}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(_=ir);switch(_&&(_=_(e,r))?Hn(o,_,n,i):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?vi(r):window,e){case"focusin":(Wn(g)||"true"===g.contentEditable)&&(mr=g,_r=r,gr=null);break;case"focusout":gr=_r=mr=null;break;case"mousedown":Er=!0;break;case"contextmenu":case"mouseup":case"dragend":Er=!1,vr(o,n,i);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":vr(o,n,i)}var E;if(Dn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Bn?jn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Mn&&"ko"!==n.locale&&(Bn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Bn&&(E=$t()):(Qt="value"in(Xt=i)?Xt.value:Xt.textContent,Bn=!0)),0<(g=qr(r,v)).length&&(v=new vn(v,e,null,n,i),o.push({event:v,listeners:g}),E?v.data=E:null!==(E=Vn(n))&&(v.data=E))),(E=xn?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Un);case"textInput":return(e=t.data)===Un&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Bn)return"compositionend"===e||!Dn&&jn(e,t)?(e=$t(),Zt=Qt=Xt=null,Bn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(i=new vn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=E))}Ur(o,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Pe(e,n))&&r.unshift(Hr(e,a,i)),null!=(a=Pe(e,t))&&r.push(Hr(e,a,i))),e=e.return}return r}function zr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==l&&(s=l,i?null!=(c=Pe(n,a))&&o.unshift(Hr(n,c,s)):i||null!=(c=Pe(n,a))&&o.push(Hr(n,c,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function Xr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Jr,"")}function Qr(e,t,n){if(t=Xr(t),Xr(e)!==t&&n)throw Error(a(425))}function Zr(){}var $r=null,ei=null;function ti(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ni="function"===typeof setTimeout?setTimeout:void 0,ri="function"===typeof clearTimeout?clearTimeout:void 0,ii="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ii?function(e){return ii.resolve(null).then(e).catch(oi)}:ni;function oi(e){setTimeout((function(){throw e}))}function si(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Bt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Bt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function li(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),ui="__reactFiber$"+di,hi="__reactProps$"+di,pi="__reactContainer$"+di,fi="__reactEvents$"+di,mi="__reactListeners$"+di,_i="__reactHandles$"+di;function gi(e){var t=e[ui];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[ui]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=li(e);null!==e;){if(n=e[ui])return n;e=li(e)}return t}n=(e=n).parentNode}return null}function Ei(e){return!(e=e[ui]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function vi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function yi(e){return e[hi]||null}var Si=[],bi=-1;function Ti(e){return{current:e}}function Ci(e){0>bi||(e.current=Si[bi],Si[bi]=null,bi--)}function wi(e,t){bi++,Si[bi]=e.current,e.current=t}var Ri={},Ai=Ti(Ri),Ii=Ti(!1),Ni=Ri;function Oi(e,t){var n=e.type.contextTypes;if(!n)return Ri;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Li(){Ci(Ii),Ci(Ai)}function Di(e,t,n){if(Ai.current!==Ri)throw Error(a(168));wi(Ai,t),wi(Ii,n)}function ki(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,W(e)||"Unknown",i));return U({},n,r)}function xi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ri,Ni=Ai.current,wi(Ai,e),wi(Ii,Ii.current),!0}function Mi(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=ki(e,t,Ni),r.__reactInternalMemoizedMergedChildContext=e,Ci(Ii),Ci(Ai),wi(Ai,e)):Ci(Ii),wi(Ii,n)}var Ui=null,Fi=!1,ji=!1;function Vi(e){null===Ui?Ui=[e]:Ui.push(e)}function Bi(){if(!ji&&null!==Ui){ji=!0;var e=0,t=Et;try{var n=Ui;for(Et=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ui=null,Fi=!1}catch(i){throw null!==Ui&&(Ui=Ui.slice(e+1)),ze(Ze,Bi),i}finally{Et=t,ji=!1}}return null}var Gi=[],Wi=0,Hi=null,qi=0,zi=[],Ki=0,Yi=null,Ji=1,Xi="";function Qi(e,t){Gi[Wi++]=qi,Gi[Wi++]=Hi,Hi=e,qi=t}function Zi(e,t,n){zi[Ki++]=Ji,zi[Ki++]=Xi,zi[Ki++]=Yi,Yi=e;var r=Ji;e=Xi;var i=32-at(r)-1;r&=~(1<<i),n+=1;var a=32-at(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Ji=1<<32-at(t)+i|n<<i|r,Xi=a+e}else Ji=1<<a|n<<i|r,Xi=e}function $i(e){null!==e.return&&(Qi(e,1),Zi(e,1,0))}function ea(e){for(;e===Hi;)Hi=Gi[--Wi],Gi[Wi]=null,qi=Gi[--Wi],Gi[Wi]=null;for(;e===Yi;)Yi=zi[--Ki],zi[Ki]=null,Xi=zi[--Ki],zi[Ki]=null,Ji=zi[--Ki],zi[Ki]=null}var ta=null,na=null,ra=!1,aa=null;function oa(e,t){var n=Bl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ca(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ta=e,na=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ta=e,na=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Yi?{id:Ji,overflow:Xi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Bl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ta=e,na=null,!0);default:return!1}}function pa(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function fa(e){if(ra){var t=na;if(t){var n=t;if(!ca(e,t)){if(pa(e))throw Error(a(418));t=ci(n.nextSibling);var r=ta;t&&ca(e,t)?oa(r,n):(e.flags=-4097&e.flags|2,ra=!1,ta=e)}}else{if(pa(e))throw Error(a(418));e.flags=-4097&e.flags|2,ra=!1,ta=e}}}function _a(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ta=e}function Ea(e){if(e!==ta)return!1;if(!ra)return _a(e),ra=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ti(e.type,e.memoizedProps)),t&&(t=na)){if(pa(e))throw va(),Error(a(418));for(;t;)oa(e,t),t=ci(t.nextSibling)}if(_a(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){na=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}na=null}}else na=ta?ci(e.stateNode.nextSibling):null;return!0}function va(){for(var e=na;e;)e=ci(e.nextSibling)}function ya(){na=ta=null,ra=!1}function Sa(e){null===aa?aa=[e]:aa.push(e)}var ba=y.ReactCurrentBatchConfig;function Ta(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Ca(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function wa(e){return(0,e._init)(e._payload)}function Ra(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Wl(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Kl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function l(e,t,n,r){var a=n.type;return a===T?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===L&&wa(a)===t.type)?((r=i(t,n.props)).ref=Ta(e,t,n),r.return=e,r):((r=Hl(n.type,n.key,n.props,null,e.mode,r)).ref=Ta(e,t,n),r.return=e,r)}function d(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Yl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function u(e,t,n,r,a){return null===t||7!==t.tag?((t=ql(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Kl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case S:return(n=Hl(t.type,t.key,t.props,null,e.mode,n)).ref=Ta(e,null,t),n.return=e,n;case b:return(t=Yl(t,e.mode,n)).return=e,t;case L:return h(e,(0,t._init)(t._payload),n)}if(te(t)||x(t))return(t=ql(t,e.mode,n,null)).return=e,t;Ca(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case S:return n.key===i?l(e,t,n,r):null;case b:return n.key===i?d(e,t,n,r):null;case L:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||x(n))return null!==i?null:u(e,t,n,r,null);Ca(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case S:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case b:return d(t,e=e.get(null===r.key?n:r.key)||null,r,i);case L:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||x(r))return u(t,e=e.get(n)||null,r,i,null);Ca(t,r)}return null}function m(i,a,s,c){for(var l=null,d=null,u=a,m=a=0,_=null;null!==u&&m<s.length;m++){u.index>m?(_=u,u=null):_=u.sibling;var g=p(i,u,s[m],c);if(null===g){null===u&&(u=_);break}e&&u&&null===g.alternate&&t(i,u),a=o(g,a,m),null===d?l=g:d.sibling=g,d=g,u=_}if(m===s.length)return n(i,u),ra&&Qi(i,m),l;if(null===u){for(;m<s.length;m++)null!==(u=h(i,s[m],c))&&(a=o(u,a,m),null===d?l=u:d.sibling=u,d=u);return ra&&Qi(i,m),l}for(u=r(i,u);m<s.length;m++)null!==(_=f(u,i,m,s[m],c))&&(e&&null!==_.alternate&&u.delete(null===_.key?m:_.key),a=o(_,a,m),null===d?l=_:d.sibling=_,d=_);return e&&u.forEach((function(e){return t(i,e)})),ra&&Qi(i,m),l}function _(i,s,c,l){var d=x(c);if("function"!==typeof d)throw Error(a(150));if(null==(c=d.call(c)))throw Error(a(151));for(var u=d=null,m=s,_=s=0,g=null,E=c.next();null!==m&&!E.done;_++,E=c.next()){m.index>_?(g=m,m=null):g=m.sibling;var v=p(i,m,E.value,l);if(null===v){null===m&&(m=g);break}e&&m&&null===v.alternate&&t(i,m),s=o(v,s,_),null===u?d=v:u.sibling=v,u=v,m=g}if(E.done)return n(i,m),ra&&Qi(i,_),d;if(null===m){for(;!E.done;_++,E=c.next())null!==(E=h(i,E.value,l))&&(s=o(E,s,_),null===u?d=E:u.sibling=E,u=E);return ra&&Qi(i,_),d}for(m=r(i,m);!E.done;_++,E=c.next())null!==(E=f(m,i,_,E.value,l))&&(e&&null!==E.alternate&&m.delete(null===E.key?_:E.key),s=o(E,s,_),null===u?d=E:u.sibling=E,u=E);return e&&m.forEach((function(e){return t(i,e)})),ra&&Qi(i,_),d}return function e(r,a,o,c){if("object"===typeof o&&null!==o&&o.type===T&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case S:e:{for(var l=o.key,d=a;null!==d;){if(d.key===l){if((l=o.type)===T){if(7===d.tag){n(r,d.sibling),(a=i(d,o.props.children)).return=r,r=a;break e}}else if(d.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===L&&wa(l)===d.type){n(r,d.sibling),(a=i(d,o.props)).ref=Ta(r,d,o),a.return=r,r=a;break e}n(r,d);break}t(r,d),d=d.sibling}o.type===T?((a=ql(o.props.children,r.mode,c,o.key)).return=r,r=a):((c=Hl(o.type,o.key,o.props,null,r.mode,c)).ref=Ta(r,a,o),c.return=r,r=c)}return s(r);case b:e:{for(d=o.key;null!==a;){if(a.key===d){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(r,a.sibling),(a=i(a,o.children||[])).return=r,r=a;break e}n(r,a);break}t(r,a),a=a.sibling}(a=Yl(o,r.mode,c)).return=r,r=a}return s(r);case L:return e(r,a,(d=o._init)(o._payload),c)}if(te(o))return m(r,a,o,c);if(x(o))return _(r,a,o,c);Ca(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(r,a.sibling),(a=i(a,o)).return=r,r=a):(n(r,a),(a=Kl(o,r.mode,c)).return=r,r=a),s(r)):n(r,a)}}var Ia=Ra(!0),Oa=Ra(!1),Pa=Ti(null),La=null,Da=null,ka=null;function xa(){ka=Da=La=null}function Ma(e){var t=Pa.current;Ci(Pa),e._currentValue=t}function Ua(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Fa(e,t){La=e,ka=Da=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ns=!0),e.firstContext=null)}function ja(e){var t=e._currentValue;if(ka!==e)if(e={context:e,memoizedValue:t,next:null},null===Da){if(null===La)throw Error(a(308));Da=e,La.dependencies={lanes:0,firstContext:e}}else Da=Da.next=e;return t}var Va=null;function Ba(e){null===Va?Va=[e]:Va.push(e)}function Ga(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ba(t)):(n.next=i.next,i.next=n),t.interleaved=n,Wa(e,r)}function Wa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ha=!1;function qa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function za(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ka(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ya(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Fc)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Wa(e,n)}return null===(i=r.interleaved)?(t.next=t,Ba(r)):(t.next=i.next,i.next=t),r.interleaved=t,Wa(e,n)}function Ja(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,gt(e,n)}}function Xa(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Qa(e,t,n,r){var i=e.updateQueue;Ha=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var c=s,l=c.next;c.next=null,null===o?a=l:o.next=l,o=c;var d=e.alternate;null!==d&&((s=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===s?d.firstBaseUpdate=l:s.next=l,d.lastBaseUpdate=c))}if(null!==a){var u=i.baseState;for(o=0,d=l=c=null,s=a;;){var h=s.lane,p=s.eventTime;if((r&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){u=f.call(p,u,h);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,u,h):f)||void 0===h)break e;u=U({},u,h);break e;case 2:Ha=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(l=d=p,c=u):d=d.next=p,o|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(h=s).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===d&&(c=u),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=d,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);zc|=o,e.lanes=o,e.memoizedState=u}}function Za(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(a(191,i));i.call(r)}}}var $a={},eo=Ti($a),to=Ti($a),no=Ti($a);function ro(e){if(e===$a)throw Error(a(174));return e}function io(e,t){switch(wi(no,t),wi(to,e),wi(eo,$a),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ci(eo),wi(eo,t)}function ao(){Ci(eo),Ci(to),Ci(no)}function oo(e){ro(no.current);var t=ro(eo.current),n=ce(t,e.type);t!==n&&(wi(to,e),wi(eo,n))}function so(e){to.current===e&&(Ci(eo),Ci(to))}var co=Ti(0);function lo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var uo=[];function ho(){for(var e=0;e<uo.length;e++)uo[e]._workInProgressVersionPrimary=null;uo.length=0}var po=y.ReactCurrentDispatcher,fo=y.ReactCurrentBatchConfig,mo=0,_o=null,go=null,Eo=null,vo=!1,yo=!1,So=0,bo=0;function To(){throw Error(a(321))}function Co(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function wo(e,t,n,r,i,o){if(mo=o,_o=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,po.current=null===e||null===e.memoizedState?ls:ds,e=n(r,i),yo){o=0;do{if(yo=!1,So=0,25<=o)throw Error(a(301));o+=1,Eo=go=null,t.updateQueue=null,po.current=us,e=n(r,i)}while(yo)}if(po.current=cs,t=null!==go&&null!==go.next,mo=0,Eo=go=_o=null,vo=!1,t)throw Error(a(300));return e}function Ro(){var e=0!==So;return So=0,e}function Ao(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Eo?_o.memoizedState=Eo=e:Eo=Eo.next=e,Eo}function Io(){if(null===go){var e=_o.alternate;e=null!==e?e.memoizedState:null}else e=go.next;var t=null===Eo?_o.memoizedState:Eo.next;if(null!==t)Eo=t,go=e;else{if(null===e)throw Error(a(310));e={memoizedState:(go=e).memoizedState,baseState:go.baseState,baseQueue:go.baseQueue,queue:go.queue,next:null},null===Eo?_o.memoizedState=Eo=e:Eo=Eo.next=e}return Eo}function No(e,t){return"function"===typeof t?t(e):t}function Oo(e){var t=Io(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=go,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(null!==i){o=i.next,r=r.baseState;var c=s=null,l=null,d=o;do{var u=d.lane;if((mo&u)===u)null!==l&&(l=l.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===l?(c=l=h,s=r):l=l.next=h,_o.lanes|=u,zc|=u}d=d.next}while(null!==d&&d!==o);null===l?s=r:l.next=c,or(r,t.memoizedState)||(Ns=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=l,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{o=i.lane,_o.lanes|=o,zc|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Po(e){var t=Io(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{o=e(o,s.action),s=s.next}while(s!==i);or(o,t.memoizedState)||(Ns=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Lo(){}function Do(e,t){var n=_o,r=Io(),i=t(),o=!or(r.memoizedState,i);if(o&&(r.memoizedState=i,Ns=!0),r=r.queue,zo(Mo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==Eo&&1&Eo.memoizedState.tag){if(n.flags|=2048,Vo(9,xo.bind(null,n,r,i,t),void 0,null),null===jc)throw Error(a(349));0!==(30&mo)||ko(n,t,i)}return i}function ko(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=_o.updateQueue)?(t={lastEffect:null,stores:null},_o.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function xo(e,t,n,r){t.value=n,t.getSnapshot=r,Uo(t)&&Fo(e)}function Mo(e,t,n){return n((function(){Uo(t)&&Fo(e)}))}function Uo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(ha){return!0}}function Fo(e){var t=Wa(e,1);null!==t&&hl(t,e,1,-1)}function jo(e){var t=Ao();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:No,lastRenderedState:e},t.queue=e,e=e.dispatch=is.bind(null,_o,e),[t.memoizedState,e]}function Vo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=_o.updateQueue)?(t={lastEffect:null,stores:null},_o.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Go(){return Io().memoizedState}function Wo(e,t,n,r){var i=Ao();_o.flags|=e,i.memoizedState=Vo(1|t,n,void 0,void 0===r?null:r)}function Ho(e,t,n,r){var i=Io();r=void 0===r?null:r;var a=void 0;if(null!==go){var o=go.memoizedState;if(a=o.destroy,null!==r&&Co(r,o.deps))return void(i.memoizedState=Vo(t,n,a,r))}_o.flags|=e,i.memoizedState=Vo(1|t,n,a,r)}function qo(e,t){return Wo(8390656,8,e,t)}function zo(e,t){return Ho(2048,8,e,t)}function Ko(e,t){return Ho(4,2,e,t)}function Yo(e,t){return Ho(4,4,e,t)}function Jo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ho(4,4,Jo.bind(null,t,e),n)}function Qo(){}function Zo(e,t){var n=Io();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Co(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function $o(e,t){var n=Io();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Co(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function es(e,t,n){return 0===(21&mo)?(e.baseState&&(e.baseState=!1,Ns=!0),e.memoizedState=n):(or(n,t)||(n=ft(),_o.lanes|=n,zc|=n,e.baseState=!0),t)}function ts(e,t){var n=Et;Et=0!==n&&4>n?n:4,e(!0);var r=fo.transition;fo.transition={};try{e(!1),t()}finally{Et=n,fo.transition=r}}function ns(){return Io().memoizedState}function rs(e,t,n){var r=ul(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},as(e))os(t,n);else if(null!==(n=Ga(e,t,n,r))){hl(n,e,r,dl()),ss(n,t,r)}}function is(e,t,n){var r=ul(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(as(e))os(t,i);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,or(s,o)){var c=t.interleaved;return null===c?(i.next=i,Ba(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(da){}null!==(n=Ga(e,t,i,r))&&(hl(n,e,r,i=dl()),ss(n,t,r))}}function as(e){var t=e.alternate;return e===_o||null!==t&&t===_o}function os(e,t){yo=vo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ss(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,gt(e,n)}}var cs={readContext:ja,useCallback:To,useContext:To,useEffect:To,useImperativeHandle:To,useInsertionEffect:To,useLayoutEffect:To,useMemo:To,useReducer:To,useRef:To,useState:To,useDebugValue:To,useDeferredValue:To,useTransition:To,useMutableSource:To,useSyncExternalStore:To,useId:To,unstable_isNewReconciler:!1},ls={readContext:ja,useCallback:function(e,t){return Ao().memoizedState=[e,void 0===t?null:t],e},useContext:ja,useEffect:qo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Wo(4194308,4,Jo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Wo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Wo(4,2,e,t)},useMemo:function(e,t){var n=Ao();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ao();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=rs.bind(null,_o,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ao().memoizedState=e},useState:jo,useDebugValue:Qo,useDeferredValue:function(e){return Ao().memoizedState=e},useTransition:function(){var e=jo(!1),t=e[0];return e=ts.bind(null,e[1]),Ao().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=_o,i=Ao();if(ra){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===jc)throw Error(a(349));0!==(30&mo)||ko(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,qo(Mo.bind(null,r,o,e),[e]),r.flags|=2048,Vo(9,xo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Ao(),t=jc.identifierPrefix;if(ra){var n=Xi;t=":"+t+"R"+(n=(Ji&~(1<<32-at(Ji)-1)).toString(32)+n),0<(n=So++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=bo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ds={readContext:ja,useCallback:Zo,useContext:ja,useEffect:zo,useImperativeHandle:Xo,useInsertionEffect:Ko,useLayoutEffect:Yo,useMemo:$o,useReducer:Oo,useRef:Go,useState:function(){return Oo(No)},useDebugValue:Qo,useDeferredValue:function(e){return es(Io(),go.memoizedState,e)},useTransition:function(){return[Oo(No)[0],Io().memoizedState]},useMutableSource:Lo,useSyncExternalStore:Do,useId:ns,unstable_isNewReconciler:!1},us={readContext:ja,useCallback:Zo,useContext:ja,useEffect:zo,useImperativeHandle:Xo,useInsertionEffect:Ko,useLayoutEffect:Yo,useMemo:$o,useReducer:Po,useRef:Go,useState:function(){return Po(No)},useDebugValue:Qo,useDeferredValue:function(e){var t=Io();return null===go?t.memoizedState=e:es(t,go.memoizedState,e)},useTransition:function(){return[Po(No)[0],Io().memoizedState]},useMutableSource:Lo,useSyncExternalStore:Do,useId:ns,unstable_isNewReconciler:!1};function hs(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ps(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var fs={isMounted:function(e){return!!(e=e._reactInternals)&&Be(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=dl(),i=ul(e),a=Ka(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ya(e,a,i))&&(hl(t,e,i,r),Ja(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=dl(),i=ul(e),a=Ka(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ya(e,a,i))&&(hl(t,e,i,r),Ja(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=dl(),r=ul(e),i=Ka(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Ya(e,i,r))&&(hl(t,e,r,n),Ja(t,e,r))}};function ms(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!sr(n,r)||!sr(i,a))}function _s(e,t,n){var r=!1,i=Ri,a=t.contextType;return"object"===typeof a&&null!==a?a=ja(a):(i=Pi(t)?Ni:Ai.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?Oi(e,i):Ri),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=fs,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function gs(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&fs.enqueueReplaceState(t,t.state,null)}function Es(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},qa(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=ja(a):(a=Pi(t)?Ni:Ai.current,i.context=Oi(e,a)),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(ps(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&fs.enqueueReplaceState(i,i.state,null),Qa(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function vs(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var i=n}catch(ua){i="\nError generating stack: "+ua.message+"\n"+ua.stack}return{value:e,source:t,stack:i,digest:null}}function ys(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function Ss(e,t){try{console.error(t.value)}catch(sa){setTimeout((function(){throw sa}))}}var bs="function"===typeof WeakMap?WeakMap:Map;function Ts(e,t,n){(n=Ka(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){el||(el=!0,tl=r),Ss(0,t)},n}function Cs(e,t,n){(n=Ka(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Ss(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){Ss(0,t),"function"!==typeof r&&(null===nl?nl=new Set([this]):nl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ws(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new bs;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=xl.bind(null,e,t,n),t.then(e,e))}function Rs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function As(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ka(-1,1)).tag=2,Ya(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var Is=y.ReactCurrentOwner,Ns=!1;function Os(e,t,n,r){t.child=null===e?Oa(t,null,n,r):Ia(t,e.child,n,r)}function Ps(e,t,n,r,i){n=n.render;var a=t.ref;return Fa(t,i),r=wo(e,t,n,r,a,i),n=Ro(),null===e||Ns?(ra&&n&&$i(t),t.flags|=1,Os(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,ec(e,t,i))}function Ls(e,t,n,r,i){if(null===e){var a=n.type;return"function"!==typeof a||Gl(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Hl(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ds(e,t,a,r,i))}if(a=e.child,0===(e.lanes&i)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:sr)(o,r)&&e.ref===t.ref)return ec(e,t,i)}return t.flags|=1,(e=Wl(a,r)).ref=t.ref,e.return=t,t.child=e}function Ds(e,t,n,r,i){if(null!==e){var a=e.memoizedProps;if(sr(a,r)&&e.ref===t.ref){if(Ns=!1,t.pendingProps=r=a,0===(e.lanes&i))return t.lanes=e.lanes,ec(e,t,i);0!==(131072&e.flags)&&(Ns=!0)}}return Ms(e,t,n,r,i)}function ks(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},wi(Wc,Gc),Gc|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,wi(Wc,Gc),Gc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:n,wi(Wc,Gc),Gc|=r}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,wi(Wc,Gc),Gc|=r;return Os(e,t,i,n),t.child}function xs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ms(e,t,n,r,i){var a=Pi(n)?Ni:Ai.current;return a=Oi(t,a),Fa(t,i),n=wo(e,t,n,r,a,i),r=Ro(),null===e||Ns?(ra&&r&&$i(t),t.flags|=1,Os(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,ec(e,t,i))}function Us(e,t,n,r,i){if(Pi(n)){var a=!0;xi(t)}else a=!1;if(Fa(t,i),null===t.stateNode)$s(e,t),_s(t,n,r),Es(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var c=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=ja(l):l=Oi(t,l=Pi(n)?Ni:Ai.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate;u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||c!==l)&&gs(t,o,r,l),Ha=!1;var h=t.memoizedState;o.state=h,Qa(t,r,o,i),c=t.memoizedState,s!==r||h!==c||Ii.current||Ha?("function"===typeof d&&(ps(t,n,d,r),c=t.memoizedState),(s=Ha||ms(t,n,s,r,h,c,l))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=l,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,za(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:hs(t.type,s),o.props=l,u=t.pendingProps,h=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=ja(c):c=Oi(t,c=Pi(n)?Ni:Ai.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==u||h!==c)&&gs(t,o,r,c),Ha=!1,h=t.memoizedState,o.state=h,Qa(t,r,o,i);var f=t.memoizedState;s!==u||h!==f||Ii.current||Ha?("function"===typeof p&&(ps(t,n,p,r),f=t.memoizedState),(l=Ha||ms(t,n,l,r,h,f,c)||!1)?(d||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,c)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=c,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Fs(e,t,n,r,a,i)}function Fs(e,t,n,r,i,a){xs(e,t);var o=0!==(128&t.flags);if(!r&&!o)return i&&Mi(t,n,!1),ec(e,t,a);r=t.stateNode,Is.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Ia(t,e.child,null,a),t.child=Ia(t,null,s,a)):Os(e,t,s,a),t.memoizedState=r.state,i&&Mi(t,n,!0),t.child}function js(e){var t=e.stateNode;t.pendingContext?Di(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Di(0,t.context,!1),io(e,t.containerInfo)}function Vs(e,t,n,r,i){return ya(),Sa(i),t.flags|=256,Os(e,t,n,r),t.child}var Bs,Gs,Ws,Hs,qs={dehydrated:null,treeContext:null,retryLane:0};function zs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ks(e,t,n){var r,i=t.pendingProps,o=co.current,s=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),wi(co,1&o),null===e)return fa(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,s?(i=t.mode,s=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=c):s=zl(c,i,0,null),e=ql(e,i,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=zs(n),t.memoizedState=qs,e):Ys(t,c));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,i,o,s){if(n)return 256&t.flags?(t.flags&=-257,Js(e,t,s,r=ys(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,i=t.mode,r=zl({mode:"visible",children:r.children},i,0,null),(o=ql(o,i,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Ia(t,e.child,null,s),t.child.memoizedState=zs(s),t.memoizedState=qs,o);if(0===(1&t.mode))return Js(e,t,s,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,Js(e,t,s,r=ys(o=Error(a(419)),r,void 0))}if(c=0!==(s&e.childLanes),Ns||c){if(null!==(r=jc)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|s))?0:i)&&i!==o.retryLane&&(o.retryLane=i,Wa(e,i),hl(r,e,i,-1))}return wl(),Js(e,t,s,r=ys(Error(a(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ul.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,na=ci(i.nextSibling),ta=t,ra=!0,aa=null,null!==e&&(zi[Ki++]=Ji,zi[Ki++]=Xi,zi[Ki++]=Yi,Ji=e.id,Xi=e.overflow,Yi=t),t=Ys(t,r.children),t.flags|=4096,t)}(e,t,c,i,r,o,n);if(s){s=i.fallback,c=t.mode,r=(o=e.child).sibling;var l={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=l,t.deletions=null):(i=Wl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Wl(r,s):(s=ql(s,c,n,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,c=null===(c=e.child.memoizedState)?zs(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},s.memoizedState=c,s.childLanes=e.childLanes&~n,t.memoizedState=qs,i}return e=(s=e.child).sibling,i=Wl(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Ys(e,t){return(t=zl({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Js(e,t,n,r){return null!==r&&Sa(r),Ia(t,e.child,null,n),(e=Ys(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Xs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ua(e.return,t,n)}function Qs(e,t,n,r,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function Zs(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(Os(e,t,r.children,n),0!==(2&(r=co.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Xs(e,n,t);else if(19===e.tag)Xs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(wi(co,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===lo(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Qs(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===lo(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Qs(t,!0,n,null,a);break;case"together":Qs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function $s(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ec(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),zc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Wl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Wl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function tc(e,t){if(!ra)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function nc(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function rc(e,t,n){var r=t.pendingProps;switch(ea(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nc(t),null;case 1:case 17:return Pi(t.type)&&Li(),nc(t),null;case 3:return r=t.stateNode,ao(),Ci(Ii),Ci(Ai),ho(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Ea(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(_l(aa),aa=null))),Gs(e,t),nc(t),null;case 5:so(t);var i=ro(no.current);if(n=t.type,null!==e&&null!=t.stateNode)Ws(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return nc(t),null}if(e=ro(eo.current),Ea(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[ui]=t,r[hi]=o,e=0!==(1&t.mode),n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(i=0;i<kr.length;i++)Fr(kr[i],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":X(r,o),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Fr("invalid",r);break;case"textarea":ie(r,o),Fr("invalid",r)}for(var c in ge(n,o),i=null,o)if(o.hasOwnProperty(c)){var l=o[c];"children"===c?"string"===typeof l?r.textContent!==l&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,l,e),i=["children",l]):"number"===typeof l&&r.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&Qr(r.textContent,l,e),i=["children",""+l]):s.hasOwnProperty(c)&&null!=l&&"onScroll"===c&&Fr("scroll",r)}switch(n){case"input":z(r),$(r,o,!0);break;case"textarea":z(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[ui]=t,e[hi]=r,Bs(e,t,!1,!1),t.stateNode=e;e:{switch(c=Ee(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),i=r;break;case"iframe":case"object":case"embed":Fr("load",e),i=r;break;case"video":case"audio":for(i=0;i<kr.length;i++)Fr(kr[i],e);i=r;break;case"source":Fr("error",e),i=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),i=r;break;case"details":Fr("toggle",e),i=r;break;case"input":X(e,r),i=J(e,r),Fr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=U({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Fr("invalid",e)}for(o in ge(n,i),l=i)if(l.hasOwnProperty(o)){var d=l[o];"style"===o?me(e,d):"dangerouslySetInnerHTML"===o?null!=(d=d?d.__html:void 0)&&de(e,d):"children"===o?"string"===typeof d?("textarea"!==n||""!==d)&&ue(e,d):"number"===typeof d&&ue(e,""+d):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=d&&"onScroll"===o&&Fr("scroll",e):null!=d&&v(e,o,d,c))}switch(n){case"input":z(e),$(e,r,!1);break;case"textarea":z(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return nc(t),null;case 6:if(e&&null!=t.stateNode)Hs(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(n=ro(no.current),ro(eo.current),Ea(t)){if(r=t.stateNode,n=t.memoizedProps,r[ui]=t,(o=r.nodeValue!==n)&&null!==(e=ta))switch(e.tag){case 3:Qr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Qr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ui]=t,t.stateNode=r}return nc(t),null;case 13:if(Ci(co),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ra&&null!==na&&0!==(1&t.mode)&&0===(128&t.flags))va(),ya(),t.flags|=98560,o=!1;else if(o=Ea(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[ui]=t}else ya(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nc(t),o=!1}else null!==aa&&(_l(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&co.current)?0===Hc&&(Hc=3):wl())),null!==t.updateQueue&&(t.flags|=4),nc(t),null);case 4:return ao(),Gs(e,t),null===e&&Br(t.stateNode.containerInfo),nc(t),null;case 10:return Ma(t.type._context),nc(t),null;case 19:if(Ci(co),null===(o=t.memoizedState))return nc(t),null;if(r=0!==(128&t.flags),null===(c=o.rendering))if(r)tc(o,!1);else{if(0!==Hc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=lo(e))){for(t.flags|=128,tc(o,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(c=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=c.childLanes,o.lanes=c.lanes,o.child=c.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=c.memoizedProps,o.memoizedState=c.memoizedState,o.updateQueue=c.updateQueue,o.type=c.type,e=c.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return wi(co,1&co.current|2),t.child}e=e.sibling}null!==o.tail&&Xe()>Zc&&(t.flags|=128,r=!0,tc(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=lo(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),tc(o,!0),null===o.tail&&"hidden"===o.tailMode&&!c.alternate&&!ra)return nc(t),null}else 2*Xe()-o.renderingStartTime>Zc&&1073741824!==n&&(t.flags|=128,r=!0,tc(o,!1),t.lanes=4194304);o.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=o.last)?n.sibling=c:t.child=c,o.last=c)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Xe(),t.sibling=null,n=co.current,wi(co,r?1&n|2:1&n),t):(nc(t),null);case 22:case 23:return Sl(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Gc)&&(nc(t),6&t.subtreeFlags&&(t.flags|=8192)):nc(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function ic(e,t){switch(ea(t),t.tag){case 1:return Pi(t.type)&&Li(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),Ci(Ii),Ci(Ai),ho(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return so(t),null;case 13:if(Ci(co),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));ya()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ci(co),null;case 4:return ao(),null;case 10:return Ma(t.type._context),null;case 22:case 23:return Sl(),null;default:return null}}Bs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Gs=function(){},Ws=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,ro(eo.current);var a,o=null;switch(n){case"input":i=J(e,i),r=J(e,r),o=[];break;case"select":i=U({},i,{value:void 0}),r=U({},r,{value:void 0}),o=[];break;case"textarea":i=re(e,i),r=re(e,r),o=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(d in ge(n,r),n=null,i)if(!r.hasOwnProperty(d)&&i.hasOwnProperty(d)&&null!=i[d])if("style"===d){var c=i[d];for(a in c)c.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(s.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in r){var l=r[d];if(c=null!=i?i[d]:void 0,r.hasOwnProperty(d)&&l!==c&&(null!=l||null!=c))if("style"===d)if(c){for(a in c)!c.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&c[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(d,n)),n=l;else"dangerouslySetInnerHTML"===d?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(o=o||[]).push(d,l)):"children"===d?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(d,""+l):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(s.hasOwnProperty(d)?(null!=l&&"onScroll"===d&&Fr("scroll",e),o||c===l||(o=[])):(o=o||[]).push(d,l))}n&&(o=o||[]).push("style",n);var d=o;(t.updateQueue=d)&&(t.flags|=4)}},Hs=function(e,t,n,r){n!==r&&(t.flags|=4)};var ac=!1,oc=!1,sc="function"===typeof WeakSet?WeakSet:Set,cc=null;function lc(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(ha){kl(e,t,ha)}else n.current=null}function dc(e,t,n){try{n()}catch(ha){kl(e,t,ha)}}var uc=!1;function hc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,void 0!==a&&dc(t,n,a)}i=i.next}while(i!==r)}}function pc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function fc(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function mc(e){var t=e.alternate;null!==t&&(e.alternate=null,mc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ui],delete t[hi],delete t[fi],delete t[mi],delete t[_i])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function _c(e){return 5===e.tag||3===e.tag||4===e.tag}function gc(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||_c(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Ec(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(Ec(e,t,n),e=e.sibling;null!==e;)Ec(e,t,n),e=e.sibling}function vc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(vc(e,t,n),e=e.sibling;null!==e;)vc(e,t,n),e=e.sibling}var yc=null,Sc=!1;function bc(e,t,n){for(n=n.child;null!==n;)Tc(e,t,n),n=n.sibling}function Tc(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(rt,n)}catch(la){}switch(n.tag){case 5:oc||lc(n,t);case 6:var r=yc,i=Sc;yc=null,bc(e,t,n),Sc=i,null!==(yc=r)&&(Sc?(e=yc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):yc.removeChild(n.stateNode));break;case 18:null!==yc&&(Sc?(e=yc,n=n.stateNode,8===e.nodeType?si(e.parentNode,n):1===e.nodeType&&si(e,n),Bt(e)):si(yc,n.stateNode));break;case 4:r=yc,i=Sc,yc=n.stateNode.containerInfo,Sc=!0,bc(e,t,n),yc=r,Sc=i;break;case 0:case 11:case 14:case 15:if(!oc&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&dc(n,t,o),i=i.next}while(i!==r)}bc(e,t,n);break;case 1:if(!oc&&(lc(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(la){kl(n,t,la)}bc(e,t,n);break;case 21:bc(e,t,n);break;case 22:1&n.mode?(oc=(r=oc)||null!==n.memoizedState,bc(e,t,n),oc=r):bc(e,t,n);break;default:bc(e,t,n)}}function Cc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new sc),t.forEach((function(t){var r=Fl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function wc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,s=t,c=s;e:for(;null!==c;){switch(c.tag){case 5:yc=c.stateNode,Sc=!1;break e;case 3:case 4:yc=c.stateNode.containerInfo,Sc=!0;break e}c=c.return}if(null===yc)throw Error(a(160));Tc(o,s,i),yc=null,Sc=!1;var l=i.alternate;null!==l&&(l.return=null),i.return=null}catch(da){kl(i,t,da)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)Rc(t,e),t=t.sibling}function Rc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(wc(t,e),Ac(e),4&r){try{hc(3,e,e.return),pc(3,e)}catch(Bo){kl(e,e.return,Bo)}try{hc(5,e,e.return)}catch(Bo){kl(e,e.return,Bo)}}break;case 1:wc(t,e),Ac(e),512&r&&null!==n&&lc(n,n.return);break;case 5:if(wc(t,e),Ac(e),512&r&&null!==n&&lc(n,n.return),32&e.flags){var i=e.stateNode;try{ue(i,"")}catch(Bo){kl(e,e.return,Bo)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,c=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===c&&"radio"===o.type&&null!=o.name&&Q(i,o),Ee(c,s);var d=Ee(c,o);for(s=0;s<l.length;s+=2){var u=l[s],h=l[s+1];"style"===u?me(i,h):"dangerouslySetInnerHTML"===u?de(i,h):"children"===u?ue(i,h):v(i,u,h,d)}switch(c){case"input":Z(i,o);break;case"textarea":ae(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ne(i,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(i,!!o.multiple,o.defaultValue,!0):ne(i,!!o.multiple,o.multiple?[]:"",!1))}i[hi]=o}catch(Bo){kl(e,e.return,Bo)}}break;case 6:if(wc(t,e),Ac(e),4&r){if(null===e.stateNode)throw Error(a(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(Bo){kl(e,e.return,Bo)}}break;case 3:if(wc(t,e),Ac(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Bt(t.containerInfo)}catch(Bo){kl(e,e.return,Bo)}break;case 4:default:wc(t,e),Ac(e);break;case 13:wc(t,e),Ac(e),8192&(i=e.child).flags&&(o=null!==i.memoizedState,i.stateNode.isHidden=o,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(Qc=Xe())),4&r&&Cc(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(oc=(d=oc)||u,wc(t,e),oc=d):wc(t,e),Ac(e),8192&r){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(cc=e,u=e.child;null!==u;){for(h=cc=u;null!==cc;){switch(f=(p=cc).child,p.tag){case 0:case 11:case 14:case 15:hc(4,p,p.return);break;case 1:lc(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(Bo){kl(r,n,Bo)}}break;case 5:lc(p,p.return);break;case 22:if(null!==p.memoizedState){Pc(h);continue}}null!==f?(f.return=p,cc=f):Pc(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{i=h.stateNode,d?"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(c=h.stateNode,s=void 0!==(l=h.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,c.style.display=fe("display",s))}catch(Bo){kl(e,e.return,Bo)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(Bo){kl(e,e.return,Bo)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:wc(t,e),Ac(e),4&r&&Cc(e);case 21:}}function Ac(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(_c(n)){var r=n;break e}n=n.return}throw Error(a(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(ue(i,""),r.flags&=-33),vc(e,gc(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;Ec(e,gc(e),o);break;default:throw Error(a(161))}}catch(Aa){kl(e,e.return,Aa)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ic(e,t,n){cc=e,Nc(e,t,n)}function Nc(e,t,n){for(var r=0!==(1&e.mode);null!==cc;){var i=cc,a=i.child;if(22===i.tag&&r){var o=null!==i.memoizedState||ac;if(!o){var s=i.alternate,c=null!==s&&null!==s.memoizedState||oc;s=ac;var l=oc;if(ac=o,(oc=c)&&!l)for(cc=i;null!==cc;)c=(o=cc).child,22===o.tag&&null!==o.memoizedState?Lc(i):null!==c?(c.return=o,cc=c):Lc(i);for(;null!==a;)cc=a,Nc(a,t,n),a=a.sibling;cc=i,ac=s,oc=l}Oc(e)}else 0!==(8772&i.subtreeFlags)&&null!==a?(a.return=i,cc=a):Oc(e)}}function Oc(e){for(;null!==cc;){var t=cc;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:oc||pc(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!oc)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:hs(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Za(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Za(t,s,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Bt(h)}}}break;default:throw Error(a(163))}oc||512&t.flags&&fc(t)}catch(p){kl(t,t.return,p)}}if(t===e){cc=null;break}if(null!==(n=t.sibling)){n.return=t.return,cc=n;break}cc=t.return}}function Pc(e){for(;null!==cc;){var t=cc;if(t===e){cc=null;break}var n=t.sibling;if(null!==n){n.return=t.return,cc=n;break}cc=t.return}}function Lc(e){for(;null!==cc;){var t=cc;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{pc(4,t)}catch(Aa){kl(t,n,Aa)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(Aa){kl(t,i,Aa)}}var a=t.return;try{fc(t)}catch(Aa){kl(t,a,Aa)}break;case 5:var o=t.return;try{fc(t)}catch(Aa){kl(t,o,Aa)}}}catch(Aa){kl(t,t.return,Aa)}if(t===e){cc=null;break}var s=t.sibling;if(null!==s){s.return=t.return,cc=s;break}cc=t.return}}var Dc,kc=Math.ceil,xc=y.ReactCurrentDispatcher,Mc=y.ReactCurrentOwner,Uc=y.ReactCurrentBatchConfig,Fc=0,jc=null,Vc=null,Bc=0,Gc=0,Wc=Ti(0),Hc=0,qc=null,zc=0,Kc=0,Yc=0,Jc=null,Xc=null,Qc=0,Zc=1/0,$c=null,el=!1,tl=null,nl=null,rl=!1,il=null,al=0,ol=0,sl=null,cl=-1,ll=0;function dl(){return 0!==(6&Fc)?Xe():-1!==cl?cl:cl=Xe()}function ul(e){return 0===(1&e.mode)?1:0!==(2&Fc)&&0!==Bc?Bc&-Bc:null!==ba.transition?(0===ll&&(ll=ft()),ll):0!==(e=Et)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function hl(e,t,n,r){if(50<ol)throw ol=0,sl=null,Error(a(185));_t(e,n,r),0!==(2&Fc)&&e===jc||(e===jc&&(0===(2&Fc)&&(Kc|=n),4===Hc&&gl(e,Bc)),pl(e,r),1===n&&0===Fc&&0===(1&t.mode)&&(Zc=Xe()+500,Fi&&Bi()))}function pl(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-at(a),s=1<<o,c=i[o];-1===c?0!==(s&n)&&0===(s&r)||(i[o]=ht(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=ut(e,e===jc?Bc:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Fi=!0,Vi(e)}(El.bind(null,e)):Vi(El.bind(null,e)),ai((function(){0===(6&Fc)&&Bi()})),n=null;else{switch(vt(r)){case 1:n=Ze;break;case 4:n=$e;break;case 16:default:n=et;break;case 536870912:n=nt}n=jl(n,fl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function fl(e,t){if(cl=-1,ll=0,0!==(6&Fc))throw Error(a(327));var n=e.callbackNode;if(Ll()&&e.callbackNode!==n)return null;var r=ut(e,e===jc?Bc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=Rl(e,r);else{t=r;var i=Fc;Fc|=2;var o=Cl();for(jc===e&&Bc===t||($c=null,Zc=Xe()+500,bl(e,t));;)try{Il();break}catch(la){Tl(e,la)}xa(),xc.current=o,Fc=i,null!==Vc?t=0:(jc=null,Bc=0,t=Hc)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=ml(e,i))),1===t)throw n=qc,bl(e,0),gl(e,r),pl(e,Xe()),n;if(6===t)gl(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!or(a(),i))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=Rl(e,r))&&(0!==(o=pt(e))&&(r=o,t=ml(e,o))),1===t))throw n=qc,bl(e,0),gl(e,r),pl(e,Xe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:Pl(e,Xc,$c);break;case 3:if(gl(e,r),(130023424&r)===r&&10<(t=Qc+500-Xe())){if(0!==ut(e,0))break;if(((i=e.suspendedLanes)&r)!==r){dl(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ni(Pl.bind(null,e,Xc,$c),t);break}Pl(e,Xc,$c);break;case 4:if(gl(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var s=31-at(r);o=1<<s,(s=t[s])>i&&(i=s),r&=~o}if(r=i,10<(r=(120>(r=Xe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*kc(r/1960))-r)){e.timeoutHandle=ni(Pl.bind(null,e,Xc,$c),r);break}Pl(e,Xc,$c);break;default:throw Error(a(329))}}}return pl(e,Xe()),e.callbackNode===n?fl.bind(null,e):null}function ml(e,t){var n=Jc;return e.current.memoizedState.isDehydrated&&(bl(e,t).flags|=256),2!==(e=Rl(e,t))&&(t=Xc,Xc=n,null!==t&&_l(t)),e}function _l(e){null===Xc?Xc=e:Xc.push.apply(Xc,e)}function gl(e,t){for(t&=~Yc,t&=~Kc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function El(e){if(0!==(6&Fc))throw Error(a(327));Ll();var t=ut(e,0);if(0===(1&t))return pl(e,Xe()),null;var n=Rl(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ml(e,r))}if(1===n)throw n=qc,bl(e,0),gl(e,t),pl(e,Xe()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Pl(e,Xc,$c),pl(e,Xe()),null}function vl(e,t){var n=Fc;Fc|=1;try{return e(t)}finally{0===(Fc=n)&&(Zc=Xe()+500,Fi&&Bi())}}function yl(e){null!==il&&0===il.tag&&0===(6&Fc)&&Ll();var t=Fc;Fc|=1;var n=Uc.transition,r=Et;try{if(Uc.transition=null,Et=1,e)return e()}finally{Et=r,Uc.transition=n,0===(6&(Fc=t))&&Bi()}}function Sl(){Gc=Wc.current,Ci(Wc)}function bl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ri(n)),null!==Vc)for(n=Vc.return;null!==n;){var r=n;switch(ea(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Li();break;case 3:ao(),Ci(Ii),Ci(Ai),ho();break;case 5:so(r);break;case 4:ao();break;case 13:case 19:Ci(co);break;case 10:Ma(r.type._context);break;case 22:case 23:Sl()}n=n.return}if(jc=e,Vc=e=Wl(e.current,null),Bc=Gc=t,Hc=0,qc=null,Yc=Kc=zc=0,Xc=Jc=null,null!==Va){for(t=0;t<Va.length;t++)if(null!==(r=(n=Va[t]).interleaved)){n.interleaved=null;var i=r.next,a=n.pending;if(null!==a){var o=a.next;a.next=i,r.next=o}n.pending=r}Va=null}return e}function Tl(e,t){for(;;){var n=Vc;try{if(xa(),po.current=cs,vo){for(var r=_o.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}vo=!1}if(mo=0,Eo=go=_o=null,yo=!1,So=0,Mc.current=null,null===n||null===n.return){Hc=1,qc=t,Vc=null;break}e:{var o=e,s=n.return,c=n,l=t;if(t=Bc,c.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var d=l,u=c,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=Rs(s);if(null!==f){f.flags&=-257,As(f,s,c,0,t),1&f.mode&&ws(o,d,t),l=d;var m=(t=f).updateQueue;if(null===m){var _=new Set;_.add(l),t.updateQueue=_}else m.add(l);break e}if(0===(1&t)){ws(o,d,t),wl();break e}l=Error(a(426))}else if(ra&&1&c.mode){var g=Rs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),As(g,s,c,0,t),Sa(vs(l,c));break e}}o=l=vs(l,c),4!==Hc&&(Hc=2),null===Jc?Jc=[o]:Jc.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Xa(o,Ts(0,l,t));break e;case 1:c=l;var E=o.type,v=o.stateNode;if(0===(128&o.flags)&&("function"===typeof E.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===nl||!nl.has(v)))){o.flags|=65536,t&=-t,o.lanes|=t,Xa(o,Cs(o,c,t));break e}}o=o.return}while(null!==o)}Ol(n)}catch(nV){t=nV,Vc===n&&null!==n&&(Vc=n=n.return);continue}break}}function Cl(){var e=xc.current;return xc.current=cs,null===e?cs:e}function wl(){0!==Hc&&3!==Hc&&2!==Hc||(Hc=4),null===jc||0===(268435455&zc)&&0===(268435455&Kc)||gl(jc,Bc)}function Rl(e,t){var n=Fc;Fc|=2;var r=Cl();for(jc===e&&Bc===t||($c=null,bl(e,t));;)try{Al();break}catch(i){Tl(e,i)}if(xa(),Fc=n,xc.current=r,null!==Vc)throw Error(a(261));return jc=null,Bc=0,Hc}function Al(){for(;null!==Vc;)Nl(Vc)}function Il(){for(;null!==Vc&&!Ye();)Nl(Vc)}function Nl(e){var t=Dc(e.alternate,e,Gc);e.memoizedProps=e.pendingProps,null===t?Ol(e):Vc=t,Mc.current=null}function Ol(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=rc(n,t,Gc)))return void(Vc=n)}else{if(null!==(n=ic(n,t)))return n.flags&=32767,void(Vc=n);if(null===e)return Hc=6,void(Vc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Vc=t);Vc=t=e}while(null!==t);0===Hc&&(Hc=5)}function Pl(e,t,n){var r=Et,i=Uc.transition;try{Uc.transition=null,Et=1,function(e,t,n,r){do{Ll()}while(null!==il);if(0!==(6&Fc))throw Error(a(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-at(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}(e,o),e===jc&&(Vc=jc=null,Bc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||rl||(rl=!0,jl(et,(function(){return Ll(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Uc.transition,Uc.transition=null;var s=Et;Et=1;var c=Fc;Fc|=4,Mc.current=null,function(e,t){if($r=Wt,hr(e=ur())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(Na){n=null;break e}var s=0,c=-1,l=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==i&&3!==h.nodeType||(c=s+i),h!==o||0!==r&&3!==h.nodeType||(l=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++d===i&&(c=s),p===o&&++u===r&&(l=s),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===c||-1===l?null:{start:c,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ei={focusedElem:e,selectionRange:n},Wt=!1,cc=t;null!==cc;)if(e=(t=cc).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,cc=e;else for(;null!==cc;){t=cc;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var _=m.memoizedProps,g=m.memoizedState,E=t.stateNode,v=E.getSnapshotBeforeUpdate(t.elementType===t.type?_:hs(t.type,_),g);E.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(a(163))}}catch(Na){kl(t,t.return,Na)}if(null!==(e=t.sibling)){e.return=t.return,cc=e;break}cc=t.return}m=uc,uc=!1}(e,n),Rc(n,e),pr(ei),Wt=!!$r,ei=$r=null,e.current=n,Ic(n,e,i),Je(),Fc=c,Et=s,Uc.transition=o}else e.current=n;if(rl&&(rl=!1,il=e,al=i),o=e.pendingLanes,0===o&&(nl=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),pl(e,Xe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(el)throw el=!1,e=tl,tl=null,e;0!==(1&al)&&0!==e.tag&&Ll(),o=e.pendingLanes,0!==(1&o)?e===sl?ol++:(ol=0,sl=e):ol=0,Bi()}(e,t,n,r)}finally{Uc.transition=i,Et=r}return null}function Ll(){if(null!==il){var e=vt(al),t=Uc.transition,n=Et;try{if(Uc.transition=null,Et=16>e?16:e,null===il)var r=!1;else{if(e=il,il=null,al=0,0!==(6&Fc))throw Error(a(331));var i=Fc;for(Fc|=4,cc=e.current;null!==cc;){var o=cc,s=o.child;if(0!==(16&cc.flags)){var c=o.deletions;if(null!==c){for(var l=0;l<c.length;l++){var d=c[l];for(cc=d;null!==cc;){var u=cc;switch(u.tag){case 0:case 11:case 15:hc(8,u,o)}var h=u.child;if(null!==h)h.return=u,cc=h;else for(;null!==cc;){var p=(u=cc).sibling,f=u.return;if(mc(u),u===d){cc=null;break}if(null!==p){p.return=f,cc=p;break}cc=f}}}var m=o.alternate;if(null!==m){var _=m.child;if(null!==_){m.child=null;do{var g=_.sibling;_.sibling=null,_=g}while(null!==_)}}cc=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,cc=s;else e:for(;null!==cc;){if(0!==(2048&(o=cc).flags))switch(o.tag){case 0:case 11:case 15:hc(9,o,o.return)}var E=o.sibling;if(null!==E){E.return=o.return,cc=E;break e}cc=o.return}}var v=e.current;for(cc=v;null!==cc;){var y=(s=cc).child;if(0!==(2064&s.subtreeFlags)&&null!==y)y.return=s,cc=y;else e:for(s=v;null!==cc;){if(0!==(2048&(c=cc).flags))try{switch(c.tag){case 0:case 11:case 15:pc(9,c)}}catch(nV){kl(c,c.return,nV)}if(c===s){cc=null;break e}var S=c.sibling;if(null!==S){S.return=c.return,cc=S;break e}cc=c.return}}if(Fc=i,Bi(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(rt,e)}catch(nV){}r=!0}return r}finally{Et=n,Uc.transition=t}}return!1}function Dl(e,t,n){e=Ya(e,t=Ts(0,t=vs(n,t),1),1),t=dl(),null!==e&&(_t(e,1,t),pl(e,t))}function kl(e,t,n){if(3===e.tag)Dl(e,e,n);else for(;null!==t;){if(3===t.tag){Dl(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===nl||!nl.has(r))){t=Ya(t,e=Cs(t,e=vs(n,e),1),1),e=dl(),null!==t&&(_t(t,1,e),pl(t,e));break}}t=t.return}}function xl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=dl(),e.pingedLanes|=e.suspendedLanes&n,jc===e&&(Bc&n)===n&&(4===Hc||3===Hc&&(130023424&Bc)===Bc&&500>Xe()-Qc?bl(e,0):Yc|=n),pl(e,t)}function Ml(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=dl();null!==(e=Wa(e,t))&&(_t(e,t,n),pl(e,n))}function Ul(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ml(e,n)}function Fl(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Ml(e,n)}function jl(e,t){return ze(e,t)}function Vl(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bl(e,t,n,r){return new Vl(e,t,n,r)}function Gl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Wl(e,t){var n=e.alternate;return null===n?((n=Bl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Hl(e,t,n,r,i,o){var s=2;if(r=e,"function"===typeof e)Gl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case T:return ql(n.children,i,o,t);case C:s=8,i|=8;break;case w:return(e=Bl(12,n,t,2|i)).elementType=w,e.lanes=o,e;case N:return(e=Bl(13,n,t,i)).elementType=N,e.lanes=o,e;case O:return(e=Bl(19,n,t,i)).elementType=O,e.lanes=o,e;case D:return zl(n,i,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case R:s=10;break e;case A:s=9;break e;case I:s=11;break e;case P:s=14;break e;case L:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Bl(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function ql(e,t,n,r){return(e=Bl(7,e,r,t)).lanes=n,e}function zl(e,t,n,r){return(e=Bl(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Kl(e,t,n){return(e=Bl(6,e,null,t)).lanes=n,e}function Yl(e,t,n){return(t=Bl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Jl(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Xl(e,t,n,r,i,a,o,s,c){return e=new Jl(e,t,n,s,c),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Bl(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},qa(a),e}function Ql(e){if(!e)return Ri;e:{if(Be(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Pi(n))return ki(e,n,t)}return t}function Zl(e,t,n,r,i,a,o,s,c){return(e=Xl(n,r,!0,e,0,a,0,s,c)).context=Ql(null),n=e.current,(a=Ka(r=dl(),i=ul(n))).callback=void 0!==t&&null!==t?t:null,Ya(n,a,i),e.current.lanes=i,_t(e,i,r),pl(e,r),e}function $l(e,t,n,r){var i=t.current,a=dl(),o=ul(i);return n=Ql(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ka(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Ya(i,t,o))&&(hl(e,i,o,a),Ja(e,i,o)),o}function ed(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function td(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function nd(e,t){td(e,t),(e=e.alternate)&&td(e,t)}Dc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ii.current)Ns=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Ns=!1,function(e,t,n){switch(t.tag){case 3:js(t),ya();break;case 5:oo(t);break;case 1:Pi(t.type)&&xi(t);break;case 4:io(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;wi(Pa,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(wi(co,1&co.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ks(e,t,n):(wi(co,1&co.current),null!==(e=ec(e,t,n))?e.sibling:null);wi(co,1&co.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Zs(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),wi(co,co.current),r)break;return null;case 22:case 23:return t.lanes=0,ks(e,t,n)}return ec(e,t,n)}(e,t,n);Ns=0!==(131072&e.flags)}else Ns=!1,ra&&0!==(1048576&t.flags)&&Zi(t,qi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;$s(e,t),e=t.pendingProps;var i=Oi(t,Ai.current);Fa(t,n),i=wo(null,t,r,e,i,n);var o=Ro();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(r)?(o=!0,xi(t)):o=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,qa(t),i.updater=fs,t.stateNode=i,i._reactInternals=t,Es(t,r,e,n),t=Fs(null,t,r,!0,o,n)):(t.tag=0,ra&&o&&$i(t),Os(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch($s(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Gl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===P)return 14}return 2}(r),e=hs(r,e),i){case 0:t=Ms(null,t,r,e,n);break e;case 1:t=Us(null,t,r,e,n);break e;case 11:t=Ps(null,t,r,e,n);break e;case 14:t=Ls(null,t,r,hs(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ms(e,t,r,i=t.elementType===r?i:hs(r,i),n);case 1:return r=t.type,i=t.pendingProps,Us(e,t,r,i=t.elementType===r?i:hs(r,i),n);case 3:e:{if(js(t),null===e)throw Error(a(387));r=t.pendingProps,i=(o=t.memoizedState).element,za(e,t),Qa(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Vs(e,t,r,n,i=vs(Error(a(423)),t));break e}if(r!==i){t=Vs(e,t,r,n,i=vs(Error(a(424)),t));break e}for(na=ci(t.stateNode.containerInfo.firstChild),ta=t,ra=!0,aa=null,n=Oa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ya(),r===i){t=ec(e,t,n);break e}Os(e,t,r,n)}t=t.child}return t;case 5:return oo(t),null===e&&fa(t),r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,s=i.children,ti(r,i)?s=null:null!==o&&ti(r,o)&&(t.flags|=32),xs(e,t),Os(e,t,s,n),t.child;case 6:return null===e&&fa(t),null;case 13:return Ks(e,t,n);case 4:return io(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ia(t,null,r,n):Os(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Ps(e,t,r,i=t.elementType===r?i:hs(r,i),n);case 7:return Os(e,t,t.pendingProps,n),t.child;case 8:case 12:return Os(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value,wi(Pa,r._currentValue),r._currentValue=s,null!==o)if(or(o.value,s)){if(o.children===i.children&&!Ii.current){t=ec(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var c=o.dependencies;if(null!==c){s=o.child;for(var l=c.firstContext;null!==l;){if(l.context===r){if(1===o.tag){(l=Ka(-1,n&-n)).tag=2;var d=o.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?l.next=l:(l.next=u.next,u.next=l),d.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ua(o.return,n,t),c.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ua(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}Os(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Fa(t,n),r=r(i=ja(i)),t.flags|=1,Os(e,t,r,n),t.child;case 14:return i=hs(r=t.type,t.pendingProps),Ls(e,t,r,i=hs(r.type,i),n);case 15:return Ds(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:hs(r,i),$s(e,t),t.tag=1,Pi(r)?(e=!0,xi(t)):e=!1,Fa(t,n),_s(t,r,i),Es(t,r,i,n),Fs(null,t,r,!0,e,n);case 19:return Zs(e,t,n);case 22:return ks(e,t,n)}throw Error(a(156,t.tag))};var rd="function"===typeof reportError?reportError:function(e){console.error(e)};function id(e){this._internalRoot=e}function ad(e){this._internalRoot=e}function od(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function sd(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function cd(){}function ld(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof i){var s=i;i=function(){var e=ed(o);s.call(e)}}$l(t,o,e,i)}else o=function(e,t,n,r,i){if(i){if("function"===typeof r){var a=r;r=function(){var e=ed(o);a.call(e)}}var o=Zl(t,r,e,0,null,!1,0,"",cd);return e._reactRootContainer=o,e[pi]=o.current,Br(8===e.nodeType?e.parentNode:e),yl(),o}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var s=r;r=function(){var e=ed(c);s.call(e)}}var c=Xl(e,0,!1,null,0,!1,0,"",cd);return e._reactRootContainer=c,e[pi]=c.current,Br(8===e.nodeType?e.parentNode:e),yl((function(){$l(t,c,n,r)})),c}(n,t,e,i,r);return ed(o)}ad.prototype.render=id.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));$l(e,t,null,null)},ad.prototype.unmount=id.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;yl((function(){$l(null,e,null,null)})),t[pi]=null}},ad.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lt.length&&0!==t&&t<Lt[n].priority;n++);Lt.splice(n,0,e),0===n&&Mt(e)}},yt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(gt(t,1|n),pl(t,Xe()),0===(6&Fc)&&(Zc=Xe()+500,Bi()))}break;case 13:yl((function(){var t=Wa(e,1);if(null!==t){var n=dl();hl(t,e,1,n)}})),nd(e,1)}},St=function(e){if(13===e.tag){var t=Wa(e,134217728);if(null!==t)hl(t,e,134217728,dl());nd(e,134217728)}},bt=function(e){if(13===e.tag){var t=ul(e),n=Wa(e,t);if(null!==n)hl(n,e,t,dl());nd(e,t)}},Tt=function(){return Et},Ct=function(e,t){var n=Et;try{return Et=e,t()}finally{Et=n}},Se=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=yi(r);if(!i)throw Error(a(90));K(r),Z(r,i)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=vl,Ie=yl;var dd={usingClientEntryPoint:!1,Events:[Ei,vi,yi,we,Re,vl]},ud={findFiberByHostInstance:gi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hd={bundleType:ud.bundleType,version:ud.version,rendererPackageName:ud.rendererPackageName,rendererConfig:ud.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:ud.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var pd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pd.isDisabled&&pd.supportsFiber)try{rt=pd.inject(hd),it=pd}catch(ia){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dd,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!od(t))throw Error(a(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:b,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!od(e))throw Error(a(299));var n=!1,r="",i=rd;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Xl(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,Br(8===e.nodeType?e.parentNode:e),new id(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return yl(e)},t.hydrate=function(e,t,n){if(!sd(t))throw Error(a(200));return ld(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!od(e))throw Error(a(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",s=rd;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Zl(t,null,e,1,null!=n?n:null,i,0,o,s),e[pi]=t.current,Br(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new ad(t)},t.render=function(e,t,n){if(!sd(t))throw Error(a(200));return ld(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!sd(e))throw Error(a(40));return!!e._reactRootContainer&&(yl((function(){ld(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=vl,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!sd(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return ld(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},4391:(e,t,n)=>{var r=n(7950);t.H=r.createRoot,r.hydrateRoot},7950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(xi){console.error(xi)}}(),e.exports=n(2730)},1153:(e,t,n)=>{var r=n(5043),i=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var r,a={},l=null,d=null;for(r in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,r)&&!c.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:l,ref:d,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},4202:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,_={};function g(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||f}function E(){}function v(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},E.prototype=g.prototype;var y=v.prototype=new E;y.constructor=v,m(y,g.prototype),y.isPureReactComponent=!0;var S=Array.isArray,b=Object.prototype.hasOwnProperty,T={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,r){var i,a={},o=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)b.call(t,i)&&!C.hasOwnProperty(i)&&(a[i]=t[i]);var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){for(var l=Array(c),d=0;d<c;d++)l[d]=arguments[d+2];a.children=l}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===a[i]&&(a[i]=c[i]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:T.current}}function R(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var A=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function N(e,t,i,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return o=o(c=e),e=""===a?"."+I(c,0):a,S(o)?(i="",null!=e&&(i=e.replace(A,"$&/")+"/"),N(o,t,i,"",(function(e){return e}))):null!=o&&(R(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||c&&c.key===o.key?"":(""+o.key).replace(A,"$&/")+"/")+e)),t.push(o)),1;if(c=0,a=""===a?".":a+":",S(e))for(var l=0;l<e.length;l++){var d=a+I(s=e[l],l);c+=N(s,t,i,d,o)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),l=0;!(s=e.next()).done;)c+=N(s=s.value,t,i,d=a+I(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function O(e,t,n){if(null==e)return e;var r=[],i=0;return N(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var L={current:null},D={transition:null},k={ReactCurrentDispatcher:L,ReactCurrentBatchConfig:D,ReactCurrentOwner:T};function x(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:O,forEach:function(e,t,n){O(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return O(e,(function(){t++})),t},toArray:function(e){return O(e,(function(e){return e}))||[]},only:function(e){if(!R(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=i,t.Profiler=o,t.PureComponent=v,t.StrictMode=a,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k,t.act=x,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=T.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)b.call(t,l)&&!C.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){c=Array(l);for(var d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}return{$$typeof:n,type:e.type,key:a,ref:o,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=R,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=x,t.useCallback=function(e,t){return L.current.useCallback(e,t)},t.useContext=function(e){return L.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return L.current.useDeferredValue(e)},t.useEffect=function(e,t){return L.current.useEffect(e,t)},t.useId=function(){return L.current.useId()},t.useImperativeHandle=function(e,t,n){return L.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return L.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return L.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return L.current.useMemo(e,t)},t.useReducer=function(e,t,n){return L.current.useReducer(e,t,n)},t.useRef=function(e){return L.current.useRef(e)},t.useState=function(e){return L.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return L.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return L.current.useTransition()},t.version="18.3.1"},5043:(e,t,n)=>{e.exports=n(4202)},579:(e,t,n)=>{e.exports=n(1153)},7234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<a(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,o=i>>>1;r<o;){var s=2*(r+1)-1,c=e[s],l=s+1,d=e[l];if(0>a(c,n))l<i&&0>a(d,c)?(e[r]=d,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else{if(!(l<i&&0>a(d,n)))break e;e[r]=d,e[l]=n,r=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var l=[],d=[],u=1,h=null,p=3,f=!1,m=!1,_=!1,g="function"===typeof setTimeout?setTimeout:null,E="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function y(e){for(var t=r(d);null!==t;){if(null===t.callback)i(d);else{if(!(t.startTime<=e))break;i(d),t.sortIndex=t.expirationTime,n(l,t)}t=r(d)}}function S(e){if(_=!1,y(e),!m)if(null!==r(l))m=!0,D(b);else{var t=r(d);null!==t&&k(S,t.startTime-e)}}function b(e,n){m=!1,_&&(_=!1,E(R),R=-1),f=!0;var a=p;try{for(y(n),h=r(l);null!==h&&(!(h.expirationTime>n)||e&&!N());){var o=h.callback;if("function"===typeof o){h.callback=null,p=h.priorityLevel;var s=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===r(l)&&i(l),y(n)}else i(l);h=r(l)}if(null!==h)var c=!0;else{var u=r(d);null!==u&&k(S,u.startTime-n),c=!1}return c}finally{h=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var T,C=!1,w=null,R=-1,A=5,I=-1;function N(){return!(t.unstable_now()-I<A)}function O(){if(null!==w){var e=t.unstable_now();I=e;var n=!0;try{n=w(!0,e)}finally{n?T():(C=!1,w=null)}}else C=!1}if("function"===typeof v)T=function(){v(O)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,L=P.port2;P.port1.onmessage=O,T=function(){L.postMessage(null)}}else T=function(){g(O,0)};function D(e){w=e,C||(C=!0,T())}function k(e,n){R=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(b))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:i,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(d,e),null===r(l)&&e===r(d)&&(_?(E(R),R=-1):_=!0,k(S,a-o))):(e.sortIndex=s,n(l,e),m||f||(m=!0,D(b))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},8853:(e,t,n)=>{e.exports=n(7234)},8365:(e,t,n)=>{var r=n(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},a=r.useSyncExternalStore,o=r.useRef,s=r.useEffect,c=r.useMemo,l=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,d){var u=o(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;u=c((function(){function e(e){if(!s){if(s=!0,a=e,e=r(e),void 0!==d&&h.hasValue){var t=h.value;if(d(t,e))return o=t}return o=e}if(t=o,i(a,e))return t;var n=r(e);return void 0!==d&&d(t,n)?(a=e,t):(a=e,o=n)}var a,o,s=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]}),[t,n,r,d]);var p=a(e,u[0],u[1]);return s((function(){h.hasValue=!0,h.value=p}),[p]),l(p),p}},7237:(e,t,n)=>{e.exports=n(8365)},4980:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(2284);function i(e){var t=function(e,t){if("object"!=(0,r.A)(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=(0,r.A)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==(0,r.A)(t)?t:t+""}function a(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},9379:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(4980);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},2284:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{A:()=>r})},2339:(e,t,n)=>{function r(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}n.d(t,{l$:()=>ve,Ay:()=>ye});var i=n(9379),a=n(5043);let o={data:""},s=e=>"object"==typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||o,c=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,l=/\/\*[^]*?\*\/|  +/g,d=/\n+/g,u=(e,t)=>{let n="",r="",i="";for(let a in e){let o=e[a];"@"==a[0]?"i"==a[1]?n=a+" "+o+";":r+="f"==a[1]?u(o,a):a+"{"+u(o,"k"==a[1]?"":t)+"}":"object"==typeof o?r+=u(o,t?t.replace(/([^,])+/g,(e=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):a):null!=o&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),i+=u.p?u.p(a,o):a+":"+o+";")}return n+(t&&i?t+"{"+i+"}":i)+r},h={},p=e=>{if("object"==typeof e){let t="";for(let n in e)t+=n+p(e[n]);return t}return e},f=(e,t,n,r,i)=>{let a=p(e),o=h[a]||(h[a]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(a));if(!h[o]){let t=a!==e?e:(e=>{let t,n,r=[{}];for(;t=c.exec(e.replace(l,""));)t[4]?r.shift():t[3]?(n=t[3].replace(d," ").trim(),r.unshift(r[0][n]=r[0][n]||{})):r[0][t[1]]=t[2].replace(d," ").trim();return r[0]})(e);h[o]=u(i?{["@keyframes "+o]:t}:t,n?"":"."+o)}let s=n&&h.g?h.g:null;return n&&(h.g=h[o]),((e,t,n,r)=>{r?t.data=t.data.replace(r,e):-1===t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(h[o],t,r,s),o};function m(e){let t=this||{},n=e.call?e(t.p):e;return f(n.unshift?n.raw?((e,t,n)=>e.reduce(((e,r,i)=>{let a=t[i];if(a&&a.call){let e=a(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;a=t?"."+t:e&&"object"==typeof e?e.props?"":u(e,""):!1===e?"":e}return e+r+(null==a?"":a)}),""))(n,[].slice.call(arguments,1),t.p):n.reduce(((e,n)=>Object.assign(e,n&&n.call?n(t.p):n)),{}):n,s(t.target),t.g,t.o,t.k)}m.bind({g:1});let _,g,E,v=m.bind({k:1});function y(e,t){let n=this||{};return function(){let r=arguments;function i(a,o){let s=Object.assign({},a),c=s.className||i.className;n.p=Object.assign({theme:g&&g()},s),n.o=/ *go\d+/.test(c),s.className=m.apply(n,r)+(c?" "+c:""),t&&(s.ref=o);let l=e;return e[0]&&(l=s.as||e,delete s.as),E&&l[0]&&E(s),_(l,s)}return t?t(i):i}}var S,b,T,C,w,R,A,I,N,O,P,L,D,k,x,M,U=(e,t)=>(e=>"function"==typeof e)(e)?e(t):e,F=(()=>{let e=0;return()=>(++e).toString()})(),j=(()=>{let e;return()=>{if(void 0===e&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),V=new Map,B=e=>{if(V.has(e))return;let t=setTimeout((()=>{V.delete(e),q({type:4,toastId:e})}),1e3);V.set(e,t)},G=(e,t)=>{switch(t.type){case 0:return(0,i.A)((0,i.A)({},e),{},{toasts:[t.toast,...e.toasts].slice(0,20)});case 1:return t.toast.id&&(e=>{let t=V.get(e);t&&clearTimeout(t)})(t.toast.id),(0,i.A)((0,i.A)({},e),{},{toasts:e.toasts.map((e=>e.id===t.toast.id?(0,i.A)((0,i.A)({},e),t.toast):e))});case 2:let{toast:n}=t;return e.toasts.find((e=>e.id===n.id))?G(e,{type:1,toast:n}):G(e,{type:0,toast:n});case 3:let{toastId:r}=t;return r?B(r):e.toasts.forEach((e=>{B(e.id)})),(0,i.A)((0,i.A)({},e),{},{toasts:e.toasts.map((e=>e.id===r||void 0===r?(0,i.A)((0,i.A)({},e),{},{visible:!1}):e))});case 4:return void 0===t.toastId?(0,i.A)((0,i.A)({},e),{},{toasts:[]}):(0,i.A)((0,i.A)({},e),{},{toasts:e.toasts.filter((e=>e.id!==t.toastId))});case 5:return(0,i.A)((0,i.A)({},e),{},{pausedAt:t.time});case 6:let a=t.time-(e.pausedAt||0);return(0,i.A)((0,i.A)({},e),{},{pausedAt:void 0,toasts:e.toasts.map((e=>(0,i.A)((0,i.A)({},e),{},{pauseDuration:e.pauseDuration+a})))})}},W=[],H={toasts:[],pausedAt:void 0},q=e=>{H=G(H,e),W.forEach((e=>{e(H)}))},z={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},K=e=>(t,n)=>{let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blank",n=arguments.length>2?arguments[2]:void 0;return(0,i.A)((0,i.A)({createdAt:Date.now(),visible:!0,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0},n),{},{id:(null==n?void 0:n.id)||F()})}(t,e,n);return q({type:2,toast:r}),r.id},Y=(e,t)=>K("blank")(e,t);Y.error=K("error"),Y.success=K("success"),Y.loading=K("loading"),Y.custom=K("custom"),Y.dismiss=e=>{q({type:3,toastId:e})},Y.remove=e=>q({type:4,toastId:e}),Y.promise=(e,t,n)=>{let r=Y.loading(t.loading,(0,i.A)((0,i.A)({},n),null==n?void 0:n.loading));return e.then((e=>(Y.success(U(t.success,e),(0,i.A)((0,i.A)({id:r},n),null==n?void 0:n.success)),e))).catch((e=>{Y.error(U(t.error,e),(0,i.A)((0,i.A)({id:r},n),null==n?void 0:n.error))})),e};var J=(e,t)=>{q({type:1,toast:{id:e,height:t}})},X=()=>{q({type:5,time:Date.now()})},Q=e=>{let{toasts:t,pausedAt:n}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,a.useState)(H);(0,a.useEffect)((()=>(W.push(n),()=>{let e=W.indexOf(n);e>-1&&W.splice(e,1)})),[t]);let r=t.toasts.map((t=>{var n,r;return(0,i.A)((0,i.A)((0,i.A)((0,i.A)({},e),e[t.type]),t),{},{duration:t.duration||(null==(n=e[t.type])?void 0:n.duration)||(null==e?void 0:e.duration)||z[t.type],style:(0,i.A)((0,i.A)((0,i.A)({},e.style),null==(r=e[t.type])?void 0:r.style),t.style)})}));return(0,i.A)((0,i.A)({},t),{},{toasts:r})}(e);(0,a.useEffect)((()=>{if(n)return;let e=Date.now(),r=t.map((t=>{if(t.duration===1/0)return;let n=(t.duration||0)+t.pauseDuration-(e-t.createdAt);if(!(n<0))return setTimeout((()=>Y.dismiss(t.id)),n);t.visible&&Y.dismiss(t.id)}));return()=>{r.forEach((e=>e&&clearTimeout(e)))}}),[t,n]);let r=(0,a.useCallback)((()=>{n&&q({type:6,time:Date.now()})}),[n]),o=(0,a.useCallback)(((e,n)=>{let{reverseOrder:r=!1,gutter:i=8,defaultPosition:a}=n||{},o=t.filter((t=>(t.position||a)===(e.position||a)&&t.height)),s=o.findIndex((t=>t.id===e.id)),c=o.filter(((e,t)=>t<s&&e.visible)).length;return o.filter((e=>e.visible)).slice(...r?[c+1]:[0,c]).reduce(((e,t)=>e+(t.height||0)+i),0)}),[t]);return{toasts:t,handlers:{updateHeight:J,startPause:X,endPause:r,calculateOffset:o}}},Z=v(S||(S=r(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n transform: scale(1) rotate(45deg);\n  opacity: 1;\n}"]))),$=v(b||(b=r(["\nfrom {\n  transform: scale(0);\n  opacity: 0;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),ee=v(T||(T=r(["\nfrom {\n  transform: scale(0) rotate(90deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(90deg);\n\topacity: 1;\n}"]))),te=y("div")(C||(C=r(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n\n  &:after,\n  &:before {\n    content: '';\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 150ms;\n    position: absolute;\n    border-radius: 3px;\n    opacity: 0;\n    background: ",";\n    bottom: 9px;\n    left: 4px;\n    height: 2px;\n    width: 12px;\n  }\n\n  &:before {\n    animation: "," 0.15s ease-out forwards;\n    animation-delay: 180ms;\n    transform: rotate(90deg);\n  }\n"])),(e=>e.primary||"#ff4b4b"),Z,$,(e=>e.secondary||"#fff"),ee),ne=v(w||(w=r(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),re=y("div")(R||(R=r(["\n  width: 12px;\n  height: 12px;\n  box-sizing: border-box;\n  border: 2px solid;\n  border-radius: 100%;\n  border-color: ",";\n  border-right-color: ",";\n  animation: "," 1s linear infinite;\n"])),(e=>e.secondary||"#e0e0e0"),(e=>e.primary||"#616161"),ne),ie=v(A||(A=r(["\nfrom {\n  transform: scale(0) rotate(45deg);\n\topacity: 0;\n}\nto {\n  transform: scale(1) rotate(45deg);\n\topacity: 1;\n}"]))),ae=v(I||(I=r(["\n0% {\n\theight: 0;\n\twidth: 0;\n\topacity: 0;\n}\n40% {\n  height: 0;\n\twidth: 6px;\n\topacity: 1;\n}\n100% {\n  opacity: 1;\n  height: 10px;\n}"]))),oe=y("div")(N||(N=r(["\n  width: 20px;\n  opacity: 0;\n  height: 20px;\n  border-radius: 10px;\n  background: ",";\n  position: relative;\n  transform: rotate(45deg);\n\n  animation: "," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n  animation-delay: 100ms;\n  &:after {\n    content: '';\n    box-sizing: border-box;\n    animation: "," 0.2s ease-out forwards;\n    opacity: 0;\n    animation-delay: 200ms;\n    position: absolute;\n    border-right: 2px solid;\n    border-bottom: 2px solid;\n    border-color: ",";\n    bottom: 6px;\n    left: 6px;\n    height: 10px;\n    width: 6px;\n  }\n"])),(e=>e.primary||"#61d345"),ie,ae,(e=>e.secondary||"#fff")),se=y("div")(O||(O=r(["\n  position: absolute;\n"]))),ce=y("div")(P||(P=r(["\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 20px;\n  min-height: 20px;\n"]))),le=v(L||(L=r(["\nfrom {\n  transform: scale(0.6);\n  opacity: 0.4;\n}\nto {\n  transform: scale(1);\n  opacity: 1;\n}"]))),de=y("div")(D||(D=r(["\n  position: relative;\n  transform: scale(0.6);\n  opacity: 0.4;\n  min-width: 20px;\n  animation: "," 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)\n    forwards;\n"])),le),ue=e=>{let{toast:t}=e,{icon:n,type:r,iconTheme:o}=t;return void 0!==n?"string"==typeof n?a.createElement(de,null,n):n:"blank"===r?null:a.createElement(ce,null,a.createElement(re,(0,i.A)({},o)),"loading"!==r&&a.createElement(se,null,"error"===r?a.createElement(te,(0,i.A)({},o)):a.createElement(oe,(0,i.A)({},o))))},he=e=>"\n0% {transform: translate3d(0,".concat(-200*e,"%,0) scale(.6); opacity:.5;}\n100% {transform: translate3d(0,0,0) scale(1); opacity:1;}\n"),pe=e=>"\n0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}\n100% {transform: translate3d(0,".concat(-150*e,"%,-1px) scale(.6); opacity:0;}\n"),fe=y("div")(k||(k=r(["\n  display: flex;\n  align-items: center;\n  background: #fff;\n  color: #363636;\n  line-height: 1.3;\n  will-change: transform;\n  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);\n  max-width: 350px;\n  pointer-events: auto;\n  padding: 8px 10px;\n  border-radius: 8px;\n"]))),me=y("div")(x||(x=r(["\n  display: flex;\n  justify-content: center;\n  margin: 4px 10px;\n  color: inherit;\n  flex: 1 1 auto;\n  white-space: pre-line;\n"]))),_e=a.memo((e=>{let{toast:t,position:n,style:r,children:o}=e,s=t.height?((e,t)=>{let n=e.includes("top")?1:-1,[r,i]=j()?["0%{opacity:0;} 100%{opacity:1;}","0%{opacity:1;} 100%{opacity:0;}"]:[he(n),pe(n)];return{animation:t?"".concat(v(r)," 0.35s cubic-bezier(.21,1.02,.73,1) forwards"):"".concat(v(i)," 0.4s forwards cubic-bezier(.06,.71,.55,1)")}})(t.position||n||"top-center",t.visible):{opacity:0},c=a.createElement(ue,{toast:t}),l=a.createElement(me,(0,i.A)({},t.ariaProps),U(t.message,t));return a.createElement(fe,{className:t.className,style:(0,i.A)((0,i.A)((0,i.A)({},s),r),t.style)},"function"==typeof o?o({icon:c,message:l}):a.createElement(a.Fragment,null,c,l))}));!function(e,t,n,r){u.p=t,_=e,g=n,E=r}(a.createElement);var ge=e=>{let{id:t,className:n,style:r,onHeightUpdate:i,children:o}=e,s=a.useCallback((e=>{if(e){let n=()=>{let n=e.getBoundingClientRect().height;i(t,n)};n(),new MutationObserver(n).observe(e,{subtree:!0,childList:!0,characterData:!0})}}),[t,i]);return a.createElement("div",{ref:s,className:n,style:r},o)},Ee=m(M||(M=r(["\n  z-index: 9999;\n  > * {\n    pointer-events: auto;\n  }\n"]))),ve=e=>{let{reverseOrder:t,position:n="top-center",toastOptions:r,gutter:o,children:s,containerStyle:c,containerClassName:l}=e,{toasts:d,handlers:u}=Q(r);return a.createElement("div",{style:(0,i.A)({position:"fixed",zIndex:9999,top:16,left:16,right:16,bottom:16,pointerEvents:"none"},c),className:l,onMouseEnter:u.startPause,onMouseLeave:u.endPause},d.map((e=>{let r=e.position||n,c=((e,t)=>{let n=e.includes("top"),r=n?{top:0}:{bottom:0},a=e.includes("center")?{justifyContent:"center"}:e.includes("right")?{justifyContent:"flex-end"}:{};return(0,i.A)((0,i.A)({left:0,right:0,display:"flex",position:"absolute",transition:j()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:"translateY(".concat(t*(n?1:-1),"px)")},r),a)})(r,u.calculateOffset(e,{reverseOrder:t,gutter:o,defaultPosition:n}));return a.createElement(ge,{id:e.id,key:e.id,onHeightUpdate:u.updateHeight,className:e.visible?Ee:"",style:c},"custom"===e.type?U(e.message,e):s?s(e):a.createElement(_e,{toast:e,position:r}))})))},ye=Y}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>r[e]));return o.default=()=>r,n.d(a,o),a}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+".chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="quipo-chrome-extension:";n.l=(r,i,a,o)=>{if(e[r])e[r].push(i);else{var s,c;if(void 0!==a)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==r||u.getAttribute("data-webpack")==t+a){s=u;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=r),e[r]=[i];var h=(t,n)=>{s.onerror=s.onload=null,clearTimeout(p);var i=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(n))),t)return t(n)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),c&&document.head.appendChild(s)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var a=new Promise(((n,r)=>i=e[t]=[n,r]));r.push(i[2]=a);var o=n.p+n.u(t),s=new Error;n.l(o,(r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,i[1](s)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,a,o=r[0],s=r[1],c=r[2],l=0;if(o.some((t=>0!==e[t]))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(c)c(n)}for(t&&t(r);l<o.length;l++)a=o[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkquipo_chrome_extension=self.webpackChunkquipo_chrome_extension||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r={};n.r(r),n.d(r,{hasBrowserEnv:()=>An,hasStandardBrowserEnv:()=>Nn,hasStandardBrowserWebWorkerEnv:()=>On,navigator:()=>In,origin:()=>Pn});var i=n(5043),a=n(4391),o=n(7237);function s(e){e()}var c={notify(){},get:()=>[]};function l(e,t){let n,r=c,i=0,a=!1;function o(){u.onStateChange&&u.onStateChange()}function l(){i++,n||(n=t?t.addNestedSub(o):e.subscribe(o),r=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){s((()=>{let t=e;for(;t;)t.callback(),t=t.next}))},get(){const t=[];let n=e;for(;n;)t.push(n),n=n.next;return t},subscribe(n){let r=!0;const i=t={callback:n,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){r&&null!==e&&(r=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}())}function d(){i--,n&&0===i&&(n(),n=void 0,r.clear(),r=c)}const u={addNestedSub:function(e){l();const t=r.subscribe(e);let n=!1;return()=>{n||(n=!0,t(),d())}},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:o,isSubscribed:function(){return a},trySubscribe:function(){a||(a=!0,l())},tryUnsubscribe:function(){a&&(a=!1,d())},getListeners:()=>r};return u}var d=(()=>!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement))(),u=(()=>"undefined"!==typeof navigator&&"ReactNative"===navigator.product)(),h=(()=>d||u?i.useLayoutEffect:i.useEffect)();Object.defineProperty,Object.getOwnPropertyNames,Object.getOwnPropertySymbols,Object.getOwnPropertyDescriptor,Object.getPrototypeOf,Object.prototype;var p=Symbol.for("react-redux-context"),f="undefined"!==typeof globalThis?globalThis:{};function m(){var e;if(!i.createContext)return{};const t=null!==(e=f[p])&&void 0!==e?e:f[p]=new Map;let n=t.get(i.createContext);return n||(n=i.createContext(null),t.set(i.createContext,n)),n}var _=m();var g=function(e){const{children:t,context:n,serverState:r,store:a}=e,o=i.useMemo((()=>{const e=l(a);return{store:a,subscription:e,getServerState:r?()=>r:void 0}}),[a,r]),s=i.useMemo((()=>a.getState()),[a]);h((()=>{const{subscription:e}=o;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),s!==a.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}}),[o,s]);const c=n||_;return i.createElement(c.Provider,{value:o},t)};function E(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;return function(){return i.useContext(e)}}var v=E();function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;const t=e===_?v:E(e),n=()=>{const{store:e}=t();return e};return Object.assign(n,{withTypes:()=>n}),n}var S=y();function b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;const t=e===_?S:y(e),n=()=>t().dispatch;return Object.assign(n,{withTypes:()=>n}),n}var T=b(),C=(e,t)=>e===t;function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;const t=e===_?v:E(e),n=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{equalityFn:r=C}="function"===typeof n?{equalityFn:n}:n;const a=t(),{store:s,subscription:c,getServerState:l}=a,d=(i.useRef(!0),i.useCallback({[e.name]:t=>e(t)}[e.name],[e])),u=(0,o.useSyncExternalStoreWithSelector)(c.addNestedSub,s.getState,l||s.getState,d,r);return i.useDebugValue(u),u};return Object.assign(n,{withTypes:()=>n}),n}var R=w(),A=n(9379);function I(e){return"Minified Redux error #".concat(e,"; visit https://redux.js.org/Errors?code=").concat(e," for the full message or use the non-minified dev environment for full errors. ")}var N=(()=>"function"===typeof Symbol&&Symbol.observable||"@@observable")(),O=()=>Math.random().toString(36).substring(7).split("").join("."),P={INIT:"@@redux/INIT".concat(O()),REPLACE:"@@redux/REPLACE".concat(O()),PROBE_UNKNOWN_ACTION:()=>"@@redux/PROBE_UNKNOWN_ACTION".concat(O())};function L(e){if("object"!==typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function D(e,t,n){if("function"!==typeof e)throw new Error(I(2));if("function"===typeof t&&"function"===typeof n||"function"===typeof n&&"function"===typeof arguments[3])throw new Error(I(0));if("function"===typeof t&&"undefined"===typeof n&&(n=t,t=void 0),"undefined"!==typeof n){if("function"!==typeof n)throw new Error(I(1));return n(D)(e,t)}let r=e,i=t,a=new Map,o=a,s=0,c=!1;function l(){o===a&&(o=new Map,a.forEach(((e,t)=>{o.set(t,e)})))}function d(){if(c)throw new Error(I(3));return i}function u(e){if("function"!==typeof e)throw new Error(I(4));if(c)throw new Error(I(5));let t=!0;l();const n=s++;return o.set(n,e),function(){if(t){if(c)throw new Error(I(6));t=!1,l(),o.delete(n),a=null}}}function h(e){if(!L(e))throw new Error(I(7));if("undefined"===typeof e.type)throw new Error(I(8));if("string"!==typeof e.type)throw new Error(I(17));if(c)throw new Error(I(9));try{c=!0,i=r(i,e)}finally{c=!1}return(a=o).forEach((e=>{e()})),e}h({type:P.INIT});return{dispatch:h,subscribe:u,getState:d,replaceReducer:function(e){if("function"!==typeof e)throw new Error(I(10));r=e,h({type:P.REPLACE})},[N]:function(){const e=u;return{subscribe(t){if("object"!==typeof t||null===t)throw new Error(I(11));function n(){const e=t;e.next&&e.next(d())}n();return{unsubscribe:e(n)}},[N](){return this}}}}}const k=Object.freeze({CLINIC:"Clinic",PHONE_APPOINTMENT:"Phone",VIRTUAL_APPOINTMENT:"Video",QUESTIONNAIRE:"Questionnaire",DICTATION:"Dictation",AI_SUMMARY:"AI Summary"}),x=Object.freeze({CLINIC:"Clinic",PHONE_CALL:"Phone call",VIDEO_CALL:"Video call"}),M=Object.freeze({TIMER:"TIMER",NAME:"NAME"}),U=Object.freeze({DEFAULT:"DEF",NONE:"NONE"});var F=n(6968);const j={linkType:"",demoGraphicId:"",patientName:"",currentWindow:"",phoneNumber:"",appointmentNumber:"",dob:"",email:"",phn:"",inProgress:!1,screen:U.DEFAULT,doctorName:"",previousData:{}},V=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F.DATA_CONSTANTS.SET_LINK_TYPE:return(0,A.A)((0,A.A)({},e),{},{linkType:t.payload});case F.DATA_CONSTANTS.SET_DEMOGRAPHIC_ID:return(0,A.A)((0,A.A)({},e),{},{demoGraphicId:t.payload});case F.DATA_CONSTANTS.SET_PATIENT_NAME:return(0,A.A)((0,A.A)({},e),{},{patientName:t.payload});case F.DATA_CONSTANTS.SET_CURRENT_WINDOW:return(0,A.A)((0,A.A)({},e),{},{currentWindow:t.payload});case F.DATA_CONSTANTS.SET_PHONE_NUMBER:return(0,A.A)((0,A.A)({},e),{},{phoneNumber:t.payload});case F.DATA_CONSTANTS.SET_APPOINTMENT_NUMBER:return(0,A.A)((0,A.A)({},e),{},{appointmentNumber:t.payload});case F.DATA_CONSTANTS.SET_EMAIL:return(0,A.A)((0,A.A)({},e),{},{email:t.payload});case F.DATA_CONSTANTS.SET_DOB:return(0,A.A)((0,A.A)({},e),{},{dob:t.payload});case F.DATA_CONSTANTS.SET_PHN:return(0,A.A)((0,A.A)({},e),{},{phn:t.payload});case F.DATA_CONSTANTS.SET_IN_PROGRESS:return(0,A.A)((0,A.A)({},e),{},{inProgress:t.payload});case F.DATA_CONSTANTS.CLEAR_STATES:return j;case F.DATA_CONSTANTS.SET_SCREEN:return(0,A.A)((0,A.A)({},e),{},{screen:t.payload});case F.DATA_CONSTANTS.SET_DOCTOR:return(0,A.A)((0,A.A)({},e),{},{doctorName:t.payload});case F.DATA_CONSTANTS.SET_PREVIOUS_DATA:return(0,A.A)((0,A.A)({},e),{},{previousData:t.payload});default:return e}},B="START_RECORDING",G="STOP_RECORDING",W="PAUSE_RECORDING",H="RESUME_RECORDING",q="SET_TRANSCRIPT",z="SET_ERROR",K="SET_SOAP_NOTE",Y="SET_DICTATION",J={transcriptText:"",isRecording:!1,isPaused:!1,error:null,soapNotes:[],responseCount:1,soapNote:null,dictationText:"",isSoapNoteLoaded:null};const X="SET_DEVICE_READY",Q="SET_IS_CALL_MUTED",Z="SET_IS_CALL_RINGING",$="SET_IS_CALL_ACTIVE",ee="SET_IS_CALL_ALREADY_CONNECTED",te="SET_IS_CALL_DISCONNECTED",ne="CLEAR_STATES",re={isDeviceReady:!1,callButtonDisabled:!1,hangupButtonDisabled:!1,muteButtonDisabled:!1,isCallMuted:!1,isCallRinging:!1,isCallActive:!1,isCallAlreadyConnected:!1,isDisconnected:!1},ie=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case X:return(0,A.A)((0,A.A)({},e),{},{isDeviceReady:t.payload});case"SET_CALL_BUTTON_DISABLED":return(0,A.A)((0,A.A)({},e),{},{callButtonDisabled:t.payload});case"SET_HANGUP_BUTTON_DISABLED":return(0,A.A)((0,A.A)({},e),{},{hangupButtonDisabled:t.payload});case"SET_MUTE_BUTTON_DISABLED":return(0,A.A)((0,A.A)({},e),{},{muteButtonDisabled:t.payload});case Q:return(0,A.A)((0,A.A)({},e),{},{isCallMuted:t.payload});case Z:return(0,A.A)((0,A.A)({},e),{},{isCallRinging:t.payload});case $:return(0,A.A)((0,A.A)({},e),{},{isCallActive:t.payload});case ee:return(0,A.A)((0,A.A)({},e),{},{isCallAlreadyConnected:t.payload});case te:return(0,A.A)((0,A.A)({},e),{},{isDisconnected:t.payload});case ne:return re;default:return e}};function ae(e){return t=>{let{dispatch:n,getState:r}=t;return t=>i=>"function"===typeof i?i(n,r,e):t(i)}}var oe=ae();const se="LOGIN_REQUEST",ce="LOGIN_SUCCESS",le="LOGIN_FAILURE",de="LOGOUT",ue={user:null,loading:!1,error:null,isAuthenticated:!1},he="SET_FIRST_API_QUESTIONS",pe="SET_SECOND_API_QUESTIONS",fe="SET_IS_APPOINTMENT_QUESTIONNAIRE_LOADED",me="SET_IS_NEW_PATIENT_QUESTIONNAIRE_LOADED",_e="SET_ACCORDION_DATA",ge="SET_SOAP_API_DATA",Ee={firstApiQuestions:null,secondApiQuestions:null,isAppointmentQuestionnaireLoaded:!1,isNewPatientQuestionnaireLoaded:!1,accordionData:[],soapApiData:null},ve="SET_VIDEO_CALL_ACTIVE",ye="TOGGLE_CAM",Se="SET_TOKEN",be={isVideoCallActive:!1,micOn:!0,cameraOn:!0,token:""},Te=function(e){const t=Object.keys(e),n={};for(let o=0;o<t.length;o++){const r=t[o];0,"function"===typeof e[r]&&(n[r]=e[r])}const r=Object.keys(n);let i;try{!function(e){Object.keys(e).forEach((t=>{const n=e[t];if("undefined"===typeof n(void 0,{type:P.INIT}))throw new Error(I(12));if("undefined"===typeof n(void 0,{type:P.PROBE_UNKNOWN_ACTION()}))throw new Error(I(13))}))}(n)}catch(a){i=a}return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(i)throw i;let a=!1;const o={};for(let i=0;i<r.length;i++){const s=r[i],c=n[s],l=e[s],d=c(l,t);if("undefined"===typeof d){t&&t.type;throw new Error(I(14))}o[s]=d,a=a||d!==l}return a=a||r.length!==Object.keys(e).length,a?o:e}}({data:V,scribe:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case B:return(0,A.A)((0,A.A)({},e),{},{isRecording:!0,isPaused:!1,error:null});case G:return(0,A.A)((0,A.A)({},e),{},{isRecording:!1,isPaused:!1,isStopping:!1,transcriptText:t.payload,error:null});case W:return(0,A.A)((0,A.A)({},e),{},{isPaused:!0});case H:return(0,A.A)((0,A.A)({},e),{},{isPaused:!1});case q:return(0,A.A)((0,A.A)({},e),{},{transcriptText:t.payload});case K:return 0===e.soapNotes.length?(0,A.A)((0,A.A)({},e),{},{soapNotes:[t.payload],soapNote:t.payload}):(0,A.A)((0,A.A)({},e),{},{soapNotes:[...e.soapNotes.flat(),t.payload],soapNote:t.payload});case z:return(0,A.A)((0,A.A)({},e),{},{error:t.payload});case Y:return(0,A.A)((0,A.A)({},e),{},{dictationText:t.payload});case"SET_STOPPING":return(0,A.A)((0,A.A)({},e),{},{isStopping:t.payload});case"CLEAR_STATES":return J;case"SET_RESPONSE_COUNT":{const{payload:n}=t,r=e.soapNotes[n-1]||null;return(0,A.A)((0,A.A)({},e),{},{responseCount:n,soapNote:r})}case"SET_IS_SOAP_NOTE_LOADED":return(0,A.A)((0,A.A)({},e),{},{isSoapNoteLoaded:t.payload});default:return e}},twilio:ie,user:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case se:return(0,A.A)((0,A.A)({},e),{},{loading:!0,error:null});case ce:return(0,A.A)((0,A.A)({},e),{},{loading:!1,user:t.payload,isAuthenticated:!0,error:null});case le:return(0,A.A)((0,A.A)({},e),{},{loading:!1,error:t.payload,isAuthenticated:!1});case de:return(0,A.A)((0,A.A)({},e),{},{user:null,isAuthenticated:!1});default:return e}},questionnaire:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he:return(0,A.A)((0,A.A)({},e),{},{firstApiQuestions:t.payload});case pe:return(0,A.A)((0,A.A)({},e),{},{secondApiQuestions:t.payload});case fe:return(0,A.A)((0,A.A)({},e),{},{isAppointmentQuestionnaireLoaded:t.payload});case me:return(0,A.A)((0,A.A)({},e),{},{isNewPatientQuestionnaireLoaded:t.payload});case _e:return(0,A.A)((0,A.A)({},e),{},{accordionData:t.payload});case"CLEAR_STATES":return Ee;case ge:return(0,A.A)((0,A.A)({},e),{},{soapApiData:t.payload});default:return e}},video:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ve:return(0,A.A)((0,A.A)({},e),{},{isVideoCallActive:t.payload});case"TOGGLE_MIC":return(0,A.A)((0,A.A)({},e),{},{micOn:!e.micOn});case ye:return(0,A.A)((0,A.A)({},e),{},{cameraOn:!e.cameraOn});case Se:return(0,A.A)((0,A.A)({},e),{},{token:t.payload});case"CLEAR_STATES":return be;default:return e}}}),Ce=D(Te,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>(n,r)=>{const i=e(n,r);let a=()=>{throw new Error(I(15))};const o={getState:i.getState,dispatch:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return a(e,...n)}},s=t.map((e=>e(o)));return a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?e=>e:1===t.length?t[0]:t.reduce(((e,t)=>function(){return e(t(...arguments))}))}(...s)(i.dispatch),(0,A.A)((0,A.A)({},i),{},{dispatch:a})}}(oe)),we=Ce;var Re=n(579);const Ae=function(e){let{parent:t}=e;return(0,Re.jsx)("div",{className:"qpeLoader-container",style:{borderRadius:"summary"===t?"12px":"0"},children:(0,Re.jsx)("div",{className:"qpeSpinner"})})},{DATA_CONSTANTS:Ie}=n(6968),Ne=e=>({type:Ie.SET_LINK_TYPE,payload:e}),Oe=e=>({type:Ie.SET_PREVIOUS_DATA,payload:e});const Pe=function(){const e=T(),t=R((e=>e.data.linkType));return(0,Re.jsxs)("div",{className:"qpeIndex-container",children:[(0,Re.jsxs)("h1",{className:"qpeIndex-heading",children:["Data available: ",t||"None"]}),(0,Re.jsxs)("div",{className:"qpeButton-container",children:[(0,Re.jsx)("button",{className:"qpeIndex-button",onClick:()=>e(Ne("Video call")),children:"Direct to Video"}),(0,Re.jsx)("button",{className:"qpeIndex-button",onClick:()=>e(Ne("Phone call")),children:"Direct to Phone"}),(0,Re.jsx)("button",{className:"qpeIndex-button",onClick:()=>e(Ne("Clinic")),children:"Direct to Inclinic"})]})]})};var Le=n(9966);const De=async(e,t,n)=>{const r="".concat("https://api.aiscribe.quipohealth.com/api","/soapnote");if(!r)return void(0,Le.O)("error","SOAP note API URL is not defined",!1);const i={appt_id:n,conversation:e||"",questionnaire:{appointment:(null===t||void 0===t?void 0:t.appointment)||[]}};try{const e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok){const t=await e.text();throw console.error("SOAP note API request failed. Status: ".concat(e.status,", Response: ").concat(t)),new Error("HTTP error! Status: ".concat(e.status))}return await e.json()}catch(a){throw(0,Le.O)("error","Unable to create AI summary. Error: ".concat(a.message),!1),a}},ke=e=>{let{selectedTab:t,setSelectedTab:n}=e;const{linkType:r}=R((e=>e.data)),a=(0,i.useRef)(null),o=(0,i.useRef)(null),s=()=>{try{switch(r){case x.CLINIC:return[k.CLINIC,k.QUESTIONNAIRE,k.DICTATION,k.AI_SUMMARY];case x.PHONE_CALL:return[k.PHONE_APPOINTMENT,k.QUESTIONNAIRE,k.DICTATION,k.AI_SUMMARY];case x.VIDEO_CALL:return[k.VIRTUAL_APPOINTMENT,k.QUESTIONNAIRE,k.DICTATION,k.AI_SUMMARY];default:(0,Le.O)("error",'Link type not available ,"'.concat(r,'"'),!1)}}catch(e){return(0,Le.O)("error","Error fetching tabs : ".concat(e),!1),[]}},c=e=>{try{if(!a.current||!o.current)return void(0,Le.O)("error","Animated Border or Tab Container not found",!1);const t=a.current.children[e];if(!t)return void(0,Le.O)("error","Tab not found at index ".concat(e),!1);const{offsetWidth:n,offsetLeft:r}=t;o.current.style.width="".concat(n,"px"),o.current.style.transform="translateX(".concat(r,"px)")}catch(t){(0,Le.O)("error","Error moving animated border: ".concat(t),!1)}};(0,i.useEffect)((()=>{try{const e=s(),r=e.indexOf(t);-1!==r?c(r):((0,Le.O)("warning",'Selected tab "'.concat(t,'" not found in tabs'),!1),e.length>0&&n(e[0]))}catch(e){(0,Le.O)("error","Error getting tabs: ".concat(e),!1)}}),[t]);const l=s();return(0,Re.jsxs)("div",{className:"qpeTabContainer",ref:a,children:[l.length>0?l.map(((e,r)=>(0,Re.jsx)("div",{className:"qpeTabOption ".concat(t===e?"qpeSelectedTab":""),onClick:()=>((e,t)=>{e?(n(e),c(t)):(0,Le.O)("error","Invalid Tab clicked",!1)})(e,r),children:e},e))):(0,Re.jsx)("div",{className:"qpeErrorContainer",children:(0,Re.jsx)("p",{children:"No tabs available. Please check your configuration."})}),(0,Re.jsx)("div",{className:"animatedBorder",ref:o})]})},xe=()=>{const e=T(),[t,n]=(0,i.useState)(""),{isRecording:r,transcriptText:a,dictationText:o,isPaused:s}=R((e=>e.scribe)),c=(0,i.useRef)(null),{inProgress:l}=R((e=>e.data));(0,i.useEffect)((()=>{try{a&&n(a)}catch(e){(0,Le.O)("error","Error updating editable text",!1)}}),[a]),(0,i.useEffect)((()=>{r&&l&&a&&o&&(a.endsWith(o)?n(a):n("".concat(a," ").concat(o).trim()))}),[r,a,o,l,e,t]),(0,i.useEffect)((()=>{r&&a&&o&&!l&&n("".concat(a," ").concat(o).trim())}),[r,a,o,l]),(0,i.useEffect)((()=>{r||n(a||"")}),[r,a]);return(0,i.useEffect)((()=>{r&&!a&&n(o)}),[r,o]),(0,i.useEffect)((()=>{r&&a&&o&&s&&!l&&n(a&&o?"".concat(a," ").concat(o):a)}),[r,a,o,s,l,e]),(0,Re.jsx)("div",{className:"qpeMajorTextContainer custom-scrollbar",children:(0,Re.jsx)("div",{className:"qpeTextContainer custom-scrollbar",children:o||a?(0,Re.jsx)("textarea",{ref:c,value:t,onChange:e=>{n(e.target.value)},onBlur:()=>{try{r||s||t!==a&&(e({type:q,payload:t}),sessionStorage.setItem("qpeTranscript",t))}catch(n){(0,Le.O)("error","Error saving edited transcript",n)}},disabled:l,placeholder:"Edit or view transcription...",className:"qpeTextArea custom-scrollbar"}):(0,Re.jsx)("div",{className:"qpeNoData",children:(0,Re.jsx)("p",{children:"No transcription available."})})})})},Me=e=>{let{fill:t="#000",stroke:n="#000"}=e;return(0,Re.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,Re.jsx)("path",{d:"M18.4 31L17 29.6L22.6 24L17 18.4L18.4 17L24 22.6L29.6 17L31 18.4L25.4 24L31 29.6L29.6 31L24 25.4L18.4 31Z",fill:"#40484C"}),(0,Re.jsx)("defs",{children:(0,Re.jsx)("clipPath",{id:"clip0_3_1719",children:(0,Re.jsx)("rect",{x:"4",y:"4",width:"40",height:"40",rx:"20",fill:"white"})})})]})},Ue=e=>{let{color:t="#fff"}=e;return(0,Re.jsx)("svg",{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M12.5 14C11.6667 14 10.9583 13.7083 10.375 13.125C9.79167 12.5417 9.5 11.8333 9.5 11V5C9.5 4.16667 9.79167 3.45833 10.375 2.875C10.9583 2.29167 11.6667 2 12.5 2C13.3333 2 14.0417 2.29167 14.625 2.875C15.2083 3.45833 15.5 4.16667 15.5 5V11C15.5 11.8333 15.2083 12.5417 14.625 13.125C14.0417 13.7083 13.3333 14 12.5 14ZM11.5 20V17.925C9.96667 17.7083 8.65417 17.0583 7.5625 15.975C6.47083 14.8917 5.80833 13.575 5.575 12.025C5.54167 11.7417 5.61667 11.5 5.8 11.3C5.98333 11.1 6.21667 11 6.5 11C6.78333 11 7.02083 11.0958 7.2125 11.2875C7.40417 11.4792 7.53333 11.7167 7.6 12C7.83333 13.1667 8.4125 14.125 9.3375 14.875C10.2625 15.625 11.3167 16 12.5 16C13.7 16 14.7583 15.6208 15.675 14.8625C16.5917 14.1042 17.1667 13.15 17.4 12C17.4667 11.7167 17.5958 11.4792 17.7875 11.2875C17.9792 11.0958 18.2167 11 18.5 11C18.7833 11 19.0167 11.1 19.2 11.3C19.3833 11.5 19.4583 11.7417 19.425 12.025C19.1917 13.5417 18.5333 14.85 17.45 15.95C16.3667 17.05 15.05 17.7083 13.5 17.925V20C13.5 20.2833 13.4042 20.5208 13.2125 20.7125C13.0208 20.9042 12.7833 21 12.5 21C12.2167 21 11.9792 20.9042 11.7875 20.7125C11.5958 20.5208 11.5 20.2833 11.5 20ZM12.5 12C12.7833 12 13.0208 11.9042 13.2125 11.7125C13.4042 11.5208 13.5 11.2833 13.5 11V5C13.5 4.71667 13.4042 4.47917 13.2125 4.2875C13.0208 4.09583 12.7833 4 12.5 4C12.2167 4 11.9792 4.09583 11.7875 4.2875C11.5958 4.47917 11.5 4.71667 11.5 5V11C11.5 11.2833 11.5958 11.5208 11.7875 11.7125C11.9792 11.9042 12.2167 12 12.5 12Z",fill:t})})},Fe=()=>(0,Re.jsx)("svg",{width:"19",height:"18",viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M15.4625 15.75C13.9 15.75 12.3563 15.4094 10.8313 14.7281C9.30625 14.0469 7.91875 13.0813 6.66875 11.8313C5.41875 10.5813 4.45312 9.19375 3.77188 7.66875C3.09063 6.14375 2.75 4.6 2.75 3.0375C2.75 2.8125 2.825 2.625 2.975 2.475C3.125 2.325 3.3125 2.25 3.5375 2.25H6.575C6.75 2.25 6.90625 2.30937 7.04375 2.42813C7.18125 2.54688 7.2625 2.6875 7.2875 2.85L7.775 5.475C7.8 5.675 7.79375 5.84375 7.75625 5.98125C7.71875 6.11875 7.65 6.2375 7.55 6.3375L5.73125 8.175C5.98125 8.6375 6.27813 9.08438 6.62188 9.51563C6.96563 9.94688 7.34375 10.3625 7.75625 10.7625C8.14375 11.15 8.55 11.5094 8.975 11.8406C9.4 12.1719 9.85 12.475 10.325 12.75L12.0875 10.9875C12.2 10.875 12.3469 10.7906 12.5281 10.7344C12.7094 10.6781 12.8875 10.6625 13.0625 10.6875L15.65 11.2125C15.825 11.2625 15.9688 11.3531 16.0813 11.4844C16.1938 11.6156 16.25 11.7625 16.25 11.925V14.9625C16.25 15.1875 16.175 15.375 16.025 15.525C15.875 15.675 15.6875 15.75 15.4625 15.75ZM5.01875 6.75L6.25625 5.5125L5.9375 3.75H4.26875C4.33125 4.2625 4.41875 4.76875 4.53125 5.26875C4.64375 5.76875 4.80625 6.2625 5.01875 6.75ZM11.7313 13.4625C12.2188 13.675 12.7156 13.8438 13.2219 13.9688C13.7281 14.0938 14.2375 14.175 14.75 14.2125V12.5625L12.9875 12.2063L11.7313 13.4625Z",fill:"white"})}),je=e=>{let{isVissible:t}=e;return(0,Re.jsx)("svg",{width:"40",height:"40",viewBox:"0 0 40 40",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M20 24C21.25 24 22.3125 23.5625 23.1875 22.6875C24.0625 21.8125 24.5 20.75 24.5 19.5C24.5 18.25 24.0625 17.1875 23.1875 16.3125C22.3125 15.4375 21.25 15 20 15C18.75 15 17.6875 15.4375 16.8125 16.3125C15.9375 17.1875 15.5 18.25 15.5 19.5C15.5 20.75 15.9375 21.8125 16.8125 22.6875C17.6875 23.5625 18.75 24 20 24ZM20 22.2C19.25 22.2 18.6125 21.9375 18.0875 21.4125C17.5625 20.8875 17.3 20.25 17.3 19.5C17.3 18.75 17.5625 18.1125 18.0875 17.5875C18.6125 17.0625 19.25 16.8 20 16.8C20.75 16.8 21.3875 17.0625 21.9125 17.5875C22.4375 18.1125 22.7 18.75 22.7 19.5C22.7 20.25 22.4375 20.8875 21.9125 21.4125C21.3875 21.9375 20.75 22.2 20 22.2ZM20 27C17.7667 27 15.7292 26.4 13.8875 25.2C12.0459 24 10.5917 22.4167 9.52502 20.45C9.44169 20.3 9.37919 20.1458 9.33752 19.9875C9.29586 19.8292 9.27502 19.6667 9.27502 19.5C9.27502 19.3333 9.29586 19.1708 9.33752 19.0125C9.37919 18.8542 9.44169 18.7 9.52502 18.55C10.5917 16.5833 12.0459 15 13.8875 13.8C15.7292 12.6 17.7667 12 20 12C22.2334 12 24.2709 12.6 26.1125 13.8C27.9542 15 29.4084 16.5833 30.475 18.55C30.5584 18.7 30.6209 18.8542 30.6625 19.0125C30.7042 19.1708 30.725 19.3333 30.725 19.5C30.725 19.6667 30.7042 19.8292 30.6625 19.9875C30.6209 20.1458 30.5584 20.3 30.475 20.45C29.4084 22.4167 27.9542 24 26.1125 25.2C24.2709 26.4 22.2334 27 20 27ZM20 25C21.8834 25 23.6125 24.5042 25.1875 23.5125C26.7625 22.5208 27.9667 21.1833 28.8 19.5C27.9667 17.8167 26.7625 16.4792 25.1875 15.4875C23.6125 14.4958 21.8834 14 20 14C18.1167 14 16.3875 14.4958 14.8125 15.4875C13.2375 16.4792 12.0334 17.8167 11.2 19.5C12.0334 21.1833 13.2375 22.5208 14.8125 23.5125C16.3875 24.5042 18.1167 25 20 25Z",fill:"#5F6368"})})},Ve=e=>{let{color:t="#fff"}=e;return(0,Re.jsx)("svg",{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M18.25 14.95L16.8 13.5C17.0334 13.1167 17.2084 12.7167 17.325 12.3C17.4417 11.8833 17.5 11.45 17.5 11H19.5C19.5 11.7333 19.3917 12.4292 19.175 13.0875C18.9584 13.7458 18.65 14.3667 18.25 14.95ZM15.3 11.95L13.5 10.15V5C13.5 4.71667 13.4042 4.47917 13.2125 4.2875C13.0209 4.09583 12.7834 4 12.5 4C12.2167 4 11.9792 4.09583 11.7875 4.2875C11.5959 4.47917 11.5 4.71667 11.5 5V8.15L9.50003 6.15V5C9.50003 4.16667 9.79169 3.45833 10.375 2.875C10.9584 2.29167 11.6667 2 12.5 2C13.3334 2 14.0417 2.29167 14.625 2.875C15.2084 3.45833 15.5 4.16667 15.5 5V11C15.5 11.1833 15.4792 11.35 15.4375 11.5C15.3959 11.65 15.35 11.8 15.3 11.95ZM11.5 21V17.925C9.76669 17.6917 8.33336 16.9167 7.20003 15.6C6.06669 14.2833 5.50002 12.75 5.50002 11H7.50002C7.50002 12.3833 7.97919 13.5625 8.93753 14.5375C9.89586 15.5125 11.0834 16 12.5 16C13.0667 16 13.6042 15.9125 14.1125 15.7375C14.6209 15.5625 15.0834 15.3167 15.5 15L16.925 16.425C16.4417 16.8083 15.9125 17.1333 15.3375 17.4C14.7625 17.6667 14.15 17.8417 13.5 17.925V21H11.5ZM20.3 22.6L1.90002 4.2L3.30002 2.8L21.7 21.2L20.3 22.6Z",fill:t})})},Be=()=>(0,Re.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M19.6 21L13.3 14.7C12.8 15.1 12.225 15.4167 11.575 15.65C10.925 15.8833 10.2333 16 9.5 16C7.68333 16 6.14583 15.3708 4.8875 14.1125C3.62917 12.8542 3 11.3167 3 9.5C3 7.68333 3.62917 6.14583 4.8875 4.8875C6.14583 3.62917 7.68333 3 9.5 3C11.3167 3 12.8542 3.62917 14.1125 4.8875C15.3708 6.14583 16 7.68333 16 9.5C16 10.2333 15.8833 10.925 15.65 11.575C15.4167 12.225 15.1 12.8 14.7 13.3L21 19.6L19.6 21ZM9.5 14C10.75 14 11.8125 13.5625 12.6875 12.6875C13.5625 11.8125 14 10.75 14 9.5C14 8.25 13.5625 7.1875 12.6875 6.3125C11.8125 5.4375 10.75 5 9.5 5C8.25 5 7.1875 5.4375 6.3125 6.3125C5.4375 7.1875 5 8.25 5 9.5C5 10.75 5.4375 11.8125 6.3125 12.6875C7.1875 13.5625 8.25 14 9.5 14Z",fill:"#3F4946"})}),Ge=e=>{let{isDisabled:t=!1,color:n="#fff"}=e;return t?(0,Re.jsx)("svg",{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M22.5 17.5L18.5 13.5V15.175L16.5 13.175V5.99999H9.32502L7.32502 3.99999H16.5C17.05 3.99999 17.5209 4.19582 17.9125 4.58749C18.3042 4.97915 18.5 5.44999 18.5 5.99999V10.5L22.5 6.49999V17.5ZM21.05 23.35L1.15002 3.44999L2.55002 2.04999L22.45 21.95L21.05 23.35ZM4.50002 3.99999L6.50002 5.99999H4.50002V18H16.5V16L18.5 18C18.5 18.55 18.3042 19.0208 17.9125 19.4125C17.5209 19.8042 17.05 20 16.5 20H4.50002C3.95002 20 3.47919 19.8042 3.08752 19.4125C2.69586 19.0208 2.50002 18.55 2.50002 18V5.99999C2.50002 5.44999 2.69586 4.97915 3.08752 4.58749C3.47919 4.19582 3.95002 3.99999 4.50002 3.99999Z",fill:n})}):(0,Re.jsx)("svg",{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M4.5 20C3.95 20 3.475 19.8083 3.075 19.425C2.69167 19.025 2.5 18.55 2.5 18V6C2.5 5.45 2.69167 4.98333 3.075 4.6C3.475 4.2 3.95 4 4.5 4H16.5C17.05 4 17.5167 4.2 17.9 4.6C18.3 4.98333 18.5 5.45 18.5 6V10.5L22.5 6.5V17.5L18.5 13.5V18C18.5 18.55 18.3 19.025 17.9 19.425C17.5167 19.8083 17.05 20 16.5 20H4.5ZM4.5 18H16.5V6H4.5V18ZM4.5 18V6V18Z",fill:n})})},We=e=>{let{isOpen:t}=e;return t?(0,Re.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M12 15L7 10H17L12 15Z",fill:"#40484C"})}):(0,Re.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M7 14L12 9L17 14H7Z",fill:"#40484C"})})},He=()=>(0,Re.jsxs)("svg",{width:"124",height:"70",viewBox:"0 0 124 70",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,Re.jsx)("path",{d:"M66 31.9999C66.2761 31.9999 66.5 32.2238 66.5 32.4999V41.4999C66.5 41.7761 66.2761 41.9999 66 41.9999H64C63.7239 41.9999 63.5 41.7761 63.5 41.4999V32.4999C63.5 32.2238 63.7239 31.9999 64 31.9999H66Z",fill:"#002914"}),(0,Re.jsx)("path",{d:"M65.5 20C65.7761 20 66 20.2239 66 20.5V27.5C66 27.7761 65.7761 28 65.5 28H64.5C64.2239 28 64 27.7761 64 27.5V20.5C64 20.2239 64.2239 20 64.5 20H65.5Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M61 23.4999C61 23.2237 61.2239 22.9999 61.5 22.9999H68.5C68.7761 22.9999 69 23.2237 69 23.4999V24.4999C69 24.776 68.7761 24.9999 68.5 24.9999H61.5C61.2239 24.9999 61 24.776 61 24.4999V23.4999Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M79.6613 34.941H75.3359C75.0597 34.941 74.8359 34.7171 74.8359 34.441V33.5C74.8359 33.2239 75.0597 33 75.3359 33H79.6613C80.5957 33 81.3524 32.8517 81.9313 32.555C82.5102 32.2583 82.9319 31.8462 83.1966 31.3187C83.4695 30.7912 83.6059 30.1896 83.6059 29.5138C83.6059 28.8956 83.4695 28.3146 83.1966 27.7706C82.9319 27.2267 82.5102 26.7899 81.9313 26.4602C81.3524 26.1223 80.5957 25.9533 79.6613 25.9533H75.8941C75.6179 25.9533 75.3941 26.1772 75.3941 26.4533V41.5C75.3941 41.7762 75.1702 42 74.8941 42H73.5C73.2239 42 73 41.7762 73 41.5V24.5C73 24.2239 73.2239 24 73.5 24H79.6613C81.0258 24 82.1794 24.2349 83.1221 24.7047C84.0649 25.1745 84.7802 25.8256 85.2681 26.658C85.7561 27.4822 86 28.4259 86 29.489C86 30.6429 85.7561 31.6278 85.2681 32.4437C84.7802 33.2596 84.0649 33.8819 83.1221 34.3105C82.1794 34.7308 81.0258 34.941 79.6613 34.941Z",fill:"#002914"}),(0,Re.jsx)("path",{d:"M104 32.4465V33.5535C104 34.869 103.837 36.0482 103.51 37.0909C103.183 38.1337 102.713 39.0201 102.099 39.75C101.485 40.48 100.748 41.0375 99.8873 41.4225C99.0344 41.8075 98.078 42 97.0179 42C95.9898 42 95.0453 41.8075 94.1845 41.4225C93.3316 41.0375 92.5904 40.48 91.9607 39.75C91.339 39.0201 90.8568 38.1337 90.5141 37.0909C90.1714 36.0482 90 34.869 90 33.5535V32.4465C90 31.131 90.1674 29.9559 90.5021 28.9212C90.8449 27.8784 91.3271 26.992 91.9488 26.2621C92.5705 25.5241 93.3077 24.9626 94.1605 24.5776C95.0213 24.1925 95.9658 24 96.994 24C98.0541 24 99.0105 24.1925 99.8634 24.5776C100.724 24.9626 101.461 25.5241 102.075 26.2621C102.697 26.992 103.171 27.8784 103.498 28.9212C103.833 29.9559 104 31.131 104 32.4465ZM101.716 33.5535V32.4225C101.716 31.3797 101.609 30.4572 101.394 29.6551C101.186 28.853 100.88 28.1792 100.473 27.6337C100.067 27.0883 99.5685 26.6752 98.9787 26.3944C98.3968 26.1137 97.7353 25.9733 96.994 25.9733C96.2767 25.9733 95.6271 26.1137 95.0453 26.3944C94.4714 26.6752 93.9772 27.0883 93.5628 27.6337C93.1563 28.1792 92.8414 28.853 92.6183 29.6551C92.3951 30.4572 92.2835 31.3797 92.2835 32.4225V33.5535C92.2835 34.6043 92.3951 35.5348 92.6183 36.3449C92.8414 37.1471 93.1603 37.8249 93.5747 38.3784C93.9972 38.9238 94.4953 39.3369 95.0692 39.6177C95.651 39.8984 96.3006 40.0388 97.0179 40.0388C97.7672 40.0388 98.4327 39.8984 99.0145 39.6177C99.5964 39.3369 100.087 38.9238 100.485 38.3784C100.892 37.8249 101.198 37.1471 101.406 36.3449C101.613 35.5348 101.716 34.6043 101.716 33.5535Z",fill:"#002914"}),(0,Re.jsx)("path",{d:"M33.4461 43.2589C33.6273 43.073 33.9202 43.056 34.1217 43.2197L39.6403 47.702C39.8761 47.8934 39.8895 48.2489 39.669 48.4577L38.1852 49.8625C38.002 50.0359 37.7189 50.0465 37.5233 49.8873L32.0747 45.4503C31.8456 45.2638 31.826 44.9206 32.0322 44.7091L33.4461 43.2589ZM40 32.2975V33.9091C40 35.8244 39.7666 37.5411 39.2997 39.0593C38.8329 40.5775 38.1611 41.868 37.2844 42.9308C36.4076 43.9935 35.3544 44.8052 34.1247 45.3657C32.9064 45.9263 31.54 46.2066 30.0256 46.2066C28.5568 46.2066 27.2075 45.9263 25.9778 45.3657C24.7595 44.8052 23.7005 43.9935 22.801 42.9308C21.9129 41.868 21.224 40.5775 20.7344 39.0593C20.2448 37.5411 20 35.8244 20 33.9091V32.2975C20 30.3822 20.2391 28.6713 20.7173 27.1648C21.2069 25.6466 21.8958 24.3561 22.7839 23.2933C23.6721 22.2189 24.7253 21.4014 25.9436 20.8409C27.1734 20.2803 28.5226 20 29.9915 20C31.5058 20 32.8779 20.2803 34.1076 20.8409C35.3373 21.4014 36.3906 22.2189 37.2673 23.2933C38.144 24.3561 38.8158 25.6466 39.2827 27.1648C39.7609 28.6713 40 30.3822 40 32.2975ZM36.7378 33.9091V32.2624C36.7378 30.7442 36.5841 29.4012 36.2767 28.2333C35.9806 27.0655 35.5423 26.0845 34.9616 25.2904C34.3809 24.4962 33.6749 23.8948 32.8437 23.486C32.0125 23.0773 31.0618 22.8729 29.9915 22.8729C28.9781 22.8729 28.0558 23.0773 27.2246 23.486C26.4048 23.8948 25.6988 24.4962 25.1067 25.2904C24.5147 26.0845 24.0592 27.0655 23.7404 28.2333C23.4216 29.4012 23.2622 30.7442 23.2622 32.2624V33.9091C23.2622 35.439 23.4216 36.7937 23.7404 37.9732C24.0592 39.1411 24.5147 40.1279 25.1067 40.9337C25.7102 41.7279 26.4276 42.3293 27.2588 42.7381C28.09 43.1468 29.0122 43.3512 30.0256 43.3512C31.0959 43.3512 32.0467 43.1468 32.8779 42.7381C33.7091 42.3293 34.4093 41.7279 34.9787 40.9337C35.5594 40.1279 35.9977 39.1411 36.2938 37.9732C36.5898 36.7937 36.7378 35.439 36.7378 33.9091Z",fill:"#002914"}),(0,Re.jsx)("path",{d:"M54.6319 24.5C54.6319 24.2239 54.8557 24 55.1319 24H56.5C56.7761 24 57 24.2239 57 24.5V36.0122C57 37.3456 56.6999 38.4553 56.0996 39.3415C55.4994 40.2277 54.7018 40.8943 53.7068 41.3415C52.7201 41.7805 51.6471 42 50.4877 42C49.2707 42 48.1689 41.7805 47.1822 41.3415C46.2037 40.8943 45.4266 40.2277 44.851 39.3415C44.2837 38.4553 44 37.3456 44 36.0122V24.5C44 24.2239 44.2239 24 44.5 24H45.8558C46.1319 24 46.3558 24.2239 46.3558 24.5V36.0122C46.3558 36.939 46.5285 37.7033 46.8738 38.3049C47.2192 38.9065 47.7002 39.3537 48.3169 39.6464C48.9418 39.939 49.6654 40.0854 50.4877 40.0854C51.3182 40.0854 52.0418 39.939 52.6584 39.6464C53.2834 39.3537 53.7685 38.9065 54.1139 38.3049C54.4592 37.7033 54.6319 36.939 54.6319 36.0122V24.5Z",fill:"#002914"}),(0,Re.jsx)("path",{d:"M49.9252 47.4741V47.7923H48.33V47.4741H49.9252ZM48.3907 46.2049V49.1568H48V46.2049H48.3907ZM50.2653 46.2049V49.1568H49.8766V46.2049H50.2653Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M52.3923 49.1973C52.2398 49.1973 52.1015 49.1716 51.9773 49.1203C51.8545 49.0676 51.7486 48.9939 51.6595 48.8993C51.5718 48.8047 51.5043 48.6925 51.4571 48.5627C51.4098 48.433 51.3862 48.2911 51.3862 48.137V48.0519C51.3862 47.8734 51.4125 47.7146 51.4652 47.5754C51.5178 47.4349 51.5893 47.3159 51.6797 47.2186C51.7702 47.1213 51.8727 47.0476 51.9874 46.9976C52.1022 46.9476 52.2209 46.9226 52.3437 46.9226C52.5003 46.9226 52.6352 46.9496 52.7486 47.0037C52.8633 47.0578 52.9571 47.1335 53.03 47.2308C53.1029 47.3267 53.1569 47.4403 53.1919 47.5714C53.227 47.7011 53.2446 47.843 53.2446 47.9971V48.1654H51.6089V47.8593H52.8701V47.8309C52.8647 47.7336 52.8444 47.6389 52.8093 47.547C52.7756 47.4551 52.7216 47.3794 52.6474 47.32C52.5732 47.2605 52.4719 47.2308 52.3437 47.2308C52.2587 47.2308 52.1804 47.249 52.1089 47.2855C52.0374 47.3206 51.976 47.3734 51.9247 47.4436C51.8734 47.5139 51.8336 47.5997 51.8053 47.7011C51.7769 47.8025 51.7627 47.9194 51.7627 48.0519V48.137C51.7627 48.2411 51.7769 48.3391 51.8053 48.431C51.8349 48.5215 51.8775 48.6013 51.9328 48.6702C51.9895 48.7391 52.0576 48.7932 52.1372 48.8324C52.2182 48.8716 52.31 48.8912 52.4126 48.8912C52.5448 48.8912 52.6568 48.8642 52.7486 48.8101C52.8404 48.756 52.9207 48.6837 52.9895 48.5932L53.2162 48.7736C53.169 48.8452 53.1089 48.9135 53.0361 48.9784C52.9632 49.0432 52.8734 49.0959 52.7668 49.1365C52.6616 49.177 52.5367 49.1973 52.3923 49.1973Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M55.5538 48.7817V47.6525C55.5538 47.566 55.5363 47.4909 55.5012 47.4274C55.4674 47.3625 55.4162 47.3125 55.3473 47.2774C55.2785 47.2423 55.1935 47.2247 55.0923 47.2247C54.9978 47.2247 54.9148 47.2409 54.8433 47.2733C54.7731 47.3058 54.7178 47.3484 54.6773 47.4011C54.6381 47.4538 54.6186 47.5105 54.6186 47.5714H54.2441C54.2441 47.493 54.2643 47.4153 54.3048 47.3382C54.3453 47.2612 54.4033 47.1916 54.4789 47.1294C54.5558 47.0659 54.6476 47.0159 54.7542 46.9794C54.8622 46.9415 54.9823 46.9226 55.1145 46.9226C55.2738 46.9226 55.4141 46.9496 55.5356 47.0037C55.6584 47.0578 55.7542 47.1395 55.8231 47.249C55.8932 47.3571 55.9283 47.493 55.9283 47.6565V48.6783C55.9283 48.7513 55.9344 48.829 55.9465 48.9115C55.96 48.9939 55.9796 49.0649 56.0053 49.1243V49.1568H55.6146C55.5957 49.1135 55.5808 49.0561 55.57 48.9844C55.5592 48.9115 55.5538 48.8439 55.5538 48.7817ZM55.6186 47.8268L55.6226 48.0904H55.2441C55.1375 48.0904 55.0423 48.0992 54.9587 48.1167C54.875 48.1329 54.8048 48.158 54.7481 48.1917C54.6914 48.2255 54.6483 48.2681 54.6186 48.3195C54.5889 48.3695 54.574 48.4283 54.574 48.4958C54.574 48.5648 54.5895 48.6276 54.6206 48.6844C54.6516 48.7412 54.6982 48.7864 54.7603 48.8202C54.8237 48.8527 54.9013 48.8689 54.9931 48.8689C55.1078 48.8689 55.209 48.8446 55.2967 48.7959C55.3844 48.7472 55.454 48.6878 55.5052 48.6175C55.5579 48.5472 55.5862 48.479 55.5903 48.4127L55.7502 48.5932C55.7407 48.6499 55.7151 48.7128 55.6733 48.7817C55.6314 48.8506 55.5754 48.9169 55.5052 48.9804C55.4364 49.0426 55.3541 49.0946 55.2583 49.1365C55.1638 49.177 55.0572 49.1973 54.9384 49.1973C54.79 49.1973 54.6597 49.1683 54.5477 49.1101C54.437 49.052 54.3507 48.9743 54.2886 48.877C54.2279 48.7783 54.1975 48.6682 54.1975 48.5465C54.1975 48.4289 54.2204 48.3255 54.2663 48.2363C54.3122 48.1458 54.3783 48.0708 54.4647 48.0113C54.5511 47.9505 54.655 47.9045 54.7765 47.8734C54.8979 47.8424 55.0336 47.8268 55.1834 47.8268H55.6186Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M57.5047 46.0427V49.1568H57.1282V46.0427H57.5047Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M59.6035 46.9632V47.251H58.4192V46.9632H59.6035ZM58.82 46.43H59.1945V48.6134C59.1945 48.6878 59.206 48.7439 59.2289 48.7817C59.2519 48.8195 59.2816 48.8446 59.318 48.8567C59.3545 48.8689 59.3936 48.875 59.4354 48.875C59.4665 48.875 59.4989 48.8723 59.5326 48.8669C59.5677 48.8601 59.594 48.8547 59.6116 48.8506L59.6136 49.1568C59.5839 49.1662 59.5447 49.175 59.4962 49.1831C59.4489 49.1926 59.3916 49.1973 59.3241 49.1973C59.2323 49.1973 59.148 49.1791 59.071 49.1426C58.9941 49.1061 58.9327 49.0453 58.8868 48.9601C58.8423 48.8736 58.82 48.7574 58.82 48.6114V46.43Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M60.9977 46.0427V49.1568H60.6232V46.0427H60.9977ZM60.9086 47.9768L60.7527 47.9708C60.7541 47.8207 60.7763 47.6822 60.8195 47.5551C60.8627 47.4267 60.9235 47.3152 61.0017 47.2206C61.08 47.126 61.1731 47.053 61.2811 47.0017C61.3904 46.949 61.5112 46.9226 61.6435 46.9226C61.7514 46.9226 61.8486 46.9375 61.935 46.9672C62.0213 46.9956 62.0949 47.0415 62.1556 47.1051C62.2177 47.1686 62.2649 47.251 62.2973 47.3524C62.3297 47.4524 62.3459 47.5747 62.3459 47.7194V49.1568H61.9694V47.7153C61.9694 47.6004 61.9525 47.5085 61.9188 47.4396C61.885 47.3693 61.8358 47.3186 61.771 47.2875C61.7062 47.2551 61.6266 47.2389 61.5321 47.2389C61.439 47.2389 61.354 47.2585 61.277 47.2977C61.2015 47.3369 61.136 47.3909 61.0807 47.4599C61.0267 47.5288 60.9842 47.6079 60.9531 47.6971C60.9235 47.7849 60.9086 47.8782 60.9086 47.9768Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M64.3636 48.8892C64.4527 48.8892 64.535 48.8709 64.6106 48.8344C64.6862 48.7979 64.7483 48.7479 64.7969 48.6844C64.8454 48.6195 64.8731 48.5459 64.8799 48.4634H65.2361C65.2294 48.5932 65.1855 48.7141 65.1046 48.8263C65.0249 48.9371 64.9203 49.027 64.7908 49.0959C64.6612 49.1635 64.5188 49.1973 64.3636 49.1973C64.199 49.1973 64.0553 49.1683 63.9325 49.1101C63.811 49.052 63.7098 48.9723 63.6288 48.8709C63.5492 48.7695 63.4891 48.6533 63.4486 48.5222C63.4095 48.3897 63.3899 48.2499 63.3899 48.1025V48.0174C63.3899 47.8701 63.4095 47.7309 63.4486 47.5997C63.4891 47.4673 63.5492 47.3504 63.6288 47.249C63.7098 47.1476 63.811 47.0679 63.9325 47.0098C64.0553 46.9517 64.199 46.9226 64.3636 46.9226C64.535 46.9226 64.6848 46.9577 64.8131 47.028C64.9413 47.097 65.0418 47.1916 65.1147 47.3119C65.1889 47.4308 65.2294 47.566 65.2361 47.7173H64.8799C64.8731 47.6268 64.8475 47.545 64.8029 47.472C64.7597 47.399 64.7004 47.3409 64.6248 47.2977C64.5506 47.2531 64.4635 47.2308 64.3636 47.2308C64.2489 47.2308 64.1524 47.2537 64.0742 47.2997C63.9972 47.3443 63.9358 47.4051 63.8899 47.4822C63.8454 47.5578 63.813 47.6423 63.7928 47.7356C63.7739 47.8275 63.7644 47.9214 63.7644 48.0174V48.1025C63.7644 48.1985 63.7739 48.2931 63.7928 48.3864C63.8117 48.4796 63.8434 48.5641 63.8879 48.6398C63.9338 48.7155 63.9952 48.7763 64.0721 48.8223C64.1504 48.8669 64.2476 48.8892 64.3636 48.8892Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M67.5292 48.7817V47.6525C67.5292 47.566 67.5116 47.4909 67.4766 47.4274C67.4428 47.3625 67.3915 47.3125 67.3227 47.2774C67.2539 47.2423 67.1689 47.2247 67.0676 47.2247C66.9732 47.2247 66.8902 47.2409 66.8186 47.2733C66.7485 47.3058 66.6931 47.3484 66.6526 47.4011C66.6135 47.4538 66.5939 47.5105 66.5939 47.5714H66.2194C66.2194 47.493 66.2397 47.4153 66.2802 47.3382C66.3206 47.2612 66.3787 47.1916 66.4543 47.1294C66.5312 47.0659 66.6229 47.0159 66.7296 46.9794C66.8375 46.9415 66.9576 46.9226 67.0899 46.9226C67.2492 46.9226 67.3895 46.9496 67.511 47.0037C67.6338 47.0578 67.7296 47.1395 67.7984 47.249C67.8686 47.3571 67.9037 47.493 67.9037 47.6565V48.6783C67.9037 48.7513 67.9098 48.829 67.9219 48.9115C67.9354 48.9939 67.955 49.0649 67.9806 49.1243V49.1568H67.5899C67.571 49.1135 67.5562 49.0561 67.5454 48.9844C67.5346 48.9115 67.5292 48.8439 67.5292 48.7817ZM67.594 47.8268L67.598 48.0904H67.2195C67.1128 48.0904 67.0177 48.0992 66.934 48.1167C66.8504 48.1329 66.7802 48.158 66.7235 48.1917C66.6668 48.2255 66.6236 48.2681 66.5939 48.3195C66.5642 48.3695 66.5494 48.4283 66.5494 48.4958C66.5494 48.5648 66.5649 48.6276 66.596 48.6844C66.627 48.7412 66.6736 48.7864 66.7356 48.8202C66.7991 48.8527 66.8767 48.8689 66.9684 48.8689C67.0832 48.8689 67.1844 48.8446 67.2721 48.7959C67.3598 48.7472 67.4293 48.6878 67.4806 48.6175C67.5332 48.5472 67.5616 48.479 67.5656 48.4127L67.7256 48.5932C67.7161 48.6499 67.6905 48.7128 67.6486 48.7817C67.6068 48.8506 67.5508 48.9169 67.4806 48.9804C67.4118 49.0426 67.3295 49.0946 67.2336 49.1365C67.1392 49.177 67.0325 49.1973 66.9138 49.1973C66.7653 49.1973 66.6351 49.1683 66.5231 49.1101C66.4124 49.052 66.326 48.9743 66.264 48.877C66.2032 48.7783 66.1729 48.6682 66.1729 48.5465C66.1729 48.4289 66.1958 48.3255 66.2417 48.2363C66.2876 48.1458 66.3537 48.0708 66.4401 48.0113C66.5265 47.9505 66.6304 47.9045 66.7518 47.8734C66.8733 47.8424 67.0089 47.8268 67.1587 47.8268H67.594Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M69.4477 47.3078V49.1568H69.0732V46.9632H69.4376L69.4477 47.3078ZM70.132 46.951L70.1299 47.2997C70.0989 47.2929 70.0692 47.2889 70.0409 47.2875C70.0139 47.2848 69.9828 47.2835 69.9477 47.2835C69.8614 47.2835 69.7851 47.297 69.719 47.324C69.6529 47.3511 69.5969 47.3889 69.551 47.4376C69.5051 47.4862 69.4686 47.5443 69.4417 47.6119C69.416 47.6781 69.3991 47.7511 69.391 47.8309L69.2858 47.8917C69.2858 47.7592 69.2986 47.6349 69.3242 47.5187C69.3512 47.4024 69.3924 47.2997 69.4477 47.2105C69.5031 47.1199 69.5732 47.0497 69.6583 46.9996C69.7446 46.9483 69.8472 46.9226 69.966 46.9226C69.993 46.9226 70.024 46.926 70.0591 46.9327C70.0942 46.9381 70.1185 46.9442 70.132 46.951Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M71.927 49.1973C71.7745 49.1973 71.6362 49.1716 71.512 49.1203C71.3892 49.0676 71.2833 48.9939 71.1942 48.8993C71.1065 48.8047 71.039 48.6925 70.9918 48.5627C70.9445 48.433 70.9209 48.2911 70.9209 48.137V48.0519C70.9209 47.8734 70.9472 47.7146 70.9999 47.5754C71.0525 47.4349 71.124 47.3159 71.2144 47.2186C71.3049 47.1213 71.4074 47.0476 71.5221 46.9976C71.6369 46.9476 71.7556 46.9226 71.8784 46.9226C72.035 46.9226 72.1699 46.9496 72.2833 47.0037C72.398 47.0578 72.4918 47.1335 72.5647 47.2308C72.6376 47.3267 72.6916 47.4403 72.7266 47.5714C72.7617 47.7011 72.7793 47.843 72.7793 47.9971V48.1654H71.1436V47.8593H72.4048V47.8309C72.3994 47.7336 72.3791 47.6389 72.344 47.547C72.3103 47.4551 72.2563 47.3794 72.1821 47.32C72.1079 47.2605 72.0066 47.2308 71.8784 47.2308C71.7934 47.2308 71.7151 47.249 71.6436 47.2855C71.5721 47.3206 71.5107 47.3734 71.4594 47.4436C71.4081 47.5139 71.3683 47.5997 71.34 47.7011C71.3116 47.8025 71.2974 47.9194 71.2974 48.0519V48.137C71.2974 48.2411 71.3116 48.3391 71.34 48.431C71.3696 48.5215 71.4122 48.6013 71.4675 48.6702C71.5242 48.7391 71.5923 48.7932 71.6719 48.8324C71.7529 48.8716 71.8447 48.8912 71.9473 48.8912C72.0795 48.8912 72.1915 48.8642 72.2833 48.8101C72.3751 48.756 72.4554 48.6837 72.5242 48.5932L72.7509 48.7736C72.7037 48.8452 72.6436 48.9135 72.5708 48.9784C72.4979 49.0432 72.4081 49.0959 72.3015 49.1365C72.1963 49.177 72.0714 49.1973 71.927 49.1973Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M78.6422 48.4107C78.6422 48.3418 78.6314 48.2809 78.6098 48.2282C78.5895 48.1742 78.5531 48.1255 78.5005 48.0823C78.4492 48.039 78.3777 47.9978 78.2859 47.9586C78.1955 47.9194 78.0808 47.8795 77.9417 47.839C77.796 47.7957 77.6644 47.7477 77.547 47.695C77.4296 47.641 77.329 47.5795 77.2454 47.5105C77.1617 47.4416 77.0976 47.3625 77.053 47.2733C77.0085 47.1841 76.9862 47.0821 76.9862 46.9672C76.9862 46.8523 77.0099 46.7462 77.0571 46.6489C77.1043 46.5516 77.1718 46.4671 77.2595 46.3955C77.3486 46.3225 77.4545 46.2657 77.5774 46.2252C77.7002 46.1846 77.8372 46.1644 77.9883 46.1644C78.2096 46.1644 78.3972 46.2069 78.5511 46.2921C78.7063 46.3759 78.8244 46.486 78.9053 46.6226C78.9863 46.7577 79.0268 46.9023 79.0268 47.0564H78.6381C78.6381 46.9456 78.6145 46.8476 78.5673 46.7624C78.52 46.6759 78.4485 46.6084 78.3527 46.5597C78.2569 46.5097 78.1354 46.4847 77.9883 46.4847C77.8493 46.4847 77.7346 46.5056 77.6442 46.5475C77.5537 46.5894 77.4863 46.6462 77.4417 46.7178C77.3985 46.7895 77.3769 46.8712 77.3769 46.9632C77.3769 47.0253 77.3898 47.0821 77.4154 47.1335C77.4424 47.1835 77.4836 47.2301 77.5389 47.2733C77.5956 47.3166 77.6671 47.3565 77.7535 47.393C77.8412 47.4294 77.9458 47.4646 78.0673 47.4984C78.2346 47.5457 78.379 47.5984 78.5005 47.6565C78.6219 47.7146 78.7218 47.7802 78.8001 47.8532C78.8797 47.9248 78.9384 48.0066 78.9762 48.0985C79.0153 48.189 79.0349 48.2918 79.0349 48.4066C79.0349 48.5269 79.0106 48.6357 78.962 48.733C78.9134 48.8304 78.8439 48.9135 78.7535 48.9824C78.6631 49.0513 78.5545 49.1047 78.4276 49.1426C78.3021 49.1791 78.1617 49.1973 78.0065 49.1973C77.8702 49.1973 77.7359 49.1784 77.6037 49.1405C77.4728 49.1027 77.3533 49.0459 77.2454 48.9703C77.1387 48.8946 77.053 48.8013 76.9883 48.6905C76.9248 48.5783 76.8931 48.4485 76.8931 48.3012H77.2818C77.2818 48.4026 77.3014 48.4898 77.3405 48.5627C77.3796 48.6344 77.433 48.6939 77.5004 48.7412C77.5693 48.7885 77.6469 48.8236 77.7332 48.8466C77.821 48.8682 77.9121 48.879 78.0065 48.879C78.1428 48.879 78.2582 48.8601 78.3527 48.8223C78.4472 48.7844 78.5187 48.7303 78.5673 48.6601C78.6172 48.5898 78.6422 48.5067 78.6422 48.4107Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M80.4636 46.9632V49.1568H80.087V46.9632H80.4636ZM80.0587 46.3813C80.0587 46.3205 80.0769 46.2691 80.1133 46.2272C80.1511 46.1853 80.2065 46.1644 80.2793 46.1644C80.3509 46.1644 80.4055 46.1853 80.4433 46.2272C80.4824 46.2691 80.502 46.3205 80.502 46.3813C80.502 46.4394 80.4824 46.4894 80.4433 46.5313C80.4055 46.5719 80.3509 46.5921 80.2793 46.5921C80.2065 46.5921 80.1511 46.5719 80.1133 46.5313C80.0769 46.4894 80.0587 46.4394 80.0587 46.3813Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M82.0177 47.399V49.1568H81.6412V46.9632H81.9975L82.0177 47.399ZM81.9408 47.9768L81.7667 47.9708C81.768 47.8207 81.7876 47.6822 81.8254 47.5551C81.8632 47.4267 81.9192 47.3152 81.9934 47.2206C82.0676 47.126 82.1601 47.053 82.2707 47.0017C82.3814 46.949 82.5096 46.9226 82.6554 46.9226C82.7579 46.9226 82.8524 46.9375 82.9388 46.9672C83.0252 46.9956 83.1001 47.0409 83.1635 47.103C83.2269 47.1652 83.2762 47.245 83.3113 47.3423C83.3464 47.4396 83.3639 47.5572 83.3639 47.695V49.1568H82.9894V47.7133C82.9894 47.5984 82.9698 47.5065 82.9307 47.4376C82.8929 47.3686 82.8389 47.3186 82.7687 47.2875C82.6986 47.2551 82.6162 47.2389 82.5218 47.2389C82.4111 47.2389 82.3187 47.2585 82.2444 47.2977C82.1702 47.3369 82.1108 47.3909 82.0663 47.4599C82.0217 47.5288 81.9894 47.6079 81.9691 47.6971C81.9502 47.7849 81.9408 47.8782 81.9408 47.9768ZM83.3599 47.77L83.1088 47.8471C83.1102 47.7268 83.1298 47.6112 83.1675 47.5004C83.2067 47.3896 83.2627 47.2909 83.3356 47.2044C83.4098 47.1179 83.5009 47.0497 83.6089 46.9996C83.7168 46.9483 83.8403 46.9226 83.9793 46.9226C84.0967 46.9226 84.2006 46.9381 84.2911 46.9692C84.3828 47.0003 84.4598 47.0483 84.5218 47.1132C84.5853 47.1767 84.6332 47.2585 84.6656 47.3585C84.698 47.4585 84.7142 47.5774 84.7142 47.7153V49.1568H84.3376V47.7113C84.3376 47.5883 84.3181 47.493 84.2789 47.4254C84.2411 47.3565 84.1871 47.3085 84.117 47.2815C84.0481 47.2531 83.9658 47.2389 83.87 47.2389C83.7877 47.2389 83.7148 47.2531 83.6514 47.2815C83.5879 47.3098 83.5346 47.349 83.4914 47.399C83.4483 47.4477 83.4152 47.5038 83.3922 47.5673C83.3707 47.6308 83.3599 47.6984 83.3599 47.77Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M86.2359 47.3848V50.0002H85.8594V46.9632H86.2035L86.2359 47.3848ZM87.7117 48.0417V48.0843C87.7117 48.2438 87.6928 48.3918 87.655 48.5283C87.6172 48.6634 87.5619 48.781 87.489 48.881C87.4175 48.9811 87.3291 49.0588 87.2238 49.1142C87.1185 49.1696 86.9978 49.1973 86.8615 49.1973C86.7224 49.1973 86.5996 49.1743 86.493 49.1284C86.3864 49.0824 86.296 49.0155 86.2218 48.9277C86.1475 48.8398 86.0881 48.7344 86.0436 48.6114C86.0004 48.4884 85.9707 48.3499 85.9545 48.1958V47.9687C85.9707 47.8065 86.0011 47.6612 86.0456 47.5328C86.0902 47.4044 86.1489 47.295 86.2218 47.2044C86.296 47.1125 86.3857 47.0429 86.491 46.9956C86.5963 46.9469 86.7177 46.9226 86.8554 46.9226C86.993 46.9226 87.1152 46.9496 87.2218 47.0037C87.3284 47.0564 87.4182 47.1321 87.491 47.2308C87.5639 47.3294 87.6186 47.4477 87.655 47.5856C87.6928 47.7221 87.7117 47.8741 87.7117 48.0417ZM87.3352 48.0843V48.0417C87.3352 47.9322 87.3237 47.8295 87.3007 47.7336C87.2778 47.6362 87.242 47.5511 87.1935 47.4781C87.1462 47.4038 87.0855 47.3457 87.0113 47.3038C86.937 47.2605 86.8486 47.2389 86.7461 47.2389C86.6516 47.2389 86.5693 47.2551 86.4991 47.2875C86.4303 47.32 86.3716 47.3639 86.323 47.4193C86.2744 47.4734 86.2346 47.5355 86.2035 47.6058C86.1738 47.6748 86.1516 47.7464 86.1367 47.8207V48.3458C86.1637 48.4404 86.2015 48.5296 86.2501 48.6134C86.2987 48.6959 86.3635 48.7628 86.4444 48.8141C86.5254 48.8642 86.6273 48.8892 86.7501 48.8892C86.8513 48.8892 86.9384 48.8682 87.0113 48.8263C87.0855 48.7831 87.1462 48.7243 87.1935 48.6499C87.242 48.5756 87.2778 48.4904 87.3007 48.3945C87.3237 48.2972 87.3352 48.1938 87.3352 48.0843Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M89.1768 46.0427V49.1568H88.8002V46.0427H89.1768Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M90.7653 46.9632V49.1568H90.3888V46.9632H90.7653ZM90.3605 46.3813C90.3605 46.3205 90.3787 46.2691 90.4151 46.2272C90.4529 46.1853 90.5082 46.1644 90.5811 46.1644C90.6526 46.1644 90.7073 46.1853 90.7451 46.2272C90.7842 46.2691 90.8038 46.3205 90.8038 46.3813C90.8038 46.4394 90.7842 46.4894 90.7451 46.5313C90.7073 46.5719 90.6526 46.5921 90.5811 46.5921C90.5082 46.5921 90.4529 46.5719 90.4151 46.5313C90.3787 46.4894 90.3605 46.4394 90.3605 46.3813Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M92.5057 49.1568H92.1312V46.732C92.1312 46.5739 92.1596 46.4408 92.2162 46.3326C92.2743 46.2232 92.3573 46.1407 92.4652 46.0853C92.5732 46.0285 92.7014 46.0002 92.8499 46.0002C92.8931 46.0002 92.9362 46.0029 92.9794 46.0083C93.024 46.0137 93.0672 46.0218 93.109 46.0326L93.0887 46.3387C93.0604 46.332 93.028 46.3272 92.9916 46.3245C92.9565 46.3218 92.9214 46.3205 92.8863 46.3205C92.8067 46.3205 92.7379 46.3367 92.6798 46.3691C92.6231 46.4002 92.58 46.4462 92.5503 46.507C92.5206 46.5678 92.5057 46.6428 92.5057 46.732V49.1568ZM92.9713 46.9632V47.251H91.785V46.9632H92.9713Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M94.2823 46.9632V49.1568H93.9058V46.9632H94.2823ZM93.8774 46.3813C93.8774 46.3205 93.8957 46.2691 93.9321 46.2272C93.9699 46.1853 94.0252 46.1644 94.0981 46.1644C94.1696 46.1644 94.2243 46.1853 94.2621 46.2272C94.3012 46.2691 94.3208 46.3205 94.3208 46.3813C94.3208 46.4394 94.3012 46.4894 94.2621 46.5313C94.2243 46.5719 94.1696 46.5921 94.0981 46.5921C94.0252 46.5921 93.9699 46.5719 93.9321 46.5313C93.8957 46.4894 93.8774 46.4394 93.8774 46.3813Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M96.3729 49.1973C96.2204 49.1973 96.0821 49.1716 95.9579 49.1203C95.8351 49.0676 95.7292 48.9939 95.6401 48.8993C95.5524 48.8047 95.4849 48.6925 95.4377 48.5627C95.3904 48.433 95.3668 48.2911 95.3668 48.137V48.0519C95.3668 47.8734 95.3931 47.7146 95.4458 47.5754C95.4984 47.4349 95.5699 47.3159 95.6603 47.2186C95.7508 47.1213 95.8533 47.0476 95.968 46.9976C96.0828 46.9476 96.2015 46.9226 96.3243 46.9226C96.4809 46.9226 96.6158 46.9496 96.7292 47.0037C96.8439 47.0578 96.9377 47.1335 97.0106 47.2308C97.0835 47.3267 97.1375 47.4403 97.1725 47.5714C97.2076 47.7011 97.2252 47.843 97.2252 47.9971V48.1654H95.5895V47.8593H96.8507V47.8309C96.8453 47.7336 96.825 47.6389 96.7899 47.547C96.7562 47.4551 96.7022 47.3794 96.628 47.32C96.5538 47.2605 96.4525 47.2308 96.3243 47.2308C96.2393 47.2308 96.161 47.249 96.0895 47.2855C96.018 47.3206 95.9566 47.3734 95.9053 47.4436C95.854 47.5139 95.8142 47.5997 95.7859 47.7011C95.7575 47.8025 95.7433 47.9194 95.7433 48.0519V48.137C95.7433 48.2411 95.7575 48.3391 95.7859 48.431C95.8155 48.5215 95.8581 48.6013 95.9134 48.6702C95.9701 48.7391 96.0382 48.7932 96.1179 48.8324C96.1988 48.8716 96.2906 48.8912 96.3932 48.8912C96.5254 48.8912 96.6374 48.8642 96.7292 48.8101C96.821 48.756 96.9013 48.6837 96.9701 48.5932L97.1968 48.7736C97.1496 48.8452 97.0895 48.9135 97.0167 48.9784C96.9438 49.0432 96.854 49.0959 96.7474 49.1365C96.6422 49.177 96.5173 49.1973 96.3729 49.1973Z",fill:"#1B6B51"}),(0,Re.jsx)("path",{d:"M99.6235 48.731V46.0427H100V49.1568H99.6559L99.6235 48.731ZM98.1498 48.0843V48.0417C98.1498 47.8741 98.17 47.7221 98.2105 47.5856C98.2523 47.4477 98.311 47.3294 98.3866 47.2308C98.4635 47.1321 98.5546 47.0564 98.6599 47.0037C98.7665 46.9496 98.8853 46.9226 99.0162 46.9226C99.1538 46.9226 99.274 46.9469 99.3765 46.9956C99.4804 47.0429 99.5682 47.1125 99.6397 47.2044C99.7126 47.295 99.7699 47.4044 99.8118 47.5328C99.8536 47.6612 99.8826 47.8065 99.8988 47.9687V48.1552C99.884 48.3161 99.8549 48.4607 99.8118 48.5891C99.7699 48.7175 99.7126 48.827 99.6397 48.9175C99.5682 49.0081 99.4804 49.0777 99.3765 49.1264C99.2726 49.1737 99.1511 49.1973 99.0121 49.1973C98.8839 49.1973 98.7665 49.1696 98.6599 49.1142C98.5546 49.0588 98.4635 48.9811 98.3866 48.881C98.311 48.781 98.2523 48.6634 98.2105 48.5283C98.17 48.3918 98.1498 48.2438 98.1498 48.0843ZM98.5263 48.0417V48.0843C98.5263 48.1938 98.5371 48.2965 98.5587 48.3924C98.5816 48.4884 98.6167 48.5729 98.6639 48.6459C98.7112 48.7189 98.7712 48.7763 98.8441 48.8182C98.917 48.8587 99.004 48.879 99.1053 48.879C99.2294 48.879 99.3313 48.8527 99.4109 48.8C99.4919 48.7472 99.5567 48.6776 99.6053 48.5911C99.6539 48.5046 99.6917 48.4107 99.7186 48.3093V47.8207C99.7024 47.7464 99.6788 47.6748 99.6478 47.6058C99.6181 47.5355 99.579 47.4734 99.5304 47.4193C99.4831 47.3639 99.4244 47.32 99.3543 47.2875C99.2854 47.2551 99.2038 47.2389 99.1093 47.2389C99.0067 47.2389 98.9183 47.2605 98.8441 47.3038C98.7712 47.3457 98.7112 47.4038 98.6639 47.4781C98.6167 47.5511 98.5816 47.6362 98.5587 47.7336C98.5371 47.8295 98.5263 47.9322 98.5263 48.0417Z",fill:"#1B6B51"})]}),qe=e=>{let{type:t=""}=e;return""===t?(0,Re.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M7.25 12H11.75C11.9625 12 12.1406 11.9281 12.2844 11.7844C12.4281 11.6406 12.5 11.4625 12.5 11.25V6.75C12.5 6.5375 12.4281 6.35938 12.2844 6.21563C12.1406 6.07188 11.9625 6 11.75 6H7.25C7.0375 6 6.85938 6.07188 6.71563 6.21563C6.57188 6.35938 6.5 6.5375 6.5 6.75V11.25C6.5 11.4625 6.57188 11.6406 6.71563 11.7844C6.85938 11.9281 7.0375 12 7.25 12ZM9.5 16.5C8.4625 16.5 7.4875 16.3031 6.575 15.9094C5.6625 15.5156 4.86875 14.9813 4.19375 14.3063C3.51875 13.6313 2.98438 12.8375 2.59063 11.925C2.19688 11.0125 2 10.0375 2 9C2 7.9625 2.19688 6.9875 2.59063 6.075C2.98438 5.1625 3.51875 4.36875 4.19375 3.69375C4.86875 3.01875 5.6625 2.48438 6.575 2.09063C7.4875 1.69688 8.4625 1.5 9.5 1.5C10.5375 1.5 11.5125 1.69688 12.425 2.09063C13.3375 2.48438 14.1313 3.01875 14.8063 3.69375C15.4813 4.36875 16.0156 5.1625 16.4094 6.075C16.8031 6.9875 17 7.9625 17 9C17 10.0375 16.8031 11.0125 16.4094 11.925C16.0156 12.8375 15.4813 13.6313 14.8063 14.3063C14.1313 14.9813 13.3375 15.5156 12.425 15.9094C11.5125 16.3031 10.5375 16.5 9.5 16.5ZM9.5 15C11.175 15 12.5938 14.4188 13.7563 13.2563C14.9188 12.0938 15.5 10.675 15.5 9C15.5 7.325 14.9188 5.90625 13.7563 4.74375C12.5938 3.58125 11.175 3 9.5 3C7.825 3 6.40625 3.58125 5.24375 4.74375C4.08125 5.90625 3.5 7.325 3.5 9C3.5 10.675 4.08125 12.0938 5.24375 13.2563C6.40625 14.4188 7.825 15 9.5 15Z",fill:"white"})}):"call"===t?(0,Re.jsx)("svg",{width:"19",height:"18",viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M3.05001 12.3L1.32501 10.6125C1.17501 10.4625 1.10001 10.2875 1.10001 10.0875C1.10001 9.8875 1.17501 9.7125 1.32501 9.5625C2.42501 8.375 3.69376 7.48438 5.13126 6.89063C6.56876 6.29688 8.02501 6 9.50001 6C10.975 6 12.4281 6.29688 13.8594 6.89063C15.2906 7.48438 16.5625 8.375 17.675 9.5625C17.825 9.7125 17.9 9.8875 17.9 10.0875C17.9 10.2875 17.825 10.4625 17.675 10.6125L15.95 12.3C15.8125 12.4375 15.6531 12.5125 15.4719 12.525C15.2906 12.5375 15.125 12.4875 14.975 12.375L12.8 10.725C12.7 10.65 12.625 10.5625 12.575 10.4625C12.525 10.3625 12.5 10.25 12.5 10.125V7.9875C12.025 7.8375 11.5375 7.71875 11.0375 7.63125C10.5375 7.54375 10.025 7.5 9.50001 7.5C8.97501 7.5 8.46251 7.54375 7.96251 7.63125C7.46251 7.71875 6.97501 7.8375 6.50001 7.9875V10.125C6.50001 10.25 6.47501 10.3625 6.42501 10.4625C6.37501 10.5625 6.30001 10.65 6.20001 10.725L4.02501 12.375C3.87501 12.4875 3.70938 12.5375 3.52813 12.525C3.34688 12.5125 3.18751 12.4375 3.05001 12.3ZM5.00001 8.5875C4.63751 8.775 4.28751 8.99063 3.95001 9.23438C3.61251 9.47813 3.26251 9.75 2.90001 10.05L3.65001 10.8L5.00001 9.75V8.5875ZM14 8.625V9.75L15.35 10.8L16.1 10.0875C15.7375 9.7625 15.3875 9.48125 15.05 9.24375C14.7125 9.00625 14.3625 8.8 14 8.625Z",fill:"white"})}):void 0},ze=()=>(0,Re.jsx)("svg",{width:"19",height:"18",viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M5.75 12.7498V5.24982C5.75 5.03732 5.82188 4.85919 5.96563 4.71544C6.10938 4.57169 6.2875 4.49982 6.5 4.49982C6.7125 4.49982 6.89062 4.57169 7.03438 4.71544C7.17813 4.85919 7.25 5.03732 7.25 5.24982V12.7498C7.25 12.9623 7.17813 13.1404 7.03438 13.2842C6.89062 13.4279 6.7125 13.4998 6.5 13.4998C6.2875 13.4998 6.10938 13.4279 5.96563 13.2842C5.82188 13.1404 5.75 12.9623 5.75 12.7498ZM8.75 15.7498V2.24982C8.75 2.03732 8.82188 1.85919 8.96563 1.71544C9.10938 1.57169 9.2875 1.49982 9.5 1.49982C9.7125 1.49982 9.89063 1.57169 10.0344 1.71544C10.1781 1.85919 10.25 2.03732 10.25 2.24982V15.7498C10.25 15.9623 10.1781 16.1404 10.0344 16.2842C9.89063 16.4279 9.7125 16.4998 9.5 16.4998C9.2875 16.4998 9.10938 16.4279 8.96563 16.2842C8.82188 16.1404 8.75 15.9623 8.75 15.7498ZM2.75 9.74982V8.24982C2.75 8.03732 2.82188 7.85919 2.96563 7.71544C3.10938 7.57169 3.2875 7.49982 3.5 7.49982C3.7125 7.49982 3.89062 7.57169 4.03438 7.71544C4.17813 7.85919 4.25 8.03732 4.25 8.24982V9.74982C4.25 9.96232 4.17813 10.1404 4.03438 10.2842C3.89062 10.4279 3.7125 10.4998 3.5 10.4998C3.2875 10.4998 3.10938 10.4279 2.96563 10.2842C2.82188 10.1404 2.75 9.96232 2.75 9.74982ZM11.75 12.7498V5.24982C11.75 5.03732 11.8219 4.85919 11.9656 4.71544C12.1094 4.57169 12.2875 4.49982 12.5 4.49982C12.7125 4.49982 12.8906 4.57169 13.0344 4.71544C13.1781 4.85919 13.25 5.03732 13.25 5.24982V12.7498C13.25 12.9623 13.1781 13.1404 13.0344 13.2842C12.8906 13.4279 12.7125 13.4998 12.5 13.4998C12.2875 13.4998 12.1094 13.4279 11.9656 13.2842C11.8219 13.1404 11.75 12.9623 11.75 12.7498ZM14.75 9.74982V8.24982C14.75 8.03732 14.8219 7.85919 14.9656 7.71544C15.1094 7.57169 15.2875 7.49982 15.5 7.49982C15.7125 7.49982 15.8906 7.57169 16.0344 7.71544C16.1781 7.85919 16.25 8.03732 16.25 8.24982V9.74982C16.25 9.96232 16.1781 10.1404 16.0344 10.2842C15.8906 10.4279 15.7125 10.4998 15.5 10.4998C15.2875 10.4998 15.1094 10.4279 14.9656 10.2842C14.8219 10.1404 14.75 9.96232 14.75 9.74982Z",fill:"#2B6A46"})}),Ke=()=>(0,Re.jsx)("svg",{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M8.5 14H10.5V12C10.5 11.7167 10.5958 11.4792 10.7875 11.2875C10.9792 11.0958 11.2167 11 11.5 11H13.5V13L16.5 10L13.5 7V9H11.5C10.6667 9 9.95833 9.29167 9.375 9.875C8.79167 10.4583 8.5 11.1667 8.5 12V14ZM4.5 18C3.95 18 3.47917 17.8042 3.0875 17.4125C2.69583 17.0208 2.5 16.55 2.5 16V5C2.5 4.45 2.69583 3.97917 3.0875 3.5875C3.47917 3.19583 3.95 3 4.5 3H20.5C21.05 3 21.5208 3.19583 21.9125 3.5875C22.3042 3.97917 22.5 4.45 22.5 5V16C22.5 16.55 22.3042 17.0208 21.9125 17.4125C21.5208 17.8042 21.05 18 20.5 18H4.5ZM4.5 16H20.5V5H4.5V16ZM1.5 21V19H23.5V21H1.5Z",fill:"white"})}),Ye=()=>(0,Re.jsx)("svg",{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M9.75 22L9.35 18.8C9.13333 18.7167 8.92917 18.6167 8.7375 18.5C8.54583 18.3833 8.35833 18.2583 8.175 18.125L5.2 19.375L2.45 14.625L5.025 12.675C5.00833 12.5583 5 12.4458 5 12.3375V11.6625C5 11.5542 5.00833 11.4417 5.025 11.325L2.45 9.375L5.2 4.625L8.175 5.875C8.35833 5.74167 8.55 5.61667 8.75 5.5C8.95 5.38333 9.15 5.28333 9.35 5.2L9.75 2H15.25L15.65 5.2C15.8667 5.28333 16.0708 5.38333 16.2625 5.5C16.4542 5.61667 16.6417 5.74167 16.825 5.875L19.8 4.625L22.55 9.375L19.975 11.325C19.9917 11.4417 20 11.5542 20 11.6625V12.3375C20 12.4458 19.9833 12.5583 19.95 12.675L22.525 14.625L19.775 19.375L16.825 18.125C16.6417 18.2583 16.45 18.3833 16.25 18.5C16.05 18.6167 15.85 18.7167 15.65 18.8L15.25 22H9.75ZM11.5 20H13.475L13.825 17.35C14.3417 17.2167 14.8208 17.0208 15.2625 16.7625C15.7042 16.5042 16.1083 16.1917 16.475 15.825L18.95 16.85L19.925 15.15L17.775 13.525C17.8583 13.2917 17.9167 13.0458 17.95 12.7875C17.9833 12.5292 18 12.2667 18 12C18 11.7333 17.9833 11.4708 17.95 11.2125C17.9167 10.9542 17.8583 10.7083 17.775 10.475L19.925 8.85L18.95 7.15L16.475 8.2C16.1083 7.81667 15.7042 7.49583 15.2625 7.2375C14.8208 6.97917 14.3417 6.78333 13.825 6.65L13.5 4H11.525L11.175 6.65C10.6583 6.78333 10.1792 6.97917 9.7375 7.2375C9.29583 7.49583 8.89167 7.80833 8.525 8.175L6.05 7.15L5.075 8.85L7.225 10.45C7.14167 10.7 7.08333 10.95 7.05 11.2C7.01667 11.45 7 11.7167 7 12C7 12.2667 7.01667 12.525 7.05 12.775C7.08333 13.025 7.14167 13.275 7.225 13.525L5.075 15.15L6.05 16.85L8.525 15.8C8.89167 16.1833 9.29583 16.5042 9.7375 16.7625C10.1792 17.0208 10.6583 17.2167 11.175 17.35L11.5 20ZM12.55 15.5C13.5167 15.5 14.3417 15.1583 15.025 14.475C15.7083 13.7917 16.05 12.9667 16.05 12C16.05 11.0333 15.7083 10.2083 15.025 9.525C14.3417 8.84167 13.5167 8.5 12.55 8.5C11.5667 8.5 10.7375 8.84167 10.0625 9.525C9.3875 10.2083 9.05 11.0333 9.05 12C9.05 12.9667 9.3875 13.7917 10.0625 14.475C10.7375 15.1583 11.5667 15.5 12.55 15.5Z",fill:"white"})}),Je=()=>(0,Re.jsxs)("svg",{width:"19",height:"18",viewBox:"0 0 19 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,Re.jsx)("path",{d:"M0.5 15V12.9188C0.5 12.4938 0.60625 12.1 0.81875 11.7375C1.03125 11.375 1.325 11.1 1.7 10.9125C1.875 10.825 2.04375 10.7438 2.20625 10.6688C2.38125 10.5938 2.5625 10.525 2.75 10.4625V15H0.5ZM3.5 9.75C2.875 9.75 2.34375 9.53125 1.90625 9.09375C1.46875 8.65625 1.25 8.125 1.25 7.5C1.25 6.875 1.46875 6.34375 1.90625 5.90625C2.34375 5.46875 2.875 5.25 3.5 5.25C4.125 5.25 4.65625 5.46875 5.09375 5.90625C5.53125 6.34375 5.75 6.875 5.75 7.5C5.75 8.125 5.53125 8.65625 5.09375 9.09375C4.65625 9.53125 4.125 9.75 3.5 9.75ZM3.5 8.25C3.7125 8.25 3.8875 8.18125 4.025 8.04375C4.175 7.89375 4.25 7.7125 4.25 7.5C4.25 7.2875 4.175 7.1125 4.025 6.975C3.8875 6.825 3.7125 6.75 3.5 6.75C3.2875 6.75 3.10625 6.825 2.95625 6.975C2.81875 7.1125 2.75 7.2875 2.75 7.5C2.75 7.7125 2.81875 7.89375 2.95625 8.04375C3.10625 8.18125 3.2875 8.25 3.5 8.25ZM3.5 15V12.9C3.5 12.475 3.60625 12.0875 3.81875 11.7375C4.04375 11.375 4.3375 11.1 4.7 10.9125C5.475 10.525 6.2625 10.2375 7.0625 10.05C7.8625 9.85 8.675 9.75 9.5 9.75C10.325 9.75 11.1375 9.85 11.9375 10.05C12.7375 10.2375 13.525 10.525 14.3 10.9125C14.6625 11.1 14.95 11.375 15.1625 11.7375C15.3875 12.0875 15.5 12.475 15.5 12.9V15H3.5ZM5 13.5H14V12.9C14 12.7625 13.9625 12.6375 13.8875 12.525C13.825 12.4125 13.7375 12.325 13.625 12.2625C12.95 11.925 12.2688 11.675 11.5813 11.5125C10.8938 11.3375 10.2 11.25 9.5 11.25C8.8 11.25 8.10625 11.3375 7.41875 11.5125C6.73125 11.675 6.05 11.925 5.375 12.2625C5.2625 12.325 5.16875 12.4125 5.09375 12.525C5.03125 12.6375 5 12.7625 5 12.9V13.5ZM9.5 9C8.675 9 7.96875 8.70625 7.38125 8.11875C6.79375 7.53125 6.5 6.825 6.5 6C6.5 5.175 6.79375 4.46875 7.38125 3.88125C7.96875 3.29375 8.675 3 9.5 3C10.325 3 11.0312 3.29375 11.6188 3.88125C12.2063 4.46875 12.5 5.175 12.5 6C12.5 6.825 12.2063 7.53125 11.6188 8.11875C11.0312 8.70625 10.325 9 9.5 9ZM9.5 7.5C9.9125 7.5 10.2625 7.35625 10.55 7.06875C10.85 6.76875 11 6.4125 11 6C11 5.5875 10.85 5.2375 10.55 4.95C10.2625 4.65 9.9125 4.5 9.5 4.5C9.0875 4.5 8.73125 4.65 8.43125 4.95C8.14375 5.2375 8 5.5875 8 6C8 6.4125 8.14375 6.76875 8.43125 7.06875C8.73125 7.35625 9.0875 7.5 9.5 7.5ZM15.5 9.75C14.875 9.75 14.3438 9.53125 13.9062 9.09375C13.4688 8.65625 13.25 8.125 13.25 7.5C13.25 6.875 13.4688 6.34375 13.9062 5.90625C14.3438 5.46875 14.875 5.25 15.5 5.25C16.125 5.25 16.6562 5.46875 17.0938 5.90625C17.5313 6.34375 17.75 6.875 17.75 7.5C17.75 8.125 17.5313 8.65625 17.0938 9.09375C16.6562 9.53125 16.125 9.75 15.5 9.75ZM15.5 8.25C15.7125 8.25 15.8875 8.18125 16.025 8.04375C16.175 7.89375 16.25 7.7125 16.25 7.5C16.25 7.2875 16.175 7.1125 16.025 6.975C15.8875 6.825 15.7125 6.75 15.5 6.75C15.2875 6.75 15.1063 6.825 14.9563 6.975C14.8188 7.1125 14.75 7.2875 14.75 7.5C14.75 7.7125 14.8188 7.89375 14.9563 8.04375C15.1063 8.18125 15.2875 8.25 15.5 8.25ZM16.25 15V10.4625C16.4375 10.525 16.6125 10.5938 16.775 10.6688C16.95 10.7438 17.125 10.825 17.3 10.9125C17.675 11.1 17.9688 11.375 18.1813 11.7375C18.3937 12.1 18.5 12.4938 18.5 12.9188V15H16.25Z",fill:"#2B6A46"}),(0,Re.jsx)("defs",{children:(0,Re.jsx)("clipPath",{id:"clip0_317_915",children:(0,Re.jsx)("rect",{width:"18",height:"18",fill:"white",transform:"translate(0.5)"})})})]}),Xe=e=>{let{color:t="#181d19"}=e;return(0,Re.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,Re.jsx)("path",{d:"M10 21C8.9 21 7.95833 20.6083 7.175 19.825C6.39167 19.0417 6 18.1 6 17C6 15.9 6.39167 14.9583 7.175 14.175C7.95833 13.3917 8.9 13 10 13C10.3833 13 10.7333 13.05 11.05 13.15C11.3833 13.2333 11.7 13.3667 12 13.55V3H18V7H14V17C14 18.1 13.6083 19.0417 12.825 19.825C12.0417 20.6083 11.1 21 10 21Z",fill:t})})};let Qe,Ze=null,$e="",et="TWILIO WEBSOCKET";const tt=(e,t,n,r,i)=>{Qe=i||"",Ze&&Ze.readyState===WebSocket.OPEN&&((0,Le.O)("","[ ".concat(et," ] :: Closing Existing Websocket Connection "),!1),Ze.close());let a="91"+t.replace(/[^\d]/g,"");const o="".concat(e).concat(a);(0,Le.O)("","[ ".concat(et," ] :: Phone Numer = ").concat(a," "),!1),Ze=new WebSocket(o),Ze.onopen=()=>{(0,Le.O)("","[ ".concat(et," ] :: Websocket Connection Opened "),!1)},Ze.onmessage=e=>{try{const t=JSON.parse(e.data);(0,Le.O)("","[ ".concat(et," ] :: Message : ").concat(JSON.stringify(t)," "),!1),t&&t.transcription?($e=t.transcription,(0,Le.O)("","[ ".concat(et," ] :: Transcription Text : ").concat($e," "),!1),Qe+=" "+$e,n(r.setTranscript(Qe))):(t&&"CALL_ENDED"===t.message&&nt(r,n),(0,Le.O)("","[ ".concat(et," ] :: Unexpected Websocket Message : ").concat(JSON.stringify(t)," "),!1))}catch(t){(0,Le.O)("error","[ ".concat(et," ] :: Error Parsing Websocket Message : ").concat(t," "),!1),nt(r,n)}},Ze.onclose=()=>{(0,Le.O)("","[ ".concat(et," ] :: Websocket connection Closed "),!1),(0,Le.O)("","[ ".concat(et," ] :: Previous Text : ").concat(Qe," "),!1),n(r.setTranscript(Qe)),n(r.setIsCallActive(!1)),Ze=null},Ze.onerror=e=>{(0,Le.O)("error","[ ".concat(et," ] :: Websocket ERROR Occured : ").concat(e," "),!1),nt(r,n)}},nt=(e,t)=>{Ze&&((0,Le.O)("","[ ".concat(et," ] :: Closing Websocket Connection "),!1),t(e.setIsCallRinging(!1)),t({type:F.DATA_CONSTANTS.SET_SCREEN,payload:U.DEFAULT}),t(e.setIsCallActive(!1)),t(e.setIsCallAlreadyConnected(!0)),t(e.setIsCallMuted(!0)),t(e.setIsCallDisconnected(!0)),Ze.close(),Ze=null)},{BaseClass:rt}=n(6591),{DeepgramLive:it}=n(7188),{FullAudioTranscriber:at}=n(2642),{WhisperLive:ot}=n(7036),st=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{live:"DEEPGRAM"};const t=((e,t)=>{switch(t){case"DEEPGRAM":default:return it(e);case"WHISPER":return ot(e)}})(rt,null===e||void 0===e?void 0:e.live);return at(t)};let ct=null,lt="",dt="";const ut=e=>async(t,n)=>{try{t({type:F.DATA_CONSTANTS.SET_IN_PROGRESS,payload:!0}),t({type:Y,payload:""});if(await navigator.mediaDevices.getUserMedia({audio:!0})){const r=localStorage.getItem("API_MODE")||"default";sessionStorage.setItem("sessionStatus",!0);const i=st({live:r});ct=new i("wss://api.aiscribe.quipohealth.com/ws","https://api.aiscribe.quipohealth.com/api",function(e,t){return n=>{if(n){const r=JSON.parse(n),i=null===r||void 0===r?void 0:r.transcription,{dictationText:a}=t().scribe;if(i!==lt){const t=i.replace(lt,"").trim();t&&(dt=a?"".concat(a," ").concat(t):t,(0,Le.O)("","[ Updated Dictation ] :: ".concat(dt),!1),e({type:Y,payload:dt}),lt=i)}}else(0,Le.O)("error","[ Error ] :: ".concat(n),!1),e({type:z,payload:"Invalid data received"})}}(t,n),e),await ct.getMicrophoneAccess((()=>{ct.startRecording(),t({type:F.DATA_CONSTANTS.SET_SCREEN,payload:U.NONE}),t({type:B}),t({type:z,payload:null})}),(e=>{(0,Le.O)("error","Error While Accessing Microphone! ".concat(e),!1),t({type:z,payload:"Microphone access error"}),t({type:F.DATA_CONSTANTS.SET_IN_PROGRESS,payload:!1})}))}}catch(r){"NotAllowedError"===r.name?(t({type:z,payload:"Microphone access denied. Please allow microphone permissions in your browser settings and try again."}),(0,Le.O)("error","Pemission for microphone is denied")):"NotFoundError"===r.name?t({type:z,payload:"Microphone not found on this device"}):((0,Le.O)("error","Error While Starting Recording: ".concat(r),!1),t({type:z,payload:"Failed to start recording"})),t({type:F.DATA_CONSTANTS.SET_IN_PROGRESS,payload:!1})}finally{ct||t({type:z,payload:"Processor not initialized"})}},ht=()=>async(e,t)=>{if(!ct)return void e({type:z,payload:"Processor not initialized"});const{transcriptText:n,dictationText:r}=t().scribe;if(n){e({type:q,payload:n+" "+r})}e({type:F.DATA_CONSTANTS.SET_IN_PROGRESS,payload:!0});try{const t=await ct.stopRecording(),r=t?t.trim():"";let i=n;(0,Le.O)("","[ Transcript Text ] :: ".concat(n),!1),(0,Le.O)("","[ Safe new Transcript ] :: ".concat(r),!1),i=n+" "+r,(0,Le.O)("","[ UPDATED Transcript ] :: ".concat(i),!1),e({type:G,payload:i}),e({type:q,payload:i}),e({type:F.DATA_CONSTANTS.SET_SCREEN,payload:U.DEFAULT}),lt=r,ct=null,sessionStorage.setItem("sessionStatus",!1),e({type:F.DATA_CONSTANTS.SET_IN_PROGRESS,payload:!1})}catch(i){(0,Le.O)("","[ Error Stopping Recording ] :: ".concat(i.message),!1),sessionStorage.setItem("sessionStatus",!1);const t="".concat(n," ").concat(dt);e({type:z,payload:"Failed to stop recording"}),e({type:F.DATA_CONSTANTS.SET_IN_PROGRESS,payload:!1}),e({type:G,payload:!1}),e({type:q,payload:t}),e({type:G,payload:n}),e({type:q,payload:n}),e({type:F.DATA_CONSTANTS.SET_SCREEN,payload:U.DEFAULT}),(0,Le.O)("error","Failed to transcribe the audio,No audio was recorded")}},pt=()=>e=>{ct?(ct.pauseRecording(),(0,Le.O)("","Dispatching PAUSE_RECORDING",!1),e({type:W})):e({type:z,payload:"Processor not initialized"})},ft=()=>e=>{ct?(e({type:F.DATA_CONSTANTS.SET_IN_PROGRESS,payload:!0}),ct.resumeRecording(),(0,Le.O)("","Dispatching RESUME_RECORDING",!1),e({type:H})):e({type:z,payload:"Processor not initialized"})},mt=e=>({type:q,payload:e}),_t=e=>({type:K,payload:e}),gt=e=>({type:"SET_STOPPING",payload:e}),Et=e=>({type:"SET_RESPONSE_COUNT",payload:e}),vt=e=>{let{onClick:t,icon:n,ariaLabel:r,className:i="",disabled:a=!1,id:o="",text:s}=e;const c="Regenerate"===s||"Download"===s||"Join"===s?i:"qpeScribe-button ".concat(i);return(0,Re.jsxs)("button",{onClick:t,className:c,"aria-label":r,disabled:a,id:o,children:[n,s&&(0,Re.jsx)("span",{children:s})]})},yt=i.memo(vt);function St(e,t){return function(){return e.apply(t,arguments)}}const{toString:bt}=Object.prototype,{getPrototypeOf:Tt}=Object,Ct=(wt=Object.create(null),e=>{const t=bt.call(e);return wt[t]||(wt[t]=t.slice(8,-1).toLowerCase())});var wt;const Rt=e=>(e=e.toLowerCase(),t=>Ct(t)===e),At=e=>t=>typeof t===e,{isArray:It}=Array,Nt=At("undefined");const Ot=Rt("ArrayBuffer");const Pt=At("string"),Lt=At("function"),Dt=At("number"),kt=e=>null!==e&&"object"===typeof e,xt=e=>{if("object"!==Ct(e))return!1;const t=Tt(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Mt=Rt("Date"),Ut=Rt("File"),Ft=Rt("Blob"),jt=Rt("FileList"),Vt=Rt("URLSearchParams"),[Bt,Gt,Wt,Ht]=["ReadableStream","Request","Response","Headers"].map(Rt);function qt(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),It(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),a=r.length;let o;for(n=0;n<a;n++)o=r[n],t.call(null,e[o],o,e)}}function zt(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Kt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,Yt=e=>!Nt(e)&&e!==Kt;const Jt=(Xt="undefined"!==typeof Uint8Array&&Tt(Uint8Array),e=>Xt&&e instanceof Xt);var Xt;const Qt=Rt("HTMLFormElement"),Zt=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),$t=Rt("RegExp"),en=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};qt(n,((n,i)=>{let a;!1!==(a=t(n,i,e))&&(r[i]=a||n)})),Object.defineProperties(e,r)},tn="abcdefghijklmnopqrstuvwxyz",nn="0123456789",rn={DIGIT:nn,ALPHA:tn,ALPHA_DIGIT:tn+tn.toUpperCase()+nn};const an=Rt("AsyncFunction"),on=((e,t)=>{return e?setImmediate:t?(n="axios@".concat(Math.random()),r=[],Kt.addEventListener("message",(e=>{let{source:t,data:i}=e;t===Kt&&i===n&&r.length&&r.shift()()}),!1),e=>{r.push(e),Kt.postMessage(n,"*")}):e=>setTimeout(e);var n,r})("function"===typeof setImmediate,Lt(Kt.postMessage)),sn="undefined"!==typeof queueMicrotask?queueMicrotask.bind(Kt):"undefined"!==typeof process&&process.nextTick||on,cn={isArray:It,isArrayBuffer:Ot,isBuffer:function(e){return null!==e&&!Nt(e)&&null!==e.constructor&&!Nt(e.constructor)&&Lt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||Lt(e.append)&&("formdata"===(t=Ct(e))||"object"===t&&Lt(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ot(e.buffer),t},isString:Pt,isNumber:Dt,isBoolean:e=>!0===e||!1===e,isObject:kt,isPlainObject:xt,isReadableStream:Bt,isRequest:Gt,isResponse:Wt,isHeaders:Ht,isUndefined:Nt,isDate:Mt,isFile:Ut,isBlob:Ft,isRegExp:$t,isFunction:Lt,isStream:e=>kt(e)&&Lt(e.pipe),isURLSearchParams:Vt,isTypedArray:Jt,isFileList:jt,forEach:qt,merge:function e(){const{caseless:t}=Yt(this)&&this||{},n={},r=(r,i)=>{const a=t&&zt(n,i)||i;xt(n[a])&&xt(r)?n[a]=e(n[a],r):xt(r)?n[a]=e({},r):It(r)?n[a]=r.slice():n[a]=r};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&qt(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return qt(t,((t,r)=>{n&&Lt(t)?e[r]=St(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,a,o;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],r&&!r(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&Tt(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Ct,kindOfTest:Rt,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(It(e))return e;let t=e.length;if(!Dt(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Qt,hasOwnProperty:Zt,hasOwnProp:Zt,reduceDescriptors:en,freezeMethods:e=>{en(e,((t,n)=>{if(Lt(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Lt(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return It(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:zt,global:Kt,isContextDefined:Yt,ALPHABET:rn,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn.ALPHA_DIGIT,n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&Lt(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(kt(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=It(e)?[]:{};return qt(e,((e,t)=>{const a=n(e,r+1);!Nt(a)&&(i[t]=a)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:an,isThenable:e=>e&&(kt(e)||Lt(e))&&Lt(e.then)&&Lt(e.catch),setImmediate:on,asap:sn};function ln(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}cn.inherits(ln,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:cn.toJSONObject(this.config),code:this.code,status:this.status}}});const dn=ln.prototype,un={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{un[e]={value:e}})),Object.defineProperties(ln,un),Object.defineProperty(dn,"isAxiosError",{value:!0}),ln.from=(e,t,n,r,i,a)=>{const o=Object.create(dn);return cn.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),ln.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};const hn=ln;function pn(e){return cn.isPlainObject(e)||cn.isArray(e)}function fn(e){return cn.endsWith(e,"[]")?e.slice(0,-2):e}function mn(e,t,n){return e?e.concat(t).map((function(e,t){return e=fn(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const _n=cn.toFlatObject(cn,{},null,(function(e){return/^is[A-Z]/.test(e)}));const gn=function(e,t,n){if(!cn.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=cn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!cn.isUndefined(t[e])}))).metaTokens,i=n.visitor||l,a=n.dots,o=n.indexes,s=(n.Blob||"undefined"!==typeof Blob&&Blob)&&cn.isSpecCompliantForm(t);if(!cn.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(cn.isDate(e))return e.toISOString();if(!s&&cn.isBlob(e))throw new hn("Blob is not supported. Use a Buffer instead.");return cn.isArrayBuffer(e)||cn.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let s=e;if(e&&!i&&"object"===typeof e)if(cn.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(cn.isArray(e)&&function(e){return cn.isArray(e)&&!e.some(pn)}(e)||(cn.isFileList(e)||cn.endsWith(n,"[]"))&&(s=cn.toArray(e)))return n=fn(n),s.forEach((function(e,r){!cn.isUndefined(e)&&null!==e&&t.append(!0===o?mn([n],r,a):null===o?n:n+"[]",c(e))})),!1;return!!pn(e)||(t.append(mn(i,n,a),c(e)),!1)}const d=[],u=Object.assign(_n,{defaultVisitor:l,convertValue:c,isVisitable:pn});if(!cn.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!cn.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),cn.forEach(n,(function(n,a){!0===(!(cn.isUndefined(n)||null===n)&&i.call(t,n,cn.isString(a)?a.trim():a,r,u))&&e(n,r?r.concat(a):[a])})),d.pop()}}(e),t};function En(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function vn(e,t){this._pairs=[],e&&gn(e,this,t)}const yn=vn.prototype;yn.append=function(e,t){this._pairs.push([e,t])},yn.toString=function(e){const t=e?function(t){return e.call(this,t,En)}:En;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Sn=vn;function bn(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Tn(e,t,n){if(!t)return e;const r=n&&n.encode||bn;cn.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let a;if(a=i?i(t,n):cn.isURLSearchParams(t)?t.toString():new Sn(t,n).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}const Cn=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){cn.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},wn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Rn={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Sn,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},An="undefined"!==typeof window&&"undefined"!==typeof document,In="object"===typeof navigator&&navigator||void 0,Nn=An&&(!In||["ReactNative","NativeScript","NS"].indexOf(In.product)<0),On="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,Pn=An&&window.location.href||"http://localhost",Ln=(0,A.A)((0,A.A)({},r),Rn);const Dn=function(e){function t(e,n,r,i){let a=e[i++];if("__proto__"===a)return!0;const o=Number.isFinite(+a),s=i>=e.length;if(a=!a&&cn.isArray(r)?r.length:a,s)return cn.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!o;r[a]&&cn.isObject(r[a])||(r[a]=[]);return t(e,n,r[a],i)&&cn.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let a;for(r=0;r<i;r++)a=n[r],t[a]=e[a];return t}(r[a])),!o}if(cn.isFormData(e)&&cn.isFunction(e.entries)){const n={};return cn.forEachEntry(e,((e,r)=>{t(function(e){return cn.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const kn={transitional:wn,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=cn.isObject(e);i&&cn.isHTMLForm(e)&&(e=new FormData(e));if(cn.isFormData(e))return r?JSON.stringify(Dn(e)):e;if(cn.isArrayBuffer(e)||cn.isBuffer(e)||cn.isStream(e)||cn.isFile(e)||cn.isBlob(e)||cn.isReadableStream(e))return e;if(cn.isArrayBufferView(e))return e.buffer;if(cn.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return gn(e,new Ln.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return Ln.isNode&&cn.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=cn.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return gn(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(cn.isString(e))try{return(t||JSON.parse)(e),cn.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||kn.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(cn.isResponse(e)||cn.isReadableStream(e))return e;if(e&&cn.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(i){if(n){if("SyntaxError"===i.name)throw hn.from(i,hn.ERR_BAD_RESPONSE,this,null,this.response);throw i}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ln.classes.FormData,Blob:Ln.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};cn.forEach(["delete","get","head","post","put","patch"],(e=>{kn.headers[e]={}}));const xn=kn,Mn=cn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Un=Symbol("internals");function Fn(e){return e&&String(e).trim().toLowerCase()}function jn(e){return!1===e||null==e?e:cn.isArray(e)?e.map(jn):String(e)}function Vn(e,t,n,r,i){return cn.isFunction(r)?r.call(this,t,n):(i&&(t=n),cn.isString(t)?cn.isString(r)?-1!==t.indexOf(r):cn.isRegExp(r)?r.test(t):void 0:void 0)}class Bn{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=Fn(t);if(!i)throw new Error("header name must be a non-empty string");const a=cn.findKey(r,i);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=jn(e))}const a=(e,t)=>cn.forEach(e,((e,n)=>i(e,n,t)));if(cn.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(cn.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))a((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&Mn[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t);else if(cn.isHeaders(e))for(const[o,s]of e.entries())i(s,o,n);else null!=e&&i(t,e,n);return this}get(e,t){if(e=Fn(e)){const n=cn.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(cn.isFunction(t))return t.call(this,e,n);if(cn.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Fn(e)){const n=cn.findKey(this,e);return!(!n||void 0===this[n]||t&&!Vn(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=Fn(e)){const i=cn.findKey(n,e);!i||t&&!Vn(0,n[i],i,t)||(delete n[i],r=!0)}}return cn.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!Vn(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return cn.forEach(this,((r,i)=>{const a=cn.findKey(n,i);if(a)return t[a]=jn(r),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):String(i).trim();o!==i&&delete t[i],t[o]=jn(r),n[o]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return cn.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&cn.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[Un]=this[Un]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=Fn(e);t[r]||(!function(e,t){const n=cn.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return cn.isArray(e)?e.forEach(r):r(e),this}}Bn.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),cn.reduceDescriptors(Bn.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),cn.freezeMethods(Bn);const Gn=Bn;function Wn(e,t){const n=this||xn,r=t||n,i=Gn.from(r.headers);let a=r.data;return cn.forEach(e,(function(e){a=e.call(n,a,i.normalize(),t?t.status:void 0)})),i.normalize(),a}function Hn(e){return!(!e||!e.__CANCEL__)}function qn(e,t,n){hn.call(this,null==e?"canceled":e,hn.ERR_CANCELED,t,n),this.name="CanceledError"}cn.inherits(qn,hn,{__CANCEL__:!0});const zn=qn;function Kn(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new hn("Request failed with status code "+n.status,[hn.ERR_BAD_REQUEST,hn.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}const Yn=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,a=0,o=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),l=r[o];i||(i=c),n[a]=s,r[a]=c;let d=o,u=0;for(;d!==a;)u+=n[d++],d%=e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),c-i<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}};const Jn=function(e,t){let n,r,i=0,a=1e3/t;const o=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=a,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];t>=a?o(c,e):(n=c,r||(r=setTimeout((()=>{r=null,o(n)}),a-t)))},()=>n&&o(n)]},Xn=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=Yn(50,250);return Jn((n=>{const a=n.loaded,o=n.lengthComputable?n.total:void 0,s=a-r,c=i(s);r=a;e({loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:c||void 0,estimated:c&&o&&a<=o?(o-a)/c:void 0,event:n,lengthComputable:null!=o,[t?"download":"upload"]:!0})}),n)},Qn=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Zn=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return cn.asap((()=>e(...n)))},$n=Ln.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,Ln.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(Ln.origin),Ln.navigator&&/(msie|trident)/i.test(Ln.navigator.userAgent)):()=>!0,er=Ln.hasStandardBrowserEnv?{write(e,t,n,r,i,a){const o=[e+"="+encodeURIComponent(t)];cn.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),cn.isString(r)&&o.push("path="+r),cn.isString(i)&&o.push("domain="+i),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function tr(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const nr=e=>e instanceof Gn?(0,A.A)({},e):e;function rr(e,t){t=t||{};const n={};function r(e,t,n,r){return cn.isPlainObject(e)&&cn.isPlainObject(t)?cn.merge.call({caseless:r},e,t):cn.isPlainObject(t)?cn.merge({},t):cn.isArray(t)?t.slice():t}function i(e,t,n,i){return cn.isUndefined(t)?cn.isUndefined(e)?void 0:r(void 0,e,0,i):r(e,t,0,i)}function a(e,t){if(!cn.isUndefined(t))return r(void 0,t)}function o(e,t){return cn.isUndefined(t)?cn.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,a){return a in t?r(n,i):a in e?r(void 0,n):void 0}const c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t,n)=>i(nr(e),nr(t),0,!0)};return cn.forEach(Object.keys(Object.assign({},e,t)),(function(r){const a=c[r]||i,o=a(e[r],t[r],r);cn.isUndefined(o)&&a!==s||(n[r]=o)})),n}const ir=e=>{const t=rr({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:a,xsrfCookieName:o,headers:s,auth:c}=t;if(t.headers=s=Gn.from(s),t.url=Tn(tr(t.baseURL,t.url),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),cn.isFormData(r))if(Ln.hasStandardBrowserEnv||Ln.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map((e=>e.trim())).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(Ln.hasStandardBrowserEnv&&(i&&cn.isFunction(i)&&(i=i(t)),i||!1!==i&&$n(t.url))){const e=a&&o&&er.read(o);e&&s.set(a,e)}return t},ar="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){const r=ir(e);let i=r.data;const a=Gn.from(r.headers).normalize();let o,s,c,l,d,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=r;function f(){l&&l(),d&&d(),r.cancelToken&&r.cancelToken.unsubscribe(o),r.signal&&r.signal.removeEventListener("abort",o)}let m=new XMLHttpRequest;function _(){if(!m)return;const r=Gn.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());Kn((function(e){t(e),f()}),(function(e){n(e),f()}),{data:u&&"text"!==u&&"json"!==u?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=_:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(_)},m.onabort=function(){m&&(n(new hn("Request aborted",hn.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new hn("Network Error",hn.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const i=r.transitional||wn;r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new hn(t,i.clarifyTimeoutError?hn.ETIMEDOUT:hn.ECONNABORTED,e,m)),m=null},void 0===i&&a.setContentType(null),"setRequestHeader"in m&&cn.forEach(a.toJSON(),(function(e,t){m.setRequestHeader(t,e)})),cn.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),u&&"json"!==u&&(m.responseType=r.responseType),p&&([c,d]=Xn(p,!0),m.addEventListener("progress",c)),h&&m.upload&&([s,l]=Xn(h),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",l)),(r.cancelToken||r.signal)&&(o=t=>{m&&(n(!t||t.type?new zn(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(o),r.signal&&(r.signal.aborted?o():r.signal.addEventListener("abort",o)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);g&&-1===Ln.protocols.indexOf(g)?n(new hn("Unsupported protocol "+g+":",hn.ERR_BAD_REQUEST,e)):m.send(i||null)}))},or=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,o();const t=e instanceof Error?e:this.reason;r.abort(t instanceof hn?t:new zn(t instanceof Error?t.message:t))}};let a=t&&setTimeout((()=>{a=null,i(new hn("timeout ".concat(t," of ms exceeded"),hn.ETIMEDOUT))}),t);const o=()=>{e&&(a&&clearTimeout(a),a=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)})),e=null)};e.forEach((e=>e.addEventListener("abort",i)));const{signal:s}=r;return s.unsubscribe=()=>cn.asap(o),s}};function sr(e,t){this.v=e,this.k=t}function cr(e){return function(){return new lr(e.apply(this,arguments))}}function lr(e){var t,n;function r(t,n){try{var a=e[t](n),o=a.value,s=o instanceof sr;Promise.resolve(s?o.v:o).then((function(n){if(s){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}i(a.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(a,o){var s={key:e,arg:i,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function dr(e){return new sr(e,0)}function ur(e){var t={},n=!1;function r(t,r){return n=!0,r=new Promise((function(n){n(e[t](r))})),{done:!1,value:new sr(r,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}function hr(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new pr(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function pr(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return pr=function(e){this.s=e,this.n=e.next},pr.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new pr(e)}lr.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},lr.prototype.next=function(e){return this._invoke("next",e)},lr.prototype.throw=function(e){return this._invoke("throw",e)},lr.prototype.return=function(e){return this._invoke("return",e)};const fr=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},mr=function(){var e=cr((function*(e,t){var n,r=!1,i=!1;try{for(var a,o=hr(_r(e));r=!(a=yield dr(o.next())).done;r=!1){const e=a.value;yield*ur(hr(fr(e,t)))}}catch(xi){i=!0,n=xi}finally{try{r&&null!=o.return&&(yield dr(o.return()))}finally{if(i)throw n}}}));return function(t,n){return e.apply(this,arguments)}}(),_r=function(){var e=cr((function*(e){if(e[Symbol.asyncIterator])return void(yield*ur(hr(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield dr(t.read());if(e)break;yield n}}finally{yield dr(t.cancel())}}));return function(t){return e.apply(this,arguments)}}(),gr=(e,t,n,r)=>{const i=mr(e,t);let a,o=0,s=e=>{a||(a=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return s(),void e.close();let a=r.byteLength;if(n){let e=o+=a;n(e)}e.enqueue(new Uint8Array(r))}catch(xi){throw s(xi),xi}},cancel:e=>(s(e),i.return())},{highWaterMark:2})},Er="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,vr=Er&&"function"===typeof ReadableStream,yr=Er&&("function"===typeof TextEncoder?(Sr=new TextEncoder,e=>Sr.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Sr;const br=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(i){return!1}},Tr=vr&&br((()=>{let e=!1;const t=new Request(Ln.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),Cr=vr&&br((()=>cn.isReadableStream(new Response("").body))),wr={stream:Cr&&(e=>e.body)};var Rr;Er&&(Rr=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!wr[e]&&(wr[e]=cn.isFunction(Rr[e])?t=>t[e]():(t,n)=>{throw new hn("Response type '".concat(e,"' is not supported"),hn.ERR_NOT_SUPPORT,n)})})));const Ar=async(e,t)=>{const n=cn.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(cn.isBlob(e))return e.size;if(cn.isSpecCompliantForm(e)){const t=new Request(Ln.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return cn.isArrayBufferView(e)||cn.isArrayBuffer(e)?e.byteLength:(cn.isURLSearchParams(e)&&(e+=""),cn.isString(e)?(await yr(e)).byteLength:void 0)})(t):n},Ir=Er&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:a,timeout:o,onDownloadProgress:s,onUploadProgress:c,responseType:l,headers:d,withCredentials:u="same-origin",fetchOptions:h}=ir(e);l=l?(l+"").toLowerCase():"text";let p,f=or([i,a&&a.toAbortSignal()],o);const m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let _;try{if(c&&Tr&&"get"!==n&&"head"!==n&&0!==(_=await Ar(d,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(cn.isFormData(r)&&(e=n.headers.get("content-type"))&&d.setContentType(e),n.body){const[e,t]=Qn(_,Xn(Zn(c)));r=gr(n.body,65536,e,t)}}cn.isString(u)||(u=u?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,(0,A.A)((0,A.A)({},h),{},{signal:f,method:n.toUpperCase(),headers:d.normalize().toJSON(),body:r,duplex:"half",credentials:i?u:void 0}));let a=await fetch(p);const o=Cr&&("stream"===l||"response"===l);if(Cr&&(s||o&&m)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=a[t]}));const t=cn.toFiniteNumber(a.headers.get("content-length")),[n,r]=s&&Qn(t,Xn(Zn(s),!0))||[];a=new Response(gr(a.body,65536,n,(()=>{r&&r(),m&&m()})),e)}l=l||"text";let g=await wr[cn.findKey(wr,l)||"text"](a,e);return!o&&m&&m(),await new Promise(((t,n)=>{Kn(t,n,{data:g,headers:Gn.from(a.headers),status:a.status,statusText:a.statusText,config:e,request:p})}))}catch(xi){if(m&&m(),xi&&"TypeError"===xi.name&&/fetch/i.test(xi.message))throw Object.assign(new hn("Network Error",hn.ERR_NETWORK,e,p),{cause:xi.cause||xi});throw hn.from(xi,xi&&xi.code,e,p)}}),Nr={http:null,xhr:ar,fetch:Ir};cn.forEach(Nr,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(n){}Object.defineProperty(e,"adapterName",{value:t})}}));const Or=e=>"- ".concat(e),Pr=e=>cn.isFunction(e)||null===e||!1===e,Lr=e=>{e=cn.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let a=0;a<t;a++){let t;if(n=e[a],r=n,!Pr(n)&&(r=Nr[(t=String(n)).toLowerCase()],void 0===r))throw new hn("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+a]=r}if(!r){const e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));let n=t?e.length>1?"since :\n"+e.map(Or).join("\n"):" "+Or(e[0]):"as no adapter specified";throw new hn("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return r};function Dr(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new zn(null,e)}function kr(e){Dr(e),e.headers=Gn.from(e.headers),e.data=Wn.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Lr(e.adapter||xn.adapter)(e).then((function(t){return Dr(e),t.data=Wn.call(e,e.transformResponse,t),t.headers=Gn.from(t.headers),t}),(function(t){return Hn(t)||(Dr(e),t&&t.response&&(t.response.data=Wn.call(e,e.transformResponse,t.response),t.response.headers=Gn.from(t.response.headers))),Promise.reject(t)}))}const xr="1.7.9",Mr={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Mr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Ur={};Mr.transitional=function(e,t,n){function r(e,t){return"[Axios v1.7.9] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,a)=>{if(!1===e)throw new hn(r(i," has been removed"+(t?" in "+t:"")),hn.ERR_DEPRECATED);return t&&!Ur[i]&&(Ur[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,a)}},Mr.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};const Fr={assertOptions:function(e,t,n){if("object"!==typeof e)throw new hn("options must be an object",hn.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const a=r[i],o=t[a];if(o){const t=e[a],n=void 0===t||o(t,a,e);if(!0!==n)throw new hn("option "+a+" must be "+n,hn.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new hn("Unknown option "+a,hn.ERR_BAD_OPTION)}},validators:Mr},jr=Fr.validators;class Vr{constructor(e){this.defaults=e,this.interceptors={request:new Cn,response:new Cn}}async request(e,t){try{return await this._request(e,t)}catch(xi){if(xi instanceof Error){let t={};Error.captureStackTrace?Error.captureStackTrace(t):t=new Error;const r=t.stack?t.stack.replace(/^.+\n/,""):"";try{xi.stack?r&&!String(xi.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(xi.stack+="\n"+r):xi.stack=r}catch(n){}}throw xi}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=rr(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&Fr.assertOptions(n,{silentJSONParsing:jr.transitional(jr.boolean),forcedJSONParsing:jr.transitional(jr.boolean),clarifyTimeoutError:jr.transitional(jr.boolean)},!1),null!=r&&(cn.isFunction(r)?t.paramsSerializer={serialize:r}:Fr.assertOptions(r,{encode:jr.function,serialize:jr.function},!0)),Fr.assertOptions(t,{baseUrl:jr.spelling("baseURL"),withXsrfToken:jr.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&cn.merge(i.common,i[t.method]);i&&cn.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=Gn.concat(a,i);const o=[];let s=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));const c=[];let l;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let d,u=0;if(!s){const e=[kr.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,c),d=e.length,l=Promise.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(p){t.call(this,p);break}}try{l=kr.call(this,h)}catch(p){return Promise.reject(p)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return Tn(tr((e=rr(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}cn.forEach(["delete","get","head","options"],(function(e){Vr.prototype[e]=function(t,n){return this.request(rr(n||{},{method:e,url:t,data:(n||{}).data}))}})),cn.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(rr(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Vr.prototype[e]=t(),Vr.prototype[e+"Form"]=t(!0)}));const Br=Vr;class Gr{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new zn(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;const t=new Gr((function(t){e=t}));return{token:t,cancel:e}}}const Wr=Gr;const Hr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Hr).forEach((e=>{let[t,n]=e;Hr[n]=t}));const qr=Hr;const zr=function e(t){const n=new Br(t),r=St(Br.prototype.request,n);return cn.extend(r,Br.prototype,n,{allOwnKeys:!0}),cn.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(rr(t,n))},r}(xn);zr.Axios=Br,zr.CanceledError=zn,zr.CancelToken=Wr,zr.isCancel=Hn,zr.VERSION=xr,zr.toFormData=gn,zr.AxiosError=hn,zr.Cancel=zr.CanceledError,zr.all=function(e){return Promise.all(e)},zr.spread=function(e){return function(t){return e.apply(null,t)}},zr.isAxiosError=function(e){return cn.isObject(e)&&!0===e.isAxiosError},zr.mergeConfig=rr,zr.AxiosHeaders=Gn,zr.formToJSON=e=>Dn(cn.isHTMLForm(e)?new FormData(e):e),zr.getAdapter=Lr,zr.HttpStatusCode=qr,zr.default=zr;const Kr=zr,Yr=e=>({type:he,payload:e}),Jr=e=>({type:pe,payload:e}),Xr=e=>({type:fe,payload:e}),Qr=e=>({type:me,payload:e}),Zr=e=>({type:_e,payload:e}),$r="https://api-dev.quipohealth.com/integration/service-integrations-api/extension",ei=async(e,t,n)=>{const r="".concat($r,"/fetch-questionnaire"),i=ti(e,t);if(!i)throw(0,Le.O)("error",'Invalid type "'.concat(t,'". Expected "demographicNo" or "oscarAppointmentId".')),new Error('Invalid type "'.concat(t,'". Expected "demographicNo" or "oscarAppointmentId".'));try{var a;const e=await Kr.post(r,i,{headers:{"Content-Type":"application/json"}});if(404===(null===(a=e.data)||void 0===a?void 0:a.statusCode)){const e="oscarAppointmentId"===t?"Not Found: Appointment Questionnaire":"Not Found: New Patient Questionnaire";return(0,Le.O)("error",e),n("oscarAppointmentId"===t?Xr(!0):Qr(!0)),null}return e.data.data}catch(o){throw(0,Le.O)("error","API call failed: ".concat(o.message)),o}},ti=(e,t)=>({demographicNo:{demographicNo:e},oscarAppointmentId:{oscarAppointmentId:e}}[t]||null),ni=e=>e?e.split(/[ ,]+/).map((e=>e.charAt(0))).join("").toUpperCase():"",ri=e=>{if(!e||"object"!==typeof e)return"Invalid SOAP note data.";return["subjective","objective","assessment","plan"].map((t=>{return n=t.charAt(0).toUpperCase()+t.slice(1),r=e[t],Array.isArray(r)&&0!==r.length?"".concat(n,":\n").concat(r.map(((e,t)=>"  ".concat(t+1,". ").concat(e))).join("\n"),"\n"):"";var n,r})).filter((e=>""!==e)).join("\n")},ii=e=>{let{timer:t,type:n,patient:r,doctor:i}=e;const{doctorName:a,patientName:o,screen:s}=R((e=>e.data)),{isRecording:c}=R((e=>e.scribe)),{isCallActive:l}=R((e=>e.twilio)),{isVideoCallActive:d}=R((e=>e.video)),u=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))},h=o||"N/A",p=a||"N/A";switch(n){case M.NAME:return i?(0,Re.jsxs)("span",{children:[p," (You)"]}):r?(0,Re.jsx)("span",{children:h}):(0,Re.jsxs)("div",{className:"qpeTimerContainer",children:[h&&(0,Re.jsx)("span",{children:h}),!r&&!i&&(0,Re.jsx)("span",{children:"-"}),p&&!i&&(0,Re.jsxs)("span",{children:[p," (You)"]}),!r&&!i&&(l||c||s===U.NONE||d)&&(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)("span",{children:"-"}),(0,Re.jsx)("span",{className:"status",children:"Recording"})]})]});case M.TIMER:return(0,Re.jsx)("p",{style:{color:"var(--white)",fontWeight:500},children:void 0!==t?u(t):"N/A"});default:return(0,Re.jsx)("p",{style:{color:"var(--white)",fontWeight:500},children:"N/A"})}};var ai=n(2284),oi=Uint8Array,si=Uint16Array,ci=Int32Array,li=new oi([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),di=new oi([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ui=new oi([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hi=function(e,t){for(var n=new si(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new ci(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return{b:n,r:i}},pi=hi(li,2),fi=pi.b,mi=pi.r;fi[28]=258,mi[258]=28;for(var _i=hi(di,0),gi=_i.b,Ei=_i.r,vi=new si(32768),yi=0;yi<32768;++yi){var Si=(43690&yi)>>1|(21845&yi)<<1;Si=(61680&(Si=(52428&Si)>>2|(13107&Si)<<2))>>4|(3855&Si)<<4,vi[yi]=((65280&Si)>>8|(255&Si)<<8)>>1}var bi=function(e,t,n){for(var r=e.length,i=0,a=new si(t);i<r;++i)e[i]&&++a[e[i]-1];var o,s=new si(t);for(i=1;i<t;++i)s[i]=s[i-1]+a[i-1]<<1;if(n){o=new si(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],d=t-e[i],u=s[e[i]-1]++<<d,h=u|(1<<d)-1;u<=h;++u)o[vi[u]>>c]=l}else for(o=new si(r),i=0;i<r;++i)e[i]&&(o[i]=vi[s[e[i]-1]++]>>15-e[i]);return o},Ti=new oi(288);for(yi=0;yi<144;++yi)Ti[yi]=8;for(yi=144;yi<256;++yi)Ti[yi]=9;for(yi=256;yi<280;++yi)Ti[yi]=7;for(yi=280;yi<288;++yi)Ti[yi]=8;var Ci=new oi(32);for(yi=0;yi<32;++yi)Ci[yi]=5;var wi=bi(Ti,9,0),Ri=bi(Ti,9,1),Ai=bi(Ci,5,0),Ii=bi(Ci,5,1),Ni=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},Oi=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},Pi=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},Li=function(e){return(e+7)/8|0},Di=function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new oi(e.subarray(t,n))},ki=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],xi=function(e,t,n){var r=new Error(t||ki[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,xi),!n)throw r;return r},Mi=function(e,t,n,r){var i=e.length,a=r?r.length:0;if(!i||t.f&&!t.l)return n||new oi(0);var o=!n,s=o||2!=t.i,c=t.i;o&&(n=new oi(3*i));var l=function(e){var t=n.length;if(e>t){var r=new oi(Math.max(2*t,e));r.set(n),n=r}},d=t.f||0,u=t.p||0,h=t.b||0,p=t.l,f=t.d,m=t.m,_=t.n,g=8*i;do{if(!p){d=Oi(e,u,1);var E=Oi(e,u+1,3);if(u+=3,!E){var v=e[(O=Li(u)+4)-4]|e[O-3]<<8,y=O+v;if(y>i){c&&xi(0);break}s&&l(h+v),n.set(e.subarray(O,y),h),t.b=h+=v,t.p=u=8*y,t.f=d;continue}if(1==E)p=Ri,f=Ii,m=9,_=5;else if(2==E){var S=Oi(e,u,31)+257,b=Oi(e,u+10,15)+4,T=S+Oi(e,u+5,31)+1;u+=14;for(var C=new oi(T),w=new oi(19),R=0;R<b;++R)w[ui[R]]=Oi(e,u+3*R,7);u+=3*b;var A=Ni(w),I=(1<<A)-1,N=bi(w,A,1);for(R=0;R<T;){var O,P=N[Oi(e,u,I)];if(u+=15&P,(O=P>>4)<16)C[R++]=O;else{var L=0,D=0;for(16==O?(D=3+Oi(e,u,3),u+=2,L=C[R-1]):17==O?(D=3+Oi(e,u,7),u+=3):18==O&&(D=11+Oi(e,u,127),u+=7);D--;)C[R++]=L}}var k=C.subarray(0,S),x=C.subarray(S);m=Ni(k),_=Ni(x),p=bi(k,m,1),f=bi(x,_,1)}else xi(1);if(u>g){c&&xi(0);break}}s&&l(h+131072);for(var M=(1<<m)-1,U=(1<<_)-1,F=u;;F=u){var j=(L=p[Pi(e,u)&M])>>4;if((u+=15&L)>g){c&&xi(0);break}if(L||xi(2),j<256)n[h++]=j;else{if(256==j){F=u,p=null;break}var V=j-254;if(j>264){var B=li[R=j-257];V=Oi(e,u,(1<<B)-1)+fi[R],u+=B}var G=f[Pi(e,u)&U],W=G>>4;G||xi(3),u+=15&G;x=gi[W];if(W>3){B=di[W];x+=Pi(e,u)&(1<<B)-1,u+=B}if(u>g){c&&xi(0);break}s&&l(h+131072);var H=h+V;if(h<x){var q=a-x,z=Math.min(x,H);for(q+h<0&&xi(3);h<z;++h)n[h]=r[q+h]}for(;h<H;++h)n[h]=n[h-x]}}t.l=p,t.p=F,t.b=h,t.f=d,p&&(d=1,t.m=m,t.d=f,t.n=_)}while(!d);return h!=n.length&&o?Di(n,0,h):n.subarray(0,h)},Ui=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8},Fi=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8,e[r+2]|=n>>16},ji=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,a=n.slice();if(!i)return{t:zi,l:0};if(1==i){var o=new oi(n[0].s+1);return o[n[0].s]=1,{t:o,l:1}}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],c=n[1],l=0,d=1,u=2;for(n[0]={s:-1,f:s.f+c.f,l:s,r:c};d!=i-1;)s=n[n[l].f<n[u].f?l++:u++],c=n[l!=d&&n[l].f<n[u].f?l++:u++],n[d++]={s:-1,f:s.f+c.f,l:s,r:c};var h=a[0].s;for(r=1;r<i;++r)a[r].s>h&&(h=a[r].s);var p=new si(h+1),f=Vi(n[d-1],p,0);if(f>t){r=0;var m=0,_=f-t,g=1<<_;for(a.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));r<i;++r){var E=a[r].s;if(!(p[E]>t))break;m+=g-(1<<f-p[E]),p[E]=t}for(m>>=_;m>0;){var v=a[r].s;p[v]<t?m-=1<<t-p[v]++-1:++r}for(;r>=0&&m;--r){var y=a[r].s;p[y]==t&&(--p[y],++m)}f=t}return{t:new oi(p),l:f}},Vi=function(e,t,n){return-1==e.s?Math.max(Vi(e.l,t,n+1),Vi(e.r,t,n+1)):t[e.s]=n},Bi=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new si(++t),r=0,i=e[0],a=1,o=function(e){n[r++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=e[s]}return{c:n.subarray(0,r),n:t}},Gi=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},Wi=function(e,t,n){var r=n.length,i=Li(t+2);e[i]=255&r,e[i+1]=r>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var a=0;a<r;++a)e[i+a+4]=n[a];return 8*(i+4+r)},Hi=function(e,t,n,r,i,a,o,s,c,l,d){Ui(t,d++,n),++i[256];for(var u=ji(i,15),h=u.t,p=u.l,f=ji(a,15),m=f.t,_=f.l,g=Bi(h),E=g.c,v=g.n,y=Bi(m),S=y.c,b=y.n,T=new si(19),C=0;C<E.length;++C)++T[31&E[C]];for(C=0;C<S.length;++C)++T[31&S[C]];for(var w=ji(T,7),R=w.t,A=w.l,I=19;I>4&&!R[ui[I-1]];--I);var N,O,P,L,D=l+5<<3,k=Gi(i,Ti)+Gi(a,Ci)+o,x=Gi(i,h)+Gi(a,m)+o+14+3*I+Gi(T,R)+2*T[16]+3*T[17]+7*T[18];if(c>=0&&D<=k&&D<=x)return Wi(t,d,e.subarray(c,c+l));if(Ui(t,d,1+(x<k)),d+=2,x<k){N=bi(h,p,0),O=h,P=bi(m,_,0),L=m;var M=bi(R,A,0);Ui(t,d,v-257),Ui(t,d+5,b-1),Ui(t,d+10,I-4),d+=14;for(C=0;C<I;++C)Ui(t,d+3*C,R[ui[C]]);d+=3*I;for(var U=[E,S],F=0;F<2;++F){var j=U[F];for(C=0;C<j.length;++C){var V=31&j[C];Ui(t,d,M[V]),d+=R[V],V>15&&(Ui(t,d,j[C]>>5&127),d+=j[C]>>12)}}}else N=wi,O=Ti,P=Ai,L=Ci;for(C=0;C<s;++C){var B=r[C];if(B>255){Fi(t,d,N[(V=B>>18&31)+257]),d+=O[V+257],V>7&&(Ui(t,d,B>>23&31),d+=li[V]);var G=31&B;Fi(t,d,P[G]),d+=L[G],G>3&&(Fi(t,d,B>>5&8191),d+=di[G])}else Fi(t,d,N[B]),d+=O[B]}return Fi(t,d,N[256]),d+O[256]},qi=new ci([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),zi=new oi(0),Ki=function(e,t,n,r,i,a){var o=a.z||e.length,s=new oi(r+o+5*(1+Math.ceil(o/7e3))+i),c=s.subarray(r,s.length-i),l=a.l,d=7&(a.r||0);if(t){d&&(c[0]=a.r>>3);for(var u=qi[t-1],h=u>>13,p=8191&u,f=(1<<n)-1,m=a.p||new si(32768),_=a.h||new si(f+1),g=Math.ceil(n/3),E=2*g,v=function(t){return(e[t]^e[t+1]<<g^e[t+2]<<E)&f},y=new ci(25e3),S=new si(288),b=new si(32),T=0,C=0,w=a.i||0,R=0,A=a.w||0,I=0;w+2<o;++w){var N=v(w),O=32767&w,P=_[N];if(m[O]=P,_[N]=O,A<=w){var L=o-w;if((T>7e3||R>24576)&&(L>423||!l)){d=Hi(e,c,0,y,S,b,C,R,I,w-I,d),R=T=C=0,I=w;for(var D=0;D<286;++D)S[D]=0;for(D=0;D<30;++D)b[D]=0}var k=2,x=0,M=p,U=O-P&32767;if(L>2&&N==v(w-U))for(var F=Math.min(h,L)-1,j=Math.min(32767,w),V=Math.min(258,L);U<=j&&--M&&O!=P;){if(e[w+k]==e[w+k-U]){for(var B=0;B<V&&e[w+B]==e[w+B-U];++B);if(B>k){if(k=B,x=U,B>F)break;var G=Math.min(U,B-2),W=0;for(D=0;D<G;++D){var H=w-U+D&32767,q=H-m[H]&32767;q>W&&(W=q,P=H)}}}U+=(O=P)-(P=m[O])&32767}if(x){y[R++]=268435456|mi[k]<<18|Ei[x];var z=31&mi[k],K=31&Ei[x];C+=li[z]+di[K],++S[257+z],++b[K],A=w+k,++T}else y[R++]=e[w],++S[e[w]]}}for(w=Math.max(w,A);w<o;++w)y[R++]=e[w],++S[e[w]];d=Hi(e,c,l,y,S,b,C,R,I,w-I,d),l||(a.r=7&d|c[d/8|0]<<3,d-=7,a.h=_,a.p=m,a.i=w,a.w=A)}else{for(w=a.w||0;w<o+l;w+=65535){var Y=w+65535;Y>=o&&(c[d/8|0]=l,Y=o),d=Wi(c,d+1,e.subarray(w,Y))}a.i=o}return Di(s,0,r+Li(d)+i)},Yi=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,a=0|n.length,o=0;o!=a;){for(var s=Math.min(o+2655,a);o<s;++o)i+=r+=n[o];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return(255&(e%=65521))<<24|(65280&e)<<8|(255&(t%=65521))<<8|t>>8}}},Ji=function(e,t,n,r,i){if(!i&&(i={l:1},t.dictionary)){var a=t.dictionary.subarray(-32768),o=new oi(a.length+e.length);o.set(a),o.set(e,a.length),e=o,i.w=a.length}return Ki(e,null==t.level?6:t.level,null==t.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):20:12+t.mem,n,r,i)},Xi=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Qi=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;if(e[0]=120,e[1]=r<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var i=Yi();i.p(t.dictionary),Xi(e,2,i.d())}},Zi=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&xi(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&xi(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function $i(e,t){t||(t={});var n=Yi();n.p(e);var r=Ji(e,t,t.dictionary?6:2,4);return Qi(r,t),Xi(r,r.length-4,n.d()),r}function ea(e,t){return Mi(e.subarray(Zi(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}var ta="undefined"!=typeof TextDecoder&&new TextDecoder;try{ta.decode(zi,{stream:!0})}catch(g0){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;var na=function(){return"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:this}();function ra(){na.console&&"function"==typeof na.console.log&&na.console.log.apply(na.console,arguments)}var ia={log:ra,warn:function(e){na.console&&("function"==typeof na.console.warn?na.console.warn.apply(na.console,arguments):ra.call(null,arguments))},error:function(e){na.console&&("function"==typeof na.console.error?na.console.error.apply(na.console,arguments):ra(e))}};function aa(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){da(r.response,t,n)},r.onerror=function(){ia.error("could not download file")},r.send()}function oa(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return t.status>=200&&t.status<=299}function sa(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var ca,la,da=na.saveAs||("object"!==("undefined"==typeof window?"undefined":(0,ai.A)(window))||window!==na?function(){}:"undefined"!=typeof HTMLAnchorElement&&"download"in HTMLAnchorElement.prototype?function(e,t,n){var r=na.URL||na.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener","string"==typeof e?(i.href=e,i.origin!==location.origin?oa(i.href)?aa(e,t,n):sa(i,i.target="_blank"):sa(i)):(i.href=r.createObjectURL(e),setTimeout((function(){r.revokeObjectURL(i.href)}),4e4),setTimeout((function(){sa(i)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,t,n){if(t=t||e.name||"download","string"==typeof e)if(oa(e))aa(e,t,n);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout((function(){sa(r)}))}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!==(0,ai.A)(t)&&(ia.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,n),t)}:function(e,t,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return aa(e,t,n);var i="application/octet-stream"===e.type,a=/constructor/i.test(na.HTMLElement)||na.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent);if((o||i&&a)&&"object"===("undefined"==typeof FileReader?"undefined":(0,ai.A)(FileReader))){var s=new FileReader;s.onloadend=function(){var e=s.result;e=o?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},s.readAsDataURL(e)}else{var c=na.URL||na.webkitURL,l=c.createObjectURL(e);r?r.location=l:location.href=l,r=null,setTimeout((function(){c.revokeObjectURL(l)}),4e4)}});function ua(e){var t;e=e||"",this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[e=(e=e.replace(/ /g,"")).toLowerCase()]||e;for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],r=0;r<n.length;r++){var i=n[r].re,a=n[r].process,o=i.exec(e);o&&(t=a(o),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n}}function ha(e,t){var n=e[0],r=e[1],i=e[2],a=e[3];n=fa(n,r,i,a,t[0],7,-680876936),a=fa(a,n,r,i,t[1],12,-389564586),i=fa(i,a,n,r,t[2],17,606105819),r=fa(r,i,a,n,t[3],22,-1044525330),n=fa(n,r,i,a,t[4],7,-176418897),a=fa(a,n,r,i,t[5],12,1200080426),i=fa(i,a,n,r,t[6],17,-1473231341),r=fa(r,i,a,n,t[7],22,-45705983),n=fa(n,r,i,a,t[8],7,1770035416),a=fa(a,n,r,i,t[9],12,-1958414417),i=fa(i,a,n,r,t[10],17,-42063),r=fa(r,i,a,n,t[11],22,-1990404162),n=fa(n,r,i,a,t[12],7,1804603682),a=fa(a,n,r,i,t[13],12,-40341101),i=fa(i,a,n,r,t[14],17,-1502002290),n=ma(n,r=fa(r,i,a,n,t[15],22,1236535329),i,a,t[1],5,-165796510),a=ma(a,n,r,i,t[6],9,-1069501632),i=ma(i,a,n,r,t[11],14,643717713),r=ma(r,i,a,n,t[0],20,-373897302),n=ma(n,r,i,a,t[5],5,-701558691),a=ma(a,n,r,i,t[10],9,38016083),i=ma(i,a,n,r,t[15],14,-660478335),r=ma(r,i,a,n,t[4],20,-405537848),n=ma(n,r,i,a,t[9],5,568446438),a=ma(a,n,r,i,t[14],9,-1019803690),i=ma(i,a,n,r,t[3],14,-187363961),r=ma(r,i,a,n,t[8],20,1163531501),n=ma(n,r,i,a,t[13],5,-1444681467),a=ma(a,n,r,i,t[2],9,-51403784),i=ma(i,a,n,r,t[7],14,1735328473),n=_a(n,r=ma(r,i,a,n,t[12],20,-1926607734),i,a,t[5],4,-378558),a=_a(a,n,r,i,t[8],11,-2022574463),i=_a(i,a,n,r,t[11],16,1839030562),r=_a(r,i,a,n,t[14],23,-35309556),n=_a(n,r,i,a,t[1],4,-1530992060),a=_a(a,n,r,i,t[4],11,1272893353),i=_a(i,a,n,r,t[7],16,-155497632),r=_a(r,i,a,n,t[10],23,-1094730640),n=_a(n,r,i,a,t[13],4,681279174),a=_a(a,n,r,i,t[0],11,-358537222),i=_a(i,a,n,r,t[3],16,-722521979),r=_a(r,i,a,n,t[6],23,76029189),n=_a(n,r,i,a,t[9],4,-640364487),a=_a(a,n,r,i,t[12],11,-421815835),i=_a(i,a,n,r,t[15],16,530742520),n=ga(n,r=_a(r,i,a,n,t[2],23,-995338651),i,a,t[0],6,-198630844),a=ga(a,n,r,i,t[7],10,1126891415),i=ga(i,a,n,r,t[14],15,-1416354905),r=ga(r,i,a,n,t[5],21,-57434055),n=ga(n,r,i,a,t[12],6,1700485571),a=ga(a,n,r,i,t[3],10,-1894986606),i=ga(i,a,n,r,t[10],15,-1051523),r=ga(r,i,a,n,t[1],21,-2054922799),n=ga(n,r,i,a,t[8],6,1873313359),a=ga(a,n,r,i,t[15],10,-30611744),i=ga(i,a,n,r,t[6],15,-1560198380),r=ga(r,i,a,n,t[13],21,1309151649),n=ga(n,r,i,a,t[4],6,-145523070),a=ga(a,n,r,i,t[11],10,-1120210379),i=ga(i,a,n,r,t[2],15,718787259),r=ga(r,i,a,n,t[9],21,-343485551),e[0]=wa(n,e[0]),e[1]=wa(r,e[1]),e[2]=wa(i,e[2]),e[3]=wa(a,e[3])}function pa(e,t,n,r,i,a){return t=wa(wa(t,e),wa(r,a)),wa(t<<i|t>>>32-i,n)}function fa(e,t,n,r,i,a,o){return pa(t&n|~t&r,e,t,i,a,o)}function ma(e,t,n,r,i,a,o){return pa(t&r|n&~r,e,t,i,a,o)}function _a(e,t,n,r,i,a,o){return pa(t^n^r,e,t,i,a,o)}function ga(e,t,n,r,i,a,o){return pa(n^(t|~r),e,t,i,a,o)}function Ea(e){var t,n=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)ha(r,va(e.substring(t-64,t)));e=e.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(ha(r,i),t=0;t<16;t++)i[t]=0;return i[14]=8*n,ha(r,i),r}function va(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}ca=na.atob.bind(na),la=na.btoa.bind(na);var ya="0123456789abcdef".split("");function Sa(e){for(var t="",n=0;n<4;n++)t+=ya[e>>8*n+4&15]+ya[e>>8*n&15];return t}function ba(e){return String.fromCharCode(255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24)}function Ta(e){return Ea(e).map(ba).join("")}var Ca="5d41402abc4b2a76b9719d911017c592"!=function(e){for(var t=0;t<e.length;t++)e[t]=Sa(e[t]);return e.join("")}(Ea("hello"));function wa(e,t){if(Ca){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}return e+t&4294967295}function Ra(e,t){var n,r,i,a;if(e!==n){for(var o=(i=e,a=1+(256/e.length|0),new Array(a+1).join(i)),s=[],c=0;c<256;c++)s[c]=c;var l=0;for(c=0;c<256;c++){var d=s[c];l=(l+d+o.charCodeAt(c))%256,s[c]=s[l],s[l]=d}n=e,r=s}else s=r;var u=t.length,h=0,p=0,f="";for(c=0;c<u;c++)p=(p+(d=s[h=(h+1)%256]))%256,s[h]=s[p],s[p]=d,o=s[(s[h]+s[p])%256],f+=String.fromCharCode(t.charCodeAt(c)^o);return f}var Aa={print:4,modify:8,copy:16,"annot-forms":32};function Ia(e,t,n,r){this.v=1,this.r=2;var i=192;e.forEach((function(e){if(void 0!==Aa.perm)throw new Error("Invalid permission: "+e);i+=Aa[e]})),this.padding="(\xbfN^Nu\x8aAd\0NV\xff\xfa\x01\b..\0\xb6\xd0h>\x80/\f\xa9\xfedSiz";var a=(t+this.padding).substr(0,32),o=(n+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,o),this.P=-(1+(255^i)),this.encryptionKey=Ta(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=Ra(this.encryptionKey,this.padding)}function Na(e){if(/[^\u0000-\u00ff]/.test(e))throw new Error("Invalid PDF Name Object: "+e+", Only accept ASCII characters.");for(var t="",n=e.length,r=0;r<n;r++){var i=e.charCodeAt(r);t+=i<33||35===i||37===i||40===i||41===i||47===i||60===i||62===i||91===i||93===i||123===i||125===i||i>126?"#"+("0"+i.toString(16)).slice(-2):e[r]}return t}function Oa(e){if("object"!==(0,ai.A)(e))throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,n,r){if(r=r||!1,"string"!=typeof e||"function"!=typeof n||"boolean"!=typeof r)throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var i=Math.random().toString(35);return t[e][i]=[n,!!r],i},this.unsubscribe=function(e){for(var n in t)if(t[n][e])return delete t[n][e],0===Object.keys(t[n]).length&&delete t[n],!0;return!1},this.publish=function(n){if(t.hasOwnProperty(n)){var r=Array.prototype.slice.call(arguments,1),i=[];for(var a in t[n]){var o=t[n][a];try{o[0].apply(e,r)}catch(n){na.console&&ia.error("jsPDF PubSub Error",n.message,n)}o[1]&&i.push(a)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function Pa(e){if(!(this instanceof Pa))return new Pa(e);var t="opacity,stroke-opacity".split(",");for(var n in e)e.hasOwnProperty(n)&&t.indexOf(n)>=0&&(this[n]=e[n]);this.id="",this.objectNumber=-1}function La(e,t){this.gState=e,this.matrix=t,this.id="",this.objectNumber=-1}function Da(e,t,n,r,i){if(!(this instanceof Da))return new Da(e,t,n,r,i);this.type="axial"===e?2:3,this.coords=t,this.colors=n,La.call(this,r,i)}function ka(e,t,n,r,i){if(!(this instanceof ka))return new ka(e,t,n,r,i);this.boundingBox=e,this.xStep=t,this.yStep=n,this.stream="",this.cloneIndex=0,La.call(this,r,i)}function xa(e){var t,n="string"==typeof arguments[0]?arguments[0]:"p",r=arguments[1],i=arguments[2],a=arguments[3],o=[],s=1,c=16,l="S",d=null;"object"===(0,ai.A)(e=e||{})&&(n=e.orientation,r=e.unit||r,i=e.format||i,a=e.compress||e.compressPdf||a,null!==(d=e.encryption||null)&&(d.userPassword=d.userPassword||"",d.ownerPassword=d.ownerPassword||"",d.userPermissions=d.userPermissions||[]),s="number"==typeof e.userUnit?Math.abs(e.userUnit):1,void 0!==e.precision&&(t=e.precision),void 0!==e.floatPrecision&&(c=e.floatPrecision),l=e.defaultPathOperation||"S"),o=e.filters||(!0===a?["FlateEncode"]:o),r=r||"mm",n=(""+(n||"P")).toLowerCase();var u=e.putOnlyUsedFonts||!1,h={},p={internal:{},__private__:{}};p.__private__.PubSub=Oa;var f="1.3",m=p.__private__.getPdfVersion=function(){return f};p.__private__.setPdfVersion=function(e){f=e};var _={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};p.__private__.getPageFormats=function(){return _};var g=p.__private__.getPageFormat=function(e){return _[e]};i=i||"a4";var E="compat",v="advanced",y=E;function S(){this.saveGraphicsState(),Q(new Pe(he,0,0,-he,0,dn()*he).toString()+" cm"),this.setFontSize(this.getFontSize()/he),l="n",y=v}function b(){this.restoreGraphicsState(),l="S",y=E}var T=p.__private__.combineFontStyleAndFontWeight=function(e,t){if("bold"==e&&"normal"==t||"bold"==e&&400==t||"normal"==e&&"italic"==t||"bold"==e&&"italic"==t)throw new Error("Invalid Combination of fontweight and fontstyle");return t&&(e=400==t||"normal"===t?"italic"===e?"italic":"normal":700!=t&&"bold"!==t||"normal"!==e?(700==t?"bold":t)+""+e:"bold"),e};p.advancedAPI=function(e){var t=y===E;return t&&S.call(this),"function"!=typeof e||(e(this),t&&b.call(this)),this},p.compatAPI=function(e){var t=y===v;return t&&b.call(this),"function"!=typeof e||(e(this),t&&S.call(this)),this},p.isAdvancedAPI=function(){return y===v};var C,w=function(e){if(y!==v)throw new Error(e+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},R=p.roundToPrecision=p.__private__.roundToPrecision=function(e,n){var r=t||n;if(isNaN(e)||isNaN(r))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return e.toFixed(r).replace(/0+$/,"")};C=p.hpf=p.__private__.hpf="number"==typeof c?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return R(e,c)}:"smart"===c?function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return R(e,e>-1&&e<1?16:5)}:function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.hpf");return R(e,16)};var A=p.f2=p.__private__.f2=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f2");return R(e,2)},I=p.__private__.f3=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.f3");return R(e,3)},N=p.scale=p.__private__.scale=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.scale");return y===E?e*he:y===v?e:void 0},O=function(e){return N(function(e){return y===E?dn()-e:y===v?e:void 0}(e))};p.__private__.setPrecision=p.setPrecision=function(e){"number"==typeof parseInt(e,10)&&(t=parseInt(e,10))};var P,L="00000000000000000000000000000000",D=p.__private__.getFileId=function(){return L},k=p.__private__.setFileId=function(e){return L=void 0!==e&&/^[a-fA-F0-9]{32}$/.test(e)?e.toUpperCase():L.split("").map((function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))})).join(""),null!==d&&(vt=new Ia(d.userPermissions,d.userPassword,d.ownerPassword,L)),L};p.setFileId=function(e){return k(e),this},p.getFileId=function(){return D()};var x=p.__private__.convertDateToPDFDate=function(e){var t=e.getTimezoneOffset(),n=t<0?"+":"-",r=Math.floor(Math.abs(t/60)),i=Math.abs(t%60),a=[n,V(r),"'",V(i),"'"].join("");return["D:",e.getFullYear(),V(e.getMonth()+1),V(e.getDate()),V(e.getHours()),V(e.getMinutes()),V(e.getSeconds()),a].join("")},M=p.__private__.convertPDFDateToDate=function(e){var t=parseInt(e.substr(2,4),10),n=parseInt(e.substr(6,2),10)-1,r=parseInt(e.substr(8,2),10),i=parseInt(e.substr(10,2),10),a=parseInt(e.substr(12,2),10),o=parseInt(e.substr(14,2),10);return new Date(t,n,r,i,a,o,0)},U=p.__private__.setCreationDate=function(e){var t;if(void 0===e&&(e=new Date),e instanceof Date)t=x(e);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(e))throw new Error("Invalid argument passed to jsPDF.setCreationDate");t=e}return P=t},F=p.__private__.getCreationDate=function(e){var t=P;return"jsDate"===e&&(t=M(P)),t};p.setCreationDate=function(e){return U(e),this},p.getCreationDate=function(e){return F(e)};var j,V=p.__private__.padd2=function(e){return("0"+parseInt(e)).slice(-2)},B=p.__private__.padd2Hex=function(e){return("00"+(e=e.toString())).substr(e.length)},G=0,W=[],H=[],q=0,z=[],K=[],Y=!1,J=H;p.__private__.setCustomOutputDestination=function(e){Y=!0,J=e};var X=function(e){Y||(J=e)};p.__private__.resetCustomOutputDestination=function(){Y=!1,J=H};var Q=p.__private__.out=function(e){return e=e.toString(),q+=e.length+1,J.push(e),J},Z=p.__private__.write=function(e){return Q(1===arguments.length?e.toString():Array.prototype.join.call(arguments," "))},$=p.__private__.getArrayBuffer=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n);t--;)r[t]=e.charCodeAt(t);return n},ee=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];p.__private__.getStandardFonts=function(){return ee};var te=e.fontSize||16;p.__private__.setFontSize=p.setFontSize=function(e){return te=y===v?e/he:e,this};var ne,re=p.__private__.getFontSize=p.getFontSize=function(){return y===E?te:te*he},ie=e.R2L||!1;p.__private__.setR2L=p.setR2L=function(e){return ie=e,this},p.__private__.getR2L=p.getR2L=function(){return ie};var ae,oe=p.__private__.setZoomMode=function(e){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(e))ne=e;else if(isNaN(e)){if(-1===[void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(e))throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+e+'" is not recognized.');ne=e}else ne=parseInt(e,10)};p.__private__.getZoomMode=function(){return ne};var se,ce=p.__private__.setPageMode=function(e){if(-1==[void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(e))throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+e+'" is not recognized.');ae=e};p.__private__.getPageMode=function(){return ae};var le=p.__private__.setLayoutMode=function(e){if(-1==[void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(e))throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+e+'" is not recognized.');se=e};p.__private__.getLayoutMode=function(){return se},p.__private__.setDisplayMode=p.setDisplayMode=function(e,t,n){return oe(e),le(t),ce(n),this};var de={title:"",subject:"",author:"",keywords:"",creator:""};p.__private__.getDocumentProperty=function(e){if(-1===Object.keys(de).indexOf(e))throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return de[e]},p.__private__.getDocumentProperties=function(){return de},p.__private__.setDocumentProperties=p.setProperties=p.setDocumentProperties=function(e){for(var t in de)de.hasOwnProperty(t)&&e[t]&&(de[t]=e[t]);return this},p.__private__.setDocumentProperty=function(e,t){if(-1===Object.keys(de).indexOf(e))throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return de[e]=t};var ue,he,pe,fe,me,_e={},ge={},Ee=[],ve={},ye={},Se={},be={},Te=null,Ce=0,we=[],Re=new Oa(p),Ae=e.hotfixes||[],Ie={},Ne={},Oe=[],Pe=function e(t,n,r,i,a,o){if(!(this instanceof e))return new e(t,n,r,i,a,o);isNaN(t)&&(t=1),isNaN(n)&&(n=0),isNaN(r)&&(r=0),isNaN(i)&&(i=1),isNaN(a)&&(a=0),isNaN(o)&&(o=0),this._matrix=[t,n,r,i,a,o]};Object.defineProperty(Pe.prototype,"sx",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Pe.prototype,"shy",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Pe.prototype,"shx",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Pe.prototype,"sy",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Pe.prototype,"tx",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Pe.prototype,"ty",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Pe.prototype,"a",{get:function(){return this._matrix[0]},set:function(e){this._matrix[0]=e}}),Object.defineProperty(Pe.prototype,"b",{get:function(){return this._matrix[1]},set:function(e){this._matrix[1]=e}}),Object.defineProperty(Pe.prototype,"c",{get:function(){return this._matrix[2]},set:function(e){this._matrix[2]=e}}),Object.defineProperty(Pe.prototype,"d",{get:function(){return this._matrix[3]},set:function(e){this._matrix[3]=e}}),Object.defineProperty(Pe.prototype,"e",{get:function(){return this._matrix[4]},set:function(e){this._matrix[4]=e}}),Object.defineProperty(Pe.prototype,"f",{get:function(){return this._matrix[5]},set:function(e){this._matrix[5]=e}}),Object.defineProperty(Pe.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Pe.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Pe.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Pe.prototype,"isIdentity",{get:function(){return 1===this.sx&&0===this.shy&&0===this.shx&&1===this.sy&&0===this.tx&&0===this.ty}}),Pe.prototype.join=function(e){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(C).join(e)},Pe.prototype.multiply=function(e){var t=e.sx*this.sx+e.shy*this.shx,n=e.sx*this.shy+e.shy*this.sy,r=e.shx*this.sx+e.sy*this.shx,i=e.shx*this.shy+e.sy*this.sy,a=e.tx*this.sx+e.ty*this.shx+this.tx,o=e.tx*this.shy+e.ty*this.sy+this.ty;return new Pe(t,n,r,i,a,o)},Pe.prototype.decompose=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty,o=Math.sqrt(e*e+t*t),s=(e/=o)*n+(t/=o)*r;n-=e*s,r-=t*s;var c=Math.sqrt(n*n+r*r);return s/=c,e*(r/=c)<t*(n/=c)&&(e=-e,t=-t,s=-s,o=-o),{scale:new Pe(o,0,0,c,0,0),translate:new Pe(1,0,0,1,i,a),rotate:new Pe(e,t,-t,e,0,0),skew:new Pe(1,0,s,1,0,0)}},Pe.prototype.toString=function(e){return this.join(" ")},Pe.prototype.inversed=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty,o=1/(e*r-t*n),s=r*o,c=-t*o,l=-n*o,d=e*o;return new Pe(s,c,l,d,-s*i-l*a,-c*i-d*a)},Pe.prototype.applyToPoint=function(e){var t=e.x*this.sx+e.y*this.shx+this.tx,n=e.x*this.shy+e.y*this.sy+this.ty;return new nn(t,n)},Pe.prototype.applyToRectangle=function(e){var t=this.applyToPoint(e),n=this.applyToPoint(new nn(e.x+e.w,e.y+e.h));return new rn(t.x,t.y,n.x-t.x,n.y-t.y)},Pe.prototype.clone=function(){var e=this.sx,t=this.shy,n=this.shx,r=this.sy,i=this.tx,a=this.ty;return new Pe(e,t,n,r,i,a)},p.Matrix=Pe;var Le=p.matrixMult=function(e,t){return t.multiply(e)},De=new Pe(1,0,0,1,0,0);p.unitMatrix=p.identityMatrix=De;var ke=function(e,t){if(!ye[e]){var n=(t instanceof Da?"Sh":"P")+(Object.keys(ve).length+1).toString(10);t.id=n,ye[e]=n,ve[n]=t,Re.publish("addPattern",t)}};p.ShadingPattern=Da,p.TilingPattern=ka,p.addShadingPattern=function(e,t){return w("addShadingPattern()"),ke(e,t),this},p.beginTilingPattern=function(e){w("beginTilingPattern()"),on(e.boundingBox[0],e.boundingBox[1],e.boundingBox[2]-e.boundingBox[0],e.boundingBox[3]-e.boundingBox[1],e.matrix)},p.endTilingPattern=function(e,t){w("endTilingPattern()"),t.stream=K[j].join("\n"),ke(e,t),Re.publish("endTilingPattern",t),Oe.pop().restore()};var xe,Me=p.__private__.newObject=function(){var e=Ue();return Fe(e,!0),e},Ue=p.__private__.newObjectDeferred=function(){return G++,W[G]=function(){return q},G},Fe=function(e,t){return t="boolean"==typeof t&&t,W[e]=q,t&&Q(e+" 0 obj"),e},je=p.__private__.newAdditionalObject=function(){var e={objId:Ue(),content:""};return z.push(e),e},Ve=Ue(),Be=Ue(),Ge=p.__private__.decodeColorString=function(e){var t=e.split(" ");if(2!==t.length||"g"!==t[1]&&"G"!==t[1])5!==t.length||"k"!==t[4]&&"K"!==t[4]||(t=[(1-t[0])*(1-t[3]),(1-t[1])*(1-t[3]),(1-t[2])*(1-t[3]),"r"]);else{var n=parseFloat(t[0]);t=[n,n,n,"r"]}for(var r="#",i=0;i<3;i++)r+=("0"+Math.floor(255*parseFloat(t[i])).toString(16)).slice(-2);return r},We=p.__private__.encodeColorString=function(e){var t;"string"==typeof e&&(e={ch1:e});var n=e.ch1,r=e.ch2,i=e.ch3,a=e.ch4,o="draw"===e.pdfColorType?["G","RG","K"]:["g","rg","k"];if("string"==typeof n&&"#"!==n.charAt(0)){var s=new ua(n);if(s.ok)n=s.toHex();else if(!/^\d*\.?\d*$/.test(n))throw new Error('Invalid color "'+n+'" passed to jsPDF.encodeColorString.')}if("string"==typeof n&&/^#[0-9A-Fa-f]{3}$/.test(n)&&(n="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]),"string"==typeof n&&/^#[0-9A-Fa-f]{6}$/.test(n)){var c=parseInt(n.substr(1),16);n=c>>16&255,r=c>>8&255,i=255&c}if(void 0===r||void 0===a&&n===r&&r===i)if("string"==typeof n)t=n+" "+o[0];else if(2===e.precision)t=A(n/255)+" "+o[0];else t=I(n/255)+" "+o[0];else if(void 0===a||"object"===(0,ai.A)(a)){if(a&&!isNaN(a.a)&&0===a.a)return["1.","1.","1.",o[1]].join(" ");if("string"==typeof n)t=[n,r,i,o[1]].join(" ");else if(2===e.precision)t=[A(n/255),A(r/255),A(i/255),o[1]].join(" ");else t=[I(n/255),I(r/255),I(i/255),o[1]].join(" ")}else if("string"==typeof n)t=[n,r,i,a,o[2]].join(" ");else if(2===e.precision)t=[A(n),A(r),A(i),A(a),o[2]].join(" ");else t=[I(n),I(r),I(i),I(a),o[2]].join(" ");return t},He=p.__private__.getFilters=function(){return o},qe=p.__private__.putStream=function(e){var t=(e=e||{}).data||"",n=e.filters||He(),r=e.alreadyAppliedFilters||[],i=e.addLength1||!1,a=t.length,o=e.objectId,s=function(e){return e};if(null!==d&&void 0===o)throw new Error("ObjectId must be passed to putStream for file encryption");null!==d&&(s=vt.encryptor(o,0));var c={};!0===n&&(n=["FlateEncode"]);var l=e.additionalKeyValues||[],u=(c=void 0!==xa.API.processDataByFilters?xa.API.processDataByFilters(t,n):{data:t,reverseChain:[]}).reverseChain+(Array.isArray(r)?r.join(" "):r.toString());if(0!==c.data.length&&(l.push({key:"Length",value:c.data.length}),!0===i&&l.push({key:"Length1",value:a})),0!=u.length)if(u.split("/").length-1==1)l.push({key:"Filter",value:u});else{l.push({key:"Filter",value:"["+u+"]"});for(var h=0;h<l.length;h+=1)if("DecodeParms"===l[h].key){for(var p=[],f=0;f<c.reverseChain.split("/").length-1;f+=1)p.push("null");p.push(l[h].value),l[h].value="["+p.join(" ")+"]"}}Q("<<");for(var m=0;m<l.length;m++)Q("/"+l[m].key+" "+l[m].value);Q(">>"),0!==c.data.length&&(Q("stream"),Q(s(c.data)),Q("endstream"))},ze=p.__private__.putPage=function(e){var t=e.number,n=e.data,r=e.objId,i=e.contentsObjId;Fe(r,!0),Q("<</Type /Page"),Q("/Parent "+e.rootDictionaryObjId+" 0 R"),Q("/Resources "+e.resourceDictionaryObjId+" 0 R"),Q("/MediaBox ["+parseFloat(C(e.mediaBox.bottomLeftX))+" "+parseFloat(C(e.mediaBox.bottomLeftY))+" "+C(e.mediaBox.topRightX)+" "+C(e.mediaBox.topRightY)+"]"),null!==e.cropBox&&Q("/CropBox ["+C(e.cropBox.bottomLeftX)+" "+C(e.cropBox.bottomLeftY)+" "+C(e.cropBox.topRightX)+" "+C(e.cropBox.topRightY)+"]"),null!==e.bleedBox&&Q("/BleedBox ["+C(e.bleedBox.bottomLeftX)+" "+C(e.bleedBox.bottomLeftY)+" "+C(e.bleedBox.topRightX)+" "+C(e.bleedBox.topRightY)+"]"),null!==e.trimBox&&Q("/TrimBox ["+C(e.trimBox.bottomLeftX)+" "+C(e.trimBox.bottomLeftY)+" "+C(e.trimBox.topRightX)+" "+C(e.trimBox.topRightY)+"]"),null!==e.artBox&&Q("/ArtBox ["+C(e.artBox.bottomLeftX)+" "+C(e.artBox.bottomLeftY)+" "+C(e.artBox.topRightX)+" "+C(e.artBox.topRightY)+"]"),"number"==typeof e.userUnit&&1!==e.userUnit&&Q("/UserUnit "+e.userUnit),Re.publish("putPage",{objId:r,pageContext:we[t],pageNumber:t,page:n}),Q("/Contents "+i+" 0 R"),Q(">>"),Q("endobj");var a=n.join("\n");return y===v&&(a+="\nQ"),Fe(i,!0),qe({data:a,filters:He(),objectId:i}),Q("endobj"),r},Ke=p.__private__.putPages=function(){var e,t,n=[];for(e=1;e<=Ce;e++)we[e].objId=Ue(),we[e].contentsObjId=Ue();for(e=1;e<=Ce;e++)n.push(ze({number:e,data:K[e],objId:we[e].objId,contentsObjId:we[e].contentsObjId,mediaBox:we[e].mediaBox,cropBox:we[e].cropBox,bleedBox:we[e].bleedBox,trimBox:we[e].trimBox,artBox:we[e].artBox,userUnit:we[e].userUnit,rootDictionaryObjId:Ve,resourceDictionaryObjId:Be}));Fe(Ve,!0),Q("<</Type /Pages");var r="/Kids [";for(t=0;t<Ce;t++)r+=n[t]+" 0 R ";Q(r+"]"),Q("/Count "+Ce),Q(">>"),Q("endobj"),Re.publish("postPutPages")},Ye=function(e){Re.publish("putFont",{font:e,out:Q,newObject:Me,putStream:qe}),!0!==e.isAlreadyPutted&&(e.objectNumber=Me(),Q("<<"),Q("/Type /Font"),Q("/BaseFont /"+Na(e.postScriptName)),Q("/Subtype /Type1"),"string"==typeof e.encoding&&Q("/Encoding /"+e.encoding),Q("/FirstChar 32"),Q("/LastChar 255"),Q(">>"),Q("endobj"))},Je=function(e){e.objectNumber=Me();var t=[];t.push({key:"Type",value:"/XObject"}),t.push({key:"Subtype",value:"/Form"}),t.push({key:"BBox",value:"["+[C(e.x),C(e.y),C(e.x+e.width),C(e.y+e.height)].join(" ")+"]"}),t.push({key:"Matrix",value:"["+e.matrix.toString()+"]"});var n=e.pages[1].join("\n");qe({data:n,additionalKeyValues:t,objectId:e.objectNumber}),Q("endobj")},Xe=function(e,t){t||(t=21);var n=Me(),r=function(e,t){var n,r=[],i=1/(t-1);for(n=0;n<1;n+=i)r.push(n);if(r.push(1),0!=e[0].offset){var a={offset:0,color:e[0].color};e.unshift(a)}if(1!=e[e.length-1].offset){var o={offset:1,color:e[e.length-1].color};e.push(o)}for(var s="",c=0,l=0;l<r.length;l++){for(n=r[l];n>e[c+1].offset;)c++;var d=e[c].offset,u=(n-d)/(e[c+1].offset-d),h=e[c].color,p=e[c+1].color;s+=B(Math.round((1-u)*h[0]+u*p[0]).toString(16))+B(Math.round((1-u)*h[1]+u*p[1]).toString(16))+B(Math.round((1-u)*h[2]+u*p[2]).toString(16))}return s.trim()}(e.colors,t),i=[];i.push({key:"FunctionType",value:"0"}),i.push({key:"Domain",value:"[0.0 1.0]"}),i.push({key:"Size",value:"["+t+"]"}),i.push({key:"BitsPerSample",value:"8"}),i.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),i.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),qe({data:r,additionalKeyValues:i,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:n}),Q("endobj"),e.objectNumber=Me(),Q("<< /ShadingType "+e.type),Q("/ColorSpace /DeviceRGB");var a="/Coords ["+C(parseFloat(e.coords[0]))+" "+C(parseFloat(e.coords[1]))+" ";2===e.type?a+=C(parseFloat(e.coords[2]))+" "+C(parseFloat(e.coords[3])):a+=C(parseFloat(e.coords[2]))+" "+C(parseFloat(e.coords[3]))+" "+C(parseFloat(e.coords[4]))+" "+C(parseFloat(e.coords[5])),Q(a+="]"),e.matrix&&Q("/Matrix ["+e.matrix.toString()+"]"),Q("/Function "+n+" 0 R"),Q("/Extend [true true]"),Q(">>"),Q("endobj")},Qe=function(e,t){var n=Ue(),r=Me();t.push({resourcesOid:n,objectOid:r}),e.objectNumber=r;var i=[];i.push({key:"Type",value:"/Pattern"}),i.push({key:"PatternType",value:"1"}),i.push({key:"PaintType",value:"1"}),i.push({key:"TilingType",value:"1"}),i.push({key:"BBox",value:"["+e.boundingBox.map(C).join(" ")+"]"}),i.push({key:"XStep",value:C(e.xStep)}),i.push({key:"YStep",value:C(e.yStep)}),i.push({key:"Resources",value:n+" 0 R"}),e.matrix&&i.push({key:"Matrix",value:"["+e.matrix.toString()+"]"}),qe({data:e.stream,additionalKeyValues:i,objectId:e.objectNumber}),Q("endobj")},Ze=function(e){for(var t in e.objectNumber=Me(),Q("<<"),e)switch(t){case"opacity":Q("/ca "+A(e[t]));break;case"stroke-opacity":Q("/CA "+A(e[t]))}Q(">>"),Q("endobj")},$e=function(e){Fe(e.resourcesOid,!0),Q("<<"),Q("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var e in Q("/Font <<"),_e)_e.hasOwnProperty(e)&&(!1===u||!0===u&&h.hasOwnProperty(e))&&Q("/"+e+" "+_e[e].objectNumber+" 0 R");Q(">>")}(),function(){if(Object.keys(ve).length>0){for(var e in Q("/Shading <<"),ve)ve.hasOwnProperty(e)&&ve[e]instanceof Da&&ve[e].objectNumber>=0&&Q("/"+e+" "+ve[e].objectNumber+" 0 R");Re.publish("putShadingPatternDict"),Q(">>")}}(),function(e){if(Object.keys(ve).length>0){for(var t in Q("/Pattern <<"),ve)ve.hasOwnProperty(t)&&ve[t]instanceof p.TilingPattern&&ve[t].objectNumber>=0&&ve[t].objectNumber<e&&Q("/"+t+" "+ve[t].objectNumber+" 0 R");Re.publish("putTilingPatternDict"),Q(">>")}}(e.objectOid),function(){if(Object.keys(Se).length>0){var e;for(e in Q("/ExtGState <<"),Se)Se.hasOwnProperty(e)&&Se[e].objectNumber>=0&&Q("/"+e+" "+Se[e].objectNumber+" 0 R");Re.publish("putGStateDict"),Q(">>")}}(),function(){for(var e in Q("/XObject <<"),Ie)Ie.hasOwnProperty(e)&&Ie[e].objectNumber>=0&&Q("/"+e+" "+Ie[e].objectNumber+" 0 R");Re.publish("putXobjectDict"),Q(">>")}(),Q(">>"),Q("endobj")},et=function(){var e=[];(function(){for(var e in _e)_e.hasOwnProperty(e)&&(!1===u||!0===u&&h.hasOwnProperty(e))&&Ye(_e[e])})(),function(){var e;for(e in Se)Se.hasOwnProperty(e)&&Ze(Se[e])}(),function(){for(var e in Ie)Ie.hasOwnProperty(e)&&Je(Ie[e])}(),function(e){var t;for(t in ve)ve.hasOwnProperty(t)&&(ve[t]instanceof Da?Xe(ve[t]):ve[t]instanceof ka&&Qe(ve[t],e))}(e),Re.publish("putResources"),e.forEach($e),$e({resourcesOid:Be,objectOid:Number.MAX_SAFE_INTEGER}),Re.publish("postPutResources")},tt=function(e){ge[e.fontName]=ge[e.fontName]||{},ge[e.fontName][e.fontStyle]=e.id},nt=function(e,t,n,r,i){var a={id:"F"+(Object.keys(_e).length+1).toString(10),postScriptName:e,fontName:t,fontStyle:n,encoding:r,isStandardFont:i||!1,metadata:{}};return Re.publish("addFont",{font:a,instance:this}),_e[a.id]=a,tt(a),a.id},rt=p.__private__.pdfEscape=p.pdfEscape=function(e,t){return function(e,t){var n,r,i,a,o,s,c,l,d;if(i=(t=t||{}).sourceEncoding||"Unicode",o=t.outputEncoding,(t.autoencode||o)&&_e[ue].metadata&&_e[ue].metadata[i]&&_e[ue].metadata[i].encoding&&(a=_e[ue].metadata[i].encoding,!o&&_e[ue].encoding&&(o=_e[ue].encoding),!o&&a.codePages&&(o=a.codePages[0]),"string"==typeof o&&(o=a[o]),o)){for(c=!1,s=[],n=0,r=e.length;n<r;n++)(l=o[e.charCodeAt(n)])?s.push(String.fromCharCode(l)):s.push(e[n]),s[n].charCodeAt(0)>>8&&(c=!0);e=s.join("")}for(n=e.length;void 0===c&&0!==n;)e.charCodeAt(n-1)>>8&&(c=!0),n--;if(!c)return e;for(s=t.noBOM?[]:[254,255],n=0,r=e.length;n<r;n++){if((d=(l=e.charCodeAt(n))>>8)>>8)throw new Error("Character at position "+n+" of string '"+e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");s.push(d),s.push(l-(d<<8))}return String.fromCharCode.apply(void 0,s)}(e,t).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},it=p.__private__.beginPage=function(e){K[++Ce]=[],we[Ce]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(e[0]),topRightY:Number(e[1])}},st(Ce),X(K[j])},at=function(e,t){var r,a,o;switch(n=t||n,"string"==typeof e&&(r=g(e.toLowerCase()),Array.isArray(r)&&(a=r[0],o=r[1])),Array.isArray(e)&&(a=e[0]*he,o=e[1]*he),isNaN(a)&&(a=i[0],o=i[1]),(a>14400||o>14400)&&(ia.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),a=Math.min(14400,a),o=Math.min(14400,o)),i=[a,o],n.substr(0,1)){case"l":o>a&&(i=[o,a]);break;case"p":a>o&&(i=[o,a])}it(i),jt(Ut),Q(Kt),0!==$t&&Q($t+" J"),0!==en&&Q(en+" j"),Re.publish("addPage",{pageNumber:Ce})},ot=function(e){e>0&&e<=Ce&&(K.splice(e,1),we.splice(e,1),Ce--,j>Ce&&(j=Ce),this.setPage(j))},st=function(e){e>0&&e<=Ce&&(j=e)},ct=p.__private__.getNumberOfPages=p.getNumberOfPages=function(){return K.length-1},lt=function(e,t,n){var r,i=void 0;return n=n||{},e=void 0!==e?e:_e[ue].fontName,t=void 0!==t?t:_e[ue].fontStyle,r=e.toLowerCase(),void 0!==ge[r]&&void 0!==ge[r][t]?i=ge[r][t]:void 0!==ge[e]&&void 0!==ge[e][t]?i=ge[e][t]:!1===n.disableWarning&&ia.warn("Unable to look up font label for font '"+e+"', '"+t+"'. Refer to getFontList() for available fonts."),i||n.noFallback||null==(i=ge.times[t])&&(i=ge.times.normal),i},dt=p.__private__.putInfo=function(){var e=Me(),t=function(e){return e};for(var n in null!==d&&(t=vt.encryptor(e,0)),Q("<<"),Q("/Producer ("+rt(t("jsPDF "+xa.version))+")"),de)de.hasOwnProperty(n)&&de[n]&&Q("/"+n.substr(0,1).toUpperCase()+n.substr(1)+" ("+rt(t(de[n]))+")");Q("/CreationDate ("+rt(t(P))+")"),Q(">>"),Q("endobj")},ut=p.__private__.putCatalog=function(e){var t=(e=e||{}).rootDictionaryObjId||Ve;switch(Me(),Q("<<"),Q("/Type /Catalog"),Q("/Pages "+t+" 0 R"),ne||(ne="fullwidth"),ne){case"fullwidth":Q("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Q("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Q("/OpenAction [3 0 R /Fit]");break;case"original":Q("/OpenAction [3 0 R /XYZ null null 1]");break;default:var n=""+ne;"%"===n.substr(n.length-1)&&(ne=parseInt(ne)/100),"number"==typeof ne&&Q("/OpenAction [3 0 R /XYZ null null "+A(ne)+"]")}switch(se||(se="continuous"),se){case"continuous":Q("/PageLayout /OneColumn");break;case"single":Q("/PageLayout /SinglePage");break;case"two":case"twoleft":Q("/PageLayout /TwoColumnLeft");break;case"tworight":Q("/PageLayout /TwoColumnRight")}ae&&Q("/PageMode /"+ae),Re.publish("putCatalog"),Q(">>"),Q("endobj")},ht=p.__private__.putTrailer=function(){Q("trailer"),Q("<<"),Q("/Size "+(G+1)),Q("/Root "+G+" 0 R"),Q("/Info "+(G-1)+" 0 R"),null!==d&&Q("/Encrypt "+vt.oid+" 0 R"),Q("/ID [ <"+L+"> <"+L+"> ]"),Q(">>")},pt=p.__private__.putHeader=function(){Q("%PDF-"+f),Q("%\xba\xdf\xac\xe0")},ft=p.__private__.putXRef=function(){var e="0000000000";Q("xref"),Q("0 "+(G+1)),Q("0000000000 65535 f ");for(var t=1;t<=G;t++)"function"==typeof W[t]?Q((e+W[t]()).slice(-10)+" 00000 n "):void 0!==W[t]?Q((e+W[t]).slice(-10)+" 00000 n "):Q("0000000000 00000 n ")},mt=p.__private__.buildDocument=function(){G=0,q=0,H=[],W=[],z=[],Ve=Ue(),Be=Ue(),X(H),Re.publish("buildDocument"),pt(),Ke(),function(){Re.publish("putAdditionalObjects");for(var e=0;e<z.length;e++){var t=z[e];Fe(t.objId,!0),Q(t.content),Q("endobj")}Re.publish("postPutAdditionalObjects")}(),et(),null!==d&&(vt.oid=Me(),Q("<<"),Q("/Filter /Standard"),Q("/V "+vt.v),Q("/R "+vt.r),Q("/U <"+vt.toHexString(vt.U)+">"),Q("/O <"+vt.toHexString(vt.O)+">"),Q("/P "+vt.P),Q(">>"),Q("endobj")),dt(),ut();var e=q;return ft(),ht(),Q("startxref"),Q(""+e),Q("%%EOF"),X(K[j]),H.join("\n")},_t=p.__private__.getBlob=function(e){return new Blob([$(e)],{type:"application/pdf"})},gt=p.output=p.__private__.output=(xe=function(e,t){switch("string"==typeof(t=t||{})?t={filename:t}:t.filename=t.filename||"generated.pdf",e){case void 0:return mt();case"save":p.save(t.filename);break;case"arraybuffer":return $(mt());case"blob":return _t(mt());case"bloburi":case"bloburl":if(void 0!==na.URL&&"function"==typeof na.URL.createObjectURL)return na.URL&&na.URL.createObjectURL(_t(mt()))||void 0;ia.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var n="",r=mt();try{n=la(r)}catch(e){n=la(unescape(encodeURIComponent(r)))}return"data:application/pdf;filename="+t.filename+";base64,"+n;case"pdfobjectnewwindow":if("[object Window]"===Object.prototype.toString.call(na)){var i="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",a=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';t.pdfObjectUrl&&(i=t.pdfObjectUrl,a="");var o='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+i+'"'+a+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(t)+");<\/script></body></html>",s=na.open();return null!==s&&s.document.write(o),s}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if("[object Window]"===Object.prototype.toString.call(na)){var c='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(t.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+t.filename+'" width="500px" height="400px" /></body></html>',l=na.open();if(null!==l){l.document.write(c);var d=this;l.document.documentElement.querySelector("#pdfViewer").onload=function(){l.document.title=t.filename,l.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(d.output("bloburl"))}}return l}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if("[object Window]"!==Object.prototype.toString.call(na))throw new Error("The option dataurlnewwindow just works in a browser-environment.");var u='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",t)+'"></iframe></body></html>',h=na.open();if(null!==h&&(h.document.write(u),h.document.title=t.filename),h||"undefined"==typeof safari)return h;break;case"datauri":case"dataurl":return na.document.location.href=this.output("datauristring",t);default:return null}},xe.foo=function(){try{return xe.apply(this,arguments)}catch(xe){var e=xe.stack||"";~e.indexOf(" at ")&&(e=e.split(" at ")[1]);var t="Error in function "+e.split("\n")[0].split("<")[0]+": "+xe.message;if(!na.console)throw new Error(t);na.console.error(t,xe),na.alert&&alert(t)}},xe.foo.bar=xe,xe.foo),Et=function(e){return!0===Array.isArray(Ae)&&Ae.indexOf(e)>-1};switch(r){case"pt":he=1;break;case"mm":he=72/25.4;break;case"cm":he=72/2.54;break;case"in":he=72;break;case"px":he=1==Et("px_scaling")?.75:96/72;break;case"pc":case"em":he=12;break;case"ex":he=6;break;default:if("number"!=typeof r)throw new Error("Invalid unit: "+r);he=r}var vt=null;U(),k();var yt=p.__private__.getPageInfo=p.getPageInfo=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:we[e].objId,pageNumber:e,pageContext:we[e]}},St=p.__private__.getPageInfoByObjId=function(e){if(isNaN(e)||e%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var t in we)if(we[t].objId===e)break;return yt(t)},bt=p.__private__.getCurrentPageInfo=p.getCurrentPageInfo=function(){return{objId:we[j].objId,pageNumber:j,pageContext:we[j]}};p.addPage=function(){return at.apply(this,arguments),this},p.setPage=function(){return st.apply(this,arguments),X.call(this,K[j]),this},p.insertPage=function(e){return this.addPage(),this.movePage(j,e),this},p.movePage=function(e,t){var n,r;if(e>t){n=K[e],r=we[e];for(var i=e;i>t;i--)K[i]=K[i-1],we[i]=we[i-1];K[t]=n,we[t]=r,this.setPage(t)}else if(e<t){n=K[e],r=we[e];for(var a=e;a<t;a++)K[a]=K[a+1],we[a]=we[a+1];K[t]=n,we[t]=r,this.setPage(t)}return this},p.deletePage=function(){return ot.apply(this,arguments),this},p.__private__.text=p.text=function(e,t,n,r,i){var a,o,s,c,l,d,u,p,f,m=(r=r||{}).scope||this;if("number"==typeof e&&"number"==typeof t&&("string"==typeof n||Array.isArray(n))){var _=n;n=t,t=e,e=_}if(arguments[3]instanceof Pe==0?(s=arguments[4],c=arguments[5],"object"===(0,ai.A)(u=arguments[3])&&null!==u||("string"==typeof s&&(c=s,s=null),"string"==typeof u&&(c=u,u=null),"number"==typeof u&&(s=u,u=null),r={flags:u,angle:s,align:c})):(w("The transform parameter of text() with a Matrix value"),f=i),isNaN(t)||isNaN(n)||null==e)throw new Error("Invalid arguments passed to jsPDF.text");if(0===e.length)return m;var g,E="",S="number"==typeof r.lineHeightFactor?r.lineHeightFactor:Mt,b=m.internal.scaleFactor;function T(e){return e=e.split("\t").join(Array(r.TabLen||9).join(" ")),rt(e,u)}function R(e){for(var t,n=e.concat(),r=[],i=n.length;i--;)"string"==typeof(t=n.shift())?r.push(t):Array.isArray(e)&&(1===t.length||void 0===t[1]&&void 0===t[2])?r.push(t[0]):r.push([t[0],t[1],t[2]]);return r}function A(e,t){var n;if("string"==typeof e)n=t(e)[0];else if(Array.isArray(e)){for(var r,i,a=e.concat(),o=[],s=a.length;s--;)"string"==typeof(r=a.shift())?o.push(t(r)[0]):Array.isArray(r)&&"string"==typeof r[0]&&(i=t(r[0],r[1],r[2]),o.push([i[0],i[1],i[2]]));n=o}return n}var I=!1,O=!0;if("string"==typeof e)I=!0;else if(Array.isArray(e)){var P=e.concat();o=[];for(var L,D=P.length;D--;)("string"!=typeof(L=P.shift())||Array.isArray(L)&&"string"!=typeof L[0])&&(O=!1);I=O}if(!1===I)throw new Error('Type of text must be string or Array. "'+e+'" is not recognized.');"string"==typeof e&&(e=e.match(/[\r?\n]/)?e.split(/\r\n|\r|\n/g):[e]);var k=te/m.internal.scaleFactor,x=k*(S-1);switch(r.baseline){case"bottom":n-=x;break;case"top":n+=k-x;break;case"hanging":n+=k-2*x;break;case"middle":n+=k/2-x}if((d=r.maxWidth||0)>0&&("string"==typeof e?e=m.splitTextToSize(e,d):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce((function(e,t){return e.concat(m.splitTextToSize(t,d))}),[]))),a={text:e,x:t,y:n,options:r,mutex:{pdfEscape:rt,activeFontKey:ue,fonts:_e,activeFontSize:te}},Re.publish("preProcessText",a),e=a.text,s=(r=a.options).angle,f instanceof Pe==0&&s&&"number"==typeof s){s*=Math.PI/180,0===r.rotationDirection&&(s=-s),y===v&&(s=-s);var M=Math.cos(s),U=Math.sin(s);f=new Pe(M,U,-U,M,0,0)}else s&&s instanceof Pe&&(f=s);y!==v||f||(f=De),void 0!==(l=r.charSpace||Qt)&&(E+=C(N(l))+" Tc\n",this.setCharSpace(this.getCharSpace()||0)),void 0!==(p=r.horizontalScale)&&(E+=C(100*p)+" Tz\n"),r.lang;var F=-1,j=void 0!==r.renderingMode?r.renderingMode:r.stroke,V=m.internal.getCurrentPageInfo().pageContext;switch(j){case 0:case!1:case"fill":F=0;break;case 1:case!0:case"stroke":F=1;break;case 2:case"fillThenStroke":F=2;break;case 3:case"invisible":F=3;break;case 4:case"fillAndAddForClipping":F=4;break;case 5:case"strokeAndAddPathForClipping":F=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":F=6;break;case 7:case"addToPathForClipping":F=7}var B=void 0!==V.usedRenderingMode?V.usedRenderingMode:-1;-1!==F?E+=F+" Tr\n":-1!==B&&(E+="0 Tr\n"),-1!==F&&(V.usedRenderingMode=F),c=r.align||"left";var G,W=te*S,H=m.internal.pageSize.getWidth(),q=_e[ue];l=r.charSpace||Qt,d=r.maxWidth||0,u=Object.assign({autoencode:!0,noBOM:!0},r.flags);var z=[],K=function(e){return m.getStringUnitWidth(e,{font:q,charSpace:l,fontSize:te,doKerning:!1})*te/b};if("[object Array]"===Object.prototype.toString.call(e)){var Y;o=R(e),"left"!==c&&(G=o.map(K));var J,X=0;if("right"===c){t-=G[0],e=[],D=o.length;for(var Z=0;Z<D;Z++)0===Z?(J=Wt(t),Y=Ht(n)):(J=N(X-G[Z]),Y=-W),e.push([o[Z],J,Y]),X=G[Z]}else if("center"===c){t-=G[0]/2,e=[],D=o.length;for(var $=0;$<D;$++)0===$?(J=Wt(t),Y=Ht(n)):(J=N((X-G[$])/2),Y=-W),e.push([o[$],J,Y]),X=G[$]}else if("left"===c){e=[],D=o.length;for(var ee=0;ee<D;ee++)e.push(o[ee])}else if("justify"===c&&"Identity-H"===q.encoding){e=[],D=o.length,d=0!==d?d:H;for(var ne=0,re=0;re<D;re++)if(Y=0===re?Ht(n):-W,J=0===re?Wt(t):ne,re<D-1){var ae=N((d-G[re])/(o[re].split(" ").length-1)),oe=o[re].split(" ");e.push([oe[0]+" ",J,Y]),ne=0;for(var se=1;se<oe.length;se++){var ce=(K(oe[se-1]+" "+oe[se])-K(oe[se]))*b+ae;se==oe.length-1?e.push([oe[se],ce,0]):e.push([oe[se]+" ",ce,0]),ne-=ce}}else e.push([o[re],J,Y]);e.push(["",ne,0])}else{if("justify"!==c)throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(e=[],D=o.length,d=0!==d?d:H,re=0;re<D;re++)Y=0===re?Ht(n):-W,J=0===re?Wt(t):0,re<D-1?z.push(C(N((d-G[re])/(o[re].split(" ").length-1)))):z.push(0),e.push([o[re],J,Y])}}!0===("boolean"==typeof r.R2L?r.R2L:ie)&&(e=A(e,(function(e,t,n){return[e.split("").reverse().join(""),t,n]}))),a={text:e,x:t,y:n,options:r,mutex:{pdfEscape:rt,activeFontKey:ue,fonts:_e,activeFontSize:te}},Re.publish("postProcessText",a),e=a.text,g=a.mutex.isHex||!1;var le=_e[ue].encoding;"WinAnsiEncoding"!==le&&"StandardEncoding"!==le||(e=A(e,(function(e,t,n){return[T(e),t,n]}))),o=R(e),e=[];for(var de,he,pe,fe=Array.isArray(o[0])?1:0,me="",ge=function(e,t,n){var i="";return n instanceof Pe?(n="number"==typeof r.angle?Le(n,new Pe(1,0,0,1,e,t)):Le(new Pe(1,0,0,1,e,t),n),y===v&&(n=Le(new Pe(1,0,0,-1,0,0),n)),i=n.join(" ")+" Tm\n"):i=C(e)+" "+C(t)+" Td\n",i},Ee=0;Ee<o.length;Ee++){switch(me="",fe){case 1:pe=(g?"<":"(")+o[Ee][0]+(g?">":")"),de=parseFloat(o[Ee][1]),he=parseFloat(o[Ee][2]);break;case 0:pe=(g?"<":"(")+o[Ee]+(g?">":")"),de=Wt(t),he=Ht(n)}void 0!==z&&void 0!==z[Ee]&&(me=z[Ee]+" Tw\n"),0===Ee?e.push(me+ge(de,he,f)+pe):0===fe?e.push(me+pe):1===fe&&e.push(me+ge(de,he,f)+pe)}e=0===fe?e.join(" Tj\nT* "):e.join(" Tj\n"),e+=" Tj\n";var ve="BT\n/";return ve+=ue+" "+te+" Tf\n",ve+=C(te*S)+" TL\n",ve+=Jt+"\n",ve+=E,ve+=e,Q(ve+="ET"),h[ue]=!0,m};var Tt=p.__private__.clip=p.clip=function(e){return Q("evenodd"===e?"W*":"W"),this};p.clipEvenOdd=function(){return Tt("evenodd")},p.__private__.discardPath=p.discardPath=function(){return Q("n"),this};var Ct=p.__private__.isValidStyle=function(e){var t=!1;return-1!==[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(e)&&(t=!0),t};p.__private__.setDefaultPathOperation=p.setDefaultPathOperation=function(e){return Ct(e)&&(l=e),this};var wt=p.__private__.getStyle=p.getStyle=function(e){var t=l;switch(e){case"D":case"S":t="S";break;case"F":t="f";break;case"FD":case"DF":t="B";break;case"f":case"f*":case"B":case"B*":t=e}return t},Rt=p.close=function(){return Q("h"),this};p.stroke=function(){return Q("S"),this},p.fill=function(e){return At("f",e),this},p.fillEvenOdd=function(e){return At("f*",e),this},p.fillStroke=function(e){return At("B",e),this},p.fillStrokeEvenOdd=function(e){return At("B*",e),this};var At=function(e,t){"object"===(0,ai.A)(t)?Ot(t,e):Q(e)},It=function(e){null===e||y===v&&void 0===e||(e=wt(e),Q(e))};function Nt(e,t,n,r,i){var a=new ka(t||this.boundingBox,n||this.xStep,r||this.yStep,this.gState,i||this.matrix);a.stream=this.stream;var o=e+"$$"+this.cloneIndex+++"$$";return ke(o,a),a}var Ot=function(e,t){var n=ye[e.key],r=ve[n];if(r instanceof Da)Q("q"),Q(Pt(t)),r.gState&&p.setGState(r.gState),Q(e.matrix.toString()+" cm"),Q("/"+n+" sh"),Q("Q");else if(r instanceof ka){var i=new Pe(1,0,0,-1,0,dn());e.matrix&&(i=i.multiply(e.matrix||De),n=Nt.call(r,e.key,e.boundingBox,e.xStep,e.yStep,i).id),Q("q"),Q("/Pattern cs"),Q("/"+n+" scn"),r.gState&&p.setGState(r.gState),Q(t),Q("Q")}},Pt=function(e){switch(e){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Lt=p.moveTo=function(e,t){return Q(C(N(e))+" "+C(O(t))+" m"),this},Dt=p.lineTo=function(e,t){return Q(C(N(e))+" "+C(O(t))+" l"),this},kt=p.curveTo=function(e,t,n,r,i,a){return Q([C(N(e)),C(O(t)),C(N(n)),C(O(r)),C(N(i)),C(O(a)),"c"].join(" ")),this};p.__private__.line=p.line=function(e,t,n,r,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!Ct(i))throw new Error("Invalid arguments passed to jsPDF.line");return y===E?this.lines([[n-e,r-t]],e,t,[1,1],i||"S"):this.lines([[n-e,r-t]],e,t,[1,1]).stroke()},p.__private__.lines=p.lines=function(e,t,n,r,i,a){var o,s,c,l,d,u,h,p,f,m,_,g;if("number"==typeof e&&(g=n,n=t,t=e,e=g),r=r||[1,1],a=a||!1,isNaN(t)||isNaN(n)||!Array.isArray(e)||!Array.isArray(r)||!Ct(i)||"boolean"!=typeof a)throw new Error("Invalid arguments passed to jsPDF.lines");for(Lt(t,n),o=r[0],s=r[1],l=e.length,m=t,_=n,c=0;c<l;c++)2===(d=e[c]).length?(m=d[0]*o+m,_=d[1]*s+_,Dt(m,_)):(u=d[0]*o+m,h=d[1]*s+_,p=d[2]*o+m,f=d[3]*s+_,m=d[4]*o+m,_=d[5]*s+_,kt(u,h,p,f,m,_));return a&&Rt(),It(i),this},p.path=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.c;switch(n.op){case"m":Lt(r[0],r[1]);break;case"l":Dt(r[0],r[1]);break;case"c":kt.apply(this,r);break;case"h":Rt()}}return this},p.__private__.rect=p.rect=function(e,t,n,r,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!Ct(i))throw new Error("Invalid arguments passed to jsPDF.rect");return y===E&&(r=-r),Q([C(N(e)),C(O(t)),C(N(n)),C(N(r)),"re"].join(" ")),It(i),this},p.__private__.triangle=p.triangle=function(e,t,n,r,i,a,o){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a)||!Ct(o))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[n-e,r-t],[i-n,a-r],[e-i,t-a]],e,t,[1,1],o,!0),this},p.__private__.roundedRect=p.roundedRect=function(e,t,n,r,i,a,o){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a)||!Ct(o))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var s=4/3*(Math.SQRT2-1);return i=Math.min(i,.5*n),a=Math.min(a,.5*r),this.lines([[n-2*i,0],[i*s,0,i,a-a*s,i,a],[0,r-2*a],[0,a*s,-i*s,a,-i,a],[2*i-n,0],[-i*s,0,-i,-a*s,-i,-a],[0,2*a-r],[0,-a*s,i*s,-a,i,-a]],e+i,t,[1,1],o,!0),this},p.__private__.ellipse=p.ellipse=function(e,t,n,r,i){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||!Ct(i))throw new Error("Invalid arguments passed to jsPDF.ellipse");var a=4/3*(Math.SQRT2-1)*n,o=4/3*(Math.SQRT2-1)*r;return Lt(e+n,t),kt(e+n,t-o,e+a,t-r,e,t-r),kt(e-a,t-r,e-n,t-o,e-n,t),kt(e-n,t+o,e-a,t+r,e,t+r),kt(e+a,t+r,e+n,t+o,e+n,t),It(i),this},p.__private__.circle=p.circle=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||!Ct(r))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(e,t,n,n,r)},p.setFont=function(e,t,n){return n&&(t=T(t,n)),ue=lt(e,t,{disableWarning:!1}),this};var xt=p.__private__.getFont=p.getFont=function(){return _e[lt.apply(p,arguments)]};p.__private__.getFontList=p.getFontList=function(){var e,t,n={};for(e in ge)if(ge.hasOwnProperty(e))for(t in n[e]=[],ge[e])ge[e].hasOwnProperty(t)&&n[e].push(t);return n},p.addFont=function(e,t,n,r,i){var a=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&-1!==a.indexOf(arguments[3])?i=arguments[3]:arguments[3]&&-1==a.indexOf(arguments[3])&&(n=T(n,r)),nt.call(this,e,t,n,i=i||"Identity-H")};var Mt,Ut=e.lineWidth||.200025,Ft=p.__private__.getLineWidth=p.getLineWidth=function(){return Ut},jt=p.__private__.setLineWidth=p.setLineWidth=function(e){return Ut=e,Q(C(N(e))+" w"),this};p.__private__.setLineDash=xa.API.setLineDash=xa.API.setLineDashPattern=function(e,t){if(e=e||[],t=t||0,isNaN(t)||!Array.isArray(e))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return e=e.map((function(e){return C(N(e))})).join(" "),t=C(N(t)),Q("["+e+"] "+t+" d"),this};var Vt=p.__private__.getLineHeight=p.getLineHeight=function(){return te*Mt};p.__private__.getLineHeight=p.getLineHeight=function(){return te*Mt};var Bt=p.__private__.setLineHeightFactor=p.setLineHeightFactor=function(e){return"number"==typeof(e=e||1.15)&&(Mt=e),this},Gt=p.__private__.getLineHeightFactor=p.getLineHeightFactor=function(){return Mt};Bt(e.lineHeight);var Wt=p.__private__.getHorizontalCoordinate=function(e){return N(e)},Ht=p.__private__.getVerticalCoordinate=function(e){return y===v?e:we[j].mediaBox.topRightY-we[j].mediaBox.bottomLeftY-N(e)},qt=p.__private__.getHorizontalCoordinateString=p.getHorizontalCoordinateString=function(e){return C(Wt(e))},zt=p.__private__.getVerticalCoordinateString=p.getVerticalCoordinateString=function(e){return C(Ht(e))},Kt=e.strokeColor||"0 G";p.__private__.getStrokeColor=p.getDrawColor=function(){return Ge(Kt)},p.__private__.setStrokeColor=p.setDrawColor=function(e,t,n,r){return Kt=We({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"draw",precision:2}),Q(Kt),this};var Yt=e.fillColor||"0 g";p.__private__.getFillColor=p.getFillColor=function(){return Ge(Yt)},p.__private__.setFillColor=p.setFillColor=function(e,t,n,r){return Yt=We({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"fill",precision:2}),Q(Yt),this};var Jt=e.textColor||"0 g",Xt=p.__private__.getTextColor=p.getTextColor=function(){return Ge(Jt)};p.__private__.setTextColor=p.setTextColor=function(e,t,n,r){return Jt=We({ch1:e,ch2:t,ch3:n,ch4:r,pdfColorType:"text",precision:3}),this};var Qt=e.charSpace,Zt=p.__private__.getCharSpace=p.getCharSpace=function(){return parseFloat(Qt||0)};p.__private__.setCharSpace=p.setCharSpace=function(e){if(isNaN(e))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Qt=e,this};var $t=0;p.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},p.__private__.setLineCap=p.setLineCap=function(e){var t=p.CapJoinStyles[e];if(void 0===t)throw new Error("Line cap style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return $t=t,Q(t+" J"),this};var en=0;p.__private__.setLineJoin=p.setLineJoin=function(e){var t=p.CapJoinStyles[e];if(void 0===t)throw new Error("Line join style of '"+e+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return en=t,Q(t+" j"),this},p.__private__.setLineMiterLimit=p.__private__.setMiterLimit=p.setLineMiterLimit=p.setMiterLimit=function(e){if(e=e||0,isNaN(e))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Q(C(N(e))+" M"),this},p.GState=Pa,p.setGState=function(e){(e="string"==typeof e?Se[be[e]]:tn(null,e)).equals(Te)||(Q("/"+e.id+" gs"),Te=e)};var tn=function(e,t){if(!e||!be[e]){var n=!1;for(var r in Se)if(Se.hasOwnProperty(r)&&Se[r].equals(t)){n=!0;break}if(n)t=Se[r];else{var i="GS"+(Object.keys(Se).length+1).toString(10);Se[i]=t,t.id=i}return e&&(be[e]=t.id),Re.publish("addGState",t),t}};p.addGState=function(e,t){return tn(e,t),this},p.saveGraphicsState=function(){return Q("q"),Ee.push({key:ue,size:te,color:Jt}),this},p.restoreGraphicsState=function(){Q("Q");var e=Ee.pop();return ue=e.key,te=e.size,Jt=e.color,Te=null,this},p.setCurrentTransformationMatrix=function(e){return Q(e.toString()+" cm"),this},p.comment=function(e){return Q("#"+e),this};var nn=function(e,t){var n=e||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return n},set:function(e){isNaN(e)||(n=parseFloat(e))}});var r=t||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return r},set:function(e){isNaN(e)||(r=parseFloat(e))}});var i="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return i},set:function(e){i=e.toString()}}),this},rn=function(e,t,n,r){nn.call(this,e,t),this.type="rect";var i=n||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return i},set:function(e){isNaN(e)||(i=parseFloat(e))}});var a=r||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return a},set:function(e){isNaN(e)||(a=parseFloat(e))}}),this},an=function(){this.page=Ce,this.currentPage=j,this.pages=K.slice(0),this.pagesContext=we.slice(0),this.x=pe,this.y=fe,this.matrix=me,this.width=cn(j),this.height=dn(j),this.outputDestination=J,this.id="",this.objectNumber=-1};an.prototype.restore=function(){Ce=this.page,j=this.currentPage,we=this.pagesContext,K=this.pages,pe=this.x,fe=this.y,me=this.matrix,ln(j,this.width),un(j,this.height),J=this.outputDestination};var on=function(e,t,n,r,i){Oe.push(new an),Ce=j=0,K=[],pe=e,fe=t,me=i,it([n,r])};for(var sn in p.beginFormObject=function(e,t,n,r,i){return on(e,t,n,r,i),this},p.endFormObject=function(e){return function(e){if(Ne[e])Oe.pop().restore();else{var t=new an,n="Xo"+(Object.keys(Ie).length+1).toString(10);t.id=n,Ne[e]=n,Ie[n]=t,Re.publish("addFormObject",t),Oe.pop().restore()}}(e),this},p.doFormObject=function(e,t){var n=Ie[Ne[e]];return Q("q"),Q(t.toString()+" cm"),Q("/"+n.id+" Do"),Q("Q"),this},p.getFormObject=function(e){var t=Ie[Ne[e]];return{x:t.x,y:t.y,width:t.width,height:t.height,matrix:t.matrix}},p.save=function(e,t){return e=e||"generated.pdf",(t=t||{}).returnPromise=t.returnPromise||!1,!1===t.returnPromise?(da(_t(mt()),e),"function"==typeof da.unload&&na.setTimeout&&setTimeout(da.unload,911),this):new Promise((function(t,n){try{var r=da(_t(mt()),e);"function"==typeof da.unload&&na.setTimeout&&setTimeout(da.unload,911),t(r)}catch(e){n(e.message)}}))},xa.API)xa.API.hasOwnProperty(sn)&&("events"===sn&&xa.API.events.length?function(e,t){var n,r,i;for(i=t.length-1;-1!==i;i--)n=t[i][0],r=t[i][1],e.subscribe.apply(e,[n].concat("function"==typeof r?[r]:r))}(Re,xa.API.events):p[sn]=xa.API[sn]);var cn=p.getPageWidth=function(e){return(we[e=e||j].mediaBox.topRightX-we[e].mediaBox.bottomLeftX)/he},ln=p.setPageWidth=function(e,t){we[e].mediaBox.topRightX=t*he+we[e].mediaBox.bottomLeftX},dn=p.getPageHeight=function(e){return(we[e=e||j].mediaBox.topRightY-we[e].mediaBox.bottomLeftY)/he},un=p.setPageHeight=function(e,t){we[e].mediaBox.topRightY=t*he+we[e].mediaBox.bottomLeftY};return p.internal={pdfEscape:rt,getStyle:wt,getFont:xt,getFontSize:re,getCharSpace:Zt,getTextColor:Xt,getLineHeight:Vt,getLineHeightFactor:Gt,getLineWidth:Ft,write:Z,getHorizontalCoordinate:Wt,getVerticalCoordinate:Ht,getCoordinateString:qt,getVerticalCoordinateString:zt,collections:{},newObject:Me,newAdditionalObject:je,newObjectDeferred:Ue,newObjectDeferredBegin:Fe,getFilters:He,putStream:qe,events:Re,scaleFactor:he,pageSize:{getWidth:function(){return cn(j)},setWidth:function(e){ln(j,e)},getHeight:function(){return dn(j)},setHeight:function(e){un(j,e)}},encryptionOptions:d,encryption:vt,getEncryptor:function(e){return null!==d?vt.encryptor(e,0):function(e){return e}},output:gt,getNumberOfPages:ct,pages:K,out:Q,f2:A,f3:I,getPageInfo:yt,getPageInfoByObjId:St,getCurrentPageInfo:bt,getPDFVersion:m,Point:nn,Rectangle:rn,Matrix:Pe,hasHotfix:Et},Object.defineProperty(p.internal.pageSize,"width",{get:function(){return cn(j)},set:function(e){ln(j,e)},enumerable:!0,configurable:!0}),Object.defineProperty(p.internal.pageSize,"height",{get:function(){return dn(j)},set:function(e){un(j,e)},enumerable:!0,configurable:!0}),function(e){for(var t=0,n=ee.length;t<n;t++){var r=nt.call(this,e[t][0],e[t][1],e[t][2],ee[t][3],!0);!1===u&&(h[r]=!0);var i=e[t][0].split("-");tt({id:r,fontName:i[0],fontStyle:i[1]||""})}Re.publish("addFonts",{fonts:_e,dictionary:ge})}.call(p,ee),ue="F1",at(i,n),Re.publish("initialized"),p}Ia.prototype.lsbFirstWord=function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)},Ia.prototype.toHexString=function(e){return e.split("").map((function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)})).join("")},Ia.prototype.hexToBytes=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(String.fromCharCode(parseInt(e.substr(n,2),16)));return t.join("")},Ia.prototype.processOwnerPassword=function(e,t){return Ra(Ta(t).substr(0,5),e)},Ia.prototype.encryptor=function(e,t){var n=Ta(this.encryptionKey+String.fromCharCode(255&e,e>>8&255,e>>16&255,255&t,t>>8&255)).substr(0,10);return function(e){return Ra(n,e)}},Pa.prototype.equals=function(e){var t,n="id,objectNumber,equals";if(!e||(0,ai.A)(e)!==(0,ai.A)(this))return!1;var r=0;for(t in this)if(!(n.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!e.hasOwnProperty(t))return!1;if(this[t]!==e[t])return!1;r++}for(t in e)e.hasOwnProperty(t)&&n.indexOf(t)<0&&r--;return 0===r},xa.API={events:[]},xa.version="2.5.2";var Ma=xa.API,Ua=1,Fa=function(e){return e.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ja=function(e){return e.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Va=function(e){return e.toFixed(2)},Ba=function(e){return e.toFixed(5)};Ma.__acroform__={};var Ga=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},Wa=function(e){return e*Ua},Ha=function(e){var t=new so,n=bo.internal.getHeight(e)||0,r=bo.internal.getWidth(e)||0;return t.BBox=[0,0,Number(Va(r)),Number(Va(n))],t},qa=Ma.__acroform__.setBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return e|1<<t},za=Ma.__acroform__.clearBit=function(e,t){if(e=e||0,t=t||0,isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return e&~(1<<t)},Ka=Ma.__acroform__.getBit=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return 0==(e&1<<t)?0:1},Ya=Ma.__acroform__.getBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Ka(e,t-1)},Ja=Ma.__acroform__.setBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return qa(e,t-1)},Xa=Ma.__acroform__.clearBitForPdf=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return za(e,t-1)},Qa=Ma.__acroform__.calculateCoordinates=function(e,t){var n=t.internal.getHorizontalCoordinate,r=t.internal.getVerticalCoordinate,i=e[0],a=e[1],o=e[2],s=e[3],c={};return c.lowerLeft_X=n(i)||0,c.lowerLeft_Y=r(a+s)||0,c.upperRight_X=n(i+o)||0,c.upperRight_Y=r(a)||0,[Number(Va(c.lowerLeft_X)),Number(Va(c.lowerLeft_Y)),Number(Va(c.upperRight_X)),Number(Va(c.upperRight_Y))]},Za=function(e){if(e.appearanceStreamContent)return e.appearanceStreamContent;if(e.V||e.DV){var t=[],n=e._V||e.DV,r=$a(e,n),i=e.scope.internal.getFont(e.fontName,e.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(e.scope.__private__.encodeColorString(e.color)),t.push("/"+i+" "+Va(r.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(r.text),t.push("ET"),t.push("Q"),t.push("EMC");var a=Ha(e);return a.scope=e.scope,a.stream=t.join("\n"),a}},$a=function(e,t){var n=0===e.fontSize?e.maxFontSize:e.fontSize,r={text:"",fontSize:""},i=(t=")"==(t="("==t.substr(0,1)?t.substr(1):t).substr(t.length-1)?t.substr(0,t.length-1):t).split(" ");i=e.multiline?i.map((function(e){return e.split("\n")})):i.map((function(e){return[e]}));var a=n,o=bo.internal.getHeight(e)||0;o=o<0?-o:o;var s=bo.internal.getWidth(e)||0;s=s<0?-s:s;var c=function(t,n,r){if(t+1<i.length){var a=n+" "+i[t+1][0];return eo(a,e,r).width<=s-4}return!1};a++;e:for(;a>0;){t="",a--;var l,d,u=eo("3",e,a).height,h=e.multiline?o-a:(o-u)/2,p=h+=2,f=0,m=0,_=0;if(a<=0){t="(...) Tj\n",t+="% Width of Text: "+eo(t,e,a=12).width+", FieldWidth:"+s+"\n";break}for(var g="",E=0,v=0;v<i.length;v++)if(i.hasOwnProperty(v)){var y=!1;if(1!==i[v].length&&_!==i[v].length-1){if((u+2)*(E+2)+2>o)continue e;g+=i[v][_],y=!0,m=v,v--}else{g=" "==(g+=i[v][_]+" ").substr(g.length-1)?g.substr(0,g.length-1):g;var S=parseInt(v),b=c(S,g,a),T=v>=i.length-1;if(b&&!T){g+=" ",_=0;continue}if(b||T){if(T)m=S;else if(e.multiline&&(u+2)*(E+2)+2>o)continue e}else{if(!e.multiline)continue e;if((u+2)*(E+2)+2>o)continue e;m=S}}for(var C="",w=f;w<=m;w++){var R=i[w];if(e.multiline){if(w===m){C+=R[_]+" ",_=(_+1)%R.length;continue}if(w===f){C+=R[R.length-1]+" ";continue}}C+=R[0]+" "}switch(C=" "==C.substr(C.length-1)?C.substr(0,C.length-1):C,d=eo(C,e,a).width,e.textAlign){case"right":l=s-d-2;break;case"center":l=(s-d)/2;break;default:l=2}t+=Va(l)+" "+Va(p)+" Td\n",t+="("+Fa(C)+") Tj\n",t+=-Va(l)+" 0 Td\n",p=-(a+2),d=0,f=y?m:m+1,E++,g=""}break}return r.text=t,r.fontSize=a,r},eo=function(e,t,n){var r=t.scope.internal.getFont(t.fontName,t.fontStyle),i=t.scope.getStringUnitWidth(e,{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n);return{height:t.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(n),charSpace:0})*parseFloat(n)*1.5,width:i}},to={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},no=function(e,t){var n={type:"reference",object:e};void 0===t.internal.getPageInfo(e.page).pageContext.annotations.find((function(e){return e.type===n.type&&e.object===n.object}))&&t.internal.getPageInfo(e.page).pageContext.annotations.push(n)},ro=function(e,t){if(t.scope=e,void 0!==e.internal&&(void 0===e.internal.acroformPlugin||!1===e.internal.acroformPlugin.isInitialized)){if(lo.FieldNum=0,e.internal.acroformPlugin=JSON.parse(JSON.stringify(to)),e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Ua=e.internal.scaleFactor,e.internal.acroformPlugin.acroFormDictionaryRoot=new co,e.internal.acroformPlugin.acroFormDictionaryRoot.scope=e,e.internal.acroformPlugin.acroFormDictionaryRoot._eventID=e.internal.events.subscribe("postPutResources",(function(){var t;(t=e).internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})),e.internal.events.subscribe("buildDocument",(function(){!function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var t=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r.objId=void 0,r.hasAnnotation&&no(r,e)}}(e)})),e.internal.events.subscribe("putCatalog",(function(){!function(e){if(void 0===e.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")}(e)})),e.internal.events.subscribe("postPutPages",(function(t){!function(e,t){var n=!e;for(var r in e||(t.internal.newObjectDeferredBegin(t.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),t.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),e=e||t.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(e.hasOwnProperty(r)){var i=e[r],a=[],o=i.Rect;if(i.Rect&&(i.Rect=Qa(i.Rect,t)),t.internal.newObjectDeferredBegin(i.objId,!0),i.DA=bo.createDefaultAppearanceStream(i),"object"===(0,ai.A)(i)&&"function"==typeof i.getKeyValueListForStream&&(a=i.getKeyValueListForStream()),i.Rect=o,i.hasAppearanceStream&&!i.appearanceStreamContent){var s=Za(i);a.push({key:"AP",value:"<</N "+s+">>"}),t.internal.acroformPlugin.xForms.push(s)}if(i.appearanceStreamContent){var c="";for(var l in i.appearanceStreamContent)if(i.appearanceStreamContent.hasOwnProperty(l)){var d=i.appearanceStreamContent[l];if(c+="/"+l+" ",c+="<<",Object.keys(d).length>=1||Array.isArray(d)){for(var r in d)if(d.hasOwnProperty(r)){var u=d[r];"function"==typeof u&&(u=u.call(t,i)),c+="/"+r+" "+u+" ",t.internal.acroformPlugin.xForms.indexOf(u)>=0||t.internal.acroformPlugin.xForms.push(u)}}else"function"==typeof(u=d)&&(u=u.call(t,i)),c+="/"+r+" "+u,t.internal.acroformPlugin.xForms.indexOf(u)>=0||t.internal.acroformPlugin.xForms.push(u);c+=">>"}a.push({key:"AP",value:"<<\n"+c+">>"})}t.internal.putStream({additionalKeyValues:a,objectId:i.objId}),t.internal.out("endobj")}n&&function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=n,i=e[n];t.internal.newObjectDeferredBegin(i.objId,!0),"object"===(0,ai.A)(i)&&"function"==typeof i.putStream&&i.putStream(),delete e[r]}}(t.internal.acroformPlugin.xForms,t)}(t,e)})),e.internal.acroformPlugin.isInitialized=!0}},io=Ma.__acroform__.arrayToPdfArray=function(e,t,n){var r=function(e){return e};if(Array.isArray(e)){for(var i="[",a=0;a<e.length;a++)switch(0!==a&&(i+=" "),(0,ai.A)(e[a])){case"boolean":case"number":case"object":i+=e[a].toString();break;case"string":"/"!==e[a].substr(0,1)?(void 0!==t&&n&&(r=n.internal.getEncryptor(t)),i+="("+Fa(r(e[a].toString()))+")"):i+=e[a].toString()}return i+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},ao=function(e,t,n){var r=function(e){return e};return void 0!==t&&n&&(r=n.internal.getEncryptor(t)),(e=e||"").toString(),"("+Fa(r(e))+")"},oo=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(void 0===this._objId){if(void 0===this.scope)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(e){this._objId=e}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};oo.prototype.toString=function(){return this.objId+" 0 R"},oo.prototype.putStream=function(){var e=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:e,objectId:this.objId}),this.scope.internal.out("endobj")},oo.prototype.getKeyValueListForStream=function(){var e=[],t=Object.getOwnPropertyNames(this).filter((function(e){return"content"!=e&&"appearanceStreamContent"!=e&&"scope"!=e&&"objId"!=e&&"_"!=e.substring(0,1)}));for(var n in t)if(!1===Object.getOwnPropertyDescriptor(this,t[n]).configurable){var r=t[n],i=this[r];i&&(Array.isArray(i)?e.push({key:r,value:io(i,this.objId,this.scope)}):i instanceof oo?(i.scope=this.scope,e.push({key:r,value:i.objId+" 0 R"})):"function"!=typeof i&&e.push({key:r,value:i}))}return e};var so=function(){oo.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var e,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){e=t.trim()},get:function(){return e||null}})};Ga(so,oo);var co=function(){oo.call(this);var e,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(e){var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Fa(t(e))+")"}},set:function(t){e=t}})};Ga(co,oo);var lo=function e(){oo.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute F supplied.');t=e}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(t,3))},set:function(e){!0===Boolean(e)?this.F=Ja(t,3):this.F=Xa(t,3)}});var n=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){if(isNaN(e))throw new Error('Invalid value "'+e+'" for attribute Ff supplied.');n=e}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(0!==r.length)return r},set:function(e){r=void 0!==e?e:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(e){r[0]=e}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(e){r[1]=e}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(e){r[2]=e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(e){r[3]=e}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){switch(e){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=e;break;default:throw new Error('Invalid value "'+e+'" for attribute FT supplied.')}}});var a=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!a||a.length<1){if(this instanceof Eo)return;a="FieldObject"+e.FieldNum++}var t=function(e){return e};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Fa(t(a))+")"},set:function(e){a=e.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return a},set:function(e){a=e}});var o="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return o},set:function(e){o=e}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(e){s=e}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(e){c=e}});var l=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return void 0===l?50/Ua:l},set:function(e){l=e}});var d="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return d},set:function(e){d=e}});var u="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!u||this instanceof Eo||this instanceof yo))return ao(u,this.objId,this.scope)},set:function(e){e=e.toString(),u=e}});var h=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(h)return this instanceof mo==0?ao(h,this.objId,this.scope):h},set:function(e){e=e.toString(),h=this instanceof mo==0?"("===e.substr(0,1)?ja(e.substr(1,e.length-2)):ja(e):e}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof mo==1?ja(h.substr(1,h.length-1)):h},set:function(e){e=e.toString(),h=this instanceof mo==1?"/"+e:e}});var p=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(p)return p},set:function(e){this.V=e}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(p)return this instanceof mo==0?ao(p,this.objId,this.scope):p},set:function(e){e=e.toString(),p=this instanceof mo==0?"("===e.substr(0,1)?ja(e.substr(1,e.length-2)):ja(e):e}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof mo==1?ja(p.substr(1,p.length-1)):p},set:function(e){e=e.toString(),p=this instanceof mo==1?"/"+e:e}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var f,m=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return m},set:function(e){e=Boolean(e),m=e}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(f)return f},set:function(e){f=e}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,1))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,1):this.Ff=Xa(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,2))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,2):this.Ff=Xa(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,3))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,3):this.Ff=Xa(this.Ff,3)}});var _=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(null!==_)return _},set:function(e){if(-1===[0,1,2].indexOf(e))throw new Error('Invalid value "'+e+'" for attribute Q supplied.');_=e}}),Object.defineProperty(this,"textAlign",{get:function(){var e;switch(_){case 0:default:e="left";break;case 1:e="center";break;case 2:e="right"}return e},configurable:!0,enumerable:!0,set:function(e){switch(e){case"right":case 2:_=2;break;case"center":case 1:_=1;break;default:_=0}}})};Ga(lo,oo);var uo=function(){lo.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var e=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){e=t}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return io(t,this.objId,this.scope)},set:function(e){var n,r;r=[],"string"==typeof(n=e)&&(r=function(e,t,n){n||(n=1);for(var r,i=[];r=t.exec(e);)i.push(r[n]);return i}(n,/\((.*?)\)/g)),t=r}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!1!==n););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,18))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,18):this.Ff=Xa(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,19))},set:function(e){!0===this.combo&&(!0===Boolean(e)?this.Ff=Ja(this.Ff,19):this.Ff=Xa(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,20))},set:function(e){!0===Boolean(e)?(this.Ff=Ja(this.Ff,20),t.sort()):this.Ff=Xa(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,22))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,22):this.Ff=Xa(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,23):this.Ff=Xa(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,27))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,27):this.Ff=Xa(this.Ff,27)}}),this.hasAppearanceStream=!1};Ga(uo,lo);var ho=function(){uo.call(this),this.fontName="helvetica",this.combo=!1};Ga(ho,uo);var po=function(){ho.call(this),this.combo=!0};Ga(po,ho);var fo=function(){po.call(this),this.edit=!0};Ga(fo,po);var mo=function(){lo.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,15))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,15):this.Ff=Xa(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,16))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,16):this.Ff=Xa(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,17))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,17):this.Ff=Xa(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,26):this.Ff=Xa(this.Ff,26)}});var e,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),0!==Object.keys(t).length){var n,r=[];for(n in r.push("<<"),t)r.push("/"+n+" ("+Fa(e(t[n]))+")");return r.push(">>"),r.join("\n")}},set:function(e){"object"===(0,ai.A)(e)&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){"string"==typeof e&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(t){e="/"+t}})};Ga(mo,lo);var _o=function(){mo.call(this),this.pushButton=!0};Ga(_o,mo);var go=function(){mo.call(this),this.radio=!0,this.pushButton=!1;var e=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=void 0!==t?t:[]}})};Ga(go,mo);var Eo=function(){var e,t;lo.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(e){t=e}});var n,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(e){return e};this.scope&&(e=this.scope.internal.getEncryptor(this.objId));var t,n=[];for(t in n.push("<<"),r)n.push("/"+t+" ("+Fa(e(r[t]))+")");return n.push(">>"),n.join("\n")},set:function(e){"object"===(0,ai.A)(e)&&(r=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(e){"string"==typeof e&&(r.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return n},set:function(e){n=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return n.substr(1,n.length-1)},set:function(e){n="/"+e}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=bo.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Ga(Eo,lo),go.prototype.setAppearance=function(e){if(!("createAppearanceStream"in e)||!("getCA"in e))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var n=this.Kids[t];n.appearanceStreamContent=e.createAppearanceStream(n.optionName),n.caption=e.getCA()}},go.prototype.createOption=function(e){var t=new Eo;return t.Parent=this,t.optionName=e,this.Kids.push(t),To.call(this.scope,t),t};var vo=function(){mo.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=bo.CheckBox.createAppearanceStream()};Ga(vo,mo);var yo=function(){lo.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,13))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,13):this.Ff=Xa(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,21))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,21):this.Ff=Xa(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,23))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,23):this.Ff=Xa(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,24))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,24):this.Ff=Xa(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,25))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,25):this.Ff=Xa(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,26))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,26):this.Ff=Xa(this.Ff,26)}});var e=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return e},set:function(t){Number.isInteger(t)&&(e=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Ga(yo,lo);var So=function(){yo.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return Boolean(Ya(this.Ff,14))},set:function(e){!0===Boolean(e)?this.Ff=Ja(this.Ff,14):this.Ff=Xa(this.Ff,14)}}),this.password=!0};Ga(So,yo);var bo={CheckBox:{createAppearanceStream:function(){return{N:{On:bo.CheckBox.YesNormal},D:{On:bo.CheckBox.YesPushDown,Off:bo.CheckBox.OffPushDown}}},YesPushDown:function(e){var t=Ha(e);t.scope=e.scope;var n=[],r=e.scope.internal.getFont(e.fontName,e.fontStyle).id,i=e.scope.__private__.encodeColorString(e.color),a=$a(e,e.caption);return n.push("0.749023 g"),n.push("0 0 "+Va(bo.internal.getWidth(e))+" "+Va(bo.internal.getHeight(e))+" re"),n.push("f"),n.push("BMC"),n.push("q"),n.push("0 0 1 rg"),n.push("/"+r+" "+Va(a.fontSize)+" Tf "+i),n.push("BT"),n.push(a.text),n.push("ET"),n.push("Q"),n.push("EMC"),t.stream=n.join("\n"),t},YesNormal:function(e){var t=Ha(e);t.scope=e.scope;var n=e.scope.internal.getFont(e.fontName,e.fontStyle).id,r=e.scope.__private__.encodeColorString(e.color),i=[],a=bo.internal.getHeight(e),o=bo.internal.getWidth(e),s=$a(e,e.caption);return i.push("1 g"),i.push("0 0 "+Va(o)+" "+Va(a)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+Va(o-1)+" "+Va(a-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+n+" "+Va(s.fontSize)+" Tf "+r),i.push(s.text),i.push("ET"),i.push("Q"),t.stream=i.join("\n"),t},OffPushDown:function(e){var t=Ha(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+Va(bo.internal.getWidth(e))+" "+Va(bo.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}},RadioButton:{Circle:{createAppearanceStream:function(e){var t={D:{Off:bo.RadioButton.Circle.OffPushDown},N:{}};return t.N[e]=bo.RadioButton.Circle.YesNormal,t.D[e]=bo.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(e){var t=Ha(e);t.scope=e.scope;var n=[],r=bo.internal.getWidth(e)<=bo.internal.getHeight(e)?bo.internal.getWidth(e)/4:bo.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var i=bo.internal.Bezier_C,a=Number((r*i).toFixed(5));return n.push("q"),n.push("1 0 0 1 "+Ba(bo.internal.getWidth(e)/2)+" "+Ba(bo.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+a+" "+a+" "+r+" 0 "+r+" c"),n.push("-"+a+" "+r+" -"+r+" "+a+" -"+r+" 0 c"),n.push("-"+r+" -"+a+" -"+a+" -"+r+" 0 -"+r+" c"),n.push(a+" -"+r+" "+r+" -"+a+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=Ha(e);t.scope=e.scope;var n=[],r=bo.internal.getWidth(e)<=bo.internal.getHeight(e)?bo.internal.getWidth(e)/4:bo.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),a=Number((i*bo.internal.Bezier_C).toFixed(5)),o=Number((r*bo.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+Ba(bo.internal.getWidth(e)/2)+" "+Ba(bo.internal.getHeight(e)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),n.push("0 g"),n.push("q"),n.push("1 0 0 1 "+Ba(bo.internal.getWidth(e)/2)+" "+Ba(bo.internal.getHeight(e)/2)+" cm"),n.push(r+" 0 m"),n.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),n.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),n.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),n.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t},OffPushDown:function(e){var t=Ha(e);t.scope=e.scope;var n=[],r=bo.internal.getWidth(e)<=bo.internal.getHeight(e)?bo.internal.getWidth(e)/4:bo.internal.getHeight(e)/4;r=Number((.9*r).toFixed(5));var i=Number((2*r).toFixed(5)),a=Number((i*bo.internal.Bezier_C).toFixed(5));return n.push("0.749023 g"),n.push("q"),n.push("1 0 0 1 "+Ba(bo.internal.getWidth(e)/2)+" "+Ba(bo.internal.getHeight(e)/2)+" cm"),n.push(i+" 0 m"),n.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),n.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),n.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),n.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),n.push("f"),n.push("Q"),t.stream=n.join("\n"),t}},Cross:{createAppearanceStream:function(e){var t={D:{Off:bo.RadioButton.Cross.OffPushDown},N:{}};return t.N[e]=bo.RadioButton.Cross.YesNormal,t.D[e]=bo.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(e){var t=Ha(e);t.scope=e.scope;var n=[],r=bo.internal.calculateCross(e);return n.push("q"),n.push("1 1 "+Va(bo.internal.getWidth(e)-2)+" "+Va(bo.internal.getHeight(e)-2)+" re"),n.push("W"),n.push("n"),n.push(Va(r.x1.x)+" "+Va(r.x1.y)+" m"),n.push(Va(r.x2.x)+" "+Va(r.x2.y)+" l"),n.push(Va(r.x4.x)+" "+Va(r.x4.y)+" m"),n.push(Va(r.x3.x)+" "+Va(r.x3.y)+" l"),n.push("s"),n.push("Q"),t.stream=n.join("\n"),t},YesPushDown:function(e){var t=Ha(e);t.scope=e.scope;var n=bo.internal.calculateCross(e),r=[];return r.push("0.749023 g"),r.push("0 0 "+Va(bo.internal.getWidth(e))+" "+Va(bo.internal.getHeight(e))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Va(bo.internal.getWidth(e)-2)+" "+Va(bo.internal.getHeight(e)-2)+" re"),r.push("W"),r.push("n"),r.push(Va(n.x1.x)+" "+Va(n.x1.y)+" m"),r.push(Va(n.x2.x)+" "+Va(n.x2.y)+" l"),r.push(Va(n.x4.x)+" "+Va(n.x4.y)+" m"),r.push(Va(n.x3.x)+" "+Va(n.x3.y)+" l"),r.push("s"),r.push("Q"),t.stream=r.join("\n"),t},OffPushDown:function(e){var t=Ha(e);t.scope=e.scope;var n=[];return n.push("0.749023 g"),n.push("0 0 "+Va(bo.internal.getWidth(e))+" "+Va(bo.internal.getHeight(e))+" re"),n.push("f"),t.stream=n.join("\n"),t}}},createDefaultAppearanceStream:function(e){var t=e.scope.internal.getFont(e.fontName,e.fontStyle).id,n=e.scope.__private__.encodeColorString(e.color);return"/"+t+" "+e.fontSize+" Tf "+n}};bo.internal={Bezier_C:.551915024494,calculateCross:function(e){var t=bo.internal.getWidth(e),n=bo.internal.getHeight(e),r=Math.min(t,n);return{x1:{x:(t-r)/2,y:(n-r)/2+r},x2:{x:(t-r)/2+r,y:(n-r)/2},x3:{x:(t-r)/2,y:(n-r)/2},x4:{x:(t-r)/2+r,y:(n-r)/2+r}}}},bo.internal.getWidth=function(e){var t=0;return"object"===(0,ai.A)(e)&&(t=Wa(e.Rect[2])),t},bo.internal.getHeight=function(e){var t=0;return"object"===(0,ai.A)(e)&&(t=Wa(e.Rect[3])),t};var To=Ma.addField=function(e){if(ro(this,e),!(e instanceof lo))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=e).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),e.page=e.scope.internal.getCurrentPageInfo().pageNumber,this};Ma.AcroFormChoiceField=uo,Ma.AcroFormListBox=ho,Ma.AcroFormComboBox=po,Ma.AcroFormEditBox=fo,Ma.AcroFormButton=mo,Ma.AcroFormPushButton=_o,Ma.AcroFormRadioButton=go,Ma.AcroFormCheckBox=vo,Ma.AcroFormTextField=yo,Ma.AcroFormPasswordField=So,Ma.AcroFormAppearance=bo,Ma.AcroForm={ChoiceField:uo,ListBox:ho,ComboBox:po,EditBox:fo,Button:mo,PushButton:_o,RadioButton:go,CheckBox:vo,TextField:yo,PasswordField:So,Appearance:bo},xa.AcroForm={ChoiceField:uo,ListBox:ho,ComboBox:po,EditBox:fo,Button:mo,PushButton:_o,RadioButton:go,CheckBox:vo,TextField:yo,PasswordField:So,Appearance:bo};xa.AcroForm;function Co(e){return e.reduce((function(e,t,n){return e[t]=n,e}),{})}!function(e){e.__addimage__={};var t="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=e.__addimage__.getImageFileTypeByImageData=function(e,r){var i,a,o,s,c,l=t;if("RGBA"===(r=r||t)||void 0!==e.data&&e.data instanceof Uint8ClampedArray&&"height"in e&&"width"in e)return"RGBA";if(b(e))for(c in n)for(o=n[c],i=0;i<o.length;i+=1){for(s=!0,a=0;a<o[i].length;a+=1)if(void 0!==o[i][a]&&o[i][a]!==e[a]){s=!1;break}if(!0===s){l=c;break}}else for(c in n)for(o=n[c],i=0;i<o.length;i+=1){for(s=!0,a=0;a<o[i].length;a+=1)if(void 0!==o[i][a]&&o[i][a]!==e.charCodeAt(a)){s=!1;break}if(!0===s){l=c;break}}return l===t&&r!==t&&(l=r),l},i=function e(t){for(var n=this.internal.write,r=this.internal.putStream,i=(0,this.internal.getFilters)();-1!==i.indexOf("FlateEncode");)i.splice(i.indexOf("FlateEncode"),1);t.objectId=this.internal.newObject();var a=[];if(a.push({key:"Type",value:"/XObject"}),a.push({key:"Subtype",value:"/Image"}),a.push({key:"Width",value:t.width}),a.push({key:"Height",value:t.height}),t.colorSpace===_.INDEXED?a.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(t.palette.length/3-1)+" "+("sMask"in t&&void 0!==t.sMask?t.objectId+2:t.objectId+1)+" 0 R]"}):(a.push({key:"ColorSpace",value:"/"+t.colorSpace}),t.colorSpace===_.DEVICE_CMYK&&a.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),a.push({key:"BitsPerComponent",value:t.bitsPerComponent}),"decodeParameters"in t&&void 0!==t.decodeParameters&&a.push({key:"DecodeParms",value:"<<"+t.decodeParameters+">>"}),"transparency"in t&&Array.isArray(t.transparency)){for(var o="",s=0,c=t.transparency.length;s<c;s++)o+=t.transparency[s]+" "+t.transparency[s]+" ";a.push({key:"Mask",value:"["+o+"]"})}void 0!==t.sMask&&a.push({key:"SMask",value:t.objectId+1+" 0 R"});var l=void 0!==t.filter?["/"+t.filter]:void 0;if(r({data:t.data,additionalKeyValues:a,alreadyAppliedFilters:l,objectId:t.objectId}),n("endobj"),"sMask"in t&&void 0!==t.sMask){var d="/Predictor "+t.predictor+" /Colors 1 /BitsPerComponent "+t.bitsPerComponent+" /Columns "+t.width,u={width:t.width,height:t.height,colorSpace:"DeviceGray",bitsPerComponent:t.bitsPerComponent,decodeParameters:d,data:t.sMask};"filter"in t&&(u.filter=t.filter),e.call(this,u)}if(t.colorSpace===_.INDEXED){var h=this.internal.newObject();r({data:C(new Uint8Array(t.palette)),objectId:h}),n("endobj")}},a=function(){var e=this.internal.collections.addImage_images;for(var t in e)i.call(this,e[t])},o=function(){var e,t=this.internal.collections.addImage_images,n=this.internal.write;for(var r in t)n("/I"+(e=t[r]).index,e.objectId,"0","R")},s=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",a),this.internal.events.subscribe("putXobjectDict",o))},c=function(){var e=this.internal.collections.addImage_images;return s.call(this),e},l=function(){return Object.keys(this.internal.collections.addImage_images).length},d=function(t){return"function"==typeof e["process"+t.toUpperCase()]},u=function(e){return"object"===(0,ai.A)(e)&&1===e.nodeType},h=function(t,n){if("IMG"===t.nodeName&&t.hasAttribute("src")){var r=""+t.getAttribute("src");if(0===r.indexOf("data:image/"))return ca(unescape(r).split("base64,").pop());var i=e.loadFile(r,!0);if(void 0!==i)return i}if("CANVAS"===t.nodeName){if(0===t.width||0===t.height)throw new Error("Given canvas must have data. Canvas width: "+t.width+", height: "+t.height);var a;switch(n){case"PNG":a="image/png";break;case"WEBP":a="image/webp";break;default:a="image/jpeg"}return ca(t.toDataURL(a,1).split("base64,").pop())}},p=function(e){var t=this.internal.collections.addImage_images;if(t)for(var n in t)if(e===t[n].alias)return t[n]},f=function(e,t,n){return e||t||(e=-96,t=-96),e<0&&(e=-1*n.width*72/e/this.internal.scaleFactor),t<0&&(t=-1*n.height*72/t/this.internal.scaleFactor),0===e&&(e=t*n.width/n.height),0===t&&(t=e*n.height/n.width),[e,t]},m=function(e,t,n,r,i,a){var o=f.call(this,n,r,i),s=this.internal.getCoordinateString,l=this.internal.getVerticalCoordinateString,d=c.call(this);if(n=o[0],r=o[1],d[i.index]=i,a){a*=Math.PI/180;var u=Math.cos(a),h=Math.sin(a),p=function(e){return e.toFixed(4)},m=[p(u),p(h),p(-1*h),p(u),0,0,"cm"]}this.internal.write("q"),a?(this.internal.write([1,"0","0",1,s(e),l(t+r),"cm"].join(" ")),this.internal.write(m.join(" ")),this.internal.write([s(n),"0","0",s(r),"0","0","cm"].join(" "))):this.internal.write([s(n),"0","0",s(r),s(e),l(t+r),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+i.index+" Do"),this.internal.write("Q")},_=e.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};e.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var g=e.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},E=e.__addimage__.sHashCode=function(e){var t,n,r=0;if("string"==typeof e)for(n=e.length,t=0;t<n;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;else if(b(e))for(n=e.byteLength/2,t=0;t<n;t++)r=(r<<5)-r+e[t],r|=0;return r},v=e.__addimage__.validateStringAsBase64=function(e){(e=e||"").toString().trim();var t=!0;return 0===e.length&&(t=!1),e.length%4!=0&&(t=!1),!1===/^[A-Za-z0-9+/]+$/.test(e.substr(0,e.length-2))&&(t=!1),!1===/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(e.substr(-2))&&(t=!1),t},y=e.__addimage__.extractImageFromDataUrl=function(e){var t=(e=e||"").split("base64,"),n=null;if(2===t.length){var r=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(t[0]);Array.isArray(r)&&(n={mimeType:r[1],charset:r[2],data:t[1]})}return n},S=e.__addimage__.supportsArrayBuffer=function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array};e.__addimage__.isArrayBuffer=function(e){return S()&&e instanceof ArrayBuffer};var b=e.__addimage__.isArrayBufferView=function(e){return S()&&"undefined"!=typeof Uint32Array&&(e instanceof Int8Array||e instanceof Uint8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)},T=e.__addimage__.binaryStringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n},C=e.__addimage__.arrayBufferToBinaryString=function(e){for(var t="",n=b(e)?e:new Uint8Array(e),r=0;r<n.length;r+=8192)t+=String.fromCharCode.apply(null,n.subarray(r,r+8192));return t};e.addImage=function(){var e,n,r,i,a,o,c,l,d;if("number"==typeof arguments[1]?(n=t,r=arguments[1],i=arguments[2],a=arguments[3],o=arguments[4],c=arguments[5],l=arguments[6],d=arguments[7]):(n=arguments[1],r=arguments[2],i=arguments[3],a=arguments[4],o=arguments[5],c=arguments[6],l=arguments[7],d=arguments[8]),"object"===(0,ai.A)(e=arguments[0])&&!u(e)&&"imageData"in e){var h=e;e=h.imageData,n=h.format||n||t,r=h.x||r||0,i=h.y||i||0,a=h.w||h.width||a,o=h.h||h.height||o,c=h.alias||c,l=h.compression||l,d=h.rotation||h.angle||d}var p=this.internal.getFilters();if(void 0===l&&-1!==p.indexOf("FlateEncode")&&(l="SLOW"),isNaN(r)||isNaN(i))throw new Error("Invalid coordinates passed to jsPDF.addImage");s.call(this);var f=w.call(this,e,n,c,l);return m.call(this,r,i,a,o,f,d),this};var w=function(n,i,a,o){var s,c,f;if("string"==typeof n&&r(n)===t){n=unescape(n);var m=R(n,!1);(""!==m||void 0!==(m=e.loadFile(n,!0)))&&(n=m)}if(u(n)&&(n=h(n,i)),i=r(n,i),!d(i))throw new Error("addImage does not support files of type '"+i+"', please ensure that a plugin for '"+i+"' support is added.");if((null==(f=a)||0===f.length)&&(a=function(e){return"string"==typeof e||b(e)?E(e):b(e.data)?E(e.data):null}(n)),(s=p.call(this,a))||(S()&&(n instanceof Uint8Array||"RGBA"===i||(c=n,n=T(n))),s=this["process"+i.toUpperCase()](n,l.call(this),a,function(t){return t&&"string"==typeof t&&(t=t.toUpperCase()),t in e.image_compression?t:g.NONE}(o),c)),!s)throw new Error("An unknown error occurred whilst processing the image.");return s},R=e.__addimage__.convertBase64ToBinaryString=function(e,t){var n;t="boolean"!=typeof t||t;var r,i="";if("string"==typeof e){r=null!==(n=y(e))?n.data:e;try{i=ca(r)}catch(e){if(t)throw v(r)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+e.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return i};e.getImageProperties=function(n){var i,a,o="";if(u(n)&&(n=h(n)),"string"==typeof n&&r(n)===t&&(""===(o=R(n,!1))&&(o=e.loadFile(n)||""),n=o),a=r(n),!d(a))throw new Error("addImage does not support files of type '"+a+"', please ensure that a plugin for '"+a+"' support is added.");if(!S()||n instanceof Uint8Array||(n=T(n)),!(i=this["process"+a.toUpperCase()](n)))throw new Error("An unknown error occurred whilst processing the image");return i.fileType=a,i}}(xa.API),function(e){var t=function(e){if(void 0!==e&&""!=e)return!0};xa.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),e.events.push(["putPage",function(e){for(var n,r,i,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,s=this.internal.getPageInfoByObjId(e.objId),c=e.pageContext.annotations,l=!1,d=0;d<c.length&&!l;d++)switch((n=c[d]).type){case"link":(t(n.options.url)||t(n.options.pageNumber))&&(l=!0);break;case"reference":case"text":case"freetext":l=!0}if(0!=l){this.internal.write("/Annots [");for(var u=0;u<c.length;u++){n=c[u];var h=this.internal.pdfEscape,p=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var f=this.internal.newAdditionalObject(),m=this.internal.newAdditionalObject(),_=this.internal.getEncryptor(f.objId),g=n.title||"Note";i="<</Type /Annot /Subtype /Text "+(r="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+h(_(n.contents))+")",i+=" /Popup "+m.objId+" 0 R",i+=" /P "+s.objId+" 0 R",i+=" /T ("+h(_(g))+") >>",f.content=i;var E=f.objId+" 0 R";i="<</Type /Annot /Subtype /Popup "+(r="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+E,n.open&&(i+=" /Open true"),i+=" >>",m.content=i,this.internal.write(f.objId,"0 R",m.objId,"0 R");break;case"freetext":r="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var v=n.color||"#000000";i="<</Type /Annot /Subtype /FreeText "+r+"/Contents ("+h(p(n.contents))+")",i+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+v+")",i+=" /Border [0 0 0]",i+=" >>",this.internal.write(i);break;case"link":if(n.options.name){var y=this.annotations._nameMap[n.options.name];n.options.pageNumber=y.page,n.options.top=y.y}else n.options.top||(n.options.top=0);if(r="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",i="",n.options.url)i="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /A <</S /URI /URI ("+h(p(n.options.url))+") >>";else if(n.options.pageNumber)switch(i="<</Type /Annot /Subtype /Link "+r+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":i+=" /Fit]";break;case"FitH":i+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,i+=" /FitV "+n.options.left+"]";break;default:var S=o(n.options.top);n.options.left=n.options.left||0,void 0===n.options.zoom&&(n.options.zoom=0),i+=" /XYZ "+n.options.left+" "+S+" "+n.options.zoom+"]"}""!=i&&(i+=" >>",this.internal.write(i))}}this.internal.write("]")}}]),e.createAnnotation=function(e){var t=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":t.pageContext.annotations.push(e)}},e.link=function(e,t,n,r,i){var a=this.internal.getCurrentPageInfo(),o=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString;a.pageContext.annotations.push({finalBounds:{x:o(e),y:s(t),w:o(e+n),h:s(t+r)},options:i,type:"link"})},e.textWithLink=function(e,t,n,r){var i,a,o=this.getTextWidth(e),s=this.internal.getLineHeight()/this.internal.scaleFactor;if(void 0!==r.maxWidth){a=r.maxWidth;var c=this.splitTextToSize(e,a).length;i=Math.ceil(s*c)}else a=o,i=s;return this.text(e,t,n,r),n+=.2*s,"center"===r.align&&(t-=o/2),"right"===r.align&&(t-=o),this.link(t,n-s,a,i,r),o},e.getTextWidth=function(e){var t=this.internal.getFontSize();return this.getStringUnitWidth(e)*t/this.internal.scaleFactor}}(xa.API),function(e){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},n={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];e.__arabicParser__={};var a=e.__arabicParser__.isInArabicSubstitutionA=function(e){return void 0!==t[e.charCodeAt(0)]},o=e.__arabicParser__.isArabicLetter=function(e){return"string"==typeof e&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(e)},s=e.__arabicParser__.isArabicEndLetter=function(e){return o(e)&&a(e)&&t[e.charCodeAt(0)].length<=2},c=e.__arabicParser__.isArabicAlfLetter=function(e){return o(e)&&i.indexOf(e.charCodeAt(0))>=0};e.__arabicParser__.arabicLetterHasIsolatedForm=function(e){return o(e)&&a(e)&&t[e.charCodeAt(0)].length>=1};var l=e.__arabicParser__.arabicLetterHasFinalForm=function(e){return o(e)&&a(e)&&t[e.charCodeAt(0)].length>=2};e.__arabicParser__.arabicLetterHasInitialForm=function(e){return o(e)&&a(e)&&t[e.charCodeAt(0)].length>=3};var d=e.__arabicParser__.arabicLetterHasMedialForm=function(e){return o(e)&&a(e)&&4==t[e.charCodeAt(0)].length},u=e.__arabicParser__.resolveLigatures=function(e){var t=0,r=n,i="",a=0;for(t=0;t<e.length;t+=1)void 0!==r[e.charCodeAt(t)]?(a++,"number"==typeof(r=r[e.charCodeAt(t)])&&(i+=String.fromCharCode(r),r=n,a=0),t===e.length-1&&(r=n,i+=e.charAt(t-(a-1)),t-=a-1,a=0)):(r=n,i+=e.charAt(t-a),t-=a,a=0);return i};e.__arabicParser__.isArabicDiacritic=function(e){return void 0!==e&&void 0!==r[e.charCodeAt(0)]};var h=e.__arabicParser__.getCorrectForm=function(e,t,n){return o(e)?!1===a(e)?-1:!l(e)||!o(t)&&!o(n)||!o(n)&&s(t)||s(e)&&!o(t)||s(e)&&c(t)||s(e)&&s(t)?0:d(e)&&o(t)&&!s(t)&&o(n)&&l(n)?3:s(e)||!o(n)?1:2:-1},p=function(e){var n=0,r=0,i=0,a="",s="",c="",l=(e=e||"").split("\\s+"),d=[];for(n=0;n<l.length;n+=1){for(d.push(""),r=0;r<l[n].length;r+=1)a=l[n][r],s=l[n][r-1],c=l[n][r+1],o(a)?(i=h(a,s,c),d[n]+=-1!==i?String.fromCharCode(t[a.charCodeAt(0)][i]):a):d[n]+=a;d[n]=u(d[n])}return d.join(" ")},f=e.__arabicParser__.processArabic=e.processArabic=function(){var e,t="string"==typeof arguments[0]?arguments[0]:arguments[0].text,n=[];if(Array.isArray(t)){var r=0;for(n=[],r=0;r<t.length;r+=1)Array.isArray(t[r])?n.push([p(t[r][0]),t[r][1],t[r][2]]):n.push([p(t[r])]);e=n}else e=p(t);return"string"==typeof arguments[0]?e:(arguments[0].text=e,arguments[0])};e.events.push(["preProcessText",f])}(xa.API),xa.API.autoPrint=function(e){var t;if("javascript"===((e=e||{}).variant=e.variant||"non-conform",e.variant))this.addJS("print({});");else this.internal.events.subscribe("postPutResources",(function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){this.internal.out("/OpenAction "+t+" 0 R")}));return this},function(e){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(t){e=t}});var t=150;Object.defineProperty(this,"width",{get:function(){return t},set:function(e){t=isNaN(e)||!1===Number.isInteger(e)||e<0?150:e,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=t+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(e){n=isNaN(e)||!1===Number.isInteger(e)||e<0?300:e,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var r=[];Object.defineProperty(this,"childNodes",{get:function(){return r},set:function(e){r=e}});var i={};Object.defineProperty(this,"style",{get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,t){var n;if("2d"!==(e=e||"2d"))return null;for(n in t)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=t[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},e.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])}(xa.API),function(e){var t={left:0,top:0,bottom:0,right:0},n=!1,r=function(){void 0===this.internal.__cell__&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new a,this.internal.__cell__.pages=1},a=function(){var e=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return e},set:function(t){e=t}});var t=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return t},set:function(e){t=e}});var n=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return n},set:function(e){n=e}});var r=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return r},set:function(e){r=e}});var i=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return i},set:function(e){i=e}});var a=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return a},set:function(e){a=e}});var o=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return o},set:function(e){o=e}}),this};a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},a.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},e.setHeaderFunction=function(e){return r.call(this),this.internal.__cell__.headerFunction="function"==typeof e?e:void 0,this},e.getTextDimensions=function(e,t){r.call(this);var n=(t=t||{}).fontSize||this.getFontSize(),i=t.font||this.getFont(),a=t.scaleFactor||this.internal.scaleFactor,o=0,s=0,c=0,l=this;if(!Array.isArray(e)&&"string"!=typeof e){if("number"!=typeof e)throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");e=String(e)}var d=t.maxWidth;d>0?"string"==typeof e?e=this.splitTextToSize(e,d):"[object Array]"===Object.prototype.toString.call(e)&&(e=e.reduce((function(e,t){return e.concat(l.splitTextToSize(t,d))}),[])):e=Array.isArray(e)?e:[e];for(var u=0;u<e.length;u++)o<(c=this.getStringUnitWidth(e[u],{font:i})*n)&&(o=c);return 0!==o&&(s=e.length),{w:o/=a,h:Math.max((s*n*this.getLineHeightFactor()-n*(this.getLineHeightFactor()-1))/a,0)}},e.cellAddPage=function(){r.call(this),this.addPage();var e=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new a(e.left,e.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var o=e.cell=function(){var e;e=arguments[0]instanceof a?arguments[0]:new a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var i=this.internal.__cell__.lastCell,o=this.internal.__cell__.padding,s=this.internal.__cell__.margins||t,c=this.internal.__cell__.tableHeaderRow,l=this.internal.__cell__.printHeaders;return void 0!==i.lineNumber&&(i.lineNumber===e.lineNumber?(e.x=(i.x||0)+(i.width||0),e.y=i.y||0):i.y+i.height+e.height+s.bottom>this.getPageHeight()?(this.cellAddPage(),e.y=s.top,l&&c&&(this.printHeaderRow(e.lineNumber,!0),e.y+=c[0].height)):e.y=i.y+i.height||e.y),void 0!==e.text[0]&&(this.rect(e.x,e.y,e.width,e.height,!0===n?"FD":void 0),"right"===e.align?this.text(e.text,e.x+e.width-o,e.y+o,{align:"right",baseline:"top"}):"center"===e.align?this.text(e.text,e.x+e.width/2,e.y+o,{align:"center",baseline:"top",maxWidth:e.width-o-o}):this.text(e.text,e.x+o,e.y+o,{align:"left",baseline:"top",maxWidth:e.width-o-o})),this.internal.__cell__.lastCell=e,this};e.table=function(e,n,c,l,d){if(r.call(this),!c)throw new Error("No data for PDF table.");var u,h,p,f,m=[],_=[],g=[],E={},v={},y=[],S=[],b=(d=d||{}).autoSize||!1,T=!1!==d.printHeaders,C=d.css&&void 0!==d.css["font-size"]?16*d.css["font-size"]:d.fontSize||12,w=d.margins||Object.assign({width:this.getPageWidth()},t),R="number"==typeof d.padding?d.padding:3,A=d.headerBackgroundColor||"#c8c8c8",I=d.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=T,this.internal.__cell__.margins=w,this.internal.__cell__.table_font_size=C,this.internal.__cell__.padding=R,this.internal.__cell__.headerBackgroundColor=A,this.internal.__cell__.headerTextColor=I,this.setFontSize(C),null==l)_=m=Object.keys(c[0]),g=m.map((function(){return"left"}));else if(Array.isArray(l)&&"object"===(0,ai.A)(l[0]))for(m=l.map((function(e){return e.name})),_=l.map((function(e){return e.prompt||e.name||""})),g=l.map((function(e){return e.align||"left"})),u=0;u<l.length;u+=1)v[l[u].name]=l[u].width*(19.049976/25.4);else Array.isArray(l)&&"string"==typeof l[0]&&(_=m=l,g=m.map((function(){return"left"})));if(b||Array.isArray(l)&&"string"==typeof l[0])for(u=0;u<m.length;u+=1){for(E[f=m[u]]=c.map((function(e){return e[f]})),this.setFont(void 0,"bold"),y.push(this.getTextDimensions(_[u],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),h=E[f],this.setFont(void 0,"normal"),p=0;p<h.length;p+=1)y.push(this.getTextDimensions(h[p],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);v[f]=Math.max.apply(null,y)+R+R,y=[]}if(T){var N={};for(u=0;u<m.length;u+=1)N[m[u]]={},N[m[u]].text=_[u],N[m[u]].align=g[u];var O=s.call(this,N,v);S=m.map((function(t){return new a(e,n,v[t],O,N[t].text,void 0,N[t].align)})),this.setTableHeaderRow(S),this.printHeaderRow(1,!1)}var P=l.reduce((function(e,t){return e[t.name]=t.align,e}),{});for(u=0;u<c.length;u+=1){"rowStart"in d&&d.rowStart instanceof Function&&d.rowStart({row:u,data:c[u]},this);var L=s.call(this,c[u],v);for(p=0;p<m.length;p+=1){var D=c[u][m[p]];"cellStart"in d&&d.cellStart instanceof Function&&d.cellStart({row:u,col:p,data:D},this),o.call(this,new a(e,n,v[m[p]],L,D,u+2,P[m[p]]))}}return this.internal.__cell__.table_x=e,this.internal.__cell__.table_y=n,this};var s=function(e,t){var n=this.internal.__cell__.padding,r=this.internal.__cell__.table_font_size,i=this.internal.scaleFactor;return Object.keys(e).map((function(r){var i=e[r];return this.splitTextToSize(i.hasOwnProperty("text")?i.text:i,t[r]-n-n)}),this).map((function(e){return this.getLineHeightFactor()*e.length*r/i+n+n}),this).reduce((function(e,t){return Math.max(e,t)}),0)};e.setTableHeaderRow=function(e){r.call(this),this.internal.__cell__.tableHeaderRow=e},e.printHeaderRow=function(e,t){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var i;if(n=!0,"function"==typeof this.internal.__cell__.headerFunction){var s=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new a(s[0],s[1],s[2],s[3],void 0,-1)}this.setFont(void 0,"bold");for(var c=[],l=0;l<this.internal.__cell__.tableHeaderRow.length;l+=1){i=this.internal.__cell__.tableHeaderRow[l].clone(),t&&(i.y=this.internal.__cell__.margins.top||0,c.push(i)),i.lineNumber=e;var d=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),o.call(this,i),this.setTextColor(d)}c.length>0&&this.setTableHeaderRow(c),this.setFont(void 0,"normal"),n=!1}}(xa.API);var wo={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Ro=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Ao=Co(Ro),Io=[100,200,300,400,500,600,700,800,900],No=Co(Io);function Oo(e){var t=e.family.replace(/"|'/g,"").toLowerCase(),n=function(e){return wo[e=e||"normal"]?e:"normal"}(e.style),r=function(e){return e?"number"==typeof e?e>=100&&e<=900&&e%100==0?e:400:/^\d00$/.test(e)?parseInt(e):"bold"===e?700:400:400}(e.weight),i=function(e){return"number"==typeof Ao[e=e||"normal"]?e:"normal"}(e.stretch);return{family:t,style:n,weight:r,stretch:i,src:e.src||[],ref:e.ref||{name:t,style:[i,n,r].join(" ")}}}function Po(e,t,n,r){var i;for(i=n;i>=0&&i<t.length;i+=r)if(e[t[i]])return e[t[i]];for(i=n;i>=0&&i<t.length;i-=r)if(e[t[i]])return e[t[i]]}var Lo={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Do={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function ko(e){return[e.stretch,e.style,e.weight,e.family].join(" ")}function xo(e){return e.trimLeft()}function Mo(e,t){for(var n=0;n<e.length;){if(e.charAt(n)===t)return[e.substring(0,n),e.substring(n+1)];n+=1}return null}function Uo(e){var t=e.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return null===t?null:[t[0],e.substring(t[0].length)]}var Fo,jo,Vo,Bo,Go=["times"];!function(e){var t,n,r,i,a,o,s,c,l,d=function(e){return e=e||{},this.isStrokeTransparent=e.isStrokeTransparent||!1,this.strokeOpacity=e.strokeOpacity||1,this.strokeStyle=e.strokeStyle||"#000000",this.fillStyle=e.fillStyle||"#000000",this.isFillTransparent=e.isFillTransparent||!1,this.fillOpacity=e.fillOpacity||1,this.font=e.font||"10px sans-serif",this.textBaseline=e.textBaseline||"alphabetic",this.textAlign=e.textAlign||"left",this.lineWidth=e.lineWidth||1,this.lineJoin=e.lineJoin||"miter",this.lineCap=e.lineCap||"butt",this.path=e.path||[],this.transform=void 0!==e.transform?e.transform.clone():new c,this.globalCompositeOperation=e.globalCompositeOperation||"normal",this.globalAlpha=e.globalAlpha||1,this.clip_path=e.clip_path||[],this.currentPoint=e.currentPoint||new o,this.miterLimit=e.miterLimit||10,this.lastPoint=e.lastPoint||new o,this.lineDashOffset=e.lineDashOffset||0,this.lineDash=e.lineDash||[],this.margin=e.margin||[0,0,0,0],this.prevPageLastElemOffset=e.prevPageLastElemOffset||0,this.ignoreClearRect="boolean"!=typeof e.ignoreClearRect||e.ignoreClearRect,this};e.events.push(["initialized",function(){this.context2d=new u(this),t=this.internal.f2,n=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,a=this.internal.getVerticalCoordinate,o=this.internal.Point,s=this.internal.Rectangle,c=this.internal.Matrix,l=new d}]);var u=function(e){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var t=e;Object.defineProperty(this,"pdf",{get:function(){return t}});var n=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return n},set:function(e){n=Boolean(e)}});var r=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return r},set:function(e){r=Boolean(e)}});var i=0;Object.defineProperty(this,"posX",{get:function(){return i},set:function(e){isNaN(e)||(i=e)}});var a=0;Object.defineProperty(this,"posY",{get:function(){return a},set:function(e){isNaN(e)||(a=e)}}),Object.defineProperty(this,"margin",{get:function(){return l.margin},set:function(e){var t;"number"==typeof e?t=[e,e,e,e]:((t=new Array(4))[0]=e[0],t[1]=e.length>=2?e[1]:t[0],t[2]=e.length>=3?e[2]:t[0],t[3]=e.length>=4?e[3]:t[1]),l.margin=t}});var o=!1;Object.defineProperty(this,"autoPaging",{get:function(){return o},set:function(e){o=e}});var s=0;Object.defineProperty(this,"lastBreak",{get:function(){return s},set:function(e){s=e}});var c=[];Object.defineProperty(this,"pageBreaks",{get:function(){return c},set:function(e){c=e}}),Object.defineProperty(this,"ctx",{get:function(){return l},set:function(e){e instanceof d&&(l=e)}}),Object.defineProperty(this,"path",{get:function(){return l.path},set:function(e){l.path=e}});var u=[];Object.defineProperty(this,"ctxStack",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(e){var t;t=h(e),this.ctx.fillStyle=t.style,this.ctx.isFillTransparent=0===t.a,this.ctx.fillOpacity=t.a,this.pdf.setFillColor(t.r,t.g,t.b,{a:t.a}),this.pdf.setTextColor(t.r,t.g,t.b,{a:t.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(e){var t=h(e);this.ctx.strokeStyle=t.style,this.ctx.isStrokeTransparent=0===t.a,this.ctx.strokeOpacity=t.a,0===t.a?this.pdf.setDrawColor(255,255,255):(t.a,this.pdf.setDrawColor(t.r,t.g,t.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(e){-1!==["butt","round","square"].indexOf(e)&&(this.ctx.lineCap=e,this.pdf.setLineCap(e))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(e){isNaN(e)||(this.ctx.lineWidth=e,this.pdf.setLineWidth(e))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(e){-1!==["bevel","round","miter"].indexOf(e)&&(this.ctx.lineJoin=e,this.pdf.setLineJoin(e))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(e){isNaN(e)||(this.ctx.miterLimit=e,this.pdf.setMiterLimit(e))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(e){this.ctx.textBaseline=e}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(e){-1!==["right","end","center","left","start"].indexOf(e)&&(this.ctx.textAlign=e)}});var p=null;function f(e,t){if(null===p){var n=function(e){var t=[];return Object.keys(e).forEach((function(n){e[n].forEach((function(e){var r=null;switch(e){case"bold":r={family:n,weight:"bold"};break;case"italic":r={family:n,style:"italic"};break;case"bolditalic":r={family:n,weight:"bold",style:"italic"};break;case"":case"normal":r={family:n}}null!==r&&(r.ref={name:n,style:e},t.push(r))}))})),t}(e.getFontList());p=function(e){for(var t={},n=0;n<e.length;++n){var r=Oo(e[n]),i=r.family,a=r.stretch,o=r.style,s=r.weight;t[i]=t[i]||{},t[i][a]=t[i][a]||{},t[i][a][o]=t[i][a][o]||{},t[i][a][o][s]=r}return t}(n.concat(t))}return p}var m=null;Object.defineProperty(this,"fontFaces",{get:function(){return m},set:function(e){p=null,m=e}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(e){var t;if(this.ctx.font=e,null!==(t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(e))){var n=t[1],r=(t[2],t[3]),i=t[4],a=(t[5],t[6]),o=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(i)[2];i="px"===o?Math.floor(parseFloat(i)*this.pdf.internal.scaleFactor):"em"===o?Math.floor(parseFloat(i)*this.pdf.getFontSize()):Math.floor(parseFloat(i)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(i);var s=function(e){var t,n,r=[],i=e.trim();if(""===i)return Go;if(i in Do)return[Do[i]];for(;""!==i;){switch(n=null,t=(i=xo(i)).charAt(0)){case'"':case"'":n=Mo(i.substring(1),t);break;default:n=Uo(i)}if(null===n)return Go;if(r.push(n[0]),""!==(i=xo(n[1]))&&","!==i.charAt(0))return Go;i=i.replace(/^,/,"")}return r}(a);if(this.fontFaces){var c=function(e,t,n){for(var r=(n=n||{}).defaultFontFamily||"times",i=Object.assign({},Lo,n.genericFontFamilies||{}),a=null,o=null,s=0;s<t.length;++s)if(i[(a=Oo(t[s])).family]&&(a.family=i[a.family]),e.hasOwnProperty(a.family)){o=e[a.family];break}if(!(o=o||e[r]))throw new Error("Could not find a font-family for the rule '"+ko(a)+"' and default family '"+r+"'.");if(o=function(e,t){if(t[e])return t[e];var n=Ao[e],r=n<=Ao.normal?-1:1,i=Po(t,Ro,n,r);if(!i)throw new Error("Could not find a matching font-stretch value for "+e);return i}(a.stretch,o),o=function(e,t){if(t[e])return t[e];for(var n=wo[e],r=0;r<n.length;++r)if(t[n[r]])return t[n[r]];throw new Error("Could not find a matching font-style for "+e)}(a.style,o),!(o=function(e,t){if(t[e])return t[e];if(400===e&&t[500])return t[500];if(500===e&&t[400])return t[400];var n=No[e],r=Po(t,Io,n,e<400?-1:1);if(!r)throw new Error("Could not find a matching font-weight for value "+e);return r}(a.weight,o)))throw new Error("Failed to resolve a font for the rule '"+ko(a)+"'.");return o}(f(this.pdf,this.fontFaces),s.map((function(e){return{family:e,stretch:"normal",weight:r,style:n}})));this.pdf.setFont(c.ref.name,c.ref.style)}else{var l="";("bold"===r||parseInt(r,10)>=700||"bold"===n)&&(l="bold"),"italic"===n&&(l+="italic"),0===l.length&&(l="normal");for(var d="",u={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},h=0;h<s.length;h++){if(void 0!==this.pdf.internal.getFont(s[h],l,{noFallback:!0,disableWarning:!0})){d=s[h];break}if("bolditalic"===l&&void 0!==this.pdf.internal.getFont(s[h],"bold",{noFallback:!0,disableWarning:!0}))d=s[h],l="bold";else if(void 0!==this.pdf.internal.getFont(s[h],"normal",{noFallback:!0,disableWarning:!0})){d=s[h],l="normal";break}}if(""===d)for(var p=0;p<s.length;p++)if(u[s[p]]){d=u[s[p]];break}d=""===d?"Times":d,this.pdf.setFont(d,l)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(e){this.ctx.globalCompositeOperation=e}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(e){this.ctx.globalAlpha=e}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(e){this.ctx.lineDashOffset=e,U.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(e){this.ctx.lineDash=e,U.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(e){this.ctx.ignoreClearRect=Boolean(e)}})};u.prototype.setLineDash=function(e){this.lineDash=e},u.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},u.prototype.fill=function(){y.call(this,"fill",!1)},u.prototype.stroke=function(){y.call(this,"stroke",!1)},u.prototype.beginPath=function(){this.path=[{type:"begin"}]},u.prototype.moveTo=function(e,t){if(isNaN(e)||isNaN(t))throw ia.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var n=this.ctx.transform.applyToPoint(new o(e,t));this.path.push({type:"mt",x:n.x,y:n.y}),this.ctx.lastPoint=new o(e,t)},u.prototype.closePath=function(){var e=new o(0,0),t=0;for(t=this.path.length-1;-1!==t;t--)if("begin"===this.path[t].type&&"object"===(0,ai.A)(this.path[t+1])&&"number"==typeof this.path[t+1].x){e=new o(this.path[t+1].x,this.path[t+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new o(e.x,e.y)},u.prototype.lineTo=function(e,t){if(isNaN(e)||isNaN(t))throw ia.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var n=this.ctx.transform.applyToPoint(new o(e,t));this.path.push({type:"lt",x:n.x,y:n.y}),this.ctx.lastPoint=new o(n.x,n.y)},u.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),y.call(this,null,!0)},u.prototype.quadraticCurveTo=function(e,t,n,r){if(isNaN(n)||isNaN(r)||isNaN(e)||isNaN(t))throw ia.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var i=this.ctx.transform.applyToPoint(new o(n,r)),a=this.ctx.transform.applyToPoint(new o(e,t));this.path.push({type:"qct",x1:a.x,y1:a.y,x:i.x,y:i.y}),this.ctx.lastPoint=new o(i.x,i.y)},u.prototype.bezierCurveTo=function(e,t,n,r,i,a){if(isNaN(i)||isNaN(a)||isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw ia.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var s=this.ctx.transform.applyToPoint(new o(i,a)),c=this.ctx.transform.applyToPoint(new o(e,t)),l=this.ctx.transform.applyToPoint(new o(n,r));this.path.push({type:"bct",x1:c.x,y1:c.y,x2:l.x,y2:l.y,x:s.x,y:s.y}),this.ctx.lastPoint=new o(s.x,s.y)},u.prototype.arc=function(e,t,n,r,i,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i))throw ia.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(a=Boolean(a),!this.ctx.transform.isIdentity){var s=this.ctx.transform.applyToPoint(new o(e,t));e=s.x,t=s.y;var c=this.ctx.transform.applyToPoint(new o(0,n)),l=this.ctx.transform.applyToPoint(new o(0,0));n=Math.sqrt(Math.pow(c.x-l.x,2)+Math.pow(c.y-l.y,2))}Math.abs(i-r)>=2*Math.PI&&(r=0,i=2*Math.PI),this.path.push({type:"arc",x:e,y:t,radius:n,startAngle:r,endAngle:i,counterclockwise:a})},u.prototype.arcTo=function(e,t,n,r,i){throw new Error("arcTo not implemented.")},u.prototype.rect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw ia.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+r),this.lineTo(e,t+r),this.lineTo(e,t),this.lineTo(e+n,t),this.lineTo(e,t)},u.prototype.fillRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw ia.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!p.call(this)){var i={};"butt"!==this.lineCap&&(i.lineCap=this.lineCap,this.lineCap="butt"),"miter"!==this.lineJoin&&(i.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(e,t,n,r),this.fill(),i.hasOwnProperty("lineCap")&&(this.lineCap=i.lineCap),i.hasOwnProperty("lineJoin")&&(this.lineJoin=i.lineJoin)}},u.prototype.strokeRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw ia.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");f.call(this)||(this.beginPath(),this.rect(e,t,n,r),this.stroke())},u.prototype.clearRect=function(e,t,n,r){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r))throw ia.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(e,t,n,r))},u.prototype.save=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("q");if(this.pdf.setPage(t),e){this.ctx.fontSize=this.pdf.internal.getFontSize();var r=new d(this.ctx);this.ctxStack.push(this.ctx),this.ctx=r}},u.prototype.restore=function(e){e="boolean"!=typeof e||e;for(var t=this.pdf.internal.getCurrentPageInfo().pageNumber,n=0;n<this.pdf.internal.getNumberOfPages();n++)this.pdf.setPage(n+1),this.pdf.internal.out("Q");this.pdf.setPage(t),e&&0!==this.ctxStack.length&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},u.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var h=function(e){var t,n,r,i;if(!0===e.isCanvasGradient&&(e=e.getColor()),!e)return{r:0,g:0,b:0,a:0,style:e};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(e))t=0,n=0,r=0,i=0;else{var a=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e);if(null!==a)t=parseInt(a[1]),n=parseInt(a[2]),r=parseInt(a[3]),i=1;else if(null!==(a=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(e)))t=parseInt(a[1]),n=parseInt(a[2]),r=parseInt(a[3]),i=parseFloat(a[4]);else{if(i=1,"string"==typeof e&&"#"!==e.charAt(0)){var o=new ua(e);e=o.ok?o.toHex():"#000000"}4===e.length?(t=e.substring(1,2),t+=t,n=e.substring(2,3),n+=n,r=e.substring(3,4),r+=r):(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7)),t=parseInt(t,16),n=parseInt(n,16),r=parseInt(r,16)}}return{r:t,g:n,b:r,a:i,style:e}},p=function(){return this.ctx.isFillTransparent||0==this.globalAlpha},f=function(){return Boolean(this.ctx.isStrokeTransparent||0==this.globalAlpha)};u.prototype.fillText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw ia.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(r=isNaN(r)?void 0:r,!p.call(this)){var i=k(this.ctx.transform.rotation),a=this.ctx.transform.scaleX;I.call(this,{text:e,x:t,y:n,scale:a,angle:i,align:this.textAlign,maxWidth:r})}},u.prototype.strokeText=function(e,t,n,r){if(isNaN(t)||isNaN(n)||"string"!=typeof e)throw ia.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!f.call(this)){r=isNaN(r)?void 0:r;var i=k(this.ctx.transform.rotation),a=this.ctx.transform.scaleX;I.call(this,{text:e,x:t,y:n,scale:a,renderingMode:"stroke",angle:i,align:this.textAlign,maxWidth:r})}},u.prototype.measureText=function(e){if("string"!=typeof e)throw ia.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var t=this.pdf,n=this.pdf.internal.scaleFactor,r=t.internal.getFontSize(),i=t.getStringUnitWidth(e)*r/t.internal.scaleFactor;return new function(e){var t=(e=e||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return t}}),this}({width:i*=Math.round(96*n/72*1e4)/1e4})},u.prototype.scale=function(e,t){if(isNaN(e)||isNaN(t))throw ia.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var n=new c(e,0,0,t,0,0);this.ctx.transform=this.ctx.transform.multiply(n)},u.prototype.rotate=function(e){if(isNaN(e))throw ia.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var t=new c(Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0);this.ctx.transform=this.ctx.transform.multiply(t)},u.prototype.translate=function(e,t){if(isNaN(e)||isNaN(t))throw ia.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var n=new c(1,0,0,1,e,t);this.ctx.transform=this.ctx.transform.multiply(n)},u.prototype.transform=function(e,t,n,r,i,a){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||isNaN(i)||isNaN(a))throw ia.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var o=new c(e,t,n,r,i,a);this.ctx.transform=this.ctx.transform.multiply(o)},u.prototype.setTransform=function(e,t,n,r,i,a){e=isNaN(e)?1:e,t=isNaN(t)?0:t,n=isNaN(n)?0:n,r=isNaN(r)?1:r,i=isNaN(i)?0:i,a=isNaN(a)?0:a,this.ctx.transform=new c(e,t,n,r,i,a)};var m=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};u.prototype.drawImage=function(e,t,n,r,i,a,o,l,d){var u=this.pdf.getImageProperties(e),h=1,p=1,f=1,g=1;void 0!==r&&void 0!==l&&(f=l/r,g=d/i,h=u.width/r*l/r,p=u.height/i*d/i),void 0===a&&(a=t,o=n,t=0,n=0),void 0!==r&&void 0===l&&(l=r,d=i),void 0===r&&void 0===l&&(l=u.width,d=u.height);for(var y,b=this.ctx.transform.decompose(),T=k(b.rotate.shx),C=new c,w=(C=(C=(C=C.multiply(b.translate)).multiply(b.skew)).multiply(b.scale)).applyToRectangle(new s(a-t*f,o-n*g,r*h,i*p)),R=_.call(this,w),A=[],I=0;I<R.length;I+=1)-1===A.indexOf(R[I])&&A.push(R[I]);if(v(A),this.autoPaging)for(var N=A[0],O=A[A.length-1],P=N;P<O+1;P++){this.pdf.setPage(P);var L=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],D=1===P?this.posY+this.margin[0]:this.margin[0],x=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],M=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],U=1===P?0:x+(P-2)*M;if(0!==this.ctx.clip_path.length){var F=this.path;y=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=E(y,this.posX+this.margin[3],-U+D+this.ctx.prevPageLastElemOffset),S.call(this,"fill",!0),this.path=F}var j=JSON.parse(JSON.stringify(w));j=E([j],this.posX+this.margin[3],-U+D+this.ctx.prevPageLastElemOffset)[0];var V=(P>N||P<O)&&m.call(this);V&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],L,M,null).clip().discardPath()),this.pdf.addImage(e,"JPEG",j.x,j.y,j.w,j.h,null,null,T),V&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(e,"JPEG",w.x,w.y,w.w,w.h,null,null,T)};var _=function(e,t,n){var r=[];t=t||this.pdf.internal.pageSize.width,n=n||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var i=this.posY+this.ctx.prevPageLastElemOffset;switch(e.type){default:case"mt":case"lt":r.push(Math.floor((e.y+i)/n)+1);break;case"arc":r.push(Math.floor((e.y+i-e.radius)/n)+1),r.push(Math.floor((e.y+i+e.radius)/n)+1);break;case"qct":var a=x(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x,e.y);r.push(Math.floor((a.y+i)/n)+1),r.push(Math.floor((a.y+a.h+i)/n)+1);break;case"bct":var o=M(this.ctx.lastPoint.x,this.ctx.lastPoint.y,e.x1,e.y1,e.x2,e.y2,e.x,e.y);r.push(Math.floor((o.y+i)/n)+1),r.push(Math.floor((o.y+o.h+i)/n)+1);break;case"rect":r.push(Math.floor((e.y+i)/n)+1),r.push(Math.floor((e.y+e.h+i)/n)+1)}for(var s=0;s<r.length;s+=1)for(;this.pdf.internal.getNumberOfPages()<r[s];)g.call(this);return r},g=function(){var e=this.fillStyle,t=this.strokeStyle,n=this.font,r=this.lineCap,i=this.lineWidth,a=this.lineJoin;this.pdf.addPage(),this.fillStyle=e,this.strokeStyle=t,this.font=n,this.lineCap=r,this.lineWidth=i,this.lineJoin=a},E=function(e,t,n){for(var r=0;r<e.length;r++)switch(e[r].type){case"bct":e[r].x2+=t,e[r].y2+=n;case"qct":e[r].x1+=t,e[r].y1+=n;default:e[r].x+=t,e[r].y+=n}return e},v=function(e){return e.sort((function(e,t){return e-t}))},y=function(e,t){for(var n,r,i=this.fillStyle,a=this.strokeStyle,o=this.lineCap,s=this.lineWidth,c=Math.abs(s*this.ctx.transform.scaleX),l=this.lineJoin,d=JSON.parse(JSON.stringify(this.path)),u=JSON.parse(JSON.stringify(this.path)),h=[],p=0;p<u.length;p++)if(void 0!==u[p].x)for(var f=_.call(this,u[p]),y=0;y<f.length;y+=1)-1===h.indexOf(f[y])&&h.push(f[y]);for(var b=0;b<h.length;b++)for(;this.pdf.internal.getNumberOfPages()<h[b];)g.call(this);if(v(h),this.autoPaging)for(var T=h[0],C=h[h.length-1],w=T;w<C+1;w++){this.pdf.setPage(w),this.fillStyle=i,this.strokeStyle=a,this.lineCap=o,this.lineWidth=c,this.lineJoin=l;var R=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],A=1===w?this.posY+this.margin[0]:this.margin[0],I=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],N=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],O=1===w?0:I+(w-2)*N;if(0!==this.ctx.clip_path.length){var P=this.path;n=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=E(n,this.posX+this.margin[3],-O+A+this.ctx.prevPageLastElemOffset),S.call(this,e,!0),this.path=P}if(r=JSON.parse(JSON.stringify(d)),this.path=E(r,this.posX+this.margin[3],-O+A+this.ctx.prevPageLastElemOffset),!1===t||0===w){var L=(w>T||w<C)&&m.call(this);L&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],R,N,null).clip().discardPath()),S.call(this,e,t),L&&this.pdf.restoreGraphicsState()}this.lineWidth=s}else this.lineWidth=c,S.call(this,e,t),this.lineWidth=s;this.path=d},S=function(e,t){if(("stroke"!==e||t||!f.call(this))&&("stroke"===e||t||!p.call(this))){for(var n,r,i=[],a=this.path,o=0;o<a.length;o++){var s=a[o];switch(s.type){case"begin":i.push({begin:!0});break;case"close":i.push({close:!0});break;case"mt":i.push({start:s,deltas:[],abs:[]});break;case"lt":var c=i.length;if(a[o-1]&&!isNaN(a[o-1].x)&&(n=[s.x-a[o-1].x,s.y-a[o-1].y],c>0))for(;c>=0;c--)if(!0!==i[c-1].close&&!0!==i[c-1].begin){i[c-1].deltas.push(n),i[c-1].abs.push(s);break}break;case"bct":n=[s.x1-a[o-1].x,s.y1-a[o-1].y,s.x2-a[o-1].x,s.y2-a[o-1].y,s.x-a[o-1].x,s.y-a[o-1].y],i[i.length-1].deltas.push(n);break;case"qct":var l=a[o-1].x+2/3*(s.x1-a[o-1].x),d=a[o-1].y+2/3*(s.y1-a[o-1].y),u=s.x+2/3*(s.x1-s.x),h=s.y+2/3*(s.y1-s.y),m=s.x,_=s.y;n=[l-a[o-1].x,d-a[o-1].y,u-a[o-1].x,h-a[o-1].y,m-a[o-1].x,_-a[o-1].y],i[i.length-1].deltas.push(n);break;case"arc":i.push({deltas:[],abs:[],arc:!0}),Array.isArray(i[i.length-1].abs)&&i[i.length-1].abs.push(s)}}r=t?null:"stroke"===e?"stroke":"fill";for(var g=!1,E=0;E<i.length;E++)if(i[E].arc)for(var v=i[E].abs,y=0;y<v.length;y++){var S=v[y];"arc"===S.type?C.call(this,S.x,S.y,S.radius,S.startAngle,S.endAngle,S.counterclockwise,void 0,t,!g):N.call(this,S.x,S.y),g=!0}else if(!0===i[E].close)this.pdf.internal.out("h"),g=!1;else if(!0!==i[E].begin){var b=i[E].start.x,T=i[E].start.y;O.call(this,i[E].deltas,b,T),g=!0}r&&w.call(this,r),t&&R.call(this)}},b=function(e){var t=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,n=t*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return e-n;case"top":return e+t-n;case"hanging":return e+t-2*n;case"middle":return e+t/2-n;default:return e}},T=function(e){return e+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};u.prototype.createLinearGradient=function(){var e=function(){};return e.colorStops=[],e.addColorStop=function(e,t){this.colorStops.push([e,t])},e.getColor=function(){return 0===this.colorStops.length?"#000000":this.colorStops[0][1]},e.isCanvasGradient=!0,e},u.prototype.createPattern=function(){return this.createLinearGradient()},u.prototype.createRadialGradient=function(){return this.createLinearGradient()};var C=function(e,t,n,r,i,a,o,s,c){for(var l=L.call(this,n,r,i,a),d=0;d<l.length;d++){var u=l[d];0===d&&(c?A.call(this,u.x1+e,u.y1+t):N.call(this,u.x1+e,u.y1+t)),P.call(this,e,t,u.x2,u.y2,u.x3,u.y3,u.x4,u.y4)}s?R.call(this):w.call(this,o)},w=function(e){switch(e){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},R=function(){this.pdf.clip(),this.pdf.discardPath()},A=function(e,t){this.pdf.internal.out(n(e)+" "+r(t)+" m")},I=function(e){var t;switch(e.align){case"right":case"end":t="right";break;case"center":t="center";break;default:t="left"}var n=this.pdf.getTextDimensions(e.text),r=b.call(this,e.y),i=T.call(this,r)-n.h,a=this.ctx.transform.applyToPoint(new o(e.x,r)),l=this.ctx.transform.decompose(),d=new c;d=(d=(d=d.multiply(l.translate)).multiply(l.skew)).multiply(l.scale);for(var u,h,p,f=this.ctx.transform.applyToRectangle(new s(e.x,r,n.w,n.h)),g=d.applyToRectangle(new s(e.x,i,n.w,n.h)),y=_.call(this,g),C=[],w=0;w<y.length;w+=1)-1===C.indexOf(y[w])&&C.push(y[w]);if(v(C),this.autoPaging)for(var R=C[0],A=C[C.length-1],I=R;I<A+1;I++){this.pdf.setPage(I);var N=1===I?this.posY+this.margin[0]:this.margin[0],O=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],P=this.pdf.internal.pageSize.height-this.margin[2],L=P-this.margin[0],D=this.pdf.internal.pageSize.width-this.margin[1],k=D-this.margin[3],x=1===I?0:O+(I-2)*L;if(0!==this.ctx.clip_path.length){var M=this.path;u=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=E(u,this.posX+this.margin[3],-1*x+N),S.call(this,"fill",!0),this.path=M}var U=E([JSON.parse(JSON.stringify(g))],this.posX+this.margin[3],-x+N+this.ctx.prevPageLastElemOffset)[0];e.scale>=.01&&(h=this.pdf.internal.getFontSize(),this.pdf.setFontSize(h*e.scale),p=this.lineWidth,this.lineWidth=p*e.scale);var F="text"!==this.autoPaging;if(F||U.y+U.h<=P){if(F||U.y>=N&&U.x<=D){var j=F?e.text:this.pdf.splitTextToSize(e.text,e.maxWidth||D-U.x)[0],V=E([JSON.parse(JSON.stringify(f))],this.posX+this.margin[3],-x+N+this.ctx.prevPageLastElemOffset)[0],B=F&&(I>R||I<A)&&m.call(this);B&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],k,L,null).clip().discardPath()),this.pdf.text(j,V.x,V.y,{angle:e.angle,align:t,renderingMode:e.renderingMode}),B&&this.pdf.restoreGraphicsState()}}else U.y<P&&(this.ctx.prevPageLastElemOffset+=P-U.y);e.scale>=.01&&(this.pdf.setFontSize(h),this.lineWidth=p)}else e.scale>=.01&&(h=this.pdf.internal.getFontSize(),this.pdf.setFontSize(h*e.scale),p=this.lineWidth,this.lineWidth=p*e.scale),this.pdf.text(e.text,a.x+this.posX,a.y+this.posY,{angle:e.angle,align:t,renderingMode:e.renderingMode,maxWidth:e.maxWidth}),e.scale>=.01&&(this.pdf.setFontSize(h),this.lineWidth=p)},N=function(e,t,i,a){i=i||0,a=a||0,this.pdf.internal.out(n(e+i)+" "+r(t+a)+" l")},O=function(e,t,n){return this.pdf.lines(e,t,n,null,null)},P=function(e,n,r,o,s,c,l,d){this.pdf.internal.out([t(i(r+e)),t(a(o+n)),t(i(s+e)),t(a(c+n)),t(i(l+e)),t(a(d+n)),"c"].join(" "))},L=function(e,t,n,r){for(var i=2*Math.PI,a=Math.PI/2;t>n;)t-=i;var o=Math.abs(n-t);o<i&&r&&(o=i-o);for(var s=[],c=r?-1:1,l=t;o>1e-5;){var d=l+c*Math.min(o,a);s.push(D.call(this,e,l,d)),o-=Math.abs(d-l),l=d}return s},D=function(e,t,n){var r=(n-t)/2,i=e*Math.cos(r),a=e*Math.sin(r),o=i,s=-a,c=o*o+s*s,l=c+o*i+s*a,d=4/3*(Math.sqrt(2*c*l)-l)/(o*a-s*i),u=o-d*s,h=s+d*o,p=u,f=-h,m=r+t,_=Math.cos(m),g=Math.sin(m);return{x1:e*Math.cos(t),y1:e*Math.sin(t),x2:u*_-h*g,y2:u*g+h*_,x3:p*_-f*g,y3:p*g+f*_,x4:e*Math.cos(n),y4:e*Math.sin(n)}},k=function(e){return 180*e/Math.PI},x=function(e,t,n,r,i,a){var o=e+.5*(n-e),c=t+.5*(r-t),l=i+.5*(n-i),d=a+.5*(r-a),u=Math.min(e,i,o,l),h=Math.max(e,i,o,l),p=Math.min(t,a,c,d),f=Math.max(t,a,c,d);return new s(u,p,h-u,f-p)},M=function(e,t,n,r,i,a,o,c){var l,d,u,h,p,f,m,_,g,E,v,y,S,b,T=n-e,C=r-t,w=i-n,R=a-r,A=o-i,I=c-a;for(d=0;d<41;d++)g=(m=(u=e+(l=d/40)*T)+l*((p=n+l*w)-u))+l*(p+l*(i+l*A-p)-m),E=(_=(h=t+l*C)+l*((f=r+l*R)-h))+l*(f+l*(a+l*I-f)-_),0==d?(v=g,y=E,S=g,b=E):(v=Math.min(v,g),y=Math.min(y,E),S=Math.max(S,g),b=Math.max(b,E));return new s(Math.round(v),Math.round(y),Math.round(S-v),Math.round(b-y))},U=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var e,t,n=(e=this.ctx.lineDash,t=this.ctx.lineDashOffset,JSON.stringify({lineDash:e,lineDashOffset:t}));this.prevLineDash!==n&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=n)}}}(xa.API),function(e){var t=function(e){var t,n,r,i,a,o,s,c,l,d;for(/[^\x00-\xFF]/.test(e),n=[],r=0,i=(e+=t="\0\0\0\0".slice(e.length%4||4)).length;i>r;r+=4)0!==(a=(e.charCodeAt(r)<<24)+(e.charCodeAt(r+1)<<16)+(e.charCodeAt(r+2)<<8)+e.charCodeAt(r+3))?(o=(a=((a=((a=((a=(a-(d=a%85))/85)-(l=a%85))/85)-(c=a%85))/85)-(s=a%85))/85)%85,n.push(o+33,s+33,c+33,l+33,d+33)):n.push(122);return function(e,t){for(var n=t;n>0;n--)e.pop()}(n,t.length),String.fromCharCode.apply(String,n)+"~>"},n=function(e){var t,n,r,i,a,o=String,s="length",c=255,l="charCodeAt",d="slice",u="replace";for(e[d](-2),e=e[d](0,-2)[u](/\s/g,"")[u]("z","!!!!!"),r=[],i=0,a=(e+=t="uuuuu"[d](e[s]%5||5))[s];a>i;i+=5)n=52200625*(e[l](i)-33)+614125*(e[l](i+1)-33)+7225*(e[l](i+2)-33)+85*(e[l](i+3)-33)+(e[l](i+4)-33),r.push(c&n>>24,c&n>>16,c&n>>8,c&n);return function(e,t){for(var n=t;n>0;n--)e.pop()}(r,t[s]),o.fromCharCode.apply(o,r)},r=function(e){var t=new RegExp(/^([0-9A-Fa-f]{2})+$/);if(-1!==(e=e.replace(/\s/g,"")).indexOf(">")&&(e=e.substr(0,e.indexOf(">"))),e.length%2&&(e+="0"),!1===t.test(e))return"";for(var n="",r=0;r<e.length;r+=2)n+=String.fromCharCode("0x"+(e[r]+e[r+1]));return n},i=function(e){for(var t=new Uint8Array(e.length),n=e.length;n--;)t[n]=e.charCodeAt(n);return(t=$i(t)).reduce((function(e,t){return e+String.fromCharCode(t)}),"")};e.processDataByFilters=function(e,a){var o=0,s=e||"",c=[];for("string"==typeof(a=a||[])&&(a=[a]),o=0;o<a.length;o+=1)switch(a[o]){case"ASCII85Decode":case"/ASCII85Decode":s=n(s),c.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":s=t(s),c.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":s=r(s),c.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":s=s.split("").map((function(e){return("0"+e.charCodeAt().toString(16)).slice(-2)})).join("")+">",c.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":s=i(s),c.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[o]+'" is not implemented')}return{data:s,reverseChain:c.reverse().join(" ")}}}(xa.API),(Bo=xa.API).loadFile=function(e,t,n){return function(e,t,n){t=!1!==t,n="function"==typeof n?n:function(){};var r=void 0;try{r=function(e,t,n){var r=new XMLHttpRequest,i=0,a=function(e){var t=e.length,n=[],r=String.fromCharCode;for(i=0;i<t;i+=1)n.push(r(255&e.charCodeAt(i)));return n.join("")};if(r.open("GET",e,!t),r.overrideMimeType("text/plain; charset=x-user-defined"),!1===t&&(r.onload=function(){200===r.status?n(a(this.responseText)):n(void 0)}),r.send(null),t&&200===r.status)return a(r.responseText)}(e,t,n)}catch(e){}return r}(e,t,n)},Bo.loadImageFile=Bo.loadFile,function(e){function t(){return(na.html2canvas?Promise.resolve(na.html2canvas):n.e(239).then(n.t.bind(n,5239,23))).catch((function(e){return Promise.reject(new Error("Could not load html2canvas: "+e))})).then((function(e){return e.default?e.default:e}))}function r(){return(na.DOMPurify?Promise.resolve(na.DOMPurify):n.e(644).then(n.t.bind(n,5644,23))).catch((function(e){return Promise.reject(new Error("Could not load dompurify: "+e))})).then((function(e){return e.default?e.default:e}))}var i=function(e){var t=(0,ai.A)(e);return"undefined"===t?"undefined":"string"===t||e instanceof String?"string":"number"===t||e instanceof Number?"number":"function"===t||e instanceof Function?"function":e&&e.constructor===Array?"array":e&&1===e.nodeType?"element":"object"===t?"object":"unknown"},a=function(e,t){var n=document.createElement(e);for(var r in t.className&&(n.className=t.className),t.innerHTML&&t.dompurify&&(n.innerHTML=t.dompurify.sanitize(t.innerHTML)),t.style)n.style[r]=t.style[r];return n},o=function e(t){var n=Object.assign(e.convert(Promise.resolve()),JSON.parse(JSON.stringify(e.template))),r=e.convert(Promise.resolve(),n);return(r=r.setProgress(1,e,1,[e])).set(t)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(e,t){return e.__proto__=t||o.prototype,e},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(e,t){return this.then((function(){switch(t=t||function(e){switch(i(e)){case"string":return"string";case"element":return"canvas"===e.nodeName.toLowerCase()?"canvas":"element";default:return"unknown"}}(e)){case"string":return this.then(r).then((function(t){return this.set({src:a("div",{innerHTML:e,dompurify:t})})}));case"element":return this.set({src:e});case"canvas":return this.set({canvas:e});case"img":return this.set({img:e});default:return this.error("Unknown source type.")}}))},o.prototype.to=function(e){switch(e){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then((function(){var e={position:"relative",display:"inline-block",width:("number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},t=function e(t,n){for(var r=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),i=t.firstChild;i;i=i.nextSibling)!0!==n&&1===i.nodeType&&"SCRIPT"===i.nodeName||r.appendChild(e(i,n));return 1===t.nodeType&&("CANVAS"===t.nodeName?(r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0)):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(r.value=t.value),r.addEventListener("load",(function(){r.scrollTop=t.scrollTop,r.scrollLeft=t.scrollLeft}),!0)),r}(this.prop.src,this.opt.html2canvas.javascriptEnabled);"BODY"===t.tagName&&(e.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=a("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=a("div",{className:"html2pdf__container",style:e}),this.prop.container.appendChild(t),this.prop.container.firstChild.appendChild(a("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"}))},o.prototype.toCanvas=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then((function(e){var t=Object.assign({},this.opt.html2canvas);return delete t.onrendered,e(this.prop.container,t)})).then((function(e){(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)}))},o.prototype.toContext2d=function(){var e=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(e).then(t).then((function(e){var t=this.opt.jsPDF,n=this.opt.fontFaces,r="number"!=typeof this.opt.width||isNaN(this.opt.width)||"number"!=typeof this.opt.windowWidth||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,i=Object.assign({async:!0,allowTaint:!0,scale:r,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete i.onrendered,t.context2d.autoPaging=void 0===this.opt.autoPaging||this.opt.autoPaging,t.context2d.posX=this.opt.x,t.context2d.posY=this.opt.y,t.context2d.margin=this.opt.margin,t.context2d.fontFaces=n,n)for(var a=0;a<n.length;++a){var o=n[a],s=o.src.find((function(e){return"truetype"===e.format}));s&&t.addFont(s.url,o.ref.name,o.ref.style)}return i.windowHeight=i.windowHeight||0,i.windowHeight=0==i.windowHeight?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):i.windowHeight,t.context2d.save(!0),e(this.prop.container,i)})).then((function(e){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(e),this.prop.canvas=e,document.body.removeChild(this.prop.overlay)}))},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then((function(){var e=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=e}))},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then((function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF}))},o.prototype.output=function(e,t,n){return"img"===(n=n||"pdf").toLowerCase()||"image"===n.toLowerCase()?this.outputImg(e,t):this.outputPdf(e,t)},o.prototype.outputPdf=function(e,t){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){return this.prop.pdf.output(e,t)}))},o.prototype.outputImg=function(e){return this.thenList([function(){return this.prop.img||this.toImg()}]).then((function(){switch(e){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+e+'" is not supported.'}}))},o.prototype.save=function(e){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(e?{filename:e}:null).then((function(){this.prop.pdf.save(this.opt.filename)}))},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then((function(){this.prop.callback(this.prop.pdf)}))},o.prototype.set=function(e){if("object"!==i(e))return this;var t=Object.keys(e||{}).map((function(t){if(t in o.template.prop)return function(){this.prop[t]=e[t]};switch(t){case"margin":return this.setMargin.bind(this,e.margin);case"jsPDF":return function(){return this.opt.jsPDF=e.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,e.pageSize);default:return function(){this.opt[t]=e[t]}}}),this);return this.then((function(){return this.thenList(t)}))},o.prototype.get=function(e,t){return this.then((function(){var n=e in o.template.prop?this.prop[e]:this.opt[e];return t?t(n):n}))},o.prototype.setMargin=function(e){return this.then((function(){switch(i(e)){case"number":e=[e,e,e,e];case"array":if(2===e.length&&(e=[e[0],e[1],e[0],e[1]]),4===e.length)break;default:return this.error("Invalid margin array.")}this.opt.margin=e})).then(this.setPageSize)},o.prototype.setPageSize=function(e){function t(e,t){return Math.floor(e*t/72*96)}return this.then((function(){(e=e||xa.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(e.inner={width:e.width-this.opt.margin[1]-this.opt.margin[3],height:e.height-this.opt.margin[0]-this.opt.margin[2]},e.inner.px={width:t(e.inner.width,e.k),height:t(e.inner.height,e.k)},e.inner.ratio=e.inner.height/e.inner.width),this.prop.pageSize=e}))},o.prototype.setProgress=function(e,t,n,r){return null!=e&&(this.progress.val=e),null!=t&&(this.progress.state=t),null!=n&&(this.progress.n=n),null!=r&&(this.progress.stack=r),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(e,t,n,r){return this.setProgress(e?this.progress.val+e:null,t||null,n?this.progress.n+n:null,r?this.progress.stack.concat(r):null)},o.prototype.then=function(e,t){var n=this;return this.thenCore(e,t,(function(e,t){return n.updateProgress(null,null,1,[e]),Promise.prototype.then.call(this,(function(t){return n.updateProgress(null,e),t})).then(e,t).then((function(e){return n.updateProgress(1),e}))}))},o.prototype.thenCore=function(e,t,n){n=n||Promise.prototype.then,e&&(e=e.bind(this)),t&&(t=t.bind(this));var r=-1!==Promise.toString().indexOf("[native code]")&&"Promise"===Promise.name?this:o.convert(Object.assign({},this),Promise.prototype),i=n.call(r,e,t);return o.convert(i,this.__proto__)},o.prototype.thenExternal=function(e,t){return Promise.prototype.then.call(this,e,t)},o.prototype.thenList=function(e){var t=this;return e.forEach((function(e){t=t.thenCore(e)})),t},o.prototype.catch=function(e){e&&(e=e.bind(this));var t=Promise.prototype.catch.call(this,e);return o.convert(t,this)},o.prototype.catchExternal=function(e){return Promise.prototype.catch.call(this,e)},o.prototype.error=function(e){return this.then((function(){throw new Error(e)}))},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,xa.getPageSize=function(e,t,n){if("object"===(0,ai.A)(e)){var r=e;e=r.orientation,t=r.unit||t,n=r.format||n}t=t||"mm",n=n||"a4",e=(""+(e||"P")).toLowerCase();var i,a=(""+n).toLowerCase(),o={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(t){case"pt":i=1;break;case"mm":i=72/25.4;break;case"cm":i=72/2.54;break;case"in":i=72;break;case"px":i=.75;break;case"pc":case"em":i=12;break;case"ex":i=6;break;default:throw"Invalid unit: "+t}var s,c=0,l=0;if(o.hasOwnProperty(a))c=o[a][1]/i,l=o[a][0]/i;else try{c=n[1],l=n[0]}catch(Bo){throw new Error("Invalid format: "+n)}if("p"===e||"portrait"===e)e="p",l>c&&(s=l,l=c,c=s);else{if("l"!==e&&"landscape"!==e)throw"Invalid orientation: "+e;e="l",c>l&&(s=l,l=c,c=s)}return{width:l,height:c,unit:t,k:i,orientation:e}},e.html=function(e,t){(t=t||{}).callback=t.callback||function(){},t.html2canvas=t.html2canvas||{},t.html2canvas.canvas=t.html2canvas.canvas||this.canvas,t.jsPDF=t.jsPDF||this,t.fontFaces=t.fontFaces?t.fontFaces.map(Oo):null;var n=new o(t);return t.worker?n:n.from(e).doCallback()}}(xa.API),xa.API.addJS=function(e){return Vo=e,this.internal.events.subscribe("postPutResources",(function(){Fo=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Fo+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),jo=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Vo+")"),this.internal.out(">>"),this.internal.out("endobj")})),this.internal.events.subscribe("putCatalog",(function(){void 0!==Fo&&void 0!==jo&&this.internal.out("/Names <</JavaScript "+Fo+" 0 R>>")})),this},function(e){var t;e.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var r=e.outline.render().split(/\r\n/),i=0;i<r.length;i++){var a=r[i],o=n.exec(a);if(null!=o){var s=o[1];e.internal.newObjectDeferredBegin(s,!1)}e.internal.write(a)}if(this.outline.createNamedDestinations){var c=this.internal.pages.length,l=[];for(i=0;i<c;i++){var d=e.internal.newObject();l.push(d);var u=e.internal.getPageInfo(i+1);e.internal.write("<< /D["+u.objId+" 0 R /XYZ null null null]>> endobj")}var h=e.internal.newObject();for(e.internal.write("<< /Names [ "),i=0;i<l.length;i++)e.internal.write("(page_"+(i+1)+")"+l[i]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+h+" 0 R"),e.internal.write(">>","endobj")}}]),e.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+t+" 0 R"))}]),e.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(e,t,n){var r={title:t,options:n,children:[]};return null==e&&(e=this.root),e.children.push(r),r},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(t){t.id=e.internal.newObjectDeferred();for(var n=0;n<t.children.length;n++)this.genIds_r(t.children[n])},e.outline.renderRoot=function(e){this.objStart(e),this.line("/Type /Outlines"),e.children.length>0&&(this.line("/First "+this.makeRef(e.children[0])),this.line("/Last "+this.makeRef(e.children[e.children.length-1]))),this.line("/Count "+this.count_r({count:0},e)),this.objEnd()},e.outline.renderItems=function(t){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,r=0;r<t.children.length;r++){var i=t.children[r];this.objStart(i),this.line("/Title "+this.makeString(i.title)),this.line("/Parent "+this.makeRef(t)),r>0&&this.line("/Prev "+this.makeRef(t.children[r-1])),r<t.children.length-1&&this.line("/Next "+this.makeRef(t.children[r+1])),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1])));var a=this.count=this.count_r({count:0},i);if(a>0&&this.line("/Count "+a),i.options&&i.options.pageNumber){var o=e.internal.getPageInfo(i.options.pageNumber);this.line("/Dest ["+o.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var s=0;s<t.children.length;s++)this.renderItems(t.children[s])},e.outline.line=function(e){this.ctx.val+=e+"\r\n"},e.outline.makeRef=function(e){return e.id+" 0 R"},e.outline.makeString=function(t){return"("+e.internal.pdfEscape(t)+")"},e.outline.objStart=function(e){this.ctx.val+="\r\n"+e.id+" 0 obj\r\n<<\r\n"},e.outline.objEnd=function(){this.ctx.val+=">> \r\nendobj\r\n"},e.outline.count_r=function(e,t){for(var n=0;n<t.children.length;n++)e.count++,this.count_r(e,t.children[n]);return e.count}}])}(xa.API),function(e){var t=[192,193,194,195,196,197,198,199];e.processJPEG=function(e,n,r,i,a,o){var s,c=this.decode.DCT_DECODE,l=null;if("string"==typeof e||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=a||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,(s=function(e){for(var n,r=256*e.charCodeAt(4)+e.charCodeAt(5),i=e.length,a={width:0,height:0,numcomponents:1},o=4;o<i;o+=2){if(o+=r,-1!==t.indexOf(e.charCodeAt(o+1))){n=256*e.charCodeAt(o+5)+e.charCodeAt(o+6),a={width:256*e.charCodeAt(o+7)+e.charCodeAt(o+8),height:n,numcomponents:e.charCodeAt(o+9)};break}r=256*e.charCodeAt(o+2)+e.charCodeAt(o+3)}return a}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e)).numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}l={data:e,width:s.width,height:s.height,colorSpace:o,bitsPerComponent:8,filter:c,index:n,alias:r}}return l}}(xa.API);var Wo,Ho,qo,zo,Ko,Yo=function(){var e,t,n;function r(e){var t,n,r,i,a,o,s,c,l,d,u,h,p,f;for(this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},o=null;;){switch(t=this.readUInt32(),l=function(){var e,t;for(t=[],e=0;e<4;++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":o&&this.animation.frames.push(o),this.pos+=4,o={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},a=this.readUInt16(),i=this.readUInt16()||100,o.delay=1e3*a/i,o.disposeOp=this.data[this.pos++],o.blendOp=this.data[this.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===l&&(this.pos+=4,t-=4),e=(null!=o?o.data:void 0)||this.imgData,h=0;0<=t?h<t:h>t;0<=t?++h:--h)e.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(r=this.palette.length/3,this.transparency.indexed=this.read(t),this.transparency.indexed.length>r)throw new Error("More transparent colors than palette size");if((d=r-this.transparency.indexed.length)>0)for(p=0;0<=d?p<d:p>d;0<=d?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":s=(u=this.read(t)).indexOf(0),c=String.fromCharCode.apply(String,u.slice(0,s)),this.text[c]=String.fromCharCode.apply(String,u.slice(s+1));break;case"IEND":return o&&this.animation.frames.push(o),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(f=this.colorType)||6===f,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;0<=e?++t:--t)n.push(this.data[this.pos++]);return n},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(e){var t=this.pixelBitlength/8,n=new Uint8Array(this.width*this.height*t),r=0,i=this;if(null==e&&(e=this.imgData),0===e.length)return new Uint8Array(0);function a(a,o,s,c){var l,d,u,h,p,f,m,_,g,E,v,y,S,b,T,C,w,R,A,I,N,O=Math.ceil((i.width-a)/s),P=Math.ceil((i.height-o)/c),L=i.width==O&&i.height==P;for(b=t*O,y=L?n:new Uint8Array(b*P),f=e.length,S=0,d=0;S<P&&r<f;){switch(e[r++]){case 0:for(h=w=0;w<b;h=w+=1)y[d++]=e[r++];break;case 1:for(h=R=0;R<b;h=R+=1)l=e[r++],p=h<t?0:y[d-t],y[d++]=(l+p)%256;break;case 2:for(h=A=0;A<b;h=A+=1)l=e[r++],u=(h-h%t)/t,T=S&&y[(S-1)*b+u*t+h%t],y[d++]=(T+l)%256;break;case 3:for(h=I=0;I<b;h=I+=1)l=e[r++],u=(h-h%t)/t,p=h<t?0:y[d-t],T=S&&y[(S-1)*b+u*t+h%t],y[d++]=(l+Math.floor((p+T)/2))%256;break;case 4:for(h=N=0;N<b;h=N+=1)l=e[r++],u=(h-h%t)/t,p=h<t?0:y[d-t],0===S?T=C=0:(T=y[(S-1)*b+u*t+h%t],C=u&&y[(S-1)*b+(u-1)*t+h%t]),m=p+T-C,_=Math.abs(m-p),E=Math.abs(m-T),v=Math.abs(m-C),g=_<=E&&_<=v?p:E<=v?T:C,y[d++]=(l+g)%256;break;default:throw new Error("Invalid filter algorithm: "+e[r-1])}if(!L){var D=((o+S*c)*i.width+a)*t,k=S*b;for(h=0;h<O;h+=1){for(var x=0;x<t;x+=1)n[D++]=y[k++];D+=(s-1)*t}}S++}}return e=ea(e),1==i.interlaceMethod?(a(0,0,8,8),a(4,0,8,8),a(0,4,4,8),a(2,0,4,4),a(0,2,2,4),a(1,0,2,2),a(0,1,1,2)):a(0,0,1,1),n},r.prototype.decodePalette=function(){var e,t,n,r,i,a,o,s,c;for(n=this.palette,a=this.transparency.indexed||[],i=new Uint8Array((a.length||0)+n.length),r=0,e=0,t=o=0,s=n.length;o<s;t=o+=3)i[r++]=n[t],i[r++]=n[t+1],i[r++]=n[t+2],i[r++]=null!=(c=a[e++])?c:255;return i},r.prototype.copyToImageData=function(e,t){var n,r,i,a,o,s,c,l,d,u,h;if(r=this.colors,d=null,n=this.hasAlphaChannel,this.palette.length&&(d=null!=(h=this._decodedPalette)?h:this._decodedPalette=this.decodePalette(),r=4,n=!0),l=(i=e.data||e).length,o=d||t,a=s=0,1===r)for(;a<l;)c=d?4*t[a/4]:s,u=o[c++],i[a++]=u,i[a++]=u,i[a++]=u,i[a++]=n?o[c++]:255,s=c;else for(;a<l;)c=d?4*t[a/4]:s,i[a++]=o[c++],i[a++]=o[c++],i[a++]=o[c++],i[a++]=n?o[c++]:255,s=c},r.prototype.decode=function(){var e;return e=new Uint8Array(this.width*this.height*4),this.copyToImageData(e,this.decodePixels()),e};var i=function(){if("[object Window]"===Object.prototype.toString.call(na)){try{t=na.document.createElement("canvas"),n=t.getContext("2d")}catch(e){return!1}return!0}return!1};return i(),e=function(e){var r;if(!0===i())return n.width=e.width,n.height=e.height,n.clearRect(0,0,e.width,e.height),n.putImageData(e,0,0),(r=new Image).src=t.toDataURL(),r;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(t){var n,r,i,a,o,s,c,l;if(this.animation){for(l=[],r=o=0,s=(c=this.animation.frames).length;o<s;r=++o)n=c[r],i=t.createImageData(n.width,n.height),a=this.decodePixels(new Uint8Array(n.data)),this.copyToImageData(i,a),n.imageData=i,l.push(n.image=e(i));return l}},r.prototype.renderFrame=function(e,t){var n,r,i;return n=(r=this.animation.frames)[t],i=r[t-1],0===t&&e.clearRect(0,0,this.width,this.height),1===(null!=i?i.disposeOp:void 0)?e.clearRect(i.xOffset,i.yOffset,i.width,i.height):2===(null!=i?i.disposeOp:void 0)&&e.putImageData(i.imageData,i.xOffset,i.yOffset),0===n.blendOp&&e.clearRect(n.xOffset,n.yOffset,n.width,n.height),e.drawImage(n.image,n.xOffset,n.yOffset)},r.prototype.animate=function(e){var t,n,r,i,a,o,s=this;return n=0,o=this.animation,i=o.numFrames,r=o.frames,a=o.numPlays,(t=function(){var o,c;if(o=n++%i,c=r[o],s.renderFrame(e,o),i>1&&n/i<a)return s.animation._timeout=setTimeout(t,c.delay)})()},r.prototype.stopAnimation=function(){var e;return clearTimeout(null!=(e=this.animation)?e._timeout:void 0)},r.prototype.render=function(e){var t,n;return e._png&&e._png.stopAnimation(),e._png=this,e.width=this.width,e.height=this.height,t=e.getContext("2d"),this.animation?(this.decodeFrames(t),this.animate(t)):(n=t.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),t.putImageData(n,0,0))},r}();function Jo(e){var t=0;if(71!==e[t++]||73!==e[t++]||70!==e[t++]||56!==e[t++]||56!=(e[t++]+1&253)||97!==e[t++])throw new Error("Invalid GIF 87a/89a header.");var n=e[t++]|e[t++]<<8,r=e[t++]|e[t++]<<8,i=e[t++],a=i>>7,o=1<<1+(7&i);e[t++],e[t++];var s=null,c=null;a&&(s=t,c=o,t+=3*o);var l=!0,d=[],u=0,h=null,p=0,f=null;for(this.width=n,this.height=r;l&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(11!==e[t]||78==e[t+1]&&69==e[t+2]&&84==e[t+3]&&83==e[t+4]&&67==e[t+5]&&65==e[t+6]&&80==e[t+7]&&69==e[t+8]&&50==e[t+9]&&46==e[t+10]&&48==e[t+11]&&3==e[t+12]&&1==e[t+13]&&0==e[t+16])t+=14,f=e[t++]|e[t++]<<8,t++;else for(t+=12;;){if(!((A=e[t++])>=0))throw Error("Invalid block size");if(0===A)break;t+=A}break;case 249:if(4!==e[t++]||0!==e[t+4])throw new Error("Invalid graphics extension block.");var m=e[t++];u=e[t++]|e[t++]<<8,h=e[t++],0==(1&m)&&(h=null),p=m>>2&7,t++;break;case 254:for(;;){if(!((A=e[t++])>=0))throw Error("Invalid block size");if(0===A)break;t+=A}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var _=e[t++]|e[t++]<<8,g=e[t++]|e[t++]<<8,E=e[t++]|e[t++]<<8,v=e[t++]|e[t++]<<8,y=e[t++],S=y>>6&1,b=1<<1+(7&y),T=s,C=c,w=!1;y>>7&&(w=!0,T=t,C=b,t+=3*b);var R=t;for(t++;;){var A;if(!((A=e[t++])>=0))throw Error("Invalid block size");if(0===A)break;t+=A}d.push({x:_,y:g,width:E,height:v,has_local_palette:w,palette_offset:T,palette_size:C,data_offset:R,data_length:t-R,transparent_index:h,interlaced:!!S,delay:u,disposal:p});break;case 59:l=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return f},this.frameInfo=function(e){if(e<0||e>=d.length)throw new Error("Frame index out of range.");return d[e]},this.decodeAndBlitFrameBGRA=function(t,r){var i=this.frameInfo(t),a=i.width*i.height,o=new Uint8Array(a);Xo(e,i.data_offset,o,a);var s=i.palette_offset,c=i.transparent_index;null===c&&(c=256);var l=i.width,d=n-l,u=l,h=4*(i.y*n+i.x),p=4*((i.y+i.height)*n+i.x),f=h,m=4*d;!0===i.interlaced&&(m+=4*n*7);for(var _=8,g=0,E=o.length;g<E;++g){var v=o[g];if(0===u&&(u=l,(f+=m)>=p&&(m=4*d+4*n*(_-1),f=h+(l+d)*(_<<1),_>>=1)),v===c)f+=4;else{var y=e[s+3*v],S=e[s+3*v+1],b=e[s+3*v+2];r[f++]=b,r[f++]=S,r[f++]=y,r[f++]=255}--u}},this.decodeAndBlitFrameRGBA=function(t,r){var i=this.frameInfo(t),a=i.width*i.height,o=new Uint8Array(a);Xo(e,i.data_offset,o,a);var s=i.palette_offset,c=i.transparent_index;null===c&&(c=256);var l=i.width,d=n-l,u=l,h=4*(i.y*n+i.x),p=4*((i.y+i.height)*n+i.x),f=h,m=4*d;!0===i.interlaced&&(m+=4*n*7);for(var _=8,g=0,E=o.length;g<E;++g){var v=o[g];if(0===u&&(u=l,(f+=m)>=p&&(m=4*d+4*n*(_-1),f=h+(l+d)*(_<<1),_>>=1)),v===c)f+=4;else{var y=e[s+3*v],S=e[s+3*v+1],b=e[s+3*v+2];r[f++]=y,r[f++]=S,r[f++]=b,r[f++]=255}--u}}}function Xo(e,t,n,r){for(var i=e[t++],a=1<<i,o=a+1,s=o+1,c=i+1,l=(1<<c)-1,d=0,u=0,h=0,p=e[t++],f=new Int32Array(4096),m=null;;){for(;d<16&&0!==p;)u|=e[t++]<<d,d+=8,1===p?p=e[t++]:--p;if(d<c)break;var _=u&l;if(u>>=c,d-=c,_!==a){if(_===o)break;for(var g=_<s?_:m,E=0,v=g;v>a;)v=f[v]>>8,++E;var y=v;if(h+E+(g!==_?1:0)>r)return void ia.log("Warning, gif stream longer than expected.");n[h++]=y;var S=h+=E;for(g!==_&&(n[h++]=y),v=g;E--;)v=f[v],n[--S]=255&v,v>>=8;null!==m&&s<4096&&(f[s++]=m<<8|y,s>=l+1&&c<12&&(++c,l=l<<1|1)),m=_}else s=o+1,l=(1<<(c=i+1))-1,m=null}return h!==r&&ia.log("Warning, gif stream shorter than expected."),n}function Qo(e){var t,n,r,i,a,o=Math.floor,s=new Array(64),c=new Array(64),l=new Array(64),d=new Array(64),u=new Array(65535),h=new Array(65535),p=new Array(64),f=new Array(64),m=[],_=0,g=7,E=new Array(64),v=new Array(64),y=new Array(64),S=new Array(256),b=new Array(2048),T=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],C=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],w=[0,1,2,3,4,5,6,7,8,9,10,11],R=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],I=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],N=[0,1,2,3,4,5,6,7,8,9,10,11],O=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],P=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function L(e,t){for(var n=0,r=0,i=new Array,a=1;a<=16;a++){for(var o=1;o<=e[a];o++)i[t[r]]=[],i[t[r]][0]=n,i[t[r]][1]=a,r++,n++;n*=2}return i}function D(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(_|=1<<g),n--,--g<0&&(255==_?(k(255),k(0)):k(_),g=7,_=0)}function k(e){m.push(e)}function x(e){k(e>>8&255),k(255&e)}function M(e,t,n,r,i){for(var a,o=i[0],s=i[240],c=function(e,t){var n,r,i,a,o,s,c,l,d,u,h=0;for(d=0;d<8;++d){n=e[h],r=e[h+1],i=e[h+2],a=e[h+3],o=e[h+4],s=e[h+5],c=e[h+6];var f=n+(l=e[h+7]),m=n-l,_=r+c,g=r-c,E=i+s,v=i-s,y=a+o,S=a-o,b=f+y,T=f-y,C=_+E,w=_-E;e[h]=b+C,e[h+4]=b-C;var R=.707106781*(w+T);e[h+2]=T+R,e[h+6]=T-R;var A=.382683433*((b=S+v)-(w=g+m)),I=.5411961*b+A,N=1.306562965*w+A,O=.707106781*(C=v+g),P=m+O,L=m-O;e[h+5]=L+I,e[h+3]=L-I,e[h+1]=P+N,e[h+7]=P-N,h+=8}for(h=0,d=0;d<8;++d){n=e[h],r=e[h+8],i=e[h+16],a=e[h+24],o=e[h+32],s=e[h+40],c=e[h+48];var D=n+(l=e[h+56]),k=n-l,x=r+c,M=r-c,U=i+s,F=i-s,j=a+o,V=a-o,B=D+j,G=D-j,W=x+U,H=x-U;e[h]=B+W,e[h+32]=B-W;var q=.707106781*(H+G);e[h+16]=G+q,e[h+48]=G-q;var z=.382683433*((B=V+F)-(H=M+k)),K=.5411961*B+z,Y=1.306562965*H+z,J=.707106781*(W=F+M),X=k+J,Q=k-J;e[h+40]=Q+K,e[h+24]=Q-K,e[h+8]=X+Y,e[h+56]=X-Y,h++}for(d=0;d<64;++d)u=e[d]*t[d],p[d]=u>0?u+.5|0:u-.5|0;return p}(e,t),l=0;l<64;++l)f[T[l]]=c[l];var d=f[0]-n;n=f[0],0==d?D(r[0]):(D(r[h[a=32767+d]]),D(u[a]));for(var m=63;m>0&&0==f[m];)m--;if(0==m)return D(o),n;for(var _,g=1;g<=m;){for(var E=g;0==f[g]&&g<=m;)++g;var v=g-E;if(v>=16){_=v>>4;for(var y=1;y<=_;++y)D(s);v&=15}a=32767+f[g],D(i[(v<<4)+h[a]]),D(u[a]),g++}return 63!=m&&D(o),n}function U(e){e=Math.min(Math.max(e,1),100),a!=e&&(function(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;n<64;n++){var r=o((t[n]*e+50)/100);r=Math.min(Math.max(r,1),255),s[T[n]]=r}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],a=0;a<64;a++){var u=o((i[a]*e+50)/100);u=Math.min(Math.max(u,1),255),c[T[a]]=u}for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0,f=0;f<8;f++)for(var m=0;m<8;m++)l[p]=1/(s[T[p]]*h[f]*h[m]*8),d[p]=1/(c[T[p]]*h[f]*h[m]*8),p++}(e<50?Math.floor(5e3/e):Math.floor(200-2*e)),a=e)}this.encode=function(e,a){a&&U(a),m=new Array,_=0,g=7,x(65496),x(65504),x(16),k(74),k(70),k(73),k(70),k(0),k(1),k(1),k(0),x(1),x(1),k(0),k(0),function(){x(65499),x(132),k(0);for(var e=0;e<64;e++)k(s[e]);k(1);for(var t=0;t<64;t++)k(c[t])}(),function(e,t){x(65472),x(17),k(8),x(t),x(e),k(3),k(1),k(17),k(0),k(2),k(17),k(1),k(3),k(17),k(1)}(e.width,e.height),function(){x(65476),x(418),k(0);for(var e=0;e<16;e++)k(C[e+1]);for(var t=0;t<=11;t++)k(w[t]);k(16);for(var n=0;n<16;n++)k(R[n+1]);for(var r=0;r<=161;r++)k(A[r]);k(1);for(var i=0;i<16;i++)k(I[i+1]);for(var a=0;a<=11;a++)k(N[a]);k(17);for(var o=0;o<16;o++)k(O[o+1]);for(var s=0;s<=161;s++)k(P[s])}(),x(65498),x(12),k(3),k(1),k(0),k(2),k(17),k(3),k(17),k(0),k(63),k(0);var o=0,u=0,h=0;_=0,g=7,this.encode.displayName="_encode_";for(var p,f,S,T,L,F,j,V,B,G=e.data,W=e.width,H=e.height,q=4*W,z=0;z<H;){for(p=0;p<q;){for(L=q*z+p,j=-1,V=0,B=0;B<64;B++)F=L+(V=B>>3)*q+(j=4*(7&B)),z+V>=H&&(F-=q*(z+1+V-H)),p+j>=q&&(F-=p+j-q+4),f=G[F++],S=G[F++],T=G[F++],E[B]=(b[f]+b[S+256|0]+b[T+512|0]>>16)-128,v[B]=(b[f+768|0]+b[S+1024|0]+b[T+1280|0]>>16)-128,y[B]=(b[f+1280|0]+b[S+1536|0]+b[T+1792|0]>>16)-128;o=M(E,l,o,t,r),u=M(v,d,u,n,i),h=M(y,d,h,n,i),p+=32}z+=8}if(g>=0){var K=[];K[1]=g+1,K[0]=(1<<g+1)-1,D(K)}return x(65497),new Uint8Array(m)},e=e||50,function(){for(var e=String.fromCharCode,t=0;t<256;t++)S[t]=e(t)}(),t=L(C,w),n=L(I,N),r=L(R,A),i=L(O,P),function(){for(var e=1,t=2,n=1;n<=15;n++){for(var r=e;r<t;r++)h[32767+r]=n,u[32767+r]=[],u[32767+r][1]=n,u[32767+r][0]=r;for(var i=-(t-1);i<=-e;i++)h[32767+i]=n,u[32767+i]=[],u[32767+i][1]=n,u[32767+i][0]=t-1+i;e<<=1,t<<=1}}(),function(){for(var e=0;e<256;e++)b[e]=19595*e,b[e+256|0]=38470*e,b[e+512|0]=7471*e+32768,b[e+768|0]=-11059*e,b[e+1024|0]=-21709*e,b[e+1280|0]=32768*e+8421375,b[e+1536|0]=-27439*e,b[e+1792|0]=-5329*e}(),U(e)}function Zo(e,t){if(this.pos=0,this.buffer=e,this.datav=new DataView(e.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,-1===["BM","BA","CI","CP","IC","PT"].indexOf(this.flag))throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function $o(e){function t(e){if(!e)throw Error("assert :P")}function n(e,t,n){for(var r=0;4>r;r++)if(e[t+r]!=n.charCodeAt(r))return!0;return!1}function r(e,t,n,r,i){for(var a=0;a<i;a++)e[t+a]=n[r+a]}function i(e,t,n,r){for(var i=0;i<r;i++)e[t+i]=n}function a(e){return new Int32Array(e)}function o(e,t){for(var n=[],r=0;r<e;r++)n.push(new t);return n}function s(e,t){var n=[];return function e(n,r,i){for(var a=i[r],o=0;o<a&&(n.push(i.length>r+1?[]:new t),!(i.length<r+1));o++)e(n[o],r+1,i)}(n,0,e),n}var c=function(){var e=this;function c(e,t){for(var n=1<<t-1>>>0;e&n;)n>>>=1;return n?(e&n-1)+n:e}function l(e,n,r,i,a){t(!(i%r));do{e[n+(i-=r)]=a}while(0<i)}function d(e,n,r,i,o){if(t(2328>=o),512>=o)var s=a(512);else if(null==(s=a(o)))return 0;return function(e,n,r,i,o,s){var d,h,p=n,f=1<<r,m=a(16),_=a(16);for(t(0!=o),t(null!=i),t(null!=e),t(0<r),h=0;h<o;++h){if(15<i[h])return 0;++m[i[h]]}if(m[0]==o)return 0;for(_[1]=0,d=1;15>d;++d){if(m[d]>1<<d)return 0;_[d+1]=_[d]+m[d]}for(h=0;h<o;++h)d=i[h],0<i[h]&&(s[_[d]++]=h);if(1==_[15])return(i=new u).g=0,i.value=s[0],l(e,p,1,f,i),f;var g,E=-1,v=f-1,y=0,S=1,b=1,T=1<<r;for(h=0,d=1,o=2;d<=r;++d,o<<=1){if(S+=b<<=1,0>(b-=m[d]))return 0;for(;0<m[d];--m[d])(i=new u).g=d,i.value=s[h++],l(e,p+y,o,T,i),y=c(y,d)}for(d=r+1,o=2;15>=d;++d,o<<=1){if(S+=b<<=1,0>(b-=m[d]))return 0;for(;0<m[d];--m[d]){if(i=new u,(y&v)!=E){for(p+=T,g=1<<(E=d)-r;15>E&&!(0>=(g-=m[E]));)++E,g<<=1;f+=T=1<<(g=E-r),e[n+(E=y&v)].g=g+r,e[n+E].value=p-n-E}i.g=d-r,i.value=s[h++],l(e,p+(y>>r),o,T,i),y=c(y,d)}}return S!=2*_[15]-1?0:f}(e,n,r,i,o,s)}function u(){this.value=this.g=0}function h(){this.value=this.g=0}function p(){this.G=o(5,u),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=o(jn,h)}function f(e,n,r,i){t(null!=e),t(null!=n),t(2147483648>i),e.Ca=254,e.I=0,e.b=-8,e.Ka=0,e.oa=n,e.pa=r,e.Jd=n,e.Yc=r+i,e.Zc=4<=i?r+i-4+1:r,R(e)}function m(e,t){for(var n=0;0<t--;)n|=I(e,128)<<t;return n}function _(e,t){var n=m(e,t);return A(e)?-n:n}function g(e,n,r,i){var a,o=0;for(t(null!=e),t(null!=n),t(4294967288>i),e.Sb=i,e.Ra=0,e.u=0,e.h=0,4<i&&(i=4),a=0;a<i;++a)o+=n[r+a]<<8*a;e.Ra=o,e.bb=i,e.oa=n,e.pa=r}function E(e){for(;8<=e.u&&e.bb<e.Sb;)e.Ra>>>=8,e.Ra+=e.oa[e.pa+e.bb]<<Gn-8>>>0,++e.bb,e.u-=8;T(e)&&(e.h=1,e.u=0)}function v(e,n){if(t(0<=n),!e.h&&n<=Bn){var r=b(e)&Vn[n];return e.u+=n,E(e),r}return e.h=1,e.u=0}function y(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function S(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function b(e){return e.Ra>>>(e.u&Gn-1)>>>0}function T(e){return t(e.bb<=e.Sb),e.h||e.bb==e.Sb&&e.u>Gn}function C(e,t){e.u=t,e.h=T(e)}function w(e){e.u>=Wn&&(t(e.u>=Wn),E(e))}function R(e){t(null!=e&&null!=e.oa),e.pa<e.Zc?(e.I=(e.oa[e.pa++]|e.I<<8)>>>0,e.b+=8):(t(null!=e&&null!=e.oa),e.pa<e.Yc?(e.b+=8,e.I=e.oa[e.pa++]|e.I<<8):e.Ka?e.b=0:(e.I<<=8,e.b+=8,e.Ka=1))}function A(e){return m(e,1)}function I(e,t){var n=e.Ca;0>e.b&&R(e);var r=e.b,i=n*t>>>8,a=(e.I>>>r>i)+0;for(a?(n-=i,e.I-=i+1<<r>>>0):n=i+1,r=n,i=0;256<=r;)i+=8,r>>=8;return r=7^i+Hn[r],e.b-=r,e.Ca=(n<<r)-1,a}function N(e,t,n){e[t+0]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n}function O(e,t){return e[t+0]|e[t+1]<<8}function P(e,t){return O(e,t)|e[t+2]<<16}function L(e,t){return O(e,t)|O(e,t+2)<<16}function D(e,n){var r=1<<n;return t(null!=e),t(0<n),e.X=a(r),null==e.X?0:(e.Mb=32-n,e.Xa=n,1)}function k(e,n){t(null!=e),t(null!=n),t(e.Xa==n.Xa),r(n.X,0,e.X,0,1<<n.Xa)}function x(){this.X=[],this.Xa=this.Mb=0}function M(e,n,r,i){t(null!=r),t(null!=i);var a=r[0],o=i[0];return 0==a&&(a=(e*o+n/2)/n),0==o&&(o=(n*a+e/2)/e),0>=a||0>=o?0:(r[0]=a,i[0]=o,1)}function U(e,t){return e+(1<<t)-1>>>t}function F(e,t){return((4278255360&e)+(4278255360&t)>>>0&4278255360)+((16711935&e)+(16711935&t)>>>0&16711935)>>>0}function j(t,n){e[n]=function(n,r,i,a,o,s,c){var l;for(l=0;l<o;++l){var d=e[t](s[c+l-1],i,a+l);s[c+l]=F(n[r+l],d)}}}function V(){this.ud=this.hd=this.jd=0}function B(e,t){return((4278124286&(e^t))>>>1)+(e&t)>>>0}function G(e){return 0<=e&&256>e?e:0>e?0:255<e?255:void 0}function W(e,t){return G(e+(e-t+.5>>1))}function H(e,t,n){return Math.abs(t-n)-Math.abs(e-n)}function q(e,t,n,r,i,a,o){for(r=a[o-1],n=0;n<i;++n)a[o+n]=r=F(e[t+n],r)}function z(e,t,n,r,i){var a;for(a=0;a<n;++a){var o=e[t+a],s=o>>8&255,c=16711935&(c=(c=16711935&o)+((s<<16)+s));r[i+a]=(4278255360&o)+c>>>0}}function K(e,t){t.jd=255&e,t.hd=e>>8&255,t.ud=e>>16&255}function Y(e,t,n,r,i,a){var o;for(o=0;o<r;++o){var s=t[n+o],c=s>>>8,l=s,d=255&(d=(d=s>>>16)+((e.jd<<24>>24)*(c<<24>>24)>>>5));l=255&(l=(l+=(e.hd<<24>>24)*(c<<24>>24)>>>5)+((e.ud<<24>>24)*(d<<24>>24)>>>5)),i[a+o]=(4278255360&s)+(d<<16)+l}}function J(t,n,r,i,a){e[n]=function(e,t,n,r,o,s,c,l,d){for(r=c;r<l;++r)for(c=0;c<d;++c)o[s++]=a(n[i(e[t++])])},e[t]=function(t,n,o,s,c,l,d){var u=8>>t.b,h=t.Ea,p=t.K[0],f=t.w;if(8>u)for(t=(1<<t.b)-1,f=(1<<u)-1;n<o;++n){var m,_=0;for(m=0;m<h;++m)m&t||(_=i(s[c++])),l[d++]=a(p[_&f]),_>>=u}else e["VP8LMapColor"+r](s,c,p,f,l,d,n,o,h)}}function X(e,t,n,r,i){for(n=t+n;t<n;){var a=e[t++];r[i++]=a>>16&255,r[i++]=a>>8&255,r[i++]=255&a}}function Q(e,t,n,r,i){for(n=t+n;t<n;){var a=e[t++];r[i++]=a>>16&255,r[i++]=a>>8&255,r[i++]=255&a,r[i++]=a>>24&255}}function Z(e,t,n,r,i){for(n=t+n;t<n;){var a=(o=e[t++])>>16&240|o>>12&15,o=240&o|o>>28&15;r[i++]=a,r[i++]=o}}function $(e,t,n,r,i){for(n=t+n;t<n;){var a=(o=e[t++])>>16&248|o>>13&7,o=o>>5&224|o>>3&31;r[i++]=a,r[i++]=o}}function ee(e,t,n,r,i){for(n=t+n;t<n;){var a=e[t++];r[i++]=255&a,r[i++]=a>>8&255,r[i++]=a>>16&255}}function te(e,t,n,i,a,o){if(0==o)for(n=t+n;t<n;)N(i,((o=e[t++])[0]>>24|o[1]>>8&65280|o[2]<<8&16711680|o[3]<<24)>>>0),a+=32;else r(i,a,e,t,n)}function ne(t,n){e[n][0]=e[t+"0"],e[n][1]=e[t+"1"],e[n][2]=e[t+"2"],e[n][3]=e[t+"3"],e[n][4]=e[t+"4"],e[n][5]=e[t+"5"],e[n][6]=e[t+"6"],e[n][7]=e[t+"7"],e[n][8]=e[t+"8"],e[n][9]=e[t+"9"],e[n][10]=e[t+"10"],e[n][11]=e[t+"11"],e[n][12]=e[t+"12"],e[n][13]=e[t+"13"],e[n][14]=e[t+"0"],e[n][15]=e[t+"0"]}function re(e){return e==Wr||e==Hr||e==qr||e==zr}function ie(){this.eb=[],this.size=this.A=this.fb=0}function ae(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function oe(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new ie,this.f.kb=new ae,this.sd=null}function se(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function ce(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function le(e){return alert("todo:WebPSamplerProcessPlane"),e.T}function de(e,t){var n=e.T,i=t.ba.f.RGBA,a=i.eb,o=i.fb+e.ka*i.A,s=gi[t.ba.S],c=e.y,l=e.O,d=e.f,u=e.N,h=e.ea,p=e.W,f=t.cc,m=t.dc,_=t.Mc,g=t.Nc,E=e.ka,v=e.ka+e.T,y=e.U,S=y+1>>1;for(0==E?s(c,l,null,null,d,u,h,p,d,u,h,p,a,o,null,null,y):(s(t.ec,t.fc,c,l,f,m,_,g,d,u,h,p,a,o-i.A,a,o,y),++n);E+2<v;E+=2)f=d,m=u,_=h,g=p,u+=e.Rc,p+=e.Rc,o+=2*i.A,s(c,(l+=2*e.fa)-e.fa,c,l,f,m,_,g,d,u,h,p,a,o-i.A,a,o,y);return l+=e.fa,e.j+v<e.o?(r(t.ec,t.fc,c,l,y),r(t.cc,t.dc,d,u,S),r(t.Mc,t.Nc,h,p,S),n--):1&v||s(c,l,null,null,d,u,h,p,d,u,h,p,a,o+i.A,null,null,y),n}function ue(e,n,r){var i=e.F,a=[e.J];if(null!=i){var o=e.U,s=n.ba.S,c=s==Vr||s==qr;n=n.ba.f.RGBA;var l=[0],d=e.ka;l[0]=e.T,e.Kb&&(0==d?--l[0]:(--d,a[0]-=e.width),e.j+e.ka+e.T==e.o&&(l[0]=e.o-e.j-d));var u=n.eb;d=n.fb+d*n.A,e=wr(i,a[0],e.width,o,l,u,d+(c?0:3),n.A),t(r==l),e&&re(s)&&Tr(u,d,c,o,l,n.A)}return 0}function he(e){var t=e.ma,n=t.ba.S,r=11>n,i=n==Ur||n==jr||n==Vr||n==Br||12==n||re(n);if(t.memory=null,t.Ib=null,t.Jb=null,t.Nd=null,!Mn(t.Oa,e,i?11:12))return 0;if(i&&re(n)&&vn(),e.da)alert("todo:use_scaling");else{if(r){if(t.Ib=le,e.Kb){if(n=e.U+1>>1,t.memory=a(e.U+2*n),null==t.memory)return 0;t.ec=t.memory,t.fc=0,t.cc=t.ec,t.dc=t.fc+e.U,t.Mc=t.cc,t.Nc=t.dc+n,t.Ib=de,vn()}}else alert("todo:EmitYUV");i&&(t.Jb=ue,r&&gn())}if(r&&!Pi){for(e=0;256>e;++e)Li[e]=89858*(e-128)+Ri>>wi,xi[e]=-22014*(e-128)+Ri,ki[e]=-45773*(e-128),Di[e]=113618*(e-128)+Ri>>wi;for(e=Ai;e<Ii;++e)t=76283*(e-16)+Ri>>wi,Mi[e-Ai]=qe(t,255),Ui[e-Ai]=qe(t+8>>4,15);Pi=1}return 1}function pe(e){var n=e.ma,r=e.U,i=e.T;return t(!(1&e.ka)),0>=r||0>=i?0:(r=n.Ib(e,n),null!=n.Jb&&n.Jb(e,n,r),n.Dc+=r,1)}function fe(e){e.ma.memory=null}function me(e,t,n,r){return 47!=v(e,8)?0:(t[0]=v(e,14)+1,n[0]=v(e,14)+1,r[0]=v(e,1),0!=v(e,3)?0:!e.h)}function _e(e,t){if(4>e)return e+1;var n=e-2>>1;return(2+(1&e)<<n)+v(t,n)+1}function ge(e,t){return 120<t?t-120:1<=(n=((n=Zr[t-1])>>4)*e+(8-(15&n)))?n:1;var n}function Ee(e,t,n){var r=b(n),i=e[t+=255&r].g-8;return 0<i&&(C(n,n.u+8),r=b(n),t+=e[t].value,t+=r&(1<<i)-1),C(n,n.u+e[t].g),e[t].value}function ve(e,n,r){return r.g+=e.g,r.value+=e.value<<n>>>0,t(8>=r.g),e.g}function ye(e,n,r){var i=e.xc;return t((n=0==i?0:e.vc[e.md*(r>>i)+(n>>i)])<e.Wb),e.Ya[n]}function Se(e,n,i,a){var o=e.ab,s=e.c*n,c=e.C;n=c+n;var l=i,d=a;for(a=e.Ta,i=e.Ua;0<o--;){var u=e.gc[o],h=c,p=n,f=l,m=d,_=(d=a,l=i,u.Ea);switch(t(h<p),t(p<=u.nc),u.hc){case 2:Kn(f,m,(p-h)*_,d,l);break;case 0:var g=h,E=p,v=d,y=l,S=(R=u).Ea;0==g&&(qn(f,m,null,null,1,v,y),q(f,m+1,0,0,S-1,v,y+1),m+=S,y+=S,++g);for(var b=1<<R.b,T=b-1,C=U(S,R.b),w=R.K,R=R.w+(g>>R.b)*C;g<E;){var A=w,I=R,N=1;for(zn(f,m,v,y-S,1,v,y);N<S;){var O=(N&~T)+b;O>S&&(O=S),(0,Zn[A[I++]>>8&15])(f,m+ +N,v,y+N-S,O-N,v,y+N),N=O}m+=S,y+=S,++g&T||(R+=C)}p!=u.nc&&r(d,l-_,d,l+(p-h-1)*_,_);break;case 1:for(_=f,E=m,S=(f=u.Ea)-(y=f&~(v=(m=1<<u.b)-1)),g=U(f,u.b),b=u.K,u=u.w+(h>>u.b)*g;h<p;){for(T=b,C=u,w=new V,R=E+y,A=E+f;E<R;)K(T[C++],w),$n(w,_,E,m,d,l),E+=m,l+=m;E<A&&(K(T[C++],w),$n(w,_,E,S,d,l),E+=S,l+=S),++h&v||(u+=g)}break;case 3:if(f==d&&m==l&&0<u.b){for(E=d,f=_=l+(p-h)*_-(y=(p-h)*U(u.Ea,u.b)),m=d,v=l,g=[],y=(S=y)-1;0<=y;--y)g[y]=m[v+y];for(y=S-1;0<=y;--y)E[f+y]=g[y];Yn(u,h,p,d,_,d,l)}else Yn(u,h,p,f,m,d,l)}l=a,d=i}d!=i&&r(a,i,l,d,s)}function be(e,n){var r=e.V,i=e.Ba+e.c*e.C,a=n-e.C;if(t(n<=e.l.o),t(16>=a),0<a){var o=e.l,s=e.Ta,c=e.Ua,l=o.width;if(Se(e,a,r,i),a=c=[c],t((r=e.C)<(i=n)),t(o.v<o.va),i>o.o&&(i=o.o),r<o.j){var d=o.j-r;r=o.j,a[0]+=d*l}if(r>=i?r=0:(a[0]+=4*o.v,o.ka=r-o.j,o.U=o.va-o.v,o.T=i-r,r=1),r){if(c=c[0],11>(r=e.ca).S){var u=r.f.RGBA,h=(i=r.S,a=o.U,o=o.T,d=u.eb,u.A),p=o;for(u=u.fb+e.Ma*u.A;0<p--;){var f=s,m=c,_=a,g=d,E=u;switch(i){case Mr:er(f,m,_,g,E);break;case Ur:tr(f,m,_,g,E);break;case Wr:tr(f,m,_,g,E),Tr(g,E,0,_,1,0);break;case Fr:ir(f,m,_,g,E);break;case jr:te(f,m,_,g,E,1);break;case Hr:te(f,m,_,g,E,1),Tr(g,E,0,_,1,0);break;case Vr:te(f,m,_,g,E,0);break;case qr:te(f,m,_,g,E,0),Tr(g,E,1,_,1,0);break;case Br:nr(f,m,_,g,E);break;case zr:nr(f,m,_,g,E),Cr(g,E,_,1,0);break;case Gr:rr(f,m,_,g,E);break;default:t(0)}c+=l,u+=h}e.Ma+=o}else alert("todo:EmitRescaledRowsYUVA");t(e.Ma<=r.height)}}e.C=n,t(e.C<=e.i)}function Te(e){var t;if(0<e.ua)return 0;for(t=0;t<e.Wb;++t){var n=e.Ya[t].G,r=e.Ya[t].H;if(0<n[1][r[1]+0].g||0<n[2][r[2]+0].g||0<n[3][r[3]+0].g)return 0}return 1}function Ce(e,n,r,i,a,o){if(0!=e.Z){var s=e.qd,c=e.rd;for(t(null!=_i[e.Z]);n<r;++n)_i[e.Z](s,c,i,a,i,a,o),s=i,c=a,a+=o;e.qd=s,e.rd=c}}function we(e,n){var r=e.l.ma,i=0==r.Z||1==r.Z?e.l.j:e.C;if(i=e.C<i?i:e.C,t(n<=e.l.o),n>i){var a=e.l.width,o=r.ca,s=r.tb+a*i,c=e.V,l=e.Ba+e.c*i,d=e.gc;t(1==e.ab),t(3==d[0].hc),Xn(d[0],i,n,c,l,o,s),Ce(r,i,n,o,s,a)}e.C=e.Ma=n}function Re(e,n,r,i,a,o,s){var c=e.$/i,l=e.$%i,d=e.m,u=e.s,h=r+e.$,p=h;a=r+i*a;var f=r+i*o,m=280+u.ua,_=e.Pb?c:16777216,g=0<u.ua?u.Wa:null,E=u.wc,v=h<f?ye(u,l,c):null;t(e.C<o),t(f<=a);var y=!1;e:for(;;){for(;y||h<f;){var S=0;if(c>=_){var R=h-r;t((_=e).Pb),_.wd=_.m,_.xd=R,0<_.s.ua&&k(_.s.Wa,_.s.vb),_=c+ei}if(l&E||(v=ye(u,l,c)),t(null!=v),v.Qb&&(n[h]=v.qb,y=!0),!y)if(w(d),v.jc){S=d,R=n;var A=h,I=v.pd[b(S)&jn-1];t(v.jc),256>I.g?(C(S,S.u+I.g),R[A]=I.value,S=0):(C(S,S.u+I.g-256),t(256<=I.value),S=I.value),0==S&&(y=!0)}else S=Ee(v.G[0],v.H[0],d);if(d.h)break;if(y||256>S){if(!y)if(v.nd)n[h]=(v.qb|S<<8)>>>0;else{if(w(d),y=Ee(v.G[1],v.H[1],d),w(d),R=Ee(v.G[2],v.H[2],d),A=Ee(v.G[3],v.H[3],d),d.h)break;n[h]=(A<<24|y<<16|S<<8|R)>>>0}if(y=!1,++h,++l>=i&&(l=0,++c,null!=s&&c<=o&&!(c%16)&&s(e,c),null!=g))for(;p<h;)S=n[p++],g.X[(506832829*S&4294967295)>>>g.Mb]=S}else if(280>S){if(S=_e(S-256,d),R=Ee(v.G[4],v.H[4],d),w(d),R=ge(i,R=_e(R,d)),d.h)break;if(h-r<R||a-h<S)break e;for(A=0;A<S;++A)n[h+A]=n[h+A-R];for(h+=S,l+=S;l>=i;)l-=i,++c,null!=s&&c<=o&&!(c%16)&&s(e,c);if(t(h<=a),l&E&&(v=ye(u,l,c)),null!=g)for(;p<h;)S=n[p++],g.X[(506832829*S&4294967295)>>>g.Mb]=S}else{if(!(S<m))break e;for(y=S-280,t(null!=g);p<h;)S=n[p++],g.X[(506832829*S&4294967295)>>>g.Mb]=S;S=h,t(!(y>>>(R=g).Xa)),n[S]=R.X[y],y=!0}y||t(d.h==T(d))}if(e.Pb&&d.h&&h<a)t(e.m.h),e.a=5,e.m=e.wd,e.$=e.xd,0<e.s.ua&&k(e.s.vb,e.s.Wa);else{if(d.h)break e;null!=s&&s(e,c>o?o:c),e.a=0,e.$=h-r}return 1}return e.a=3,0}function Ae(e){t(null!=e),e.vc=null,e.yc=null,e.Ya=null;var n=e.Wa;null!=n&&(n.X=null),e.vb=null,t(null!=e)}function Ie(){var t=new sn;return null==t?null:(t.a=0,t.xb=mi,ne("Predictor","VP8LPredictors"),ne("Predictor","VP8LPredictors_C"),ne("PredictorAdd","VP8LPredictorsAdd"),ne("PredictorAdd","VP8LPredictorsAdd_C"),Kn=z,$n=Y,er=X,tr=Q,nr=Z,rr=$,ir=ee,e.VP8LMapColor32b=Jn,e.VP8LMapColor8b=Qn,t)}function Ne(e,n,r,s,c){var l=1,h=[e],f=[n],m=s.m,_=s.s,g=null,E=0;e:for(;;){if(r)for(;l&&v(m,1);){var y=h,S=f,T=s,R=1,A=T.m,I=T.gc[T.ab],N=v(A,2);if(T.Oc&1<<N)l=0;else{switch(T.Oc|=1<<N,I.hc=N,I.Ea=y[0],I.nc=S[0],I.K=[null],++T.ab,t(4>=T.ab),N){case 0:case 1:I.b=v(A,3)+2,R=Ne(U(I.Ea,I.b),U(I.nc,I.b),0,T,I.K),I.K=I.K[0];break;case 3:var O,P=v(A,8)+1,L=16<P?0:4<P?1:2<P?2:3;if(y[0]=U(I.Ea,L),I.b=L,O=R=Ne(P,1,0,T,I.K)){var k,x=P,M=I,j=1<<(8>>M.b),V=a(j);if(null==V)O=0;else{var B=M.K[0],G=M.w;for(V[0]=M.K[0][0],k=1;k<1*x;++k)V[k]=F(B[G+k],V[k-1]);for(;k<4*j;++k)V[k]=0;M.K[0]=null,M.K[0]=V,O=1}}R=O;break;case 2:break;default:t(0)}l=R}}if(h=h[0],f=f[0],l&&v(m,1)&&!(l=1<=(E=v(m,4))&&11>=E)){s.a=3;break e}var W;if(W=l)t:{var H,q,z,K=s,Y=h,J=f,X=E,Q=r,Z=K.m,$=K.s,ee=[null],te=1,ne=0,re=$r[X];n:for(;;){if(Q&&v(Z,1)){var ie=v(Z,3)+2,ae=U(Y,ie),oe=U(J,ie),se=ae*oe;if(!Ne(ae,oe,0,K,ee))break n;for(ee=ee[0],$.xc=ie,H=0;H<se;++H){var ce=ee[H]>>8&65535;ee[H]=ce,ce>=te&&(te=ce+1)}}if(Z.h)break n;for(q=0;5>q;++q){var le=Jr[q];!q&&0<X&&(le+=1<<X),ne<le&&(ne=le)}var de=o(te*re,u),ue=te,he=o(ue,p);if(null==he)var pe=null;else t(65536>=ue),pe=he;var fe=a(ne);if(null==pe||null==fe||null==de){K.a=1;break n}var me=de;for(H=z=0;H<te;++H){var _e=pe[H],ge=_e.G,Ee=_e.H,ye=0,Se=1,be=0;for(q=0;5>q;++q){le=Jr[q],ge[q]=me,Ee[q]=z,!q&&0<X&&(le+=1<<X);r:{var Te,Ce=le,we=K,Ie=fe,Oe=me,Pe=z,Le=0,De=we.m,ke=v(De,1);if(i(Ie,0,0,Ce),ke){var xe=v(De,1)+1,Me=v(De,1),Ue=v(De,0==Me?1:8);Ie[Ue]=1,2==xe&&(Ie[Ue=v(De,8)]=1);var Fe=1}else{var je=a(19),Ve=v(De,4)+4;if(19<Ve){we.a=3;var Be=0;break r}for(Te=0;Te<Ve;++Te)je[Qr[Te]]=v(De,3);var Ge=void 0,We=void 0,He=we,qe=je,ze=Ce,Ke=Ie,Ye=0,Je=He.m,Xe=8,Qe=o(128,u);i:for(;d(Qe,0,7,qe,19);){if(v(Je,1)){var Ze=2+2*v(Je,3);if((Ge=2+v(Je,Ze))>ze)break i}else Ge=ze;for(We=0;We<ze&&Ge--;){w(Je);var $e=Qe[0+(127&b(Je))];C(Je,Je.u+$e.g);var et=$e.value;if(16>et)Ke[We++]=et,0!=et&&(Xe=et);else{var tt=16==et,nt=et-16,rt=Yr[nt],it=v(Je,Kr[nt])+rt;if(We+it>ze)break i;for(var at=tt?Xe:0;0<it--;)Ke[We++]=at}}Ye=1;break i}Ye||(He.a=3),Fe=Ye}(Fe=Fe&&!De.h)&&(Le=d(Oe,Pe,8,Ie,Ce)),Fe&&0!=Le?Be=Le:(we.a=3,Be=0)}if(0==Be)break n;if(Se&&1==Xr[q]&&(Se=0==me[z].g),ye+=me[z].g,z+=Be,3>=q){var ot,st=fe[0];for(ot=1;ot<le;++ot)fe[ot]>st&&(st=fe[ot]);be+=st}}if(_e.nd=Se,_e.Qb=0,Se&&(_e.qb=(ge[3][Ee[3]+0].value<<24|ge[1][Ee[1]+0].value<<16|ge[2][Ee[2]+0].value)>>>0,0==ye&&256>ge[0][Ee[0]+0].value&&(_e.Qb=1,_e.qb+=ge[0][Ee[0]+0].value<<8)),_e.jc=!_e.Qb&&6>be,_e.jc){var ct,lt=_e;for(ct=0;ct<jn;++ct){var dt=ct,ut=lt.pd[dt],ht=lt.G[0][lt.H[0]+dt];256<=ht.value?(ut.g=ht.g+256,ut.value=ht.value):(ut.g=0,ut.value=0,dt>>=ve(ht,8,ut),dt>>=ve(lt.G[1][lt.H[1]+dt],16,ut),dt>>=ve(lt.G[2][lt.H[2]+dt],0,ut),ve(lt.G[3][lt.H[3]+dt],24,ut))}}}$.vc=ee,$.Wb=te,$.Ya=pe,$.yc=de,W=1;break t}W=0}if(!(l=W)){s.a=3;break e}if(0<E){if(_.ua=1<<E,!D(_.Wa,E)){s.a=1,l=0;break e}}else _.ua=0;var pt=s,ft=h,mt=f,_t=pt.s,gt=_t.xc;if(pt.c=ft,pt.i=mt,_t.md=U(ft,gt),_t.wc=0==gt?-1:(1<<gt)-1,r){s.xb=fi;break e}if(null==(g=a(h*f))){s.a=1,l=0;break e}l=(l=Re(s,g,0,h,f,f,null))&&!m.h;break e}return l?(null!=c?c[0]=g:(t(null==g),t(r)),s.$=0,r||Ae(_)):Ae(_),l}function Oe(e,n){var r=e.c*e.i,i=r+n+16*n;return t(e.c<=n),e.V=a(i),null==e.V?(e.Ta=null,e.Ua=0,e.a=1,0):(e.Ta=e.V,e.Ua=e.Ba+r+n,1)}function Pe(e,n){var r=e.C,i=n-r,a=e.V,o=e.Ba+e.c*r;for(t(n<=e.l.o);0<i;){var s=16<i?16:i,c=e.l.ma,l=e.l.width,d=l*s,u=c.ca,h=c.tb+l*r,p=e.Ta,f=e.Ua;Se(e,s,a,o),Rr(p,f,u,h,d),Ce(c,r,r+s,u,h,l),i-=s,a+=s*e.c,r+=s}t(r==n),e.C=e.Ma=n}function Le(){this.ub=this.yd=this.td=this.Rb=0}function De(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function ke(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function xe(){this.Yb=function(){var e=[];return function e(t,n,r){for(var i=r[n],a=0;a<i&&(t.push(r.length>n+1?[]:0),!(r.length<n+1));a++)e(t[a],n+1,r)}(e,0,[3,11]),e}()}function Me(){this.jb=a(3),this.Wc=s([4,8],xe),this.Xc=s([4,17],xe)}function Ue(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function Fe(){this.ld=this.La=this.dd=this.tc=0}function je(){this.Na=this.la=0}function Ve(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Be(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Ge(){this.uc=this.M=this.Nb=0,this.wa=Array(new Fe),this.Y=0,this.ya=Array(new Be),this.aa=0,this.l=new ze}function We(){this.y=a(16),this.f=a(8),this.ea=a(8)}function He(){this.cb=this.a=0,this.sc="",this.m=new y,this.Od=new Le,this.Kc=new De,this.ed=new Ue,this.Qa=new ke,this.Ic=this.$c=this.Aa=0,this.D=new Ge,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=o(8,y),this.ia=0,this.pb=o(4,Ve),this.Pa=new Me,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new We),this.Hd=0,this.rb=Array(new je),this.sb=0,this.wa=Array(new Fe),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Be),this.L=this.aa=0,this.gd=s([4,2],Fe),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function qe(e,t){return 0>e?0:e>t?t:e}function ze(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Ke(){var e=new He;return null!=e&&(e.a=0,e.sc="OK",e.cb=0,e.Xb=0,ri||(ri=Qe)),e}function Ye(e,t,n){return 0==e.a&&(e.a=t,e.sc=n,e.cb=0),0}function Je(e,t,n){return 3<=n&&157==e[t+0]&&1==e[t+1]&&42==e[t+2]}function Xe(e,n){if(null==e)return 0;if(e.a=0,e.sc="OK",null==n)return Ye(e,2,"null VP8Io passed to VP8GetHeaders()");var r=n.data,a=n.w,o=n.ha;if(4>o)return Ye(e,7,"Truncated header.");var s=r[a+0]|r[a+1]<<8|r[a+2]<<16,c=e.Od;if(c.Rb=!(1&s),c.td=s>>1&7,c.yd=s>>4&1,c.ub=s>>5,3<c.td)return Ye(e,3,"Incorrect keyframe parameters.");if(!c.yd)return Ye(e,4,"Frame not displayable.");a+=3,o-=3;var l=e.Kc;if(c.Rb){if(7>o)return Ye(e,7,"cannot parse picture header");if(!Je(r,a,o))return Ye(e,3,"Bad code word");l.c=16383&(r[a+4]<<8|r[a+3]),l.Td=r[a+4]>>6,l.i=16383&(r[a+6]<<8|r[a+5]),l.Ud=r[a+6]>>6,a+=7,o-=7,e.za=l.c+15>>4,e.Ub=l.i+15>>4,n.width=l.c,n.height=l.i,n.Da=0,n.j=0,n.v=0,n.va=n.width,n.o=n.height,n.da=0,n.ib=n.width,n.hb=n.height,n.U=n.width,n.T=n.height,i((s=e.Pa).jb,0,255,s.jb.length),t(null!=(s=e.Qa)),s.Cb=0,s.Bb=0,s.Fb=1,i(s.Zb,0,0,s.Zb.length),i(s.Lb,0,0,s.Lb)}if(c.ub>o)return Ye(e,7,"bad partition length");f(s=e.m,r,a,c.ub),a+=c.ub,o-=c.ub,c.Rb&&(l.Ld=A(s),l.Kd=A(s)),l=e.Qa;var d,u=e.Pa;if(t(null!=s),t(null!=l),l.Cb=A(s),l.Cb){if(l.Bb=A(s),A(s)){for(l.Fb=A(s),d=0;4>d;++d)l.Zb[d]=A(s)?_(s,7):0;for(d=0;4>d;++d)l.Lb[d]=A(s)?_(s,6):0}if(l.Bb)for(d=0;3>d;++d)u.jb[d]=A(s)?m(s,8):255}else l.Bb=0;if(s.Ka)return Ye(e,3,"cannot parse segment header");if((l=e.ed).zd=A(s),l.Tb=m(s,6),l.wb=m(s,3),l.Pc=A(s),l.Pc&&A(s)){for(u=0;4>u;++u)A(s)&&(l.vd[u]=_(s,6));for(u=0;4>u;++u)A(s)&&(l.od[u]=_(s,6))}if(e.L=0==l.Tb?0:l.zd?1:2,s.Ka)return Ye(e,3,"cannot parse filter header");var h=o;if(o=d=a,a=d+h,l=h,e.Xb=(1<<m(e.m,2))-1,h<3*(u=e.Xb))r=7;else{for(d+=3*u,l-=3*u,h=0;h<u;++h){var p=r[o+0]|r[o+1]<<8|r[o+2]<<16;p>l&&(p=l),f(e.Jc[+h],r,d,p),d+=p,l-=p,o+=3}f(e.Jc[+u],r,d,l),r=d<a?0:5}if(0!=r)return Ye(e,r,"cannot parse partitions");for(r=m(d=e.m,7),o=A(d)?_(d,4):0,a=A(d)?_(d,4):0,l=A(d)?_(d,4):0,u=A(d)?_(d,4):0,d=A(d)?_(d,4):0,h=e.Qa,p=0;4>p;++p){if(h.Cb){var g=h.Zb[p];h.Fb||(g+=r)}else{if(0<p){e.pb[p]=e.pb[0];continue}g=r}var E=e.pb[p];E.Sc[0]=ti[qe(g+o,127)],E.Sc[1]=ni[qe(g+0,127)],E.Eb[0]=2*ti[qe(g+a,127)],E.Eb[1]=101581*ni[qe(g+l,127)]>>16,8>E.Eb[1]&&(E.Eb[1]=8),E.Qc[0]=ti[qe(g+u,117)],E.Qc[1]=ni[qe(g+d,127)],E.lc=g+d}if(!c.Rb)return Ye(e,4,"Not a key frame.");for(A(s),c=e.Pa,r=0;4>r;++r){for(o=0;8>o;++o)for(a=0;3>a;++a)for(l=0;11>l;++l)u=I(s,li[r][o][a][l])?m(s,8):si[r][o][a][l],c.Wc[r][o].Yb[a][l]=u;for(o=0;17>o;++o)c.Xc[r][o]=c.Wc[r][di[o]]}return e.kc=A(s),e.kc&&(e.Bd=m(s,8)),e.cb=1}function Qe(e,t,n,r,i,a,o){var s=t[i].Yb[n];for(n=0;16>i;++i){if(!I(e,s[n+0]))return i;for(;!I(e,s[n+1]);)if(s=t[++i].Yb[0],n=0,16==i)return 16;var c=t[i+1].Yb;if(I(e,s[n+2])){var l=e,d=0;if(I(l,(h=s)[(u=n)+3]))if(I(l,h[u+6])){for(s=0,u=2*(d=I(l,h[u+8]))+(h=I(l,h[u+9+d])),d=0,h=ii[u];h[s];++s)d+=d+I(l,h[s]);d+=3+(8<<u)}else I(l,h[u+7])?(d=7+2*I(l,165),d+=I(l,145)):d=5+I(l,159);else d=I(l,h[u+4])?3+I(l,h[u+5]):2;s=c[2]}else d=1,s=c[1];c=o+ai[i],0>(l=e).b&&R(l);var u,h=l.b,p=(u=l.Ca>>1)-(l.I>>h)>>31;--l.b,l.Ca+=p,l.Ca|=1,l.I-=(u+1&p)<<h,a[c]=((d^p)-p)*r[(0<i)+0]}return 16}function Ze(e){var t=e.rb[e.sb-1];t.la=0,t.Na=0,i(e.zc,0,0,e.zc.length),e.ja=0}function $e(e,n){if(null==e)return 0;if(null==n)return Ye(e,2,"NULL VP8Io parameter in VP8Decode().");if(!e.cb&&!Xe(e,n))return 0;if(t(e.cb),null==n.ac||n.ac(n)){n.ob&&(e.L=0);var s=ji[e.L];if(2==e.L?(e.yb=0,e.zb=0):(e.yb=n.v-s>>4,e.zb=n.j-s>>4,0>e.yb&&(e.yb=0),0>e.zb&&(e.zb=0)),e.Va=n.o+15+s>>4,e.Hb=n.va+15+s>>4,e.Hb>e.za&&(e.Hb=e.za),e.Va>e.Ub&&(e.Va=e.Ub),0<e.L){var c=e.ed;for(s=0;4>s;++s){var l;if(e.Qa.Cb){var d=e.Qa.Lb[s];e.Qa.Fb||(d+=c.Tb)}else d=c.Tb;for(l=0;1>=l;++l){var u=e.gd[s][l],h=d;if(c.Pc&&(h+=c.vd[0],l&&(h+=c.od[0])),0<(h=0>h?0:63<h?63:h)){var p=h;0<c.wb&&(p=4<c.wb?p>>2:p>>1)>9-c.wb&&(p=9-c.wb),1>p&&(p=1),u.dd=p,u.tc=2*h+p,u.ld=40<=h?2:15<=h?1:0}else u.tc=0;u.La=l}}}s=0}else Ye(e,6,"Frame setup failed"),s=e.a;if(s=0==s){if(s){e.$c=0,0<e.Aa||(e.Ic=Bi);e:{s=e.Ic,c=4*(p=e.za);var f=32*p,m=p+1,_=0<e.L?p*(0<e.Aa?2:1):0,g=(2==e.Aa?2:1)*p;if((u=c+832+(l=3*(16*s+ji[e.L])/2*f)+(d=null!=e.Fa&&0<e.Fa.length?e.Kc.c*e.Kc.i:0))!=u)s=0;else{if(u>e.Vb){if(e.Vb=0,e.Ec=a(u),e.Fc=0,null==e.Ec){s=Ye(e,1,"no memory during frame initialization.");break e}e.Vb=u}u=e.Ec,h=e.Fc,e.Ac=u,e.Bc=h,h+=c,e.Gd=o(f,We),e.Hd=0,e.rb=o(m+1,je),e.sb=1,e.wa=_?o(_,Fe):null,e.Y=0,e.D.Nb=0,e.D.wa=e.wa,e.D.Y=e.Y,0<e.Aa&&(e.D.Y+=p),t(!0),e.oc=u,e.pc=h,h+=832,e.ya=o(g,Be),e.aa=0,e.D.ya=e.ya,e.D.aa=e.aa,2==e.Aa&&(e.D.aa+=p),e.R=16*p,e.B=8*p,p=(f=ji[e.L])*e.R,f=f/2*e.B,e.sa=u,e.ta=h+p,e.qa=e.sa,e.ra=e.ta+16*s*e.R+f,e.Ha=e.qa,e.Ia=e.ra+8*s*e.B+f,e.$c=0,h+=l,e.mb=d?u:null,e.nb=d?h:null,t(h+d<=e.Fc+e.Vb),Ze(e),i(e.Ac,e.Bc,0,c),s=1}}if(s){if(n.ka=0,n.y=e.sa,n.O=e.ta,n.f=e.qa,n.N=e.ra,n.ea=e.Ha,n.Vd=e.Ia,n.fa=e.R,n.Rc=e.B,n.F=null,n.J=0,!Pr){for(s=-255;255>=s;++s)Ar[255+s]=0>s?-s:s;for(s=-1020;1020>=s;++s)Ir[1020+s]=-128>s?-128:127<s?127:s;for(s=-112;112>=s;++s)Nr[112+s]=-16>s?-16:15<s?15:s;for(s=-255;510>=s;++s)Or[255+s]=0>s?0:255<s?255:s;Pr=1}ar=lt,or=at,cr=ot,lr=st,dr=ct,sr=it,ur=Yt,hr=Jt,pr=Zt,fr=$t,mr=Xt,_r=Qt,gr=en,Er=tn,vr=Gt,yr=Wt,Sr=Ht,br=qt,hi[0]=Ct,hi[1]=ut,hi[2]=bt,hi[3]=Tt,hi[4]=wt,hi[5]=At,hi[6]=Rt,hi[7]=It,hi[8]=Ot,hi[9]=Nt,ui[0]=gt,ui[1]=pt,ui[2]=ft,ui[3]=mt,ui[4]=Et,ui[5]=vt,ui[6]=yt,pi[0]=kt,pi[1]=ht,pi[2]=Pt,pi[3]=Lt,pi[4]=Mt,pi[5]=xt,pi[6]=Ut,s=1}else s=0}s&&(s=function(e,n){for(e.M=0;e.M<e.Va;++e.M){var o,s=e.Jc[e.M&e.Xb],c=e.m,l=e;for(o=0;o<l.za;++o){var d=c,u=l,h=u.Ac,p=u.Bc+4*o,f=u.zc,m=u.ya[u.aa+o];if(u.Qa.Bb?m.$b=I(d,u.Pa.jb[0])?2+I(d,u.Pa.jb[2]):I(d,u.Pa.jb[1]):m.$b=0,u.kc&&(m.Ad=I(d,u.Bd)),m.Za=!I(d,145)+0,m.Za){var _=m.Ob,g=0;for(u=0;4>u;++u){var E,v=f[0+u];for(E=0;4>E;++E){v=ci[h[p+E]][v];for(var y=oi[I(d,v[0])];0<y;)y=oi[2*y+I(d,v[y])];v=-y,h[p+E]=v}r(_,g,h,p,4),g+=4,f[0+u]=v}}else v=I(d,156)?I(d,128)?1:3:I(d,163)?2:0,m.Ob[0]=v,i(h,p,v,4),i(f,0,v,4);m.Dd=I(d,142)?I(d,114)?I(d,183)?1:3:2:0}if(l.m.Ka)return Ye(e,7,"Premature end-of-partition0 encountered.");for(;e.ja<e.za;++e.ja){if(l=s,d=(c=e).rb[c.sb-1],h=c.rb[c.sb+c.ja],o=c.ya[c.aa+c.ja],p=c.kc?o.Ad:0)d.la=h.la=0,o.Za||(d.Na=h.Na=0),o.Hc=0,o.Gc=0,o.ia=0;else{var S,b;if(d=h,h=l,p=c.Pa.Xc,f=c.ya[c.aa+c.ja],m=c.pb[f.$b],u=f.ad,_=0,g=c.rb[c.sb-1],v=E=0,i(u,_,0,384),f.Za)var T=0,C=p[3];else{y=a(16);var w=d.Na+g.Na;if(w=ri(h,p[1],w,m.Eb,0,y,0),d.Na=g.Na=(0<w)+0,1<w)ar(y,0,u,_);else{var R=y[0]+3>>3;for(y=0;256>y;y+=16)u[_+y]=R}T=1,C=p[0]}var A=15&d.la,N=15&g.la;for(y=0;4>y;++y){var O=1&N;for(R=b=0;4>R;++R)A=A>>1|(O=(w=ri(h,C,w=O+(1&A),m.Sc,T,u,_))>T)<<7,b=b<<2|(3<w?3:1<w?2:0!=u[_+0]),_+=16;A>>=4,N=N>>1|O<<7,E=(E<<8|b)>>>0}for(C=A,T=N>>4,S=0;4>S;S+=2){for(b=0,A=d.la>>4+S,N=g.la>>4+S,y=0;2>y;++y){for(O=1&N,R=0;2>R;++R)w=O+(1&A),A=A>>1|(O=0<(w=ri(h,p[2],w,m.Qc,0,u,_)))<<3,b=b<<2|(3<w?3:1<w?2:0!=u[_+0]),_+=16;A>>=2,N=N>>1|O<<5}v|=b<<4*S,C|=A<<4<<S,T|=(240&N)<<S}d.la=C,g.la=T,f.Hc=E,f.Gc=v,f.ia=43690&v?0:m.ia,p=!(E|v)}if(0<c.L&&(c.wa[c.Y+c.ja]=c.gd[o.$b][o.Za],c.wa[c.Y+c.ja].La|=!p),l.Ka)return Ye(e,7,"Premature end-of-file encountered.")}if(Ze(e),c=n,l=1,o=(s=e).D,d=0<s.L&&s.M>=s.zb&&s.M<=s.Va,0==s.Aa)e:{if(o.M=s.M,o.uc=d,kn(s,o),l=1,o=(b=s.D).Nb,d=(v=ji[s.L])*s.R,h=v/2*s.B,y=16*o*s.R,R=8*o*s.B,p=s.sa,f=s.ta-d+y,m=s.qa,u=s.ra-h+R,_=s.Ha,g=s.Ia-h+R,N=0==(A=b.M),E=A>=s.Va-1,2==s.Aa&&kn(s,b),b.uc)for(O=(w=s).D.M,t(w.D.uc),b=w.yb;b<w.Hb;++b){T=b,C=O;var P=(L=(B=w).D).Nb;S=B.R;var L=L.wa[L.Y+T],D=B.sa,k=B.ta+16*P*S+16*T,x=L.dd,M=L.tc;if(0!=M)if(t(3<=M),1==B.L)0<T&&yr(D,k,S,M+4),L.La&&br(D,k,S,M),0<C&&vr(D,k,S,M+4),L.La&&Sr(D,k,S,M);else{var U=B.B,F=B.qa,j=B.ra+8*P*U+8*T,V=B.Ha,B=B.Ia+8*P*U+8*T;P=L.ld,0<T&&(hr(D,k,S,M+4,x,P),fr(F,j,V,B,U,M+4,x,P)),L.La&&(_r(D,k,S,M,x,P),Er(F,j,V,B,U,M,x,P)),0<C&&(ur(D,k,S,M+4,x,P),pr(F,j,V,B,U,M+4,x,P)),L.La&&(mr(D,k,S,M,x,P),gr(F,j,V,B,U,M,x,P))}}if(s.ia&&alert("todo:DitherRow"),null!=c.put){if(b=16*A,A=16*(A+1),N?(c.y=s.sa,c.O=s.ta+y,c.f=s.qa,c.N=s.ra+R,c.ea=s.Ha,c.W=s.Ia+R):(b-=v,c.y=p,c.O=f,c.f=m,c.N=u,c.ea=_,c.W=g),E||(A-=v),A>c.o&&(A=c.o),c.F=null,c.J=null,null!=s.Fa&&0<s.Fa.length&&b<A&&(c.J=hn(s,c,b,A-b),c.F=s.mb,null==c.F&&0==c.F.length)){l=Ye(s,3,"Could not decode alpha data.");break e}b<c.j&&(v=c.j-b,b=c.j,t(!(1&v)),c.O+=s.R*v,c.N+=s.B*(v>>1),c.W+=s.B*(v>>1),null!=c.F&&(c.J+=c.width*v)),b<A&&(c.O+=c.v,c.N+=c.v>>1,c.W+=c.v>>1,null!=c.F&&(c.J+=c.v),c.ka=b-c.j,c.U=c.va-c.v,c.T=A-b,l=c.put(c))}o+1!=s.Ic||E||(r(s.sa,s.ta-d,p,f+16*s.R,d),r(s.qa,s.ra-h,m,u+8*s.B,h),r(s.Ha,s.Ia-h,_,g+8*s.B,h))}if(!l)return Ye(e,6,"Output aborted.")}return 1}(e,n)),null!=n.bc&&n.bc(n),s&=1}return s?(e.cb=0,s):0}function et(e,t,n,r,i){i=e[t+n+32*r]+(i>>3),e[t+n+32*r]=-256&i?0>i?0:255:i}function tt(e,t,n,r,i,a){et(e,t,0,n,r+i),et(e,t,1,n,r+a),et(e,t,2,n,r-a),et(e,t,3,n,r-i)}function nt(e){return(20091*e>>16)+e}function rt(e,t,n,r){var i,o=0,s=a(16);for(i=0;4>i;++i){var c=e[t+0]+e[t+8],l=e[t+0]-e[t+8],d=(35468*e[t+4]>>16)-nt(e[t+12]),u=nt(e[t+4])+(35468*e[t+12]>>16);s[o+0]=c+u,s[o+1]=l+d,s[o+2]=l-d,s[o+3]=c-u,o+=4,t++}for(i=o=0;4>i;++i)c=(e=s[o+0]+4)+s[o+8],l=e-s[o+8],d=(35468*s[o+4]>>16)-nt(s[o+12]),et(n,r,0,0,c+(u=nt(s[o+4])+(35468*s[o+12]>>16))),et(n,r,1,0,l+d),et(n,r,2,0,l-d),et(n,r,3,0,c-u),o++,r+=32}function it(e,t,n,r){var i=e[t+0]+4,a=35468*e[t+4]>>16,o=nt(e[t+4]),s=35468*e[t+1]>>16;tt(n,r,0,i+o,e=nt(e[t+1]),s),tt(n,r,1,i+a,e,s),tt(n,r,2,i-a,e,s),tt(n,r,3,i-o,e,s)}function at(e,t,n,r,i){rt(e,t,n,r),i&&rt(e,t+16,n,r+4)}function ot(e,t,n,r){or(e,t+0,n,r,1),or(e,t+32,n,r+128,1)}function st(e,t,n,r){var i;for(e=e[t+0]+4,i=0;4>i;++i)for(t=0;4>t;++t)et(n,r,t,i,e)}function ct(e,t,n,r){e[t+0]&&lr(e,t+0,n,r),e[t+16]&&lr(e,t+16,n,r+4),e[t+32]&&lr(e,t+32,n,r+128),e[t+48]&&lr(e,t+48,n,r+128+4)}function lt(e,t,n,r){var i,o=a(16);for(i=0;4>i;++i){var s=e[t+0+i]+e[t+12+i],c=e[t+4+i]+e[t+8+i],l=e[t+4+i]-e[t+8+i],d=e[t+0+i]-e[t+12+i];o[0+i]=s+c,o[8+i]=s-c,o[4+i]=d+l,o[12+i]=d-l}for(i=0;4>i;++i)s=(e=o[0+4*i]+3)+o[3+4*i],c=o[1+4*i]+o[2+4*i],l=o[1+4*i]-o[2+4*i],d=e-o[3+4*i],n[r+0]=s+c>>3,n[r+16]=d+l>>3,n[r+32]=s-c>>3,n[r+48]=d-l>>3,r+=64}function dt(e,t,n){var r,i=t-32,a=kr,o=255-e[i-1];for(r=0;r<n;++r){var s,c=a,l=o+e[t-1];for(s=0;s<n;++s)e[t+s]=c[l+e[i+s]];t+=32}}function ut(e,t){dt(e,t,4)}function ht(e,t){dt(e,t,8)}function pt(e,t){dt(e,t,16)}function ft(e,t){var n;for(n=0;16>n;++n)r(e,t+32*n,e,t-32,16)}function mt(e,t){var n;for(n=16;0<n;--n)i(e,t,e[t-1],16),t+=32}function _t(e,t,n){var r;for(r=0;16>r;++r)i(t,n+32*r,e,16)}function gt(e,t){var n,r=16;for(n=0;16>n;++n)r+=e[t-1+32*n]+e[t+n-32];_t(r>>5,e,t)}function Et(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t-1+32*n];_t(r>>4,e,t)}function vt(e,t){var n,r=8;for(n=0;16>n;++n)r+=e[t+n-32];_t(r>>4,e,t)}function yt(e,t){_t(128,e,t)}function St(e,t,n){return e+2*t+n+2>>2}function bt(e,t){var n,i=t-32;for(i=new Uint8Array([St(e[i-1],e[i+0],e[i+1]),St(e[i+0],e[i+1],e[i+2]),St(e[i+1],e[i+2],e[i+3]),St(e[i+2],e[i+3],e[i+4])]),n=0;4>n;++n)r(e,t+32*n,i,0,i.length)}function Tt(e,t){var n=e[t-1],r=e[t-1+32],i=e[t-1+64],a=e[t-1+96];N(e,t+0,16843009*St(e[t-1-32],n,r)),N(e,t+32,16843009*St(n,r,i)),N(e,t+64,16843009*St(r,i,a)),N(e,t+96,16843009*St(i,a,a))}function Ct(e,t){var n,r=4;for(n=0;4>n;++n)r+=e[t+n-32]+e[t-1+32*n];for(r>>=3,n=0;4>n;++n)i(e,t+32*n,r,4)}function wt(e,t){var n=e[t-1+0],r=e[t-1+32],i=e[t-1+64],a=e[t-1-32],o=e[t+0-32],s=e[t+1-32],c=e[t+2-32],l=e[t+3-32];e[t+0+96]=St(r,i,e[t-1+96]),e[t+1+96]=e[t+0+64]=St(n,r,i),e[t+2+96]=e[t+1+64]=e[t+0+32]=St(a,n,r),e[t+3+96]=e[t+2+64]=e[t+1+32]=e[t+0+0]=St(o,a,n),e[t+3+64]=e[t+2+32]=e[t+1+0]=St(s,o,a),e[t+3+32]=e[t+2+0]=St(c,s,o),e[t+3+0]=St(l,c,s)}function Rt(e,t){var n=e[t+1-32],r=e[t+2-32],i=e[t+3-32],a=e[t+4-32],o=e[t+5-32],s=e[t+6-32],c=e[t+7-32];e[t+0+0]=St(e[t+0-32],n,r),e[t+1+0]=e[t+0+32]=St(n,r,i),e[t+2+0]=e[t+1+32]=e[t+0+64]=St(r,i,a),e[t+3+0]=e[t+2+32]=e[t+1+64]=e[t+0+96]=St(i,a,o),e[t+3+32]=e[t+2+64]=e[t+1+96]=St(a,o,s),e[t+3+64]=e[t+2+96]=St(o,s,c),e[t+3+96]=St(s,c,c)}function At(e,t){var n=e[t-1+0],r=e[t-1+32],i=e[t-1+64],a=e[t-1-32],o=e[t+0-32],s=e[t+1-32],c=e[t+2-32],l=e[t+3-32];e[t+0+0]=e[t+1+64]=a+o+1>>1,e[t+1+0]=e[t+2+64]=o+s+1>>1,e[t+2+0]=e[t+3+64]=s+c+1>>1,e[t+3+0]=c+l+1>>1,e[t+0+96]=St(i,r,n),e[t+0+64]=St(r,n,a),e[t+0+32]=e[t+1+96]=St(n,a,o),e[t+1+32]=e[t+2+96]=St(a,o,s),e[t+2+32]=e[t+3+96]=St(o,s,c),e[t+3+32]=St(s,c,l)}function It(e,t){var n=e[t+0-32],r=e[t+1-32],i=e[t+2-32],a=e[t+3-32],o=e[t+4-32],s=e[t+5-32],c=e[t+6-32],l=e[t+7-32];e[t+0+0]=n+r+1>>1,e[t+1+0]=e[t+0+64]=r+i+1>>1,e[t+2+0]=e[t+1+64]=i+a+1>>1,e[t+3+0]=e[t+2+64]=a+o+1>>1,e[t+0+32]=St(n,r,i),e[t+1+32]=e[t+0+96]=St(r,i,a),e[t+2+32]=e[t+1+96]=St(i,a,o),e[t+3+32]=e[t+2+96]=St(a,o,s),e[t+3+64]=St(o,s,c),e[t+3+96]=St(s,c,l)}function Nt(e,t){var n=e[t-1+0],r=e[t-1+32],i=e[t-1+64],a=e[t-1+96];e[t+0+0]=n+r+1>>1,e[t+2+0]=e[t+0+32]=r+i+1>>1,e[t+2+32]=e[t+0+64]=i+a+1>>1,e[t+1+0]=St(n,r,i),e[t+3+0]=e[t+1+32]=St(r,i,a),e[t+3+32]=e[t+1+64]=St(i,a,a),e[t+3+64]=e[t+2+64]=e[t+0+96]=e[t+1+96]=e[t+2+96]=e[t+3+96]=a}function Ot(e,t){var n=e[t-1+0],r=e[t-1+32],i=e[t-1+64],a=e[t-1+96],o=e[t-1-32],s=e[t+0-32],c=e[t+1-32],l=e[t+2-32];e[t+0+0]=e[t+2+32]=n+o+1>>1,e[t+0+32]=e[t+2+64]=r+n+1>>1,e[t+0+64]=e[t+2+96]=i+r+1>>1,e[t+0+96]=a+i+1>>1,e[t+3+0]=St(s,c,l),e[t+2+0]=St(o,s,c),e[t+1+0]=e[t+3+32]=St(n,o,s),e[t+1+32]=e[t+3+64]=St(r,n,o),e[t+1+64]=e[t+3+96]=St(i,r,n),e[t+1+96]=St(a,i,r)}function Pt(e,t){var n;for(n=0;8>n;++n)r(e,t+32*n,e,t-32,8)}function Lt(e,t){var n;for(n=0;8>n;++n)i(e,t,e[t-1],8),t+=32}function Dt(e,t,n){var r;for(r=0;8>r;++r)i(t,n+32*r,e,8)}function kt(e,t){var n,r=8;for(n=0;8>n;++n)r+=e[t+n-32]+e[t-1+32*n];Dt(r>>4,e,t)}function xt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t+n-32];Dt(r>>3,e,t)}function Mt(e,t){var n,r=4;for(n=0;8>n;++n)r+=e[t-1+32*n];Dt(r>>3,e,t)}function Ut(e,t){Dt(128,e,t)}function Ft(e,t,n){var r=e[t-n],i=e[t+0],a=3*(i-r)+Lr[1020+e[t-2*n]-e[t+n]],o=Dr[112+(a+4>>3)];e[t-n]=kr[255+r+Dr[112+(a+3>>3)]],e[t+0]=kr[255+i-o]}function jt(e,t,n,r){var i=e[t+0],a=e[t+n];return xr[255+e[t-2*n]-e[t-n]]>r||xr[255+a-i]>r}function Vt(e,t,n,r){return 4*xr[255+e[t-n]-e[t+0]]+xr[255+e[t-2*n]-e[t+n]]<=r}function Bt(e,t,n,r,i){var a=e[t-3*n],o=e[t-2*n],s=e[t-n],c=e[t+0],l=e[t+n],d=e[t+2*n],u=e[t+3*n];return 4*xr[255+s-c]+xr[255+o-l]>r?0:xr[255+e[t-4*n]-a]<=i&&xr[255+a-o]<=i&&xr[255+o-s]<=i&&xr[255+u-d]<=i&&xr[255+d-l]<=i&&xr[255+l-c]<=i}function Gt(e,t,n,r){var i=2*r+1;for(r=0;16>r;++r)Vt(e,t+r,n,i)&&Ft(e,t+r,n)}function Wt(e,t,n,r){var i=2*r+1;for(r=0;16>r;++r)Vt(e,t+r*n,1,i)&&Ft(e,t+r*n,1)}function Ht(e,t,n,r){var i;for(i=3;0<i;--i)Gt(e,t+=4*n,n,r)}function qt(e,t,n,r){var i;for(i=3;0<i;--i)Wt(e,t+=4,n,r)}function zt(e,t,n,r,i,a,o,s){for(a=2*a+1;0<i--;){if(Bt(e,t,n,a,o))if(jt(e,t,n,s))Ft(e,t,n);else{var c=e,l=t,d=n,u=c[l-2*d],h=c[l-d],p=c[l+0],f=c[l+d],m=c[l+2*d],_=27*(E=Lr[1020+3*(p-h)+Lr[1020+u-f]])+63>>7,g=18*E+63>>7,E=9*E+63>>7;c[l-3*d]=kr[255+c[l-3*d]+E],c[l-2*d]=kr[255+u+g],c[l-d]=kr[255+h+_],c[l+0]=kr[255+p-_],c[l+d]=kr[255+f-g],c[l+2*d]=kr[255+m-E]}t+=r}}function Kt(e,t,n,r,i,a,o,s){for(a=2*a+1;0<i--;){if(Bt(e,t,n,a,o))if(jt(e,t,n,s))Ft(e,t,n);else{var c=e,l=t,d=n,u=c[l-d],h=c[l+0],p=c[l+d],f=Dr[112+(4+(m=3*(h-u))>>3)],m=Dr[112+(m+3>>3)],_=f+1>>1;c[l-2*d]=kr[255+c[l-2*d]+_],c[l-d]=kr[255+u+m],c[l+0]=kr[255+h-f],c[l+d]=kr[255+p-_]}t+=r}}function Yt(e,t,n,r,i,a){zt(e,t,n,1,16,r,i,a)}function Jt(e,t,n,r,i,a){zt(e,t,1,n,16,r,i,a)}function Xt(e,t,n,r,i,a){var o;for(o=3;0<o;--o)Kt(e,t+=4*n,n,1,16,r,i,a)}function Qt(e,t,n,r,i,a){var o;for(o=3;0<o;--o)Kt(e,t+=4,1,n,16,r,i,a)}function Zt(e,t,n,r,i,a,o,s){zt(e,t,i,1,8,a,o,s),zt(n,r,i,1,8,a,o,s)}function $t(e,t,n,r,i,a,o,s){zt(e,t,1,i,8,a,o,s),zt(n,r,1,i,8,a,o,s)}function en(e,t,n,r,i,a,o,s){Kt(e,t+4*i,i,1,8,a,o,s),Kt(n,r+4*i,i,1,8,a,o,s)}function tn(e,t,n,r,i,a,o,s){Kt(e,t+4,1,i,8,a,o,s),Kt(n,r+4,1,i,8,a,o,s)}function nn(){this.ba=new oe,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new ce,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function rn(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function an(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function on(){this.ua=0,this.Wa=new x,this.vb=new x,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new p,this.yc=new u}function sn(){this.xb=this.a=0,this.l=new ze,this.ca=new oe,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new S,this.Pb=0,this.wd=new S,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new on,this.ab=0,this.gc=o(4,an),this.Oc=0}function cn(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new ze,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ln(e,t,n,r,i,a,o){for(e=null==e?0:e[t+0],t=0;t<o;++t)i[a+t]=e+n[r+t]&255,e=i[a+t]}function dn(e,t,n,r,i,a,o){var s;if(null==e)ln(null,null,n,r,i,a,o);else for(s=0;s<o;++s)i[a+s]=e[t+s]+n[r+s]&255}function un(e,t,n,r,i,a,o){if(null==e)ln(null,null,n,r,i,a,o);else{var s,c=e[t+0],l=c,d=c;for(s=0;s<o;++s)l=d+(c=e[t+s])-l,d=n[r+s]+(-256&l?0>l?0:255:l)&255,l=c,i[a+s]=d}}function hn(e,n,i,o){var s=n.width,c=n.o;if(t(null!=e&&null!=n),0>i||0>=o||i+o>c)return null;if(!e.Cc){if(null==e.ga){var l;if(e.ga=new cn,(l=null==e.ga)||(l=n.width*n.o,t(0==e.Gb.length),e.Gb=a(l),e.Uc=0,null==e.Gb?l=0:(e.mb=e.Gb,e.nb=e.Uc,e.rc=null,l=1),l=!l),!l){l=e.ga;var d=e.Fa,u=e.P,h=e.qc,p=e.mb,f=e.nb,m=u+1,_=h-1,E=l.l;if(t(null!=d&&null!=p&&null!=n),_i[0]=null,_i[1]=ln,_i[2]=dn,_i[3]=un,l.ca=p,l.tb=f,l.c=n.width,l.i=n.height,t(0<l.c&&0<l.i),1>=h)n=0;else if(l.$a=3&d[u+0],l.Z=d[u+0]>>2&3,l.Lc=d[u+0]>>4&3,u=d[u+0]>>6&3,0>l.$a||1<l.$a||4<=l.Z||1<l.Lc||u)n=0;else if(E.put=pe,E.ac=he,E.bc=fe,E.ma=l,E.width=n.width,E.height=n.height,E.Da=n.Da,E.v=n.v,E.va=n.va,E.j=n.j,E.o=n.o,l.$a)e:{t(1==l.$a),n=Ie();t:for(;;){if(null==n){n=0;break e}if(t(null!=l),l.mc=n,n.c=l.c,n.i=l.i,n.l=l.l,n.l.ma=l,n.l.width=l.c,n.l.height=l.i,n.a=0,g(n.m,d,m,_),!Ne(l.c,l.i,1,n,null))break t;if(1==n.ab&&3==n.gc[0].hc&&Te(n.s)?(l.ic=1,d=n.c*n.i,n.Ta=null,n.Ua=0,n.V=a(d),n.Ba=0,null==n.V?(n.a=1,n=0):n=1):(l.ic=0,n=Oe(n,l.c)),!n)break t;n=1;break e}l.mc=null,n=0}else n=_>=l.c*l.i;l=!n}if(l)return null;1!=e.ga.Lc?e.Ga=0:o=c-i}t(null!=e.ga),t(i+o<=c);e:{if(n=(d=e.ga).c,c=d.l.o,0==d.$a){if(m=e.rc,_=e.Vc,E=e.Fa,u=e.P+1+i*n,h=e.mb,p=e.nb+i*n,t(u<=e.P+e.qc),0!=d.Z)for(t(null!=_i[d.Z]),l=0;l<o;++l)_i[d.Z](m,_,E,u,h,p,n),m=h,_=p,p+=n,u+=n;else for(l=0;l<o;++l)r(h,p,E,u,n),m=h,_=p,p+=n,u+=n;e.rc=m,e.Vc=_}else{if(t(null!=d.mc),n=i+o,t(null!=(l=d.mc)),t(n<=l.i),l.C>=n)n=1;else if(d.ic||gn(),d.ic){d=l.V,m=l.Ba,_=l.c;var v=l.i,y=(E=1,u=l.$/_,h=l.$%_,p=l.m,f=l.s,l.$),S=_*v,b=_*n,C=f.wc,R=y<b?ye(f,h,u):null;t(y<=S),t(n<=v),t(Te(f));t:for(;;){for(;!p.h&&y<b;){if(h&C||(R=ye(f,h,u)),t(null!=R),w(p),256>(v=Ee(R.G[0],R.H[0],p)))d[m+y]=v,++y,++h>=_&&(h=0,++u<=n&&!(u%16)&&we(l,u));else{if(!(280>v)){E=0;break t}v=_e(v-256,p);var A,I=Ee(R.G[4],R.H[4],p);if(w(p),!(y>=(I=ge(_,I=_e(I,p)))&&S-y>=v)){E=0;break t}for(A=0;A<v;++A)d[m+y+A]=d[m+y+A-I];for(y+=v,h+=v;h>=_;)h-=_,++u<=n&&!(u%16)&&we(l,u);y<b&&h&C&&(R=ye(f,h,u))}t(p.h==T(p))}we(l,u>n?n:u);break t}!E||p.h&&y<S?(E=0,l.a=p.h?5:3):l.$=y,n=E}else n=Re(l,l.V,l.Ba,l.c,l.i,n,Pe);if(!n){o=0;break e}}i+o>=c&&(e.Cc=1),o=1}if(!o)return null;if(e.Cc&&(null!=(o=e.ga)&&(o.mc=null),e.ga=null,0<e.Ga))return alert("todo:WebPDequantizeLevels"),null}return e.nb+i*s}function pn(e,t,n,r,i,a){for(;0<i--;){var o,s=e,c=t+(n?1:0),l=e,d=t+(n?0:3);for(o=0;o<r;++o){var u=l[d+4*o];255!=u&&(u*=32897,s[c+4*o+0]=s[c+4*o+0]*u>>23,s[c+4*o+1]=s[c+4*o+1]*u>>23,s[c+4*o+2]=s[c+4*o+2]*u>>23)}t+=a}}function fn(e,t,n,r,i){for(;0<r--;){var a;for(a=0;a<n;++a){var o=e[t+2*a+0],s=15&(l=e[t+2*a+1]),c=4369*s,l=(240&l|l>>4)*c>>16;e[t+2*a+0]=(240&o|o>>4)*c>>16&240|(15&o|o<<4)*c>>16>>4&15,e[t+2*a+1]=240&l|s}t+=i}}function mn(e,t,n,r,i,a,o,s){var c,l,d=255;for(l=0;l<i;++l){for(c=0;c<r;++c){var u=e[t+c];a[o+4*c]=u,d&=u}t+=n,o+=s}return 255!=d}function _n(e,t,n,r,i){var a;for(a=0;a<i;++a)n[r+a]=e[t+a]>>8}function gn(){Tr=pn,Cr=fn,wr=mn,Rr=_n}function En(n,r,i){e[n]=function(e,n,a,o,s,c,l,d,u,h,p,f,m,_,g,E,v){var y,S=v-1>>1,b=s[c+0]|l[d+0]<<16,T=u[h+0]|p[f+0]<<16;t(null!=e);var C=3*b+T+131074>>2;for(r(e[n+0],255&C,C>>16,m,_),null!=a&&(C=3*T+b+131074>>2,r(a[o+0],255&C,C>>16,g,E)),y=1;y<=S;++y){var w=s[c+y]|l[d+y]<<16,R=u[h+y]|p[f+y]<<16,A=b+w+T+R+524296,I=A+2*(w+T)>>3;C=I+b>>1,b=(A=A+2*(b+R)>>3)+w>>1,r(e[n+2*y-1],255&C,C>>16,m,_+(2*y-1)*i),r(e[n+2*y-0],255&b,b>>16,m,_+(2*y-0)*i),null!=a&&(C=A+T>>1,b=I+R>>1,r(a[o+2*y-1],255&C,C>>16,g,E+(2*y-1)*i),r(a[o+2*y+0],255&b,b>>16,g,E+(2*y+0)*i)),b=w,T=R}1&v||(C=3*b+T+131074>>2,r(e[n+v-1],255&C,C>>16,m,_+(v-1)*i),null!=a&&(C=3*T+b+131074>>2,r(a[o+v-1],255&C,C>>16,g,E+(v-1)*i)))}}function vn(){gi[Mr]=Ei,gi[Ur]=yi,gi[Fr]=vi,gi[jr]=Si,gi[Vr]=bi,gi[Br]=Ti,gi[Gr]=Ci,gi[Wr]=yi,gi[Hr]=Si,gi[qr]=bi,gi[zr]=Ti}function yn(e){return e&~Oi?0>e?0:255:e>>Ni}function Sn(e,t){return yn((19077*e>>8)+(26149*t>>8)-14234)}function bn(e,t,n){return yn((19077*e>>8)-(6419*t>>8)-(13320*n>>8)+8708)}function Tn(e,t){return yn((19077*e>>8)+(33050*t>>8)-17685)}function Cn(e,t,n,r,i){r[i+0]=Sn(e,n),r[i+1]=bn(e,t,n),r[i+2]=Tn(e,t)}function wn(e,t,n,r,i){r[i+0]=Tn(e,t),r[i+1]=bn(e,t,n),r[i+2]=Sn(e,n)}function Rn(e,t,n,r,i){var a=bn(e,t,n);t=a<<3&224|Tn(e,t)>>3,r[i+0]=248&Sn(e,n)|a>>5,r[i+1]=t}function An(e,t,n,r,i){var a=240&Tn(e,t)|15;r[i+0]=240&Sn(e,n)|bn(e,t,n)>>4,r[i+1]=a}function In(e,t,n,r,i){r[i+0]=255,Cn(e,t,n,r,i+1)}function Nn(e,t,n,r,i){wn(e,t,n,r,i),r[i+3]=255}function On(e,t,n,r,i){Cn(e,t,n,r,i),r[i+3]=255}function qe(e,t){return 0>e?0:e>t?t:e}function Pn(t,n,r){e[t]=function(e,t,i,a,o,s,c,l,d){for(var u=l+(-2&d)*r;l!=u;)n(e[t+0],i[a+0],o[s+0],c,l),n(e[t+1],i[a+0],o[s+0],c,l+r),t+=2,++a,++s,l+=2*r;1&d&&n(e[t+0],i[a+0],o[s+0],c,l)}}function Ln(e,t,n){return 0==n?0==e?0==t?6:5:0==t?4:0:n}function Dn(e,t,n,r,i){switch(e>>>30){case 3:or(t,n,r,i,0);break;case 2:sr(t,n,r,i);break;case 1:lr(t,n,r,i)}}function kn(e,t){var n,a,o=t.M,s=t.Nb,c=e.oc,l=e.pc+40,d=e.oc,u=e.pc+584,h=e.oc,p=e.pc+600;for(n=0;16>n;++n)c[l+32*n-1]=129;for(n=0;8>n;++n)d[u+32*n-1]=129,h[p+32*n-1]=129;for(0<o?c[l-1-32]=d[u-1-32]=h[p-1-32]=129:(i(c,l-32-1,127,21),i(d,u-32-1,127,9),i(h,p-32-1,127,9)),a=0;a<e.za;++a){var f=t.ya[t.aa+a];if(0<a){for(n=-1;16>n;++n)r(c,l+32*n-4,c,l+32*n+12,4);for(n=-1;8>n;++n)r(d,u+32*n-4,d,u+32*n+4,4),r(h,p+32*n-4,h,p+32*n+4,4)}var m=e.Gd,_=e.Hd+a,g=f.ad,E=f.Hc;if(0<o&&(r(c,l-32,m[_].y,0,16),r(d,u-32,m[_].f,0,8),r(h,p-32,m[_].ea,0,8)),f.Za){var v=c,y=l-32+16;for(0<o&&(a>=e.za-1?i(v,y,m[_].y[15],4):r(v,y,m[_+1].y,0,4)),n=0;4>n;n++)v[y+128+n]=v[y+256+n]=v[y+384+n]=v[y+0+n];for(n=0;16>n;++n,E<<=2)v=c,y=l+Fi[n],hi[f.Ob[n]](v,y),Dn(E,g,16*+n,v,y)}else if(v=Ln(a,o,f.Ob[0]),ui[v](c,l),0!=E)for(n=0;16>n;++n,E<<=2)Dn(E,g,16*+n,c,l+Fi[n]);for(n=f.Gc,v=Ln(a,o,f.Dd),pi[v](d,u),pi[v](h,p),E=g,v=d,y=u,255&(f=n|0)&&(170&f?cr(E,256,v,y):dr(E,256,v,y)),f=h,E=p,255&(n>>=8)&&(170&n?cr(g,320,f,E):dr(g,320,f,E)),o<e.Ub-1&&(r(m[_].y,0,c,l+480,16),r(m[_].f,0,d,u+224,8),r(m[_].ea,0,h,p+224,8)),n=8*s*e.B,m=e.sa,_=e.ta+16*a+16*s*e.R,g=e.qa,f=e.ra+8*a+n,E=e.Ha,v=e.Ia+8*a+n,n=0;16>n;++n)r(m,_+n*e.R,c,l+32*n,16);for(n=0;8>n;++n)r(g,f+n*e.B,d,u+32*n,8),r(E,v+n*e.B,h,p+32*n,8)}}function xn(e,r,i,a,o,s,c,l,d){var u=[0],h=[0],p=0,f=null!=d?d.kd:0,m=null!=d?d:new rn;if(null==e||12>i)return 7;m.data=e,m.w=r,m.ha=i,r=[r],i=[i],m.gb=[m.gb];e:{var _=r,E=i,v=m.gb;if(t(null!=e),t(null!=E),t(null!=v),v[0]=0,12<=E[0]&&!n(e,_[0],"RIFF")){if(n(e,_[0]+8,"WEBP")){v=3;break e}var y=L(e,_[0]+4);if(12>y||4294967286<y){v=3;break e}if(f&&y>E[0]-8){v=7;break e}v[0]=y,_[0]+=12,E[0]-=12}v=0}if(0!=v)return v;for(y=0<m.gb[0],i=i[0];;){e:{var b=e;E=r,v=i;var T=u,C=h,w=_=[0];if((I=p=[p])[0]=0,8>v[0])v=7;else{if(!n(b,E[0],"VP8X")){if(10!=L(b,E[0]+4)){v=3;break e}if(18>v[0]){v=7;break e}var R=L(b,E[0]+8),A=1+P(b,E[0]+12);if(2147483648<=A*(b=1+P(b,E[0]+15))){v=3;break e}null!=w&&(w[0]=R),null!=T&&(T[0]=A),null!=C&&(C[0]=b),E[0]+=18,v[0]-=18,I[0]=1}v=0}}if(p=p[0],_=_[0],0!=v)return v;if(E=!!(2&_),!y&&p)return 3;if(null!=s&&(s[0]=!!(16&_)),null!=c&&(c[0]=E),null!=l&&(l[0]=0),c=u[0],_=h[0],p&&E&&null==d){v=0;break}if(4>i){v=7;break}if(y&&p||!y&&!p&&!n(e,r[0],"ALPH")){i=[i],m.na=[m.na],m.P=[m.P],m.Sa=[m.Sa];e:{R=e,v=r,y=i;var I=m.gb;T=m.na,C=m.P,w=m.Sa,A=22,t(null!=R),t(null!=y),b=v[0];var N=y[0];for(t(null!=T),t(null!=w),T[0]=null,C[0]=null,w[0]=0;;){if(v[0]=b,y[0]=N,8>N){v=7;break e}var O=L(R,b+4);if(4294967286<O){v=3;break e}var D=8+O+1&-2;if(A+=D,0<I&&A>I){v=3;break e}if(!n(R,b,"VP8 ")||!n(R,b,"VP8L")){v=0;break e}if(N[0]<D){v=7;break e}n(R,b,"ALPH")||(T[0]=R,C[0]=b+8,w[0]=O),b+=D,N-=D}}if(i=i[0],m.na=m.na[0],m.P=m.P[0],m.Sa=m.Sa[0],0!=v)break}i=[i],m.Ja=[m.Ja],m.xa=[m.xa];e:if(I=e,v=r,y=i,T=m.gb[0],C=m.Ja,w=m.xa,R=v[0],b=!n(I,R,"VP8 "),A=!n(I,R,"VP8L"),t(null!=I),t(null!=y),t(null!=C),t(null!=w),8>y[0])v=7;else{if(b||A){if(I=L(I,R+4),12<=T&&I>T-12){v=3;break e}if(f&&I>y[0]-8){v=7;break e}C[0]=I,v[0]+=8,y[0]-=8,w[0]=A}else w[0]=5<=y[0]&&47==I[R+0]&&!(I[R+4]>>5),C[0]=y[0];v=0}if(i=i[0],m.Ja=m.Ja[0],m.xa=m.xa[0],r=r[0],0!=v)break;if(4294967286<m.Ja)return 3;if(null==l||E||(l[0]=m.xa?2:1),c=[c],_=[_],m.xa){if(5>i){v=7;break}l=c,f=_,E=s,null==e||5>i?e=0:5<=i&&47==e[r+0]&&!(e[r+4]>>5)?(y=[0],I=[0],T=[0],g(C=new S,e,r,i),me(C,y,I,T)?(null!=l&&(l[0]=y[0]),null!=f&&(f[0]=I[0]),null!=E&&(E[0]=T[0]),e=1):e=0):e=0}else{if(10>i){v=7;break}l=_,null==e||10>i||!Je(e,r+3,i-3)?e=0:(f=e[r+0]|e[r+1]<<8|e[r+2]<<16,E=16383&(e[r+7]<<8|e[r+6]),e=16383&(e[r+9]<<8|e[r+8]),1&f||3<(f>>1&7)||!(f>>4&1)||f>>5>=m.Ja||!E||!e?e=0:(c&&(c[0]=E),l&&(l[0]=e),e=1))}if(!e)return 3;if(c=c[0],_=_[0],p&&(u[0]!=c||h[0]!=_))return 3;null!=d&&(d[0]=m,d.offset=r-d.w,t(4294967286>r-d.w),t(d.offset==d.ha-i));break}return 0==v||7==v&&p&&null==d?(null!=s&&(s[0]|=null!=m.na&&0<m.na.length),null!=a&&(a[0]=c),null!=o&&(o[0]=_),0):v}function Mn(e,t,n){var r=t.width,i=t.height,a=0,o=0,s=r,c=i;if(t.Da=null!=e&&0<e.Da,t.Da&&(s=e.cd,c=e.bd,a=e.v,o=e.j,11>n||(a&=-2,o&=-2),0>a||0>o||0>=s||0>=c||a+s>r||o+c>i))return 0;if(t.v=a,t.j=o,t.va=a+s,t.o=o+c,t.U=s,t.T=c,t.da=null!=e&&0<e.da,t.da){if(!M(s,c,n=[e.ib],a=[e.hb]))return 0;t.ib=n[0],t.hb=a[0]}return t.ob=null!=e&&e.ob,t.Kb=null==e||!e.Sd,t.da&&(t.ob=t.ib<3*r/4&&t.hb<3*i/4,t.Kb=0),1}function Un(e){if(null==e)return 2;if(11>e.S){var t=e.f.RGBA;t.fb+=(e.height-1)*t.A,t.A=-t.A}else t=e.f.kb,e=e.height,t.O+=(e-1)*t.fa,t.fa=-t.fa,t.N+=(e-1>>1)*t.Ab,t.Ab=-t.Ab,t.W+=(e-1>>1)*t.Db,t.Db=-t.Db,null!=t.F&&(t.J+=(e-1)*t.lb,t.lb=-t.lb);return 0}function Fn(e,t,n,r){if(null==r||0>=e||0>=t)return 2;if(null!=n){if(n.Da){var i=n.cd,o=n.bd,s=-2&n.v,c=-2&n.j;if(0>s||0>c||0>=i||0>=o||s+i>e||c+o>t)return 2;e=i,t=o}if(n.da){if(!M(e,t,i=[n.ib],o=[n.hb]))return 2;e=i[0],t=o[0]}}r.width=e,r.height=t;e:{var l=r.width,d=r.height;if(e=r.S,0>=l||0>=d||!(e>=Mr&&13>e))e=2;else{if(0>=r.Rd&&null==r.sd){s=o=i=t=0;var u=(c=l*Gi[e])*d;if(11>e||(o=(d+1)/2*(t=(l+1)/2),12==e&&(s=(i=l)*d)),null==(d=a(u+2*o+s))){e=1;break e}r.sd=d,11>e?((l=r.f.RGBA).eb=d,l.fb=0,l.A=c,l.size=u):((l=r.f.kb).y=d,l.O=0,l.fa=c,l.Fd=u,l.f=d,l.N=0+u,l.Ab=t,l.Cd=o,l.ea=d,l.W=0+u+o,l.Db=t,l.Ed=o,12==e&&(l.F=d,l.J=0+u+2*o),l.Tc=s,l.lb=i)}if(t=1,i=r.S,o=r.width,s=r.height,i>=Mr&&13>i)if(11>i)e=r.f.RGBA,t&=(c=Math.abs(e.A))*(s-1)+o<=e.size,t&=c>=o*Gi[i],t&=null!=e.eb;else{e=r.f.kb,c=(o+1)/2,u=(s+1)/2,l=Math.abs(e.fa),d=Math.abs(e.Ab);var h=Math.abs(e.Db),p=Math.abs(e.lb),f=p*(s-1)+o;t&=l*(s-1)+o<=e.Fd,t&=d*(u-1)+c<=e.Cd,t=(t&=h*(u-1)+c<=e.Ed)&l>=o&d>=c&h>=c,t&=null!=e.y,t&=null!=e.f,t&=null!=e.ea,12==i&&(t&=p>=o,t&=f<=e.Tc,t&=null!=e.F)}else t=0;e=t?0:2}}return 0!=e||null!=n&&n.fd&&(e=Un(r)),e}var jn=64,Vn=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Bn=24,Gn=32,Wn=8,Hn=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];j("Predictor0","PredictorAdd0"),e.Predictor0=function(){return 4278190080},e.Predictor1=function(e){return e},e.Predictor2=function(e,t,n){return t[n+0]},e.Predictor3=function(e,t,n){return t[n+1]},e.Predictor4=function(e,t,n){return t[n-1]},e.Predictor5=function(e,t,n){return B(B(e,t[n+1]),t[n+0])},e.Predictor6=function(e,t,n){return B(e,t[n-1])},e.Predictor7=function(e,t,n){return B(e,t[n+0])},e.Predictor8=function(e,t,n){return B(t[n-1],t[n+0])},e.Predictor9=function(e,t,n){return B(t[n+0],t[n+1])},e.Predictor10=function(e,t,n){return B(B(e,t[n-1]),B(t[n+0],t[n+1]))},e.Predictor11=function(e,t,n){var r=t[n+0];return 0>=H(r>>24&255,e>>24&255,(t=t[n-1])>>24&255)+H(r>>16&255,e>>16&255,t>>16&255)+H(r>>8&255,e>>8&255,t>>8&255)+H(255&r,255&e,255&t)?r:e},e.Predictor12=function(e,t,n){var r=t[n+0];return(G((e>>24&255)+(r>>24&255)-((t=t[n-1])>>24&255))<<24|G((e>>16&255)+(r>>16&255)-(t>>16&255))<<16|G((e>>8&255)+(r>>8&255)-(t>>8&255))<<8|G((255&e)+(255&r)-(255&t)))>>>0},e.Predictor13=function(e,t,n){var r=t[n-1];return(W((e=B(e,t[n+0]))>>24&255,r>>24&255)<<24|W(e>>16&255,r>>16&255)<<16|W(e>>8&255,r>>8&255)<<8|W(255&e,255&r))>>>0};var qn=e.PredictorAdd0;e.PredictorAdd1=q,j("Predictor2","PredictorAdd2"),j("Predictor3","PredictorAdd3"),j("Predictor4","PredictorAdd4"),j("Predictor5","PredictorAdd5"),j("Predictor6","PredictorAdd6"),j("Predictor7","PredictorAdd7"),j("Predictor8","PredictorAdd8"),j("Predictor9","PredictorAdd9"),j("Predictor10","PredictorAdd10"),j("Predictor11","PredictorAdd11"),j("Predictor12","PredictorAdd12"),j("Predictor13","PredictorAdd13");var zn=e.PredictorAdd2;J("ColorIndexInverseTransform","MapARGB","32b",(function(e){return e>>8&255}),(function(e){return e})),J("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",(function(e){return e}),(function(e){return e>>8&255}));var Kn,Yn=e.ColorIndexInverseTransform,Jn=e.MapARGB,Xn=e.VP8LColorIndexInverseTransformAlpha,Qn=e.MapAlpha,Zn=e.VP8LPredictorsAdd=[];Zn.length=16,(e.VP8LPredictors=[]).length=16,(e.VP8LPredictorsAdd_C=[]).length=16,(e.VP8LPredictors_C=[]).length=16;var $n,er,tr,nr,rr,ir,ar,or,sr,cr,lr,dr,ur,hr,pr,fr,mr,_r,gr,Er,vr,yr,Sr,br,Tr,Cr,wr,Rr,Ar=a(511),Ir=a(2041),Nr=a(225),Or=a(767),Pr=0,Lr=Ir,Dr=Nr,kr=Or,xr=Ar,Mr=0,Ur=1,Fr=2,jr=3,Vr=4,Br=5,Gr=6,Wr=7,Hr=8,qr=9,zr=10,Kr=[2,3,7],Yr=[3,3,11],Jr=[280,256,256,256,40],Xr=[0,1,1,1,0],Qr=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Zr=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],$r=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],ei=8,ti=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],ni=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ri=null,ii=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],ai=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],oi=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],si=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],ci=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],li=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],di=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ui=[],hi=[],pi=[],fi=1,mi=2,_i=[],gi=[];En("UpsampleRgbLinePair",Cn,3),En("UpsampleBgrLinePair",wn,3),En("UpsampleRgbaLinePair",On,4),En("UpsampleBgraLinePair",Nn,4),En("UpsampleArgbLinePair",In,4),En("UpsampleRgba4444LinePair",An,2),En("UpsampleRgb565LinePair",Rn,2);var Ei=e.UpsampleRgbLinePair,vi=e.UpsampleBgrLinePair,yi=e.UpsampleRgbaLinePair,Si=e.UpsampleBgraLinePair,bi=e.UpsampleArgbLinePair,Ti=e.UpsampleRgba4444LinePair,Ci=e.UpsampleRgb565LinePair,wi=16,Ri=1<<wi-1,Ai=-227,Ii=482,Ni=6,Oi=(256<<Ni)-1,Pi=0,Li=a(256),Di=a(256),ki=a(256),xi=a(256),Mi=a(Ii-Ai),Ui=a(Ii-Ai);Pn("YuvToRgbRow",Cn,3),Pn("YuvToBgrRow",wn,3),Pn("YuvToRgbaRow",On,4),Pn("YuvToBgraRow",Nn,4),Pn("YuvToArgbRow",In,4),Pn("YuvToRgba4444Row",An,2),Pn("YuvToRgb565Row",Rn,2);var Fi=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],ji=[0,2,8],Vi=[8,7,6,4,4,2,2,2,1,1,1,1],Bi=1;this.WebPDecodeRGBA=function(e,n,r,i,a){var o=Ur,s=new nn,c=new oe;s.ba=c,c.S=o,c.width=[c.width],c.height=[c.height];var l=c.width,d=c.height,u=new se;if(null==u||null==e)var h=2;else t(null!=u),h=xn(e,n,r,u.width,u.height,u.Pd,u.Qd,u.format,null);if(0!=h?l=0:(null!=l&&(l[0]=u.width[0]),null!=d&&(d[0]=u.height[0]),l=1),l){c.width=c.width[0],c.height=c.height[0],null!=i&&(i[0]=c.width),null!=a&&(a[0]=c.height);e:{if(i=new ze,(a=new rn).data=e,a.w=n,a.ha=r,a.kd=1,n=[0],t(null!=a),(0==(e=xn(a.data,a.w,a.ha,null,null,null,n,null,a))||7==e)&&n[0]&&(e=4),0==(n=e)){if(t(null!=s),i.data=a.data,i.w=a.w+a.offset,i.ha=a.ha-a.offset,i.put=pe,i.ac=he,i.bc=fe,i.ma=s,a.xa){if(null==(e=Ie())){s=1;break e}if(function(e,n){var r=[0],i=[0],a=[0];t:for(;;){if(null==e)return 0;if(null==n)return e.a=2,0;if(e.l=n,e.a=0,g(e.m,n.data,n.w,n.ha),!me(e.m,r,i,a)){e.a=3;break t}if(e.xb=mi,n.width=r[0],n.height=i[0],!Ne(r[0],i[0],1,e,null))break t;return 1}return t(0!=e.a),0}(e,i)){if(i=0==(n=Fn(i.width,i.height,s.Oa,s.ba))){t:{i=e;n:for(;;){if(null==i){i=0;break t}if(t(null!=i.s.yc),t(null!=i.s.Ya),t(0<i.s.Wb),t(null!=(r=i.l)),t(null!=(a=r.ma)),0!=i.xb){if(i.ca=a.ba,i.tb=a.tb,t(null!=i.ca),!Mn(a.Oa,r,jr)){i.a=2;break n}if(!Oe(i,r.width))break n;if(r.da)break n;if((r.da||re(i.ca.S))&&gn(),11>i.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),null!=i.ca.f.kb.F&&gn()),i.Pb&&0<i.s.ua&&null==i.s.vb.X&&!D(i.s.vb,i.s.Wa.Xa)){i.a=1;break n}i.xb=0}if(!Re(i,i.V,i.Ba,i.c,i.i,r.o,be))break n;a.Dc=i.Ma,i=1;break t}t(0!=i.a),i=0}i=!i}i&&(n=e.a)}else n=e.a}else{if(null==(e=new Ke)){s=1;break e}if(e.Fa=a.na,e.P=a.P,e.qc=a.Sa,Xe(e,i)){if(0==(n=Fn(i.width,i.height,s.Oa,s.ba))){if(e.Aa=0,r=s.Oa,t(null!=(a=e)),null!=r){if(0<(l=0>(l=r.Md)?0:100<l?255:255*l/100)){for(d=u=0;4>d;++d)12>(h=a.pb[d]).lc&&(h.ia=l*Vi[0>h.lc?0:h.lc]>>3),u|=h.ia;u&&(alert("todo:VP8InitRandom"),a.ia=1)}a.Ga=r.Id,100<a.Ga?a.Ga=100:0>a.Ga&&(a.Ga=0)}$e(e,i)||(n=e.a)}}else n=e.a}0==n&&null!=s.Oa&&s.Oa.fd&&(n=Un(s.ba))}s=n}o=0!=s?null:11>o?c.f.RGBA.eb:c.f.kb.y}else o=null;return o};var Gi=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function l(e,t){for(var n="",r=0;r<4;r++)n+=String.fromCharCode(e[t++]);return n}function d(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16)>>>0}function u(e,t){return(e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}new c;var h=[0],p=[0],f=[],m=new c,_=e,g=function(e,t){var n={},r=0,i=!1,a=0,o=0;if(n.frames=[],!function(e,t){for(var n=0;n<4;n++)if(e[t+n]!="RIFF".charCodeAt(n))return!0;return!1}(e,t)){var s,c;for(u(e,t+=4),t+=8;t<e.length;){var h=l(e,t),p=u(e,t+=4);t+=4;var f=p+(1&p);switch(h){case"VP8 ":case"VP8L":void 0===n.frames[r]&&(n.frames[r]={}),(g=n.frames[r]).src_off=i?o:t-8,g.src_size=a+p+8,r++,i&&(i=!1,a=0,o=0);break;case"VP8X":(g=n.header={}).feature_flags=e[t];var m=t+4;g.canvas_width=1+d(e,m),m+=3,g.canvas_height=1+d(e,m),m+=3;break;case"ALPH":i=!0,a=f+8,o=t-8;break;case"ANIM":(g=n.header).bgcolor=u(e,t),m=t+4,g.loop_count=(s=e)[(c=m)+0]|s[c+1]<<8,m+=2;break;case"ANMF":var _,g;(g=n.frames[r]={}).offset_x=2*d(e,t),t+=3,g.offset_y=2*d(e,t),t+=3,g.width=1+d(e,t),t+=3,g.height=1+d(e,t),t+=3,g.duration=d(e,t),t+=3,_=e[t++],g.dispose=1&_,g.blend=_>>1&1}"ANMF"!=h&&(t+=f)}return n}}(_,0);g.response=_,g.rgbaoutput=!0,g.dataurl=!1;var E=g.header?g.header:null,v=g.frames?g.frames:null;if(E){E.loop_counter=E.loop_count,h=[E.canvas_height],p=[E.canvas_width];for(var y=0;y<v.length&&0!=v[y].blend;y++);}var S=v[0],b=m.WebPDecodeRGBA(_,S.src_off,S.src_size,p,h);S.rgba=b,S.imgwidth=p[0],S.imgheight=h[0];for(var T=0;T<p[0]*h[0]*4;T++)f[T]=b[T];return this.width=p,this.height=h,this.data=f,this}!function(e){var t=function(t,r,c,l){var d=4,u=a;switch(l){case e.image_compression.FAST:d=1,u=i;break;case e.image_compression.MEDIUM:d=6,u=o;break;case e.image_compression.SLOW:d=9,u=s}var h=$i(t=n(t,r,c,u),{level:d});return e.__addimage__.arrayBufferToBinaryString(h)},n=function(e,t,n,r){for(var i,a,o,s=e.length/t,c=new Uint8Array(e.length+s),u=l(),h=0;h<s;h+=1){if(o=h*t,i=e.subarray(o,o+t),r)c.set(r(i,n,a),o+h);else{for(var p,f=u.length,m=[];p<f;p+=1)m[p]=u[p](i,n,a);var _=d(m.concat());c.set(m[_],o+h)}a=i}return c},r=function(e){var t=Array.apply([],e);return t.unshift(0),t},i=function(e,t){var n,r=[],i=e.length;r[0]=1;for(var a=0;a<i;a+=1)n=e[a-t]||0,r[a+1]=e[a]-n+256&255;return r},a=function(e,t,n){var r,i=[],a=e.length;i[0]=2;for(var o=0;o<a;o+=1)r=n&&n[o]||0,i[o+1]=e[o]-r+256&255;return i},o=function(e,t,n){var r,i,a=[],o=e.length;a[0]=3;for(var s=0;s<o;s+=1)r=e[s-t]||0,i=n&&n[s]||0,a[s+1]=e[s]+256-(r+i>>>1)&255;return a},s=function(e,t,n){var r,i,a,o,s=[],l=e.length;s[0]=4;for(var d=0;d<l;d+=1)r=e[d-t]||0,i=n&&n[d]||0,a=n&&n[d-t]||0,o=c(r,i,a),s[d+1]=e[d]-o+256&255;return s},c=function(e,t,n){if(e===t&&t===n)return e;var r=Math.abs(t-n),i=Math.abs(e-n),a=Math.abs(e+t-n-n);return r<=i&&r<=a?e:i<=a?t:n},l=function(){return[r,i,a,o,s]},d=function(e){var t=e.map((function(e){return e.reduce((function(e,t){return e+Math.abs(t)}),0)}));return t.indexOf(Math.min.apply(null,t))};e.processPNG=function(n,r,i,a){var o,s,c,l,d,u,h,p,f,m,_,g,E,v,y,S=this.decode.FLATE_DECODE,b="";if(this.__addimage__.isArrayBuffer(n)&&(n=new Uint8Array(n)),this.__addimage__.isArrayBufferView(n)){if(n=(c=new Yo(n)).imgData,s=c.bits,o=c.colorSpace,d=c.colors,-1!==[4,6].indexOf(c.colorType)){if(8===c.bits){f=(p=32==c.pixelBitlength?new Uint32Array(c.decodePixels().buffer):16==c.pixelBitlength?new Uint16Array(c.decodePixels().buffer):new Uint8Array(c.decodePixels().buffer)).length,_=new Uint8Array(f*c.colors),m=new Uint8Array(f);var T,C=c.pixelBitlength-c.bits;for(v=0,y=0;v<f;v++){for(E=p[v],T=0;T<C;)_[y++]=E>>>T&255,T+=c.bits;m[v]=E>>>T&255}}if(16===c.bits){f=(p=new Uint32Array(c.decodePixels().buffer)).length,_=new Uint8Array(f*(32/c.pixelBitlength)*c.colors),m=new Uint8Array(f*(32/c.pixelBitlength)),g=c.colors>1,v=0,y=0;for(var w=0;v<f;)E=p[v++],_[y++]=E>>>0&255,g&&(_[y++]=E>>>16&255,E=p[v++],_[y++]=E>>>0&255),m[w++]=E>>>16&255;s=8}a!==e.image_compression.NONE?(n=t(_,c.width*c.colors,c.colors,a),h=t(m,c.width,1,a)):(n=_,h=m,S=void 0)}if(3===c.colorType&&(o=this.color_spaces.INDEXED,u=c.palette,c.transparency.indexed)){var R=c.transparency.indexed,A=0;for(v=0,f=R.length;v<f;++v)A+=R[v];if((A/=255)===f-1&&-1!==R.indexOf(0))l=[R.indexOf(0)];else if(A!==f){for(p=c.decodePixels(),m=new Uint8Array(p.length),v=0,f=p.length;v<f;v++)m[v]=R[p[v]];h=t(m,c.width,1)}}var I=function(t){var n;switch(t){case e.image_compression.FAST:n=11;break;case e.image_compression.MEDIUM:n=13;break;case e.image_compression.SLOW:n=14;break;default:n=12}return n}(a);return S===this.decode.FLATE_DECODE&&(b="/Predictor "+I+" "),b+="/Colors "+d+" /BitsPerComponent "+s+" /Columns "+c.width,(this.__addimage__.isArrayBuffer(n)||this.__addimage__.isArrayBufferView(n))&&(n=this.__addimage__.arrayBufferToBinaryString(n)),(h&&this.__addimage__.isArrayBuffer(h)||this.__addimage__.isArrayBufferView(h))&&(h=this.__addimage__.arrayBufferToBinaryString(h)),{alias:i,data:n,index:r,filter:S,decodeParameters:b,transparency:l,palette:u,sMask:h,predictor:I,width:c.width,height:c.height,bitsPerComponent:s,colorSpace:o}}}}(xa.API),function(e){e.processGIF89A=function(t,n,r,i){var a=new Jo(t),o=a.width,s=a.height,c=[];a.decodeAndBlitFrameRGBA(0,c);var l={data:c,width:o,height:s},d=new Qo(100).encode(l,100);return e.processJPEG.call(this,d,n,r,i)},e.processGIF87A=e.processGIF89A}(xa.API),Zo.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,16===this.bitPP&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var n=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:i,green:r,blue:n,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Zo.prototype.parseBGR=function(){this.pos=this.offset;try{var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[e]()}catch(e){ia.log("bit decode error:"+e)}},Zo.prototype.bit1=function(){var e,t=Math.ceil(this.width/8),n=t%4;for(e=this.height-1;e>=0;e--){for(var r=this.bottom_up?e:this.height-1-e,i=0;i<t;i++)for(var a=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+8*i*4,s=0;s<8&&8*i+s<this.width;s++){var c=this.palette[a>>7-s&1];this.data[o+4*s]=c.blue,this.data[o+4*s+1]=c.green,this.data[o+4*s+2]=c.red,this.data[o+4*s+3]=255}0!==n&&(this.pos+=4-n)}},Zo.prototype.bit4=function(){for(var e=Math.ceil(this.width/2),t=e%4,n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<e;i++){var a=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+2*i*4,s=a>>4,c=15&a,l=this.palette[s];if(this.data[o]=l.blue,this.data[o+1]=l.green,this.data[o+2]=l.red,this.data[o+3]=255,2*i+1>=this.width)break;l=this.palette[c],this.data[o+4]=l.blue,this.data[o+4+1]=l.green,this.data[o+4+2]=l.red,this.data[o+4+3]=255}0!==t&&(this.pos+=4-t)}},Zo.prototype.bit8=function(){for(var e=this.width%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,r=0;r<this.width;r++){var i=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+4*r;if(i<this.palette.length){var o=this.palette[i];this.data[a]=o.red,this.data[a+1]=o.green,this.data[a+2]=o.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}0!==e&&(this.pos+=4-e)}},Zo.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),n=this.height-1;n>=0;n--){for(var r=this.bottom_up?n:this.height-1-n,i=0;i<this.width;i++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&t)/t*255|0,s=(a>>5&t)/t*255|0,c=(a>>10&t)/t*255|0,l=a>>15?255:0,d=r*this.width*4+4*i;this.data[d]=c,this.data[d+1]=s,this.data[d+2]=o,this.data[d+3]=l}this.pos+=e}},Zo.prototype.bit16=function(){for(var e=this.width%3,t=parseInt("11111",2),n=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,a=0;a<this.width;a++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(o&t)/t*255|0,c=(o>>5&n)/n*255|0,l=(o>>11)/t*255|0,d=i*this.width*4+4*a;this.data[d]=l,this.data[d+1]=c,this.data[d+2]=s,this.data[d+3]=255}this.pos+=e}},Zo.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*n;this.data[o]=a,this.data[o+1]=i,this.data[o+2]=r,this.data[o+3]=255}this.pos+=this.width%4}},Zo.prototype.bit32=function(){for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var r=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*n;this.data[s]=a,this.data[s+1]=i,this.data[s+2]=r,this.data[s+3]=o}},Zo.prototype.getData=function(){return this.data},function(e){e.processBMP=function(t,n,r,i){var a=new Zo(t,!1),o=a.width,s=a.height,c={data:a.getData(),width:o,height:s},l=new Qo(100).encode(c,100);return e.processJPEG.call(this,l,n,r,i)}}(xa.API),$o.prototype.getData=function(){return this.data},function(e){e.processWEBP=function(t,n,r,i){var a=new $o(t,!1),o=a.width,s=a.height,c={data:a.getData(),width:o,height:s},l=new Qo(100).encode(c,100);return e.processJPEG.call(this,l,n,r,i)}}(xa.API),xa.API.processRGBA=function(e,t,n){for(var r=e.data,i=r.length,a=new Uint8Array(i/4*3),o=new Uint8Array(i/4),s=0,c=0,l=0;l<i;l+=4){var d=r[l],u=r[l+1],h=r[l+2],p=r[l+3];a[s++]=d,a[s++]=u,a[s++]=h,o[c++]=p}var f=this.__addimage__.arrayBufferToBinaryString(a);return{alpha:this.__addimage__.arrayBufferToBinaryString(o),data:f,index:t,alias:n,colorSpace:"DeviceRGB",bitsPerComponent:8,width:e.width,height:e.height}},xa.API.setLanguage=function(e){return void 0===this.internal.languageSettings&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),void 0!=={af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[e]&&(this.internal.languageSettings.languageCode=e,!1===this.internal.languageSettings.isSubscribed&&(this.internal.events.subscribe("putCatalog",(function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")})),this.internal.languageSettings.isSubscribed=!0)),this},Wo=xa.API,Ho=Wo.getCharWidthsArray=function(e,t){var n,r,i=(t=t||{}).font||this.internal.getFont(),a=t.fontSize||this.internal.getFontSize(),o=t.charSpace||this.internal.getCharSpace(),s=t.widths?t.widths:i.metadata.Unicode.widths,c=s.fof?s.fof:1,l=t.kerning?t.kerning:i.metadata.Unicode.kerning,d=l.fof?l.fof:1,u=!1!==t.doKerning,h=0,p=e.length,f=0,m=s[0]||c,_=[];for(n=0;n<p;n++)r=e.charCodeAt(n),"function"==typeof i.metadata.widthOfString?_.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(r))+o*(1e3/a)||0)/1e3):(h=u&&"object"===(0,ai.A)(l[r])&&!isNaN(parseInt(l[r][f],10))?l[r][f]/d:0,_.push((s[r]||m)/c+h)),f=r;return _},qo=Wo.getStringUnitWidth=function(e,t){var n=(t=t||{}).fontSize||this.internal.getFontSize(),r=t.font||this.internal.getFont(),i=t.charSpace||this.internal.getCharSpace();return Wo.processArabic&&(e=Wo.processArabic(e)),"function"==typeof r.metadata.widthOfString?r.metadata.widthOfString(e,n,i)/n:Ho.apply(this,arguments).reduce((function(e,t){return e+t}),0)},zo=function(e,t,n,r){for(var i=[],a=0,o=e.length,s=0;a!==o&&s+t[a]<n;)s+=t[a],a++;i.push(e.slice(0,a));var c=a;for(s=0;a!==o;)s+t[a]>r&&(i.push(e.slice(c,a)),s=0,c=a),s+=t[a],a++;return c!==a&&i.push(e.slice(c,a)),i},Ko=function(e,t,n){n||(n={});var r,i,a,o,s,c,l,d=[],u=[d],h=n.textIndent||0,p=0,f=0,m=e.split(" "),_=Ho.apply(this,[" ",n])[0];if(c=-1===n.lineIndent?m[0].length+2:n.lineIndent||0){var g=Array(c).join(" "),E=[];m.map((function(e){(e=e.split(/\s*\n/)).length>1?E=E.concat(e.map((function(e,t){return(t&&e.length?"\n":"")+e}))):E.push(e[0])})),m=E,c=qo.apply(this,[g,n])}for(a=0,o=m.length;a<o;a++){var v=0;if(r=m[a],c&&"\n"==r[0]&&(r=r.substr(1),v=1),h+p+(f=(i=Ho.apply(this,[r,n])).reduce((function(e,t){return e+t}),0))>t||v){if(f>t){for(s=zo.apply(this,[r,i,t-(h+p),t]),d.push(s.shift()),d=[s.pop()];s.length;)u.push([s.shift()]);f=i.slice(r.length-(d[0]?d[0].length:0)).reduce((function(e,t){return e+t}),0)}else d=[r];u.push(d),h=f+c,p=_}else d.push(r),h+=p+f,p=_}return l=c?function(e,t){return(t?g:"")+e.join(" ")}:function(e){return e.join(" ")},u.map(l)},Wo.splitTextToSize=function(e,t,n){var r,i=(n=n||{}).fontSize||this.internal.getFontSize(),a=function(e){if(e.widths&&e.kerning)return{widths:e.widths,kerning:e.kerning};var t=this.internal.getFont(e.fontName,e.fontStyle);return t.metadata.Unicode?{widths:t.metadata.Unicode.widths||{0:1},kerning:t.metadata.Unicode.kerning||{}}:{font:t.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,n);r=Array.isArray(e)?e:String(e).split(/\r?\n/);var o=1*this.internal.scaleFactor*t/i;a.textIndent=n.textIndent?1*n.textIndent*this.internal.scaleFactor/i:0,a.lineIndent=n.lineIndent;var s,c,l=[];for(s=0,c=r.length;s<c;s++)l=l.concat(Ko.apply(this,[r[s],o,a]));return l},function(e){e.__fontmetrics__=e.__fontmetrics__||{};for(var t="klmnopqrstuvwxyz",n={},r={},i=0;i<16;i++)n[t[i]]="0123456789abcdef"[i],r["0123456789abcdef"[i]]=t[i];var a=function(e){return"0x"+parseInt(e,10).toString(16)},o=e.__fontmetrics__.compress=function(e){var t,n,i,s,c=["{"];for(var l in e){if(t=e[l],isNaN(parseInt(l,10))?n="'"+l+"'":(l=parseInt(l,10),n=(n=a(l).slice(2)).slice(0,-1)+r[n.slice(-1)]),"number"==typeof t)t<0?(i=a(t).slice(3),s="-"):(i=a(t).slice(2),s=""),i=s+i.slice(0,-1)+r[i.slice(-1)];else{if("object"!==(0,ai.A)(t))throw new Error("Don't know what to do with value type "+(0,ai.A)(t)+".");i=o(t)}c.push(n+i)}return c.push("}"),c.join("")},s=e.__fontmetrics__.uncompress=function(e){if("string"!=typeof e)throw new Error("Invalid argument passed to uncompress.");for(var t,r,i,a,o={},s=1,c=o,l=[],d="",u="",h=e.length-1,p=1;p<h;p+=1)"'"==(a=e[p])?t?(i=t.join(""),t=void 0):t=[]:t?t.push(a):"{"==a?(l.push([c,i]),c={},i=void 0):"}"==a?((r=l.pop())[0][r[1]]=c,i=void 0,c=r[0]):"-"==a?s=-1:void 0===i?n.hasOwnProperty(a)?(d+=n[a],i=parseInt(d,16)*s,s=1,d=""):d+=a:n.hasOwnProperty(a)?(u+=n[a],c[i]=parseInt(u,16)*s,s=1,i=void 0,u=""):u+=a;return o},c={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},l={Unicode:{Courier:c,"Courier-Bold":c,"Courier-BoldOblique":c,"Courier-Oblique":c,Helvetica:c,"Helvetica-Bold":c,"Helvetica-BoldOblique":c,"Helvetica-Oblique":c,"Times-Roman":c,"Times-Bold":c,"Times-BoldItalic":c,"Times-Italic":c}},d={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};e.events.push(["addFont",function(e){var t=e.font,n=d.Unicode[t.postScriptName];n&&(t.metadata.Unicode={},t.metadata.Unicode.widths=n.widths,t.metadata.Unicode.kerning=n.kerning);var r=l.Unicode[t.postScriptName];r&&(t.metadata.Unicode.encoding=r,t.encoding=r.codePages[0])}])}(xa.API),function(e){var t=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n};e.API.events.push(["addFont",function(n){var r=void 0,i=n.font,a=n.instance;if(!i.isStandardFont){if(void 0===a)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if("string"!=typeof(r=!1===a.existsFileInVFS(i.postScriptName)?a.loadFile(i.postScriptName):a.getFileFromVFS(i.postScriptName)))throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");!function(n,r){r=/^\x00\x01\x00\x00/.test(r)?t(r):t(ca(r)),n.metadata=e.API.TTFFont.open(r),n.metadata.Unicode=n.metadata.Unicode||{encoding:{},kerning:{},widths:[]},n.metadata.glyIdsUsed=[0]}(i,r)}}])}(xa),function(){function e(){return(na.canvg?Promise.resolve(na.canvg):n.e(455).then(n.bind(n,8455))).catch((function(e){return Promise.reject(new Error("Could not load canvg: "+e))})).then((function(e){return e.default?e.default:e}))}xa.API.addSvgAsImage=function(t,n,r,i,a,o,s,c){if(isNaN(n)||isNaN(r))throw ia.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(i)||isNaN(a))throw ia.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var l=document.createElement("canvas");l.width=i,l.height=a;var d=l.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,l.width,l.height);var u={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},h=this;return e().then((function(e){return e.fromString(d,t,u)}),(function(){return Promise.reject(new Error("Could not load canvg."))})).then((function(e){return e.render(u)})).then((function(){h.addImage(l.toDataURL("image/jpeg",1),n,r,i,a,s,c)}))}}(),xa.API.putTotalPages=function(e){var t,n=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(e,"g"),n=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(e,this.internal.getFont()),"g"),n=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var i=0;i<this.internal.pages[r].length;i++)this.internal.pages[r][i]=this.internal.pages[r][i].replace(t,n);return this},xa.API.viewerPreferences=function(e,t){var n;e=e||{},t=t||!1;var r,i,a,o={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(o),c=[],l=0,d=0,u=0;function h(e,t){var n,r=!1;for(n=0;n<e.length;n+=1)e[n]===t&&(r=!0);return r}if(void 0===this.internal.viewerpreferences&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(o)),this.internal.viewerpreferences.isSubscribed=!1),n=this.internal.viewerpreferences.configuration,"reset"===e||!0===t){var p=s.length;for(u=0;u<p;u+=1)n[s[u]].value=n[s[u]].defaultValue,n[s[u]].explicitSet=!1}if("object"===(0,ai.A)(e))for(i in e)if(a=e[i],h(s,i)&&void 0!==a){if("boolean"===n[i].type&&"boolean"==typeof a)n[i].value=a;else if("name"===n[i].type&&h(n[i].valueSet,a))n[i].value=a;else if("integer"===n[i].type&&Number.isInteger(a))n[i].value=a;else if("array"===n[i].type){for(l=0;l<a.length;l+=1)if(r=!0,1===a[l].length&&"number"==typeof a[l][0])c.push(String(a[l]-1));else if(a[l].length>1){for(d=0;d<a[l].length;d+=1)"number"!=typeof a[l][d]&&(r=!1);!0===r&&c.push([a[l][0]-1,a[l][1]-1].join(" "))}n[i].value="["+c.join(" ")+"]"}else n[i].value=n[i].defaultValue;n[i].explicitSet=!0}return!1===this.internal.viewerpreferences.isSubscribed&&(this.internal.events.subscribe("putCatalog",(function(){var e,t=[];for(e in n)!0===n[e].explicitSet&&("name"===n[e].type?t.push("/"+e+" /"+n[e].value):t.push("/"+e+" "+n[e].value));0!==t.length&&this.internal.write("/ViewerPreferences\n<<\n"+t.join("\n")+"\n>>")})),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=n,this},function(e){var t=function(){var e='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',t=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),n=unescape(encodeURIComponent(e)),r=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),i=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),a=unescape(encodeURIComponent("</x:xmpmeta>")),o=n.length+r.length+i.length+t.length+a.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+o+" >>"),this.internal.write("stream"),this.internal.write(t+n+r+i+a),this.internal.write("endstream"),this.internal.write("endobj")},n=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};e.addMetadata=function(e,r){return void 0===this.internal.__metadata__&&(this.internal.__metadata__={metadata:e,namespaceuri:r||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",n),this.internal.events.subscribe("postPutResources",t)),this}}(xa.API),function(e){var t=e.API,n=t.pdfEscape16=function(e,t){for(var n,r=t.metadata.Unicode.widths,i=["","0","00","000","0000"],a=[""],o=0,s=e.length;o<s;++o){if(n=t.metadata.characterToGlyph(e.charCodeAt(o)),t.metadata.glyIdsUsed.push(n),t.metadata.toUnicode[n]=e.charCodeAt(o),-1==r.indexOf(n)&&(r.push(n),r.push([parseInt(t.metadata.widthOfGlyph(n),10)])),"0"==n)return a.join("");n=n.toString(16),a.push(i[4-n.length],n)}return a.join("")},r=function(e){var t,n,r,i,a,o,s;for(a="/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo <<\n  /Registry (Adobe)\n  /Ordering (UCS)\n  /Supplement 0\n>> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000><ffff>\nendcodespacerange",r=[],o=0,s=(n=Object.keys(e).sort((function(e,t){return e-t}))).length;o<s;o++)t=n[o],r.length>=100&&(a+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar",r=[]),void 0!==e[t]&&null!==e[t]&&"function"==typeof e[t].toString&&(i=("0000"+e[t].toString(16)).slice(-4),t=("0000"+(+t).toString(16)).slice(-4),r.push("<"+t+"><"+i+">"));return r.length&&(a+="\n"+r.length+" beginbfchar\n"+r.join("\n")+"\nendbfchar\n"),a+"endcmap\nCMapName currentdict /CMap defineresource pop\nend\nend"};t.events.push(["putFont",function(t){!function(t){var n=t.font,i=t.out,a=t.newObject,o=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"Identity-H"===n.encoding){for(var s=n.metadata.Unicode.widths,c=n.metadata.subset.encode(n.metadata.glyIdsUsed,1),l="",d=0;d<c.length;d++)l+=String.fromCharCode(c[d]);var u=a();o({data:l,addLength1:!0,objectId:u}),i("endobj");var h=a();o({data:r(n.metadata.toUnicode),addLength1:!0,objectId:h}),i("endobj");var p=a();i("<<"),i("/Type /FontDescriptor"),i("/FontName /"+Na(n.fontName)),i("/FontFile2 "+u+" 0 R"),i("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),i("/Flags "+n.metadata.flags),i("/StemV "+n.metadata.stemV),i("/ItalicAngle "+n.metadata.italicAngle),i("/Ascent "+n.metadata.ascender),i("/Descent "+n.metadata.decender),i("/CapHeight "+n.metadata.capHeight),i(">>"),i("endobj");var f=a();i("<<"),i("/Type /Font"),i("/BaseFont /"+Na(n.fontName)),i("/FontDescriptor "+p+" 0 R"),i("/W "+e.API.PDFObject.convert(s)),i("/CIDToGIDMap /Identity"),i("/DW 1000"),i("/Subtype /CIDFontType2"),i("/CIDSystemInfo"),i("<<"),i("/Supplement 0"),i("/Registry (Adobe)"),i("/Ordering ("+n.encoding+")"),i(">>"),i(">>"),i("endobj"),n.objectNumber=a(),i("<<"),i("/Type /Font"),i("/Subtype /Type0"),i("/ToUnicode "+h+" 0 R"),i("/BaseFont /"+Na(n.fontName)),i("/Encoding /"+n.encoding),i("/DescendantFonts ["+f+" 0 R]"),i(">>"),i("endobj"),n.isAlreadyPutted=!0}}(t)}]),t.events.push(["putFont",function(t){!function(t){var n=t.font,i=t.out,a=t.newObject,o=t.putStream;if(n.metadata instanceof e.API.TTFFont&&"WinAnsiEncoding"===n.encoding){for(var s=n.metadata.rawData,c="",l=0;l<s.length;l++)c+=String.fromCharCode(s[l]);var d=a();o({data:c,addLength1:!0,objectId:d}),i("endobj");var u=a();o({data:r(n.metadata.toUnicode),addLength1:!0,objectId:u}),i("endobj");var h=a();i("<<"),i("/Descent "+n.metadata.decender),i("/CapHeight "+n.metadata.capHeight),i("/StemV "+n.metadata.stemV),i("/Type /FontDescriptor"),i("/FontFile2 "+d+" 0 R"),i("/Flags 96"),i("/FontBBox "+e.API.PDFObject.convert(n.metadata.bbox)),i("/FontName /"+Na(n.fontName)),i("/ItalicAngle "+n.metadata.italicAngle),i("/Ascent "+n.metadata.ascender),i(">>"),i("endobj"),n.objectNumber=a();for(var p=0;p<n.metadata.hmtx.widths.length;p++)n.metadata.hmtx.widths[p]=parseInt(n.metadata.hmtx.widths[p]*(1e3/n.metadata.head.unitsPerEm));i("<</Subtype/TrueType/Type/Font/ToUnicode "+u+" 0 R/BaseFont/"+Na(n.fontName)+"/FontDescriptor "+h+" 0 R/Encoding/"+n.encoding+" /FirstChar 29 /LastChar 255 /Widths "+e.API.PDFObject.convert(n.metadata.hmtx.widths)+">>"),i("endobj"),n.isAlreadyPutted=!0}}(t)}]);var i=function(e){var t,r=e.text||"",i=e.x,a=e.y,o=e.options||{},s=e.mutex||{},c=s.pdfEscape,l=s.activeFontKey,d=s.fonts,u=l,h="",p=0,f="",m=d[u].encoding;if("Identity-H"!==d[u].encoding)return{text:r,x:i,y:a,options:o,mutex:s};for(f=r,u=l,Array.isArray(r)&&(f=r[0]),p=0;p<f.length;p+=1)d[u].metadata.hasOwnProperty("cmap")&&(t=d[u].metadata.cmap.unicode.codeMap[f[p].charCodeAt(0)]),t||f[p].charCodeAt(0)<256&&d[u].metadata.hasOwnProperty("Unicode")?h+=f[p]:h+="";var _="";return parseInt(u.slice(1))<14||"WinAnsiEncoding"===m?_=c(h,u).split("").map((function(e){return e.charCodeAt(0).toString(16)})).join(""):"Identity-H"===m&&(_=n(h,d[u])),s.isHex=!0,{text:_,x:i,y:a,options:o,mutex:s}};t.events.push(["postProcessText",function(e){var t=e.text||"",n=[],r={text:t,x:e.x,y:e.y,options:e.options,mutex:e.mutex};if(Array.isArray(t)){var a=0;for(a=0;a<t.length;a+=1)Array.isArray(t[a])&&3===t[a].length?n.push([i(Object.assign({},r,{text:t[a][0]})).text,t[a][1],t[a][2]]):n.push(i(Object.assign({},r,{text:t[a]})).text);e.text=n}else e.text=i(Object.assign({},r,{text:t})).text}])}(xa),function(e){var t=function(){return void 0===this.internal.vFS&&(this.internal.vFS={}),!0};e.existsFileInVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]},e.addFileToVFS=function(e,n){return t.call(this),this.internal.vFS[e]=n,this},e.getFileFromVFS=function(e){return t.call(this),void 0!==this.internal.vFS[e]?this.internal.vFS[e]:null}}(xa.API),function(e){e.__bidiEngine__=e.prototype.__bidiEngine__=function(e){var n,r,i,a,o,s,c,l=t,d=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],h={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},p={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},f=["(",")","(","<",">","<","[","]","[","{","}","{","\xab","\xbb","\xab","\u2039","\u203a","\u2039","\u2045","\u2046","\u2045","\u207d","\u207e","\u207d","\u208d","\u208e","\u208d","\u2264","\u2265","\u2264","\u2329","\u232a","\u2329","\ufe59","\ufe5a","\ufe59","\ufe5b","\ufe5c","\ufe5b","\ufe5d","\ufe5e","\ufe5d","\ufe64","\ufe65","\ufe64"],m=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),_=!1,g=0;this.__bidiEngine__={};var E=function(e){var t=e.charCodeAt(),n=t>>8,r=p[n];return void 0!==r?l[256*r+(255&t)]:252===n||253===n?"AL":m.test(n)?"L":8===n?"R":"N"},v=function(e){for(var t,n=0;n<e.length;n++){if("L"===(t=E(e.charAt(n))))return!1;if("R"===t)return!0}return!1},y=function(e,t,o,s){var c,l,d,u,h=t[s];switch(h){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":_=!1;break;case"N":case"AN":break;case"EN":_&&(h="AN");break;case"AL":_=!0,h="R";break;case"WS":case"BN":h="N";break;case"CS":s<1||s+1>=t.length||"EN"!==(c=o[s-1])&&"AN"!==c||"EN"!==(l=t[s+1])&&"AN"!==l?h="N":_&&(l="AN"),h=l===c?l:"N";break;case"ES":h="EN"===(c=s>0?o[s-1]:"B")&&s+1<t.length&&"EN"===t[s+1]?"EN":"N";break;case"ET":if(s>0&&"EN"===o[s-1]){h="EN";break}if(_){h="N";break}for(d=s+1,u=t.length;d<u&&"ET"===t[d];)d++;h=d<u&&"EN"===t[d]?"EN":"N";break;case"NSM":if(i&&!a){for(u=t.length,d=s+1;d<u&&"NSM"===t[d];)d++;if(d<u){var p=e[s],f=p>=1425&&p<=2303||64286===p;if(c=t[d],f&&("R"===c||"AL"===c)){h="R";break}}}h=s<1||"B"===(c=t[s-1])?"N":o[s-1];break;case"B":_=!1,n=!0,h=g;break;case"S":r=!0,h="N"}return h},S=function(e,t,n){var r=e.split("");return n&&b(r,n,{hiLevel:g}),r.reverse(),t&&t.reverse(),r.join("")},b=function(e,t,i){var a,o,s,c,l,p=-1,f=e.length,m=0,v=[],S=g?u:d,b=[];for(_=!1,n=!1,r=!1,o=0;o<f;o++)b[o]=E(e[o]);for(s=0;s<f;s++){if(l=m,v[s]=y(e,b,v,s),a=240&(m=S[l][h[v[s]]]),m&=15,t[s]=c=S[m][5],a>0)if(16===a){for(o=p;o<s;o++)t[o]=1;p=-1}else p=-1;if(S[m][6])-1===p&&(p=s);else if(p>-1){for(o=p;o<s;o++)t[o]=c;p=-1}"B"===b[s]&&(t[s]=0),i.hiLevel|=c}r&&function(e,t,n){for(var r=0;r<n;r++)if("S"===e[r]){t[r]=g;for(var i=r-1;i>=0&&"WS"===e[i];i--)t[i]=g}}(b,t,f)},T=function(e,t,r,i,a){if(!(a.hiLevel<e)){if(1===e&&1===g&&!n)return t.reverse(),void(r&&r.reverse());for(var o,s,c,l,d=t.length,u=0;u<d;){if(i[u]>=e){for(c=u+1;c<d&&i[c]>=e;)c++;for(l=u,s=c-1;l<s;l++,s--)o=t[l],t[l]=t[s],t[s]=o,r&&(o=r[l],r[l]=r[s],r[s]=o);u=c}u++}}},C=function(e,t,n){var r=e.split(""),i={hiLevel:g};return n||(n=[]),b(r,n,i),function(e,t,n){if(0!==n.hiLevel&&c)for(var r,i=0;i<e.length;i++)1===t[i]&&(r=f.indexOf(e[i]))>=0&&(e[i]=f[r+1])}(r,n,i),T(2,r,t,n,i),T(1,r,t,n,i),r.join("")};return this.__bidiEngine__.doBidiReorder=function(e,t,n){if(function(e,t){if(t)for(var n=0;n<e.length;n++)t[n]=n;void 0===a&&(a=v(e)),void 0===s&&(s=v(e))}(e,t),i||!o||s)if(i&&o&&a^s)g=a?1:0,e=S(e,t,n);else if(!i&&o&&s)g=a?1:0,e=C(e,t,n),e=S(e,t);else if(!i||a||o||s){if(i&&!o&&a^s)e=S(e,t),a?(g=0,e=C(e,t,n)):(g=1,e=C(e,t,n),e=S(e,t));else if(i&&a&&!o&&s)g=1,e=C(e,t,n),e=S(e,t);else if(!i&&!o&&a^s){var r=c;a?(g=1,e=C(e,t,n),g=0,c=!1,e=C(e,t,n),c=r):(g=0,e=C(e,t,n),e=S(e,t),g=1,c=!1,e=C(e,t,n),c=r,e=S(e,t))}}else g=0,e=C(e,t,n);else g=a?1:0,e=C(e,t,n);return e},this.__bidiEngine__.setOptions=function(e){e&&(i=e.isInputVisual,o=e.isOutputVisual,a=e.isInputRtl,s=e.isOutputRtl,c=e.isSymmetricSwapping)},this.__bidiEngine__.setOptions(e),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],n=new e.__bidiEngine__({isInputVisual:!0});e.API.events.push(["postProcessText",function(e){var t=e.text,r=(e.x,e.y,e.options||{}),i=(e.mutex,r.lang,[]);if(r.isInputVisual="boolean"!=typeof r.isInputVisual||r.isInputVisual,n.setOptions(r),"[object Array]"===Object.prototype.toString.call(t)){var a=0;for(i=[],a=0;a<t.length;a+=1)"[object Array]"===Object.prototype.toString.call(t[a])?i.push([n.doBidiReorder(t[a][0]),t[a][1],t[a][2]]):i.push([n.doBidiReorder(t[a])]);e.text=i}else e.text=n.doBidiReorder(t);n.setOptions({isInputVisual:!0})}])}(xa),xa.API.TTFFont=function(){function e(e){var t;if(this.rawData=e,t=this.contents=new ts(e),this.contents.pos=4,"ttcf"===t.readString(4))throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new ys(this),this.registerTTF()}return e.open=function(t){return new e(t)},e.prototype.parse=function(){return this.directory=new ns(this.contents),this.head=new as(this),this.name=new hs(this),this.cmap=new ss(this),this.toUnicode={},this.hhea=new cs(this),this.maxp=new ps(this),this.hmtx=new fs(this),this.post=new ds(this),this.os2=new ls(this),this.loca=new vs(this),this.glyf=new _s(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},e.prototype.registerTTF=function(){var e,t,n,r,i;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var t,n,r,i;for(i=[],t=0,n=(r=this.bbox).length;t<n;t++)e=r[t],i.push(Math.round(e*this.scaleFactor));return i}.call(this),this.stemV=0,this.post.exists?(n=255&(r=this.post.italic_angle),0!=(32768&(t=r>>16))&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=1===(i=this.familyClass)||2===i||3===i||4===i||5===i||7===i,this.isScript=10===this.familyClass,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),0!==this.italicAngle&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},e.prototype.characterToGlyph=function(e){var t;return(null!=(t=this.cmap.unicode)?t.codeMap[e]:void 0)||0},e.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},e.prototype.widthOfString=function(e,t,n){var r,i,a,o;for(a=0,i=0,o=(e=""+e).length;0<=o?i<o:i>o;i=0<=o?++i:--i)r=e.charCodeAt(i),a+=this.widthOfGlyph(this.characterToGlyph(r))+n*(1e3/t)||0;return a*(t/1e3)},e.prototype.lineHeight=function(e,t){var n;return null==t&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},e}();var es,ts=function(){function e(e){this.data=null!=e?e:[],this.pos=0,this.length=this.data.length}return e.prototype.readByte=function(){return this.data[this.pos++]},e.prototype.writeByte=function(e){return this.data[this.pos++]=e},e.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},e.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},e.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},e.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},e.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},e.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},e.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},e.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},e.prototype.writeString=function(e){var t,n,r;for(r=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)r.push(this.writeByte(e.charCodeAt(t)));return r},e.prototype.readShort=function(){return this.readInt16()},e.prototype.writeShort=function(e){return this.writeInt16(e)},e.prototype.readLongLong=function(){var e,t,n,r,i,a,o,s;return e=this.readByte(),t=this.readByte(),n=this.readByte(),r=this.readByte(),i=this.readByte(),a=this.readByte(),o=this.readByte(),s=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^r)+16777216*(255^i)+65536*(255^a)+256*(255^o)+(255^s)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*r+16777216*i+65536*a+256*o+s},e.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},e.prototype.readInt=function(){return this.readInt32()},e.prototype.writeInt=function(e){return this.writeInt32(e)},e.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},e.prototype.write=function(e){var t,n,r,i;for(i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push(this.writeByte(t));return i},e}(),ns=function(){var e;function t(e){var t,n,r;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},n=0,r=this.tableCount;0<=r?n<r:n>r;n=0<=r?++n:--n)t={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[t.tag]=t}return t.prototype.encode=function(t){var n,r,i,a,o,s,c,l,d,u,h,p,f;for(f in h=Object.keys(t).length,s=Math.log(2),d=16*Math.floor(Math.log(h)/s),a=Math.floor(d/s),l=16*h-d,(r=new ts).writeInt(this.scalarType),r.writeShort(h),r.writeShort(d),r.writeShort(a),r.writeShort(l),i=16*h,c=r.pos+i,o=null,p=[],t)for(u=t[f],r.writeString(f),r.writeInt(e(u)),r.writeInt(c),r.writeInt(u.length),p=p.concat(u),"head"===f&&(o=c),c+=u.length;c%4;)p.push(0),c++;return r.write(p),n=2981146554-e(r.data),r.pos=o+8,r.writeUInt32(n),r.data},e=function(e){var t,n,r,i;for(e=ms.call(e);e.length%4;)e.push(0);for(r=new ts(e),n=0,t=0,i=e.length;t<i;t=t+=4)n+=r.readUInt32();return 4294967295&n},t}(),rs={}.hasOwnProperty,is=function(e,t){for(var n in t)rs.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};es=function(){function e(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return e.prototype.parse=function(){},e.prototype.encode=function(){},e.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},e}();var as=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="head",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},e.prototype.encode=function(e){var t;return(t=new ts).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},e}(),os=function(){function e(e,t){var n,r,i,a,o,s,c,l,d,u,h,p,f,m,_,g,E;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),d=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=3===this.platformID&&1===this.encodingID&&4===this.format||0===this.platformID&&4===this.format,this.codeMap={},this.format){case 0:for(s=0;s<256;++s)this.codeMap[s]=e.readByte();break;case 4:for(h=e.readUInt16(),u=h/2,e.pos+=6,i=function(){var t,n;for(n=[],s=t=0;0<=u?t<u:t>u;s=0<=u?++t:--t)n.push(e.readUInt16());return n}(),e.pos+=2,f=function(){var t,n;for(n=[],s=t=0;0<=u?t<u:t>u;s=0<=u?++t:--t)n.push(e.readUInt16());return n}(),c=function(){var t,n;for(n=[],s=t=0;0<=u?t<u:t>u;s=0<=u?++t:--t)n.push(e.readUInt16());return n}(),l=function(){var t,n;for(n=[],s=t=0;0<=u?t<u:t>u;s=0<=u?++t:--t)n.push(e.readUInt16());return n}(),r=(this.length-e.pos+this.offset)/2,o=function(){var t,n;for(n=[],s=t=0;0<=r?t<r:t>r;s=0<=r?++t:--t)n.push(e.readUInt16());return n}(),s=_=0,E=i.length;_<E;s=++_)for(m=i[s],n=g=p=f[s];p<=m?g<=m:g>=m;n=p<=m?++g:--g)0===l[s]?a=n+c[s]:0!==(a=o[l[s]/2+(n-p)-(u-s)]||0)&&(a+=c[s]),this.codeMap[n]=65535&a}e.pos=d}return e.encode=function(e,t){var n,r,i,a,o,s,c,l,d,u,h,p,f,m,_,g,E,v,y,S,b,T,C,w,R,A,I,N,O,P,L,D,k,x,M,U,F,j,V,B,G,W,H,q,z,K;switch(N=new ts,a=Object.keys(e).sort((function(e,t){return e-t})),t){case"macroman":for(f=0,m=function(){var e=[];for(p=0;p<256;++p)e.push(0);return e}(),g={0:0},i={},O=0,k=a.length;O<k;O++)null==g[H=e[r=a[O]]]&&(g[H]=++f),i[r]={old:e[r],new:g[e[r]]},m[r]=g[e[r]];return N.writeUInt16(1),N.writeUInt16(0),N.writeUInt32(12),N.writeUInt16(0),N.writeUInt16(262),N.writeUInt16(0),N.write(m),{charMap:i,subtable:N.data,maxGlyphID:f+1};case"unicode":for(A=[],d=[],E=0,g={},n={},_=c=null,P=0,x=a.length;P<x;P++)null==g[y=e[r=a[P]]]&&(g[y]=++E),n[r]={old:y,new:g[y]},o=g[y]-r,null!=_&&o===c||(_&&d.push(_),A.push(r),c=o),_=r;for(_&&d.push(_),d.push(65535),A.push(65535),w=2*(C=A.length),T=2*Math.pow(Math.log(C)/Math.LN2,2),u=Math.log(T/2)/Math.LN2,b=2*C-T,s=[],S=[],h=[],p=L=0,M=A.length;L<M;p=++L){if(R=A[p],l=d[p],65535===R){s.push(0),S.push(0);break}if(R-(I=n[R].new)>=32768)for(s.push(0),S.push(2*(h.length+C-p)),r=D=R;R<=l?D<=l:D>=l;r=R<=l?++D:--D)h.push(n[r].new);else s.push(I-R),S.push(0)}for(N.writeUInt16(3),N.writeUInt16(1),N.writeUInt32(12),N.writeUInt16(4),N.writeUInt16(16+8*C+2*h.length),N.writeUInt16(0),N.writeUInt16(w),N.writeUInt16(T),N.writeUInt16(u),N.writeUInt16(b),G=0,U=d.length;G<U;G++)r=d[G],N.writeUInt16(r);for(N.writeUInt16(0),W=0,F=A.length;W<F;W++)r=A[W],N.writeUInt16(r);for(q=0,j=s.length;q<j;q++)o=s[q],N.writeUInt16(o);for(z=0,V=S.length;z<V;z++)v=S[z],N.writeUInt16(v);for(K=0,B=h.length;K<B;K++)f=h[K],N.writeUInt16(f);return{charMap:n,subtable:N.data,maxGlyphID:E+1}}},e}(),ss=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="cmap",e.prototype.parse=function(e){var t,n,r;for(e.pos=this.offset,this.version=e.readUInt16(),r=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=r?n<r:n>r;n=0<=r?++n:--n)t=new os(e,this.offset),this.tables.push(t),t.isUnicode&&null==this.unicode&&(this.unicode=t);return!0},e.encode=function(e,t){var n,r;return null==t&&(t="macroman"),n=os.encode(e,t),(r=new ts).writeUInt16(0),r.writeUInt16(1),n.table=r.data.concat(n.subtable),n},e}(),cs=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="hhea",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},e}(),ls=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="OS/2",e.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n}(),this.charRange=function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},e}(),ds=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="post",e.prototype.parse=function(e){var t,n,r;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var i;for(n=e.readUInt16(),this.glyphNameIndex=[],i=0;0<=n?i<n:i>n;i=0<=n?++i:--i)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],r=[];e.pos<this.offset+this.length;)t=e.readByte(),r.push(this.names.push(e.readString(t)));return r;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=function(){var t,n,r;for(r=[],i=t=0,n=this.file.maxp.numGlyphs;0<=n?t<n:t>n;i=0<=n?++t:--t)r.push(e.readUInt32());return r}.call(this)}},e}(),us=function(e,t){this.raw=e,this.length=e.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},hs=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="name",e.prototype.parse=function(e){var t,n,r,i,a,o,s,c,l,d,u;for(e.pos=this.offset,e.readShort(),t=e.readShort(),o=e.readShort(),n=[],i=0;0<=t?i<t:i>t;i=0<=t?++i:--i)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+o+e.readShort()});for(s={},i=l=0,d=n.length;l<d;i=++l)r=n[i],e.pos=r.offset,c=e.readString(r.length),a=new us(c,r),null==s[u=r.nameID]&&(s[u]=[]),s[r.nameID].push(a);this.strings=s,this.copyright=s[0],this.fontFamily=s[1],this.fontSubfamily=s[2],this.uniqueSubfamily=s[3],this.fontName=s[4],this.version=s[5];try{this.postscriptName=s[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch(e){this.postscriptName=s[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=s[7],this.manufacturer=s[8],this.designer=s[9],this.description=s[10],this.vendorUrl=s[11],this.designerUrl=s[12],this.license=s[13],this.licenseUrl=s[14],this.preferredFamily=s[15],this.preferredSubfamily=s[17],this.compatibleFull=s[18],this.sampleText=s[19]},e}(),ps=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="maxp",e.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},e}(),fs=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="hmtx",e.prototype.parse=function(e){var t,n,r,i,a,o,s;for(e.pos=this.offset,this.metrics=[],t=0,o=this.file.hhea.numberOfMetrics;0<=o?t<o:t>o;t=0<=o?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(r=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var n,i;for(i=[],t=n=0;0<=r?n<r:n>r;t=0<=r?++n:--n)i.push(e.readInt16());return i}(),this.widths=function(){var e,t,n,r;for(r=[],e=0,t=(n=this.metrics).length;e<t;e++)i=n[e],r.push(i.advance);return r}.call(this),n=this.widths[this.widths.length-1],s=[],t=a=0;0<=r?a<r:a>r;t=0<=r?++a:--a)s.push(this.widths.push(n));return s},e.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},e}(),ms=[].slice,_s=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(e){var t,n,r,i,a,o,s,c,l,d;return e in this.cache?this.cache[e]:(i=this.file.loca,t=this.file.contents,n=i.indexOf(e),0===(r=i.lengthOf(e))?this.cache[e]=null:(t.pos=this.offset+n,a=(o=new ts(t.read(r))).readShort(),c=o.readShort(),d=o.readShort(),s=o.readShort(),l=o.readShort(),this.cache[e]=-1===a?new Es(o,c,d,s,l):new gs(o,a,c,d,s,l),this.cache[e]))},e.prototype.encode=function(e,t,n){var r,i,a,o,s;for(a=[],i=[],o=0,s=t.length;o<s;o++)r=e[t[o]],i.push(a.length),r&&(a=a.concat(r.encode(n)));return i.push(a.length),{table:a,offsets:i}},e}(),gs=function(){function e(e,t,n,r,i,a){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=r,this.xMax=i,this.yMax=a,this.compound=!1}return e.prototype.encode=function(){return this.raw.data},e}(),Es=function(){function e(e,t,n,r,i){var a,o;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=r,this.yMax=i,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return e.prototype.encode=function(){var e,t,n;for(t=new ts(ms.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},e}(),vs=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return is(e,es),e.prototype.tag="loca",e.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=0===t?function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=2)r.push(2*e.readUInt16());return r}.call(this):function(){var t,r;for(r=[],n=0,t=this.length;n<t;n+=4)r.push(e.readUInt32());return r}.call(this)},e.prototype.indexOf=function(e){return this.offsets[e]},e.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},e.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),r=0,i=0,a=0;a<n.length;++a)if(n[a]=r,i<t.length&&t[i]==a){++i,n[a]=r;var o=this.offsets[a],s=this.offsets[a+1]-o;s>0&&(r+=s)}for(var c=new Array(4*n.length),l=0;l<n.length;++l)c[4*l+3]=255&n[l],c[4*l+2]=(65280&n[l])>>8,c[4*l+1]=(16711680&n[l])>>16,c[4*l]=(4278190080&n[l])>>24;return c},e}(),ys=function(){function e(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return e.prototype.generateCmap=function(){var e,t,n,r,i;for(t in r=this.font.cmap.tables[0].codeMap,e={},i=this.subset)n=i[t],e[t]=r[n];return e},e.prototype.glyphsFor=function(e){var t,n,r,i,a,o,s;for(r={},a=0,o=e.length;a<o;a++)r[i=e[a]]=this.font.glyf.glyphFor(i);for(i in t=[],r)(null!=(n=r[i])?n.compound:void 0)&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(i in s=this.glyphsFor(t))n=s[i],r[i]=n;return r},e.prototype.encode=function(e,t){var n,r,i,a,o,s,c,l,d,u,h,p,f,m,_;for(r in n=ss.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(e),h={0:0},_=n.charMap)h[(s=_[r]).old]=s.new;for(p in u=n.maxGlyphID,a)p in h||(h[p]=u++);return l=function(e){var t,n;for(t in n={},e)n[e[t]]=t;return n}(h),d=Object.keys(l).sort((function(e,t){return e-t})),f=function(){var e,t,n;for(n=[],e=0,t=d.length;e<t;e++)o=d[e],n.push(l[o]);return n}(),i=this.font.glyf.encode(a,f,h),c=this.font.loca.encode(i.offsets,f),m={cmap:this.font.cmap.raw(),glyf:i.table,loca:c,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(m["OS/2"]=this.font.os2.raw()),this.font.directory.encode(m)},e}();xa.API.PDFObject=function(){var e;function t(){}return e=function(e,t){return(Array(t+1).join("0")+e).slice(-t)},t.convert=function(n){var r,i,a,o;if(Array.isArray(n))return"["+function(){var e,i,a;for(a=[],e=0,i=n.length;e<i;e++)r=n[e],a.push(t.convert(r));return a}().join(" ")+"]";if("string"==typeof n)return"/"+n;if(null!=n?n.isString:void 0)return"("+n+")";if(n instanceof Date)return"(D:"+e(n.getUTCFullYear(),4)+e(n.getUTCMonth(),2)+e(n.getUTCDate(),2)+e(n.getUTCHours(),2)+e(n.getUTCMinutes(),2)+e(n.getUTCSeconds(),2)+"Z)";if("[object Object]"==={}.toString.call(n)){for(i in a=["<<"],n)o=n[i],a.push("/"+i+" "+t.convert(o));return a.push(">>"),a.join("\n")}return""+n},t}();const Ss=xa,bs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHwAAABGCAYAAAAO//B1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAc9SURBVHgB7ZvdctNWEID3yHZMelMzcWagdAZx0dbJTcMT4DxBxRMk3AHtDMkTYJ6AZIYyvYvzBBFPgHkC3BucthcoU2iZSTJRrzI0tk53j34s/0oOOq5D9psxOZL2/Eh7fncXAIZhGIZhGIZhGIZhGIZhGIZhGIZhGIZhGIZhGIaZDQRMA7NUgvn8OnhwBwyxAiDNoHYX7zXxehf2j+vwP3Djx7sn9Pf9z3tX4RJggG6+XbDgi/xbTD3F2qxI2YSEEiq9CkLswNLCW6gsrMP0KQW/S4FehS+XH0NO7CnF9nIQ/GIIUym+gnkYbeib0pfKG0CjuluVg0N6G07bdXBcV92iqf5KwcJWPO4Z+R5swm9HW6CJYBofNardz3l6z4MOKiVTKVFGd5pwerYaKTrEv67DSsmGjwVUsFxT9w3MW8F7+64zUPZy+cSfMeRdaB3bMIolXEoAZxdUILSOehRIvVyOyDZ0BER1jqQJUuJepPNkaJv7oe8D+TWc0dZjHX2yMs6JnhFeWajjy6wFVTggc6uw/8EZm2cFR/vHwuvoA0hZx43cvQG5pbIMnt8bu9GrLK6DkDsq3Toa+Z442lV5OKpHf4uwzmRcbNcGtmt3pERlYQ03rltjOlByGZ9A9mu4Gt2hsoGG0pNEZRNN11VKDKHeT1P+LEFLDXWe/p+EVX/Jok2oqMM3iytD81fKVfXcV/YrlS8sQ4jbWMZuVAbJakDDpi1XjV24sH9Yh7TsHzXUUS3kSs4CzeCwdumXTlgOl6N2F89uR23Py9qI/DtBpTYquaryhbw5bELrkGal7UhWQ4fPXuEC4kp6BZPiiRexqzugmXe4QXuXxSbNn6HCaXiw3erIKUyV9vKbI8uZ69T8joOy8z2DJxM0KFzcjNKSjCqT5pfdPMJYgYuENMK2D47M7kB4MXaJo44TdnoJP0DG6DiHm1FKGJMrXIrYtBk7ql0IovYOTv3hQPCgAUmEnZ6MUhmTvcLju0/ppVsbewtwYhcXxwJG662Q4WZ1cCmT4M9WhuFAIuE3ECZkjH7T6ixDxiE6ctHvO2UomhxSNO2o5/MvIwW1RW2kfJpB0DPLZYsew8tFwbfl+4gUs4my+Zd3Rj+nMzQeQ/84nHwpmxKXW+HZcOArWjbAQ2thks1BGCk6lizpsollr3C/lwcvdY5NV+/LapvazkWSdW885Cy6CZ5nJouKQEZkPlPo2LT9002Lc2y6hBlLO/C5IEVD/RXy+2RZGRxH5QFkjAaFBy9GpHm5gfwydvYe+sL+PQEJZ3SvGjRiNtZT4dn+X2GNtaCRadoQ/vlbChsyRoPhJW44EZObRkXMSjX0zCqDj4D2euV1GoLvrbsTlDcbCleevcDePp8fs/HLP/KXRJSdxCydkuwVXkR/d5fSRE4AJSvM6FrkB3u4xI2Rb7PGHXbu5UD5ykGRC45I+NG83BOYFbrOIQt3+3s9ThZqN90D8I+HHW8TNJC9wpvKx92I3UkfwSLgUZSWaLwYtuNV90TgnRI0kl/6Z+nFt+ovXdP9tG7ZaaKcJejH9zushU6W15EdQLUbrODZJvx+nPl0TugxvNBZNITMg0vlp4l5llVoU3wJqI2UJc8SKVMKGjGv/I8kzeBjkZVrE07Re5V4RIqdAsSYE0H4TOQ+/dRAU7uX912hAn6NPTlQEUH0rKUv2kdfiNPyAjr5xaPYHRtke3MgmsOPaCVlxyxd+OKt4/NZvpix6A1TXlqsR2FLXZq4GXOUb1lQyPLAbhv9wke3gdGC/rj05XINp/iU6ziuuzQV98e+MZkxnf+IULmG6ys69lVgQJL1DT1FsrOqM5DvMjMdbxltnih8p3V4C07bV1UsF8VwyfYtP54rCOtRCFMdq0bFhfVx/YFlmRtW6cZDS8mXMN0vg8/WSca8b5mUjssMk0969tVD6zGVQ2kqM5QdVu61+1YVf2Yoh3lrpRHtDcvUyXRGeBqGTf0p4tPxI20ZBjQk2t2lByb+vSkoqgT3Bpg2/3pu1+hDCiPvdKBdMjwoobzb7qAjIYdV4HUBDTxnBlRD+a9/urv17tnexnUsm+Ld6F5PnQ+sDdq5v39u10MlqTI9qBoSnI4EOycMPGJ5bof2KwBODssvzIH9b9vY8NpePZ/HtgbtxTbs5nKGJYQ0qV7QyOz4w98c1WLRnz4iVQBE86zdtaahgg5QgaEDJwovbrfbDnT89J/PbNvAsttBfvrHww4iBHxJaenJJs0IKCOpM/VXiLJOf5ixKpPKio5wntsv42zZrvA8JyrHUAGUB1f8Sl3PkyegmdkKgCDDBJ2vldGEwpuxEyRAo+bDL7aDI6ZJI66AH93B60IR7DkcOXGZYhGalA7v/Y1KQnkg+eIcbBU6sB0+I+UUCrBN5fbXqcopQj2UjZcZptU1ymC9Dao7LhO2N6jfb+8cNML2MgzDMAzDMAzDMAzDMAzDMAzDMAzDMAzDMAzDMMxl4D9cvNWgooI9ZwAAAABJRU5ErkJggg==",Ts=e=>({type:ve,payload:e}),Cs=()=>({type:ye}),ws=()=>async e=>{try{(0,Le.O)("success","Starting video call"),e(Ts(!0)),console.log("Video call is active now.")}catch(t){console.error("Error while initiating the video call:",t),(0,Le.O)("error","Error while initiating the video call",t),e(Ts(!1))}},Rs=()=>async e=>{try{console.log("Ending video call."),(0,Le.O)("success","Ending video call"),e(Ts(!1))}catch(t){console.error("Error while ending the video call:",t),(0,Le.O)("error","Error while ending the video call",t)}},As=()=>(0,Re.jsx)("div",{className:"qpeLoader"}),Is=e=>{let{onClose:t,settings:n=!1}=e;const{phoneNumber:r,phn:a,patientName:o,email:s,dob:c}=R((e=>e.data)),{linkType:l}=R((e=>e.data)),[d,u]=(0,i.useState)([]),[h,p]=(0,i.useState)([]),[f,m]=(0,i.useState)([]),[_,g]=(0,i.useState)("default"),[E,v]=(0,i.useState)("default"),[y,S]=(0,i.useState)("default");(0,i.useEffect)((()=>{(async()=>{try{const e=await navigator.mediaDevices.enumerateDevices(),t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"audiooutput"===e.kind)),r=e.filter((e=>"videoinput"===e.kind));u(t),p(n),m(r),console.log("Available Input Devices: ",t),console.log("Available Output Devices: ",n),console.log("Available Video Devices: ",r);const i=t.find((e=>"default"===e.deviceId)),a=n.find((e=>"default"===e.deviceId)),o=r.find((e=>"default"===e.deviceId));i&&g(i.deviceId),a&&v(a.deviceId),o&&S(o.deviceId)}catch(xi){console.error("Error fetching devices: ",xi)}})()}),[]);const b=[{label:"Date of Birth",value:c,key:"dob"},{label:"Health Card Number",value:a,key:"phn"},{label:"Phone Number",value:r,key:"phoneNumber"},{label:"Email",value:s,key:"email"},{label:"Address",value:"Not Available",key:"address"}],T=[{icon:(0,Re.jsx)(Ue,{color:"var(--dark-text)"}),label:"Microphone",options:d,selected:_,onChange:e=>g(e.target.value)},{icon:(0,Re.jsx)(Xe,{isDisabled:!0,color:"var(--dark-text)"}),label:"Speaker",options:h,selected:E,onChange:e=>v(e.target.value)},...l===x.VIDEO_CALL?[{icon:(0,Re.jsx)(Ge,{color:"var(--dark-text)"}),label:"Video",options:f,selected:y,onChange:e=>S(e.target.value)}]:[]];return(0,Re.jsx)("div",{className:"qpe-modal-overlay",children:(0,Re.jsxs)("div",{className:"qpe-modal-container",children:[(0,Re.jsx)("div",{className:"qpe-modal-header",children:n?(0,Re.jsxs)("div",{className:"qpe-modal-sub-header",children:[(0,Re.jsx)("h2",{children:"Settings"}),(0,Re.jsx)("p",{children:"Set your microphone and speaker, test them, adjust their volume, view your video feed and change your camera and change other settings."})]}):(0,Re.jsx)("h2",{children:o||"No Name Available"})}),(0,Re.jsx)("div",{className:"qpe-modal-body",children:n?(0,Re.jsx)("div",{className:"device-settings",children:T.map(((e,t)=>(0,Re.jsxs)("div",{className:"device-setting",children:[e.icon,(0,Re.jsx)("label",{children:e.label}),(0,Re.jsx)("div",{className:"custom-select-container",children:(0,Re.jsx)("select",{value:e.selected,onChange:e.onChange,children:e.options.map(((e,t)=>(0,Re.jsx)("option",{value:e.deviceId,children:e.label||e.deviceId},t)))})})]},t)))}):b.map(((e,t)=>(0,Re.jsx)("div",{className:"qpe-modal-row",children:(0,Re.jsxs)("div",{className:"qpe-modal-info",children:[(0,Re.jsx)("p",{children:e.label}),(0,Re.jsx)("p",{children:e.value||"Not Available"})]})},e.key)))}),(0,Re.jsxs)("div",{className:"qpe-modal-footer",children:[(0,Re.jsx)("button",{onClick:t,children:n?"Cancel":"Close"}),n&&(0,Re.jsx)("button",{onClick:async()=>{if(_&&E&&y)try{const e=window.stream;if(e){e.getTracks().forEach((e=>e.stop()))}const n=await navigator.mediaDevices.getUserMedia((0,A.A)({audio:{deviceId:_}},l===x.VIDEO_CALL&&{video:{deviceId:y}}));window.stream=n,console.log("Media stream setup successfully");const r=d.find((e=>e.deviceId===_)),i=h.find((e=>e.deviceId===E)),a=f.find((e=>e.deviceId===y));console.log("Currently using Input Device: ",r),console.log("Currently using Output Device: ",i),console.log("Currently using Video Device: ",a);const o=document.getElementById("videoElement");o&&n&&(o.srcObject=n),t()}catch(e){console.error("Error setting up media stream:",e)}else console.error("Please select all devices before proceeding.")},children:"Done"})]})]})})},Ns=e=>{let{selectedTab:t,isCallActive:n,isCallMuted:r,actions:a,type:o,timer:s,selectedSOAP:c,initializeCall:l,videoTrack:d,micTrack:u,videoContainerRef:h,loading:p,totalUsers:f,disabled:m}=e;const _=T(),{soapApiData:g}=R((e=>e.questionnaire)),{soapNotes:E}=R((e=>e.scribe)),[v,y]=(0,i.useState)(!1),[S,b]=(0,i.useState)(!1),[C,w]=(0,i.useState)(!1),{isRecording:A,isPaused:I,isStopping:N,transcriptText:O}=R((e=>e.scribe)),{appointmentNumber:P,screen:L,demoGraphicId:D,linkType:j}=R((e=>e.data)),{isVideoCallActive:V,micOn:B,cameraOn:G}=R((e=>e.video)),W=v||n||A||V||S,H=(0,i.useCallback)((e=>{y(!0),De(e,g,P).then((e=>{const t=(null===e||void 0===e?void 0:e.soapnote)||{subjective:[],objective:[],assessment:[],plan:[]};(0,Le.O)("success","SOAP note generated successfully"),_(_t(t)),_(Et(E.length+1)),y(!1)})).catch((e=>{(0,Le.O)("error","Error regenerating SOAP note: ".concat(e.message)),y(!1)}))}),[g,P,_,E.length]),q=(0,i.useCallback)((async e=>{b(!0);try{const t=ri(e);await(async(e,t,n)=>{try{const r=await Kr.post("".concat($r,"/upload-soap-note"),{oscarAppointmentId:t,demographicNo:e,soapNote:n});if(r.data.statusCode&&200!==r.data.statusCode)throw(0,Le.O)("error",r.data.message||"Error uploading SOAP Note"),new Error(r.data.message||"Error uploading SOAP Note");return(0,Le.O)("success","SOAP Note generated.",!1),r}catch(r){throw(0,Le.O)("error",r.message||"Error uploading SOAP Note"),r}})(D,P,t),(0,Le.O)("success","SOAP Note uploaded successfully.")}catch(t){(0,Le.O)("error","SOAP Note Upload failed: ".concat(t.message))}finally{b(!1)}}),[D,P]),z=(0,i.useCallback)((async e=>{if(e){b(!0);try{const t=await(async e=>{if(!e)throw new Error("No SOAP Note provided.");try{const t=new Ss({orientation:"portrait",unit:"mm",format:"a4"}),n={pageWidth:t.internal.pageSize.getWidth(),pageHeight:t.internal.pageSize.getHeight(),margins:{top:10,bottom:10,left:10,right:10},header:{height:40},footer:{height:25},signature:{height:30}},r={maxHeight:n.pageHeight-n.header.height-n.footer.height-n.margins.top-n.margins.bottom,width:n.pageWidth-n.margins.left-n.margins.right},i=()=>{t.setFillColor("#f6fbf4"),t.rect(0,0,n.pageWidth,n.header.height,"F"),t.setTextColor("#181d19"),t.setFontSize(22),t.setFont("helvetica","bold"),t.text("Medical Clinic Name",10,10),t.setFontSize(10);const e=["123 Medical Center Drive","City, State 12345","Tel: (555) 123-4567","Fax: (555) 123-4568"];t.setFont("helvetica","bold"),t.text(e[0],10,17),t.setFont("helvetica","normal"),e.slice(1).forEach(((e,n)=>{t.text(e,10,17+6*(n+1))})),t.setDrawColor("#c0c8cd"),t.setLineWidth(.5),t.line(0,n.header.height,n.pageWidth,n.header.height)},a=e=>{const r=n.pageHeight-n.footer.height;t.setFillColor("#D1E8D5"),t.rect(0,r,n.pageWidth,n.footer.height,"F");const i=r+(n.footer.height-18)/2;bs&&t.addImage(bs,"PNG",4,i,40,18),t.setTextColor("#40484c"),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("Page ".concat(e),n.pageWidth-n.margins.right-10,r+15)},o=(e,a,o)=>{if(!a||0===a.length)return o;const s=Array.isArray(a)?a.join("\n"):a,c=t.splitTextToSize(s,r.width);let l=o;return t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor("#000"),t.text(e,n.margins.left,l),l+=8,t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor("#000"),c.forEach((e=>{l+7>n.pageHeight-n.footer.height-n.margins.bottom&&(t.addPage(),i(),l=n.header.height+n.margins.top),t.text(e,n.margins.left,l),l+=7})),l},s=()=>{const e=n.pageHeight-n.footer.height-20;t.setDrawColor("#181d19"),t.setLineWidth(.5),t.line(n.margins.left,e,n.margins.left+60,e),t.setFontSize(10),t.text("Doctor's Signature:",n.margins.left,e+5)};let c=n.header.height+n.margins.top;i(),c=o("SUBJECTIVE",e.subjective,c),c=o("OBJECTIVE",e.objective,c),c=o("ASSESSMENT",e.assessment,c),c=o("PLAN",e.plan,c);const l=t.internal.getNumberOfPages();for(let e=1;e<=l;e++)t.setPage(e),a(e);return s(),t.save("SOAP_Note.pdf"),"SOAP Note downloaded successfully as PDF."}catch(t){throw console.error("Error while downloading the SOAP Note:",t),new Error("Failed to download SOAP Note as PDF: "+t.message)}})(e);(0,Le.O)("success",t)}catch(t){(0,Le.O)("error","SOAP Note PDF Download failed: ".concat(t.message))}finally{b(!1)}}else(0,Le.O)("error","No SOAP Note provided for download.")}),[]),K=(0,i.useCallback)((async e=>{try{e===ht?(_(gt(!0)),await _(e()),_(gt(!1)),(0,Le.O)("success","Recording stopped successfully.",!1)):(_(e(P)),(0,Le.O)("success","Recording",!1))}catch(t){(0,Le.O)("error",t)}}),[_,P]),Y=(0,i.useCallback)((async e=>{try{e===ws?(_((U.NONE,{type:Ie.SET_SCREEN})),await _(e()),_({type:F.DATA_CONSTANTS.SET_SCREEN,payload:U.NONE}),(0,Le.O)("info","Video Call started")):e===Rs&&(await _(e()),_({type:F.DATA_CONSTANTS.SET_SCREEN,payload:U.DEFAULT}),(0,Le.O)("info","Video Call ended"))}catch(t){(0,Le.O)("error","Error handling the video call ".concat(t," "))}}),[_]),J=(0,i.useCallback)((()=>{try{const e=a.setIsCallMuted(!r);_(e),(0,Le.O)("success","Call Controls",!1)}catch(e){(0,Le.O)("error","Call Controls",e)}}),[_,a,r]),X=(0,i.useCallback)((async e=>{e?(e.setMuted(!e._muted),_({type:"TOGGLE_MIC"})):(0,Le.O)("error","Video Controls","No mic track found")}),[_]),Q=(0,i.useCallback)((async(e,t)=>{if(e)try{_(Cs())}catch(n){console.log("Error toggling camera")}else console.log("No video track found")}),[_,G]),Z=(0,i.useCallback)((()=>{w(!C)}),[C]),$=e=>{let{color:t="var(--dark-text)"}=e;return(0,Re.jsx)("div",{className:"smLoader",style:{borderTopColor:t}})},ee=()=>(0,Re.jsxs)("div",{className:"statusContainer",children:[(0,Re.jsx)(ze,{}),(0,Re.jsx)("span",{children:"Dictation On"})]}),te=()=>(0,Re.jsx)(yt,{icon:(0,Re.jsx)(Ye,{}),onClick:Z,className:"qpeScribe-button"}),ne=(0,i.useCallback)((()=>{if(P)switch(j){case x.CLINIC:K(ut);break;case x.PHONE_CALL:l();break;case x.VIDEO_CALL:Y(ws);break;default:(0,Le.O)("error","Invalid link type")}else(0,Le.O)("error","Appointment number is required")}),[P,j,K,l,Y]),re=(0,i.useMemo)((()=>N?(0,Re.jsx)(yt,{text:"Stopping",icon:(0,Re.jsx)($,{color:"#fff"}),className:"greenButton",disabled:!0}):(0,Re.jsxs)(Re.Fragment,{children:[I?(0,Re.jsx)(yt,{onClick:()=>K(ft),icon:(0,Re.jsx)(Ve,{}),ariaLabel:"Resume Recording",id:"resumeBtn"}):(0,Re.jsx)(yt,{onClick:()=>K(pt),icon:(0,Re.jsx)(Ue,{color:"var(--white)"}),ariaLabel:"Pause Recording",id:"pauseBtn"}),(0,Re.jsx)(te,{}),(0,Re.jsx)(ee,{}),(0,Re.jsx)(yt,{onClick:()=>K(ht),icon:(0,Re.jsx)(qe,{}),text:(0,Re.jsx)(ii,{timer:s,type:M.TIMER}),ariaLabel:"Stop Recording",className:"hangupIcon"})]})),[I,N,K,s]),ie=(0,i.useMemo)((()=>{const e=j===x.VIDEO_CALL?"Start video Call":j===x.PHONE_CALL?"Start Phone Call":"Start Recording",t=j===x.VIDEO_CALL?(0,Re.jsx)(Ge,{}):j===x.CLINIC?(0,Re.jsx)(Ue,{color:"var(--white)"}):x.PHONE_CALL?(0,Re.jsx)(Fe,{}):(0,Re.jsx)(Ue,{color:"var(--white)"}),i=j===x.VIDEO_CALL?"video-call-button":j===x.CLINIC?"clinic-recording-button":j===x.PHONE_CALL?"phone-call-button":"default-button",l=(0,Re.jsx)(yt,{id:!p&&i,icon:p?(0,Re.jsx)(As,{}):t,text:e,className:"qpeSummaryButton greenButton",disabled:p||m,onClick:()=>ne()});return{Phone:(0,Re.jsx)(Re.Fragment,{children:L!==U.DEFAULT||n?(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(yt,{onClick:J,icon:r?(0,Re.jsx)(Ve,{}):(0,Re.jsx)(Ue,{color:"var(--white)"}),ariaLabel:"Mute Call",disabled:!n,id:"mute-button",className:"qpeScribe-button"}),(0,Re.jsx)(te,{}),(0,Re.jsx)(ee,{}),(0,Re.jsx)(yt,{onClick:()=>nt(a,_),icon:(0,Re.jsx)(qe,{type:"call"}),ariaLabel:"End Call",disabled:!n,id:"hangup-button",className:"hangupIcon",text:(0,Re.jsx)(ii,{timer:s,type:M.TIMER})})]}):l}),Clinic:(0,Re.jsx)(Re.Fragment,{children:L!==U.DEFAULT||A?(0,Re.jsx)(Re.Fragment,{children:re}):l}),Video:(0,Re.jsx)(Re.Fragment,{children:L===U.DEFAULT?!V&&l:(0,Re.jsx)(Re.Fragment,{children:"join"===o?(0,Re.jsx)(yt,{text:"Join",className:"qpeSummaryButton",onClick:()=>Y(ws)}):(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(yt,{icon:B?(0,Re.jsx)(Ue,{}):(0,Re.jsx)(Ve,{}),onClick:()=>X(u)}),(0,Re.jsx)(yt,{icon:G?(0,Re.jsx)(Ge,{}):(0,Re.jsx)(Ge,{isDisabled:!0}),onClick:()=>Q(d,h)}),(0,Re.jsx)(yt,{icon:(0,Re.jsx)(Ke,{}),ariaLabel:"Share Screen",id:"shareScreen",className:"qpeScribe-button"}),(0,Re.jsx)(te,{}),(0,Re.jsx)(ee,{}),(0,Re.jsxs)("div",{className:"participantIconContainer",children:[(0,Re.jsx)(Je,{}),(0,Re.jsx)("p",{children:f})]}),(0,Re.jsx)(yt,{onClick:()=>{Y(Rs),nt(a,_)},icon:(0,Re.jsx)(qe,{type:"call"}),ariaLabel:"End Call",disabled:!V,className:"hangupIcon",text:(0,Re.jsx)(ii,{timer:s})})]})})}),"AI Summary":(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(yt,{text:"Regenerate",className:"qpeSummaryButton",onClick:()=>H(O),disabled:v||W}),(0,Re.jsx)(yt,{text:"Download",className:"qpeSummaryButton",onClick:()=>z(c),disabled:S||!E.length}),(0,Re.jsx)(yt,{text:"Save",className:"qpeSummaryButton save",onClick:()=>q(c),disabled:S||!E.length})]})}}),[n,r,J,a,_,re,q,c,E.length,v,S,z,L,o,W,G,m,ne,H,Y,Q,A,V,j,p,B,u,s,X,f,O,h,d]);return(0,Re.jsxs)("div",{className:"qpeMainButtonContainer",style:{padding:t===k.AI_SUMMARY?"10px 10px":""},children:[ie[t]||null,C?(0,Re.jsx)(Is,{onClose:()=>Z(),settings:!0}):null]})},Os=i.memo(Ns),Ps=()=>{const e=T(),{soapNotes:t,responseCount:n}=R((e=>e.scribe)),[r,a]=(0,i.useState)(n||1),[o,s]=(0,i.useState)({subjective:"No data available for subjective",objective:"No data available for objective",assessment:"No data available for assessment",plan:"No data available for plan"});(0,i.useEffect)((()=>{var e,r,i,o;let c=0;n&&null!==t&&void 0!==t&&t.length&&(c=Math.max(1,Math.min(n,t.length))),a(c);const l=(t||[])[c-1]||{},d={subjective:null!==(e=l.subjective)&&void 0!==e&&e.length?l.subjective.join("\n"):"No data available for subjective",objective:null!==(r=l.objective)&&void 0!==r&&r.length?l.objective.join("\n"):"No data available for objective",assessment:null!==(i=l.assessment)&&void 0!==i&&i.length?l.assessment.join("\n"):"No data available for assessment",plan:null!==(o=l.plan)&&void 0!==o&&o.length?l.plan.join("\n"):"No data available for plan"};s(d)}),[n,t,e]);const c=n=>{const i=n.charAt(0).toUpperCase()+n.slice(1);return(0,Re.jsxs)("div",{className:"soapBox",children:[(0,Re.jsx)("div",{className:"soapBoxHeader",children:i}),(0,Re.jsx)("textarea",{className:"soapBoxContent custom-scrollbar",value:o[n]||"",onChange:e=>((e,t)=>{s((0,A.A)((0,A.A)({},o),{},{[e]:t}))})(n,e.target.value),onBlur:()=>(n=>{var i,a;const c=o[n].split("\n").filter((e=>""!==e.trim())),l=c.length>0?c:["No data available for ".concat(n)];if(((null===t||void 0===t||null===(i=t[r-1])||void 0===i||null===(a=i[n])||void 0===a?void 0:a.join("\n"))||"")===l.join("\n"))return;const d=(0,A.A)((0,A.A)({},null===t||void 0===t?void 0:t[r-1]),{},{[n]:l});e(_t(d)),s((0,A.A)((0,A.A)({},o),{},{[n]:l.join("\n")})),e(Et(t.length+1))})(n)})]},n)},l=(null===t||void 0===t?void 0:t[r-1])&&Object.keys(t[r-1]).some((e=>Array.isArray(t[r-1][e])&&t[r-1][e].length>0));return(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsxs)("div",{className:"soapController",children:[(0,Re.jsx)("div",{className:"tempplateHeader",children:(0,Re.jsx)("p",{children:"SOAP (Default Template)"})}),(0,Re.jsxs)("div",{className:"qpeResponseCount",children:[(0,Re.jsx)("button",{disabled:r<=1||0===(null===t||void 0===t?void 0:t.length),onClick:()=>{r>1&&e({type:"SET_RESPONSE_COUNT",payload:r-1})},children:"<"}),(0,Re.jsx)("p",{children:"".concat((null===t||void 0===t?void 0:t.length)>0?r:0," / ").concat((null===t||void 0===t?void 0:t.length)>0?null===t||void 0===t?void 0:t.length:0)}),(0,Re.jsx)("button",{disabled:r>=(null===t||void 0===t?void 0:t.length)||0===(null===t||void 0===t?void 0:t.length),onClick:()=>{r<(null===t||void 0===t?void 0:t.length)&&e({type:"SET_RESPONSE_COUNT",payload:r+1})},children:">"})]}),(0,Re.jsx)(Os,{selectedTab:"AI Summary",selectedSOAP:l?t[r-1]:void 0,disabled:!l})]}),(0,Re.jsx)("div",{className:"soapGrid",children:["subjective","objective","assessment","plan"].map((e=>c(e)))})]})},Ls=e=>({type:Q,payload:e}),Ds=e=>({type:Z,payload:e}),ks=e=>({type:$,payload:e}),xs=e=>({type:ee,payload:e}),Ms=e=>({type:te,payload:e}),Us=e=>{let{demoGraphicId:t,appointmentNumber:n,isNewPatientQuestionnaireLoaded:r,isAppointmentQuestionnaireLoaded:a,dispatch:o,fetchQuestionnaireApi:s,setFirstApiQuestions:c,setSecondApiQuestions:l,setIsNewPatientQuestionnaireLoaded:d,setIsAppointmentQuestionnaireLoaded:u}=e;const h=async(e,t)=>{try{if("demographicNo"===t?r:a)return void(0,Le.O)("warning","".concat(t," questionnaire already loaded, skipping API call"),!1);const n=await s(e,t,o);if(!n||!n.questionWithAnswers)return(0,Le.O)("warning","No questions found for ".concat(t),!1),"demographicNo"===t&&(o(c(null)),o(d(!0))),void("oscarAppointmentId"===t&&(o(l(null)),o(u(!0))));const i=JSON.parse(n.questionWithAnswers);"demographicNo"===t&&(o(c(i)),o(d(!0))),"oscarAppointmentId"===t&&(o(l(i)),o(u(!0))),(0,Le.O)("","Questionnaire loaded for ".concat(t),!1)}catch(n){(0,Le.O)("error","Error fetching ".concat(t," API: ").concat(n),!1),"demographicNo"===t&&o(c(null)),"oscarAppointmentId"===t&&o(l(null))}};(0,i.useEffect)((()=>{if(!r&&t&&h(t,"demographicNo"),!a&&n){const e=String(n);h(e,"oscarAppointmentId")}}),[t,n,r,a,o,s,c,l,d,u])},Fs=e=>{let{size:t,main:n=!0}=e;const{isCallMuted:r}=R((e=>e.twilio)),{isPaused:i}=R((e=>e.scribe)),{patientName:a,doctorName:o,screen:s,linkType:c}=R((e=>e.data));return(0,Re.jsxs)("div",{className:"qpeProfileContainerMain",children:[!(c===x.VIDEO_CALL&&s===U.NONE&&n)&&(0,Re.jsxs)("div",{className:"qpeProfileContainer ".concat(t||""," ").concat(n?"hasBorder":""),style:n&&s===U.NONE&&c!==x.CLINIC&&c!==x.VIDEO_CALL?{border:"1px solid var(--outline)"}:{},children:[s===U.NONE&&n&&c!==x.CLINIC&&(0,Re.jsx)(ii,{type:M.NAME,patient:!0}),(0,Re.jsx)("div",{className:"qpeProfile",children:(0,Re.jsx)("p",{children:ni(a)||"N/A"})}),s===U.NONE&&n&&(r||i?(0,Re.jsx)(Ve,{color:"var(--primary)"}):(0,Re.jsx)(Ue,{color:"var(--primary)"}))]}),s===U.NONE&&n&&c===x.VIDEO_CALL&&(0,Re.jsx)("div",{className:"qpeProfileContainer",children:(0,Re.jsx)("div",{className:"qpeProfile",children:(0,Re.jsx)("p",{children:ni(a)||"N/A"})})}),n&&c===x.PHONE_CALL&&s===U.NONE&&(0,Re.jsxs)("div",{className:"qpeProfileContainer ".concat(t||""," ").concat(n?"hasBorder":""),style:{border:c===x.CLINIC?void 0:"1px solid var(--outline)"},children:[s===U.NONE&&n&&(0,Re.jsx)(ii,{type:M.NAME,doctor:!0}),(0,Re.jsx)("div",{className:"qpeProfile",children:(0,Re.jsx)("p",{children:ni(o)||"N/A"})}),s===U.NONE&&(r||i?(0,Re.jsx)(Ve,{color:"var(--primary)"}):(0,Re.jsx)(Ue,{color:"var(--primary)"}))]})]})},js=e=>{let{selectedTab:t,timer:n,phoneNumber:r,isCallMuted:a,actions:o}=e;const s=T(),c=(0,i.useRef)(!1);let l;const{isCallActive:d}=R((e=>e.twilio)),{transcriptText:u}=R((e=>e.scribe)),{linkType:h,appointmentNumber:p}=R((e=>e.data)),[f,m]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{if(x.VIDEO_CALL===h){if(m(!0),!p)return(0,Le.O)("error","Appointment number is required for video call"),void m(!1);(async()=>{try{const e=await(async e=>{try{return(await Kr.post("".concat("https://api.aiscribe.quipohealth.com/api","/video/auth/"),{room_name:e})).data.token}catch(t){console.error("Error getting token",t)}})(p);s((e=>({type:Se,payload:e}))(e)),console.log("Token fetched successfully",e),m(!1)}catch(e){(0,Le.O)("error",e.message,!1)}})()}}),[h,p,s]),(0,i.useEffect)((()=>{l}),[d,l]),(0,Re.jsxs)("div",{className:"qpeElevatedDiv",id:h===x.VIDEO_CALL?"qpeVdoCall":void 0,children:[(0,Re.jsx)(ii,{type:M.NAME}),U.DEFAULT&&(0,Re.jsx)(Fs,{}),(0,Re.jsx)(Os,{selectedTab:t,phoneNumber:r,isCallActive:d,isCallMuted:a,actions:o,timer:n,initializeCall:()=>{if(d)(0,Le.O)("Info","Skipping websocker connection as a call is active.",!1);else try{(0,Le.O)("log","Attempting to connect to WebSocket...",!1),c.current=!0,s({type:F.DATA_CONSTANTS.SET_IN_PROGRESS,payload:!0}),tt("wss://api.aiscribe.quipohealth.com/ws/twilio/call/",r,s,o,u),s(o.setIsCallMuted(!1)),s(o.setIsCallRinging(!0)),s(o.setIsCallActive(!0)),s(o.setIsCallAlreadyConnected(!0)),s({type:F.DATA_CONSTANTS.SET_SCREEN,payload:U.NONE})}catch(e){c.current=!1,(0,Le.O)("error",e.message,!1)}},loading:f,disabled:f})]})};function Vs(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Bs=n(4980);const Gs=["track","play","disabled","muted","style","videoPlayerConfig"],Ws=["micOn","cameraOn","audioTrack","videoTrack","playAudio","playVideo","volume","cover","children","style"],Hs=["track","play","style","videoPlayerConfig"],qs=["user","playVideo","playAudio","playbackDeviceId","volume","cover","style","children","videoPlayerConfig"];var zs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ks(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ys=function(e){try{return!!e()}catch(t){return!0}},Js=!Ys((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),Xs=Js,Qs=Function.prototype,Zs=Qs.call,$s=Xs&&Qs.bind.bind(Zs,Zs),ec=Xs?$s:function(e){return function(){return Zs.apply(e,arguments)}},tc=ec({}.isPrototypeOf),nc=function(e){return e&&e.Math==Math&&e},rc=nc("object"==typeof globalThis&&globalThis)||nc("object"==typeof window&&window)||nc("object"==typeof self&&self)||nc("object"==typeof zs&&zs)||function(){return this}()||zs||Function("return this")(),ic=Js,ac=Function.prototype,oc=ac.apply,sc=ac.call,cc="object"==typeof Reflect&&Reflect.apply||(ic?sc.bind(oc):function(){return sc.apply(oc,arguments)}),lc=ec,dc=lc({}.toString),uc=lc("".slice),hc=function(e){return uc(dc(e),8,-1)},pc=hc,fc=ec,mc=function(e){if("Function"===pc(e))return fc(e)},_c="object"==typeof document&&document.all,gc={all:_c,IS_HTMLDDA:void 0===_c&&void 0!==_c},Ec=gc.all,vc=gc.IS_HTMLDDA?function(e){return"function"==typeof e||e===Ec}:function(e){return"function"==typeof e},yc={},Sc=!Ys((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),bc=Js,Tc=Function.prototype.call,Cc=bc?Tc.bind(Tc):function(){return Tc.apply(Tc,arguments)},wc={},Rc={}.propertyIsEnumerable,Ac=Object.getOwnPropertyDescriptor,Ic=Ac&&!Rc.call({1:2},1);wc.f=Ic?function(e){var t=Ac(this,e);return!!t&&t.enumerable}:Rc;var Nc,Oc,Pc=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Lc=Ys,Dc=hc,kc=Object,xc=ec("".split),Mc=Lc((function(){return!kc("z").propertyIsEnumerable(0)}))?function(e){return"String"==Dc(e)?xc(e,""):kc(e)}:kc,Uc=function(e){return null==e},Fc=Uc,jc=TypeError,Vc=function(e){if(Fc(e))throw jc("Can't call method on "+e);return e},Bc=Mc,Gc=Vc,Wc=function(e){return Bc(Gc(e))},Hc=vc,qc=gc.all,zc=gc.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Hc(e)||e===qc}:function(e){return"object"==typeof e?null!==e:Hc(e)},Kc={},Yc=Kc,Jc=rc,Xc=vc,Qc=function(e){return Xc(e)?e:void 0},Zc=function(e,t){return arguments.length<2?Qc(Yc[e])||Qc(Jc[e]):Yc[e]&&Yc[e][t]||Jc[e]&&Jc[e][t]},$c=typeof navigator<"u"&&String(navigator.userAgent)||"",el=rc,tl=$c,nl=el.process,rl=el.Deno,il=nl&&nl.versions||rl&&rl.version,al=il&&il.v8;al&&(Oc=(Nc=al.split("."))[0]>0&&Nc[0]<4?1:+(Nc[0]+Nc[1])),!Oc&&tl&&(!(Nc=tl.match(/Edge\/(\d+)/))||Nc[1]>=74)&&(Nc=tl.match(/Chrome\/(\d+)/))&&(Oc=+Nc[1]);var ol=Oc,sl=ol,cl=Ys,ll=rc.String,dl=!!Object.getOwnPropertySymbols&&!cl((function(){var e=Symbol();return!ll(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&sl&&sl<41})),ul=dl&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,hl=Zc,pl=vc,fl=tc,ml=Object,_l=ul?function(e){return"symbol"==typeof e}:function(e){var t=hl("Symbol");return pl(t)&&fl(t.prototype,ml(e))},gl=String,El=function(e){try{return gl(e)}catch(t){return"Object"}},vl=vc,yl=El,Sl=TypeError,bl=function(e){if(vl(e))return e;throw Sl(yl(e)+" is not a function")},Tl=bl,Cl=Uc,wl=function(e,t){var n=e[t];return Cl(n)?void 0:Tl(n)},Rl=Cc,Al=vc,Il=zc,Nl=TypeError,Ol={exports:{}},Pl=rc,Ll=Object.defineProperty,Dl="__core-js_shared__",kl=rc[Dl]||function(e,t){try{Ll(Pl,e,{value:t,configurable:!0,writable:!0})}catch(n){Pl[e]=t}return t}(Dl,{}),xl=kl;(Ol.exports=function(e,t){return xl[e]||(xl[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ml=Ol.exports,Ul=Vc,Fl=Object,jl=function(e){return Fl(Ul(e))},Vl=jl,Bl=ec({}.hasOwnProperty),Gl=Object.hasOwn||function(e,t){return Bl(Vl(e),t)},Wl=ec,Hl=0,ql=Math.random(),zl=Wl(1..toString),Kl=function(e){return"Symbol("+(void 0===e?"":e)+")_"+zl(++Hl+ql,36)},Yl=Ml,Jl=Gl,Xl=Kl,Ql=dl,Zl=ul,$l=rc.Symbol,ed=Yl("wks"),td=Zl?$l.for||$l:$l&&$l.withoutSetter||Xl,nd=function(e){return Jl(ed,e)||(ed[e]=Ql&&Jl($l,e)?$l[e]:td("Symbol."+e)),ed[e]},rd=Cc,id=zc,ad=_l,od=wl,sd=TypeError,cd=nd("toPrimitive"),ld=function(e,t){if(!id(e)||ad(e))return e;var n,r=od(e,cd);if(r){if(n=rd(r,e,t),!id(n)||ad(n))return n;throw sd("Can't convert object to primitive value")}return function(e,t){var n,r;if(Al(n=e.toString)&&!Il(r=Rl(n,e))||Al(n=e.valueOf)&&!Il(r=Rl(n,e))||"string"!==t)return r;throw Nl("Can't convert object to primitive value")}(e,t)},dd=_l,ud=function(e){var t=ld(e,"string");return dd(t)?t:t+""},hd=zc,pd=rc.document,fd=hd(pd)&&hd(pd.createElement),md=function(e){return fd?pd.createElement(e):{}},_d=md,gd=!Sc&&!Ys((function(){return 7!=Object.defineProperty(_d("div"),"a",{get:function(){return 7}}).a})),Ed=Sc,vd=Cc,yd=wc,Sd=Pc,bd=Wc,Td=ud,Cd=Gl,wd=gd,Rd=Object.getOwnPropertyDescriptor;yc.f=Ed?Rd:function(e,t){if(e=bd(e),t=Td(t),wd)try{return Rd(e,t)}catch(n){}if(Cd(e,t))return Sd(!vd(yd.f,e,t),e[t])};var Ad=Ys,Id=vc,Nd=/#|\.prototype\./,Od=function(e,t){var n=Ld[Pd(e)];return n==kd||n!=Dd&&(Id(t)?Ad(t):!!t)},Pd=Od.normalize=function(e){return String(e).replace(Nd,".").toLowerCase()},Ld=Od.data={},Dd=Od.NATIVE="N",kd=Od.POLYFILL="P",xd=Od,Md=bl,Ud=Js,Fd=mc(mc.bind),jd=function(e,t){return Md(e),void 0===t?e:Ud?Fd(e,t):function(){return e.apply(t,arguments)}},Vd={},Bd=Sc&&Ys((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Gd=zc,Wd=String,Hd=TypeError,qd=function(e){if(Gd(e))return e;throw Hd(Wd(e)+" is not an object")},zd=Sc,Kd=gd,Yd=Bd,Jd=qd,Xd=ud,Qd=TypeError,Zd=Object.defineProperty,$d=Object.getOwnPropertyDescriptor,eu="enumerable",tu="configurable",nu="writable";Vd.f=zd?Yd?function(e,t,n){if(Jd(e),t=Xd(t),Jd(n),"function"==typeof e&&"prototype"===t&&"value"in n&&nu in n&&!n[nu]){var r=$d(e,t);r&&r[nu]&&(e[t]=n.value,n={configurable:tu in n?n[tu]:r[tu],enumerable:eu in n?n[eu]:r[eu],writable:!1})}return Zd(e,t,n)}:Zd:function(e,t,n){if(Jd(e),t=Xd(t),Jd(n),Kd)try{return Zd(e,t,n)}catch(r){}if("get"in n||"set"in n)throw Qd("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var ru=Vd,iu=Pc,au=Sc?function(e,t,n){return ru.f(e,t,iu(1,n))}:function(e,t,n){return e[t]=n,e},ou=rc,su=cc,cu=mc,lu=vc,du=yc.f,uu=xd,hu=Kc,pu=jd,fu=au,mu=Gl,_u=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return su(e,this,arguments)};return t.prototype=e.prototype,t},gu=function(e,t){var n,r,i,a,o,s,c,l,d,u=e.target,h=e.global,p=e.stat,f=e.proto,m=h?ou:p?ou[u]:(ou[u]||{}).prototype,_=h?hu:hu[u]||fu(hu,u,{})[u],g=_.prototype;for(a in t)r=!(n=uu(h?a:u+(p?".":"#")+a,e.forced))&&m&&mu(m,a),s=_[a],r&&(c=e.dontCallGetSet?(d=du(m,a))&&d.value:m[a]),o=r&&c?c:t[a],r&&typeof s==typeof o||(l=e.bind&&r?pu(o,ou):e.wrap&&r?_u(o):f&&lu(o)?cu(o):o,(e.sham||o&&o.sham||s&&s.sham)&&fu(l,"sham",!0),fu(_,a,l),f&&(mu(hu,i=u+"Prototype")||fu(hu,i,{}),fu(hu[i],a,o),e.real&&g&&(n||!g[a])&&fu(g,a,o)))},Eu=Math.ceil,vu=Math.floor,yu=Math.trunc||function(e){var t=+e;return(t>0?vu:Eu)(t)},Su=yu,bu=function(e){var t=+e;return t!=t||0===t?0:Su(t)},Tu=bu,Cu=Math.max,wu=Math.min,Ru=function(e,t){var n=Tu(e);return n<0?Cu(n+t,0):wu(n,t)},Au=bu,Iu=Math.min,Nu=function(e){return e>0?Iu(Au(e),9007199254740991):0},Ou=Nu,Pu=function(e){return Ou(e.length)},Lu=Wc,Du=Ru,ku=Pu,xu=function(e){return function(t,n,r){var i,a=Lu(t),o=ku(a),s=Du(r,o);if(e&&n!=n){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}},Mu={includes:xu(!0),indexOf:xu(!1)},Uu=Mu.includes;gu({target:"Array",proto:!0,forced:Ys((function(){return!Array(1).includes()}))},{includes:function(e){return Uu(this,e,arguments.length>1?arguments[1]:void 0)}});var Fu=Kc,ju=function(e){return Fu[e+"Prototype"]},Vu=ju("Array").includes,Bu=zc,Gu=hc,Wu=nd("match"),Hu=function(e){var t;return Bu(e)&&(void 0!==(t=e[Wu])?!!t:"RegExp"==Gu(e))},qu=Hu,zu=TypeError,Ku={};Ku[nd("toStringTag")]="z";var Yu="[object z]"===String(Ku),Ju=Yu,Xu=vc,Qu=hc,Zu=nd("toStringTag"),$u=Object,eh="Arguments"==Qu(function(){return arguments}()),th=Ju?Qu:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=$u(e),Zu))?n:eh?Qu(t):"Object"==(r=Qu(t))&&Xu(t.callee)?"Arguments":r},nh=th,rh=String,ih=function(e){if("Symbol"===nh(e))throw TypeError("Cannot convert a Symbol value to a string");return rh(e)},ah=nd("match"),oh=gu,sh=Vc,ch=ih,lh=ec("".indexOf);oh({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[ah]=!1,"/./"[e](t)}catch(r){}}return!1}("includes")},{includes:function(e){return!!~lh(ch(sh(this)),ch(function(e){if(qu(e))throw zu("The method doesn't accept regular expressions");return e}(e)),arguments.length>1?arguments[1]:void 0)}});var dh=ju("String").includes,uh=tc,hh=Vu,ph=dh,fh=Array.prototype,mh=String.prototype,_h=Ks((function(e){var t=e.includes;return e===fh||uh(fh,e)&&t===fh.includes?hh:"string"==typeof e||e===mh||uh(mh,e)&&t===mh.includes?ph:t})),gh=bl,Eh=jl,vh=Mc,yh=Pu,Sh=TypeError,bh=function(e){return function(t,n,r,i){gh(n);var a=Eh(t),o=vh(a),s=yh(a),c=e?s-1:0,l=e?-1:1;if(r<2)for(;;){if(c in o){i=o[c],c+=l;break}if(c+=l,e?c<0:s<=c)throw Sh("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=l)c in o&&(i=n(i,o[c],c,a));return i}},Th={left:bh(!1),right:bh(!0)},Ch=Ys,wh=function(e,t){var n=[][e];return!!n&&Ch((function(){n.call(null,t||function(){return 1},1)}))},Rh=typeof process<"u"&&"process"==hc(process),Ah=Th.left;gu({target:"Array",proto:!0,forced:!Rh&&ol>79&&ol<83||!wh("reduce")},{reduce:function(e){var t=arguments.length;return Ah(this,e,t,t>1?arguments[1]:void 0)}});var Ih=ju("Array").reduce,Nh=tc,Oh=Ih,Ph=Array.prototype,Lh=function(e){var t=e.reduce;return e===Ph||Nh(Ph,e)&&t===Ph.reduce?Oh:t},Dh=Ks(Lh),kh=!0,xh=!0;function Mh(e,t,n){let r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Uh(e,t,n){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);let a=e=>{let t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,a),i.apply(this,[e,a])};let a=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(n))return a.apply(this,arguments);let r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Fh(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(kh=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function jh(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(xh=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Vh(){if("object"==typeof window){if(kh)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Bh(e,t){xh&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Gh(e){return"[object Object]"===Object.prototype.toString.call(e)}function Wh(e){var t;return Gh(e)?Dh(t=Object.keys(e)).call(t,(function(t,n){let r=Gh(e[n]),i=r?Wh(e[n]):e[n],a=r&&!Object.keys(i).length;return void 0===i||a?t:Object.assign(t,{[n]:i})}),{}):e}function Hh(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?Hh(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{Hh(e,e.get(t),n)}))})))}function qh(e,t,n){let r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;let a=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&Hh(e,n,i)}))})),i}var zh=Kl,Kh=Ml("keys"),Yh=function(e){return Kh[e]||(Kh[e]=zh(e))},Jh=!Ys((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Xh=Gl,Qh=vc,Zh=jl,$h=Jh,ep=Yh("IE_PROTO"),tp=Object,np=tp.prototype,rp=$h?tp.getPrototypeOf:function(e){var t=Zh(e);if(Xh(t,ep))return t[ep];var n=t.constructor;return Qh(n)&&t instanceof n?n.prototype:t instanceof tp?np:null},ip=ec,ap=bl,op=vc,sp=String,cp=TypeError,lp=qd,dp=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=function(e,t,n){try{return ip(ap(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(r){}}(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(r){}return function(n,r){return lp(n),function(e){if("object"==typeof e||op(e))return e;throw cp("Can't set "+sp(e)+" as a prototype")}(r),t?e(n,r):n.__proto__=r,n}}():void 0),up={},hp={},pp=Gl,fp=Wc,mp=Mu.indexOf,_p=hp,gp=ec([].push),Ep=function(e,t){var n,r=fp(e),i=0,a=[];for(n in r)!pp(_p,n)&&pp(r,n)&&gp(a,n);for(;t.length>i;)pp(r,n=t[i++])&&(~mp(a,n)||gp(a,n));return a},vp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],yp=Ep,Sp=vp.concat("length","prototype");up.f=Object.getOwnPropertyNames||function(e){return yp(e,Sp)};var bp={};bp.f=Object.getOwnPropertySymbols;var Tp=Zc,Cp=up,wp=bp,Rp=qd,Ap=ec([].concat),Ip=Tp("Reflect","ownKeys")||function(e){var t=Cp.f(Rp(e)),n=wp.f;return n?Ap(t,n(e)):t},Np=Gl,Op=Ip,Pp=yc,Lp=Vd,Dp={},kp=Ep,xp=vp,Mp=Object.keys||function(e){return kp(e,xp)},Up=Sc,Fp=Bd,jp=Vd,Vp=qd,Bp=Wc,Gp=Mp;Dp.f=Up&&!Fp?Object.defineProperties:function(e,t){Vp(e);for(var n,r=Bp(t),i=Gp(t),a=i.length,o=0;a>o;)jp.f(e,n=i[o++],r[n]);return e};var Wp,Hp=Zc("document","documentElement"),qp=qd,zp=Dp,Kp=vp,Yp=hp,Jp=Hp,Xp=md,Qp="prototype",Zp="script",$p=Yh("IE_PROTO"),ef=function(){},tf=function(e){return"<"+Zp+">"+e+"</"+Zp+">"},nf=function(e){e.write(tf("")),e.close();var t=e.parentWindow.Object;return e=null,t},rf=function(){try{Wp=new ActiveXObject("htmlfile")}catch(i){}var e,t,n;rf=typeof document<"u"?document.domain&&Wp?nf(Wp):(t=Xp("iframe"),n="java"+Zp+":",t.style.display="none",Jp.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(tf("document.F=Object")),e.close(),e.F):nf(Wp);for(var r=Kp.length;r--;)delete rf[Qp][Kp[r]];return rf()};Yp[$p]=!0;var af=Object.create||function(e,t){var n;return null!==e?(ef[Qp]=qp(e),n=new ef,ef[Qp]=null,n[$p]=e):n=rf(),void 0===t?n:zp.f(n,t)},of=zc,sf=au,cf=Error,lf=ec("".replace),df=String(cf("zxcasd").stack),uf=/\n\s*at [^:]*:[^\n]*/,hf=uf.test(df),pf=Pc,ff=!Ys((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",pf(1,7)),7!==e.stack)})),mf=au,_f=ff,gf=Error.captureStackTrace,Ef={},vf=Ef,yf=nd("iterator"),Sf=Array.prototype,bf=function(e){return void 0!==e&&(vf.Array===e||Sf[yf]===e)},Tf=th,Cf=wl,wf=Uc,Rf=Ef,Af=nd("iterator"),If=function(e){if(!wf(e))return Cf(e,Af)||Cf(e,"@@iterator")||Rf[Tf(e)]},Nf=Cc,Of=bl,Pf=qd,Lf=El,Df=If,kf=TypeError,xf=function(e,t){var n=arguments.length<2?Df(e):t;if(Of(n))return Pf(Nf(n,e));throw kf(Lf(e)+" is not iterable")},Mf=Cc,Uf=qd,Ff=wl,jf=function(e,t,n){var r,i;Uf(e);try{if(!(r=Ff(e,"return"))){if("throw"===t)throw n;return n}r=Mf(r,e)}catch(aa){i=!0,r=aa}if("throw"===t)throw n;if(i)throw r;return Uf(r),n},Vf=jd,Bf=Cc,Gf=qd,Wf=El,Hf=bf,qf=Pu,zf=tc,Kf=xf,Yf=If,Jf=jf,Xf=TypeError,Qf=function(e,t){this.stopped=e,this.result=t},Zf=Qf.prototype,$f=function(e,t,n){var r,i,a,o,s,c,l,d=n&&n.that,u=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),m=Vf(t,d),_=function(e){return r&&Jf(r,"normal",e),new Qf(!0,e)},g=function(e){return u?(Gf(e),f?m(e[0],e[1],_):m(e[0],e[1])):f?m(e,_):m(e)};if(h)r=e.iterator;else if(p)r=e;else{if(!(i=Yf(e)))throw Xf(Wf(e)+" is not iterable");if(Hf(i)){for(a=0,o=qf(e);o>a;a++)if((s=g(e[a]))&&zf(Zf,s))return s;return new Qf(!1)}r=Kf(e,i)}for(c=h?e.next:r.next;!(l=Bf(c,r)).done;){try{s=g(l.value)}catch(Oa){Jf(r,"throw",Oa)}if("object"==typeof s&&s&&zf(Zf,s))return s}return new Qf(!1)},em=ih,tm=gu,nm=tc,rm=rp,im=dp,am=af,om=au,sm=Pc,cm=function(e,t,n,r){_f&&(gf?gf(e,t):mf(e,"stack",function(e,t){if(hf&&"string"==typeof e&&!cf.prepareStackTrace)for(;t--;)e=lf(e,uf,"");return e}(n,r)))},lm=$f,dm=nd("toStringTag"),um=Error,hm=[].push,pm=function(e,t){var n,r=nm(fm,this);im?n=im(um(),r?rm(this):fm):(n=r?this:am(fm),om(n,dm,"Error")),void 0!==t&&om(n,"message",function(e,t){return void 0===e?arguments.length<2?"":t:em(e)}(t)),cm(n,pm,n.stack,1),arguments.length>2&&function(e,t){of(t)&&"cause"in t&&sf(e,"cause",t.cause)}(n,arguments[2]);var i=[];return lm(e,hm,{that:i}),om(n,"errors",i),n};im?im(pm,um):function(e,t,n){for(var r=Op(t),i=Lp.f,a=Pp.f,o=0;o<r.length;o++){var s=r[o];Np(e,s)||n&&Np(n,s)||i(e,s,a(t,s))}}(pm,um,{name:!0});var fm=pm.prototype=am(um.prototype,{constructor:sm(1,pm),message:sm(1,""),name:sm(1,"AggregateError")});tm({global:!0,constructor:!0,arity:2},{AggregateError:pm});var mm,_m,gm,Em=vc,vm=rc.WeakMap,ym=Em(vm)&&/native code/.test(String(vm)),Sm=rc,bm=zc,Tm=au,Cm=Gl,wm=kl,Rm=Yh,Am=hp,Im="Object already initialized",Nm=Sm.TypeError,Om=Sm.WeakMap;ym||wm.state?((Pm=wm.state||(wm.state=new Om)).get=Pm.get,Pm.has=Pm.has,Pm.set=Pm.set,mm=function(e,t){if(Pm.has(e))throw Nm(Im);return t.facade=e,Pm.set(e,t),t},_m=function(e){return Pm.get(e)||{}},gm=function(e){return Pm.has(e)}):(Am[Lm=Rm("state")]=!0,mm=function(e,t){if(Cm(e,Lm))throw Nm(Im);return t.facade=e,Tm(e,Lm,t),t},_m=function(e){return Cm(e,Lm)?e[Lm]:{}},gm=function(e){return Cm(e,Lm)});var Pm,Lm,Dm,km,xm,Mm={set:mm,get:_m,has:gm,enforce:function(e){return gm(e)?_m(e):mm(e,{})},getterFor:function(e){return function(t){var n;if(!bm(t)||(n=_m(t)).type!==e)throw Nm("Incompatible receiver, "+e+" required");return n}}},Um=Sc,Fm=Gl,jm=Function.prototype,Vm=Um&&Object.getOwnPropertyDescriptor,Bm=Fm(jm,"name"),Gm={EXISTS:Bm,PROPER:Bm&&"something"===function(){}.name,CONFIGURABLE:Bm&&(!Um||Um&&Vm(jm,"name").configurable)},Wm=au,Hm=function(e,t,n,r){return r&&r.enumerable?e[t]=n:Wm(e,t,n),e},qm=Ys,zm=vc,Km=zc,Ym=af,Jm=rp,Xm=Hm,Qm=nd("iterator"),Zm=!1;[].keys&&("next"in(xm=[].keys())?(km=Jm(Jm(xm)))!==Object.prototype&&(Dm=km):Zm=!0);var $m=!Km(Dm)||qm((function(){var e={};return Dm[Qm].call(e)!==e}));zm((Dm=$m?{}:Ym(Dm))[Qm])||Xm(Dm,Qm,(function(){return this}));var e_={IteratorPrototype:Dm,BUGGY_SAFARI_ITERATORS:Zm},t_=th,n_=Yu?{}.toString:function(){return"[object "+t_(this)+"]"},r_=Yu,i_=Vd.f,a_=au,o_=Gl,s_=n_,c_=nd("toStringTag"),l_=function(e,t,n,r){if(e){var i=n?e:e.prototype;o_(i,c_)||i_(i,c_,{configurable:!0,value:t}),r&&!r_&&a_(i,"toString",s_)}},d_=e_.IteratorPrototype,u_=af,h_=Pc,p_=l_,f_=Ef,m_=function(){return this},__=function(e,t,n,r){var i=t+" Iterator";return e.prototype=u_(d_,{next:h_(+!r,n)}),p_(e,i,!1,!0),f_[i]=m_,e},g_=gu,E_=Cc,v_=__,y_=rp,S_=l_,b_=Hm,T_=Ef,C_=Gm.PROPER,w_=e_.BUGGY_SAFARI_ITERATORS,R_=nd("iterator"),A_="keys",I_="values",N_="entries",O_=function(){return this},P_=function(e,t,n,r,i,a,o){v_(n,t,r);var s,c,l,d=function(e){if(e===i&&m)return m;if(!w_&&e in p)return p[e];switch(e){case A_:case I_:case N_:return function(){return new n(this,e)}}return function(){return new n(this)}},u=t+" Iterator",h=!1,p=e.prototype,f=p[R_]||p["@@iterator"]||i&&p[i],m=!w_&&f||d(i),_="Array"==t&&p.entries||f;if(_&&(s=y_(_.call(new e)))!==Object.prototype&&s.next&&(S_(s,u,!0,!0),T_[u]=O_),C_&&i==I_&&f&&f.name!==I_&&(h=!0,m=function(){return E_(f,this)}),i)if(c={values:d(I_),keys:a?m:d(A_),entries:d(N_)},o)for(l in c)(w_||h||!(l in p))&&b_(p,l,c[l]);else g_({target:t,proto:!0,forced:w_||h},c);return o&&p[R_]!==m&&b_(p,R_,m,{name:i}),T_[t]=m,c},L_=function(e,t){return{value:e,done:t}},D_=Wc,k_=Ef,x_=Mm;Vd.f;var M_=P_,U_=L_,F_="Array Iterator",j_=x_.set,V_=x_.getterFor(F_);M_(Array,"Array",(function(e,t){j_(this,{type:F_,target:D_(e),index:0,kind:t})}),(function(){var e=V_(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,U_(void 0,!0)):U_("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values"),k_.Arguments=k_.Array;var B_=Vd,G_=function(e,t,n){return B_.f(e,t,n)},W_=Zc,H_=G_,q_=Sc,z_=nd("species"),K_=tc,Y_=TypeError,J_=function(e,t){if(K_(t,e))return e;throw Y_("Incorrect invocation")},X_=vc,Q_=kl,Z_=ec(Function.toString);X_(Q_.inspectSource)||(Q_.inspectSource=function(e){return Z_(e)});var $_=Q_.inspectSource,eg=ec,tg=Ys,ng=vc,rg=th,ig=$_,ag=function(){},og=[],sg=Zc("Reflect","construct"),cg=/^\s*(?:class|function)\b/,lg=eg(cg.exec),dg=!cg.exec(ag),ug=function(e){if(!ng(e))return!1;try{return sg(ag,og,e),!0}catch(t){return!1}},hg=function(e){if(!ng(e))return!1;switch(rg(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return dg||!!lg(cg,ig(e))}catch(t){return!0}};hg.sham=!0;var pg,fg,mg,_g,gg=!sg||tg((function(){var e;return ug(ug.call)||!ug(Object)||!ug((function(){e=!0}))||e}))?hg:ug,Eg=gg,vg=El,yg=TypeError,Sg=qd,bg=Uc,Tg=nd("species"),Cg=function(e,t){var n,r=Sg(e).constructor;return void 0===r||bg(n=Sg(r)[Tg])?t:function(e){if(Eg(e))return e;throw yg(vg(e)+" is not a constructor")}(n)},wg=ec([].slice),Rg=TypeError,Ag=function(e,t){if(e<t)throw Rg("Not enough arguments");return e},Ig=/(?:ipad|iphone|ipod).*applewebkit/i.test($c),Ng=rc,Og=cc,Pg=jd,Lg=vc,Dg=Gl,kg=Ys,xg=Hp,Mg=wg,Ug=md,Fg=Ag,jg=Ig,Vg=Rh,Bg=Ng.setImmediate,Gg=Ng.clearImmediate,Wg=Ng.process,Hg=Ng.Dispatch,qg=Ng.Function,zg=Ng.MessageChannel,Kg=Ng.String,Yg=0,Jg={},Xg="onreadystatechange";kg((function(){pg=Ng.location}));var Qg=function(e){if(Dg(Jg,e)){var t=Jg[e];delete Jg[e],t()}},Zg=function(e){return function(){Qg(e)}},$g=function(e){Qg(e.data)},eE=function(e){Ng.postMessage(Kg(e),pg.protocol+"//"+pg.host)};Bg&&Gg||(Bg=function(e){Fg(arguments.length,1);var t=Lg(e)?e:qg(e),n=Mg(arguments,1);return Jg[++Yg]=function(){Og(t,void 0,n)},fg(Yg),Yg},Gg=function(e){delete Jg[e]},Vg?fg=function(e){Wg.nextTick(Zg(e))}:Hg&&Hg.now?fg=function(e){Hg.now(Zg(e))}:zg&&!jg?(_g=(mg=new zg).port2,mg.port1.onmessage=$g,fg=Pg(_g.postMessage,_g)):Ng.addEventListener&&Lg(Ng.postMessage)&&!Ng.importScripts&&pg&&"file:"!==pg.protocol&&!kg(eE)?(fg=eE,Ng.addEventListener("message",$g,!1)):fg=Xg in Ug("script")?function(e){xg.appendChild(Ug("script"))[Xg]=function(){xg.removeChild(this),Qg(e)}}:function(e){setTimeout(Zg(e),0)});var tE={set:Bg,clear:Gg},nE=function(){this.head=null,this.tail=null};nE.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var rE,iE,aE,oE,sE,cE=nE,lE=/ipad|iphone|ipod/i.test($c)&&typeof Pebble<"u",dE=/web0s(?!.*chrome)/i.test($c),uE=rc,hE=jd,pE=yc.f,fE=tE.set,mE=cE,_E=Ig,gE=lE,EE=dE,vE=Rh,yE=uE.MutationObserver||uE.WebKitMutationObserver,SE=uE.document,bE=uE.process,TE=uE.Promise,CE=pE(uE,"queueMicrotask"),wE=CE&&CE.value;wE||(RE=new mE,AE=function(){var e,t;for(vE&&(e=bE.domain)&&e.exit();t=RE.get();)try{t()}catch(na){throw RE.head&&rE(),na}e&&e.enter()},_E||vE||EE||!yE||!SE?!gE&&TE&&TE.resolve?((oE=TE.resolve(void 0)).constructor=TE,sE=hE(oE.then,oE),rE=function(){sE(AE)}):vE?rE=function(){bE.nextTick(AE)}:(fE=hE(fE,uE),rE=function(){fE(AE)}):(iE=!0,aE=SE.createTextNode(""),new yE(AE).observe(aE,{characterData:!0}),rE=function(){aE.data=iE=!iE}),wE=function(e){RE.head||rE(),RE.add(e)});var RE,AE,IE=wE,NE=function(e){try{return{error:!1,value:e()}}catch(g0){return{error:!0,value:g0}}},OE=rc.Promise,PE="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,LE=!PE&&!Rh&&"object"==typeof window&&"object"==typeof document,DE=rc,kE=OE,xE=vc,ME=xd,UE=$_,FE=nd,jE=LE,VE=PE,BE=ol,GE=kE&&kE.prototype,WE=FE("species"),HE=!1,qE=xE(DE.PromiseRejectionEvent),zE=ME("Promise",(function(){var e=UE(kE),t=e!==String(kE);if(!t&&66===BE||!GE.catch||!GE.finally)return!0;if(!BE||BE<51||!/native code/.test(e)){var n=new kE((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[WE]=r,!(HE=n.then((function(){}))instanceof r))return!0}return!t&&(jE||VE)&&!qE})),KE={CONSTRUCTOR:zE,REJECTION_EVENT:qE,SUBCLASSING:HE},YE={},JE=bl,XE=TypeError,QE=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw XE("Bad Promise constructor");t=e,n=r})),this.resolve=JE(t),this.reject=JE(n)};YE.f=function(e){return new QE(e)};var ZE,$E,ev=gu,tv=Rh,nv=rc,rv=Cc,iv=Hm,av=l_,ov=bl,sv=vc,cv=zc,lv=J_,dv=Cg,uv=tE.set,hv=IE,pv=NE,fv=cE,mv=Mm,_v=OE,gv=YE,Ev="Promise",vv=KE.CONSTRUCTOR,yv=KE.REJECTION_EVENT,Sv=mv.getterFor(Ev),bv=mv.set,Tv=_v&&_v.prototype,Cv=_v,wv=Tv,Rv=nv.TypeError,Av=nv.document,Iv=nv.process,Nv=gv.f,Ov=Nv,Pv=!!(Av&&Av.createEvent&&nv.dispatchEvent),Lv="unhandledrejection",Dv=function(e){var t;return!(!cv(e)||!sv(t=e.then))&&t},kv=function(e,t){var n,r,i,a=t.value,o=1==t.state,s=o?e.ok:e.fail,c=e.resolve,l=e.reject,d=e.domain;try{s?(o||(2===t.rejection&&jv(t),t.rejection=1),!0===s?n=a:(d&&d.enter(),n=s(a),d&&(d.exit(),i=!0)),n===e.promise?l(Rv("Promise-chain cycle")):(r=Dv(n))?rv(r,n,c,l):c(n)):l(a)}catch(ca){d&&!i&&d.exit(),l(ca)}},xv=function(e,t){e.notified||(e.notified=!0,hv((function(){for(var n,r=e.reactions;n=r.get();)kv(n,e);e.notified=!1,t&&!e.rejection&&Uv(e)})))},Mv=function(e,t,n){var r,i;Pv?((r=Av.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),nv.dispatchEvent(r)):r={promise:t,reason:n},!yv&&(i=nv["on"+e])?i(r):e===Lv&&function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(n){}}("Unhandled promise rejection",n)},Uv=function(e){rv(uv,nv,(function(){var t,n=e.facade,r=e.value;if(Fv(e)&&(t=pv((function(){tv?Iv.emit("unhandledRejection",r,n):Mv(Lv,n,r)})),e.rejection=tv||Fv(e)?2:1,t.error))throw t.value}))},Fv=function(e){return 1!==e.rejection&&!e.parent},jv=function(e){rv(uv,nv,(function(){var t=e.facade;tv?Iv.emit("rejectionHandled",t):Mv("rejectionhandled",t,e.value)}))},Vv=function(e,t,n){return function(r){e(t,r,n)}},Bv=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,xv(e,!0))},Gv=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Rv("Promise can't be resolved itself");var r=Dv(t);r?hv((function(){var n={done:!1};try{rv(r,t,Vv(Gv,n,e),Vv(Bv,n,e))}catch(aa){Bv(n,aa,e)}})):(e.value=t,e.state=1,xv(e,!1))}catch(i){Bv({done:!1},i,e)}}};vv&&(wv=(Cv=function(e){lv(this,wv),ov(e),rv(ZE,this);var t=Sv(this);try{e(Vv(Gv,t),Vv(Bv,t))}catch(na){Bv(t,na)}}).prototype,(ZE=function(e){bv(this,{type:Ev,done:!1,notified:!1,parent:!1,reactions:new fv,rejection:!1,state:0,value:void 0})}).prototype=iv(wv,"then",(function(e,t){var n=Sv(this),r=Nv(dv(this,Cv));return n.parent=!0,r.ok=!sv(e)||e,r.fail=sv(t)&&t,r.domain=tv?Iv.domain:void 0,0==n.state?n.reactions.add(r):hv((function(){kv(r,n)})),r.promise})),$E=function(){var e=new ZE,t=Sv(e);this.promise=e,this.resolve=Vv(Gv,t),this.reject=Vv(Bv,t)},gv.f=Nv=function(e){return e===Cv||void 0===e?new $E(e):Ov(e)}),ev({global:!0,constructor:!0,wrap:!0,forced:vv},{Promise:Cv}),av(Cv,Ev,!1,!0),function(e){var t=W_(e);q_&&t&&!t[z_]&&H_(t,z_,{configurable:!0,get:function(){return this}})}(Ev);var Wv=nd("iterator"),Hv=!1;try{qv=0,(zv={next:function(){return{done:!!qv++}},return:function(){Hv=!0}})[Wv]=function(){return this},Array.from(zv,(function(){throw 2}))}catch(E0){}var qv,zv,Kv=OE,Yv=KE.CONSTRUCTOR||!function(e){if(!Hv)return!1;var t=!1;try{var n={};n[Wv]=function(){return{next:function(){return{done:t=!0}}}},e(n)}catch(r){}return t}((function(e){Kv.all(e).then(void 0,(function(){}))})),Jv=Cc,Xv=bl,Qv=YE,Zv=NE,$v=$f;gu({target:"Promise",stat:!0,forced:Yv},{all:function(e){var t=this,n=Qv.f(t),r=n.resolve,i=n.reject,a=Zv((function(){var n=Xv(t.resolve),a=[],o=0,s=1;$v(e,(function(e){var c=o++,l=!1;s++,Jv(n,t,e).then((function(e){l||(l=!0,a[c]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise}});var ey=gu,ty=KE.CONSTRUCTOR;OE&&OE.prototype,ey({target:"Promise",proto:!0,forced:ty,real:!0},{catch:function(e){return this.then(void 0,e)}});var ny=Cc,ry=bl,iy=YE,ay=NE,oy=$f;gu({target:"Promise",stat:!0,forced:Yv},{race:function(e){var t=this,n=iy.f(t),r=n.reject,i=ay((function(){var i=ry(t.resolve);oy(e,(function(e){ny(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var sy=Cc,cy=YE;gu({target:"Promise",stat:!0,forced:KE.CONSTRUCTOR},{reject:function(e){var t=cy.f(this);return sy(t.reject,void 0,e),t.promise}});var ly=qd,dy=zc,uy=YE,hy=function(e,t){if(ly(e),dy(t)&&t.constructor===e)return t;var n=uy.f(e);return(0,n.resolve)(t),n.promise},py=gu,fy=OE,my=KE.CONSTRUCTOR,_y=hy,gy=Zc("Promise"),Ey=!my;py({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return _y(Ey&&this===gy?fy:this,e)}});var vy=Cc,yy=bl,Sy=YE,by=NE,Ty=$f;gu({target:"Promise",stat:!0,forced:Yv},{allSettled:function(e){var t=this,n=Sy.f(t),r=n.resolve,i=n.reject,a=by((function(){var n=yy(t.resolve),i=[],a=0,o=1;Ty(e,(function(e){var s=a++,c=!1;o++,vy(n,t,e).then((function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--o||r(i))}),(function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--o||r(i))}))})),--o||r(i)}));return a.error&&i(a.value),n.promise}});var Cy=Cc,wy=bl,Ry=Zc,Ay=YE,Iy=NE,Ny=$f,Oy="No one promise resolved";gu({target:"Promise",stat:!0,forced:Yv},{any:function(e){var t=this,n=Ry("AggregateError"),r=Ay.f(t),i=r.resolve,a=r.reject,o=Iy((function(){var r=wy(t.resolve),o=[],s=0,c=1,l=!1;Ny(e,(function(e){var d=s++,u=!1;c++,Cy(r,t,e).then((function(e){u||l||(l=!0,i(e))}),(function(e){u||l||(u=!0,o[d]=e,--c||a(new n(o,Oy)))}))})),--c||a(new n(o,Oy))}));return o.error&&a(o.value),r.promise}});var Py=gu,Ly=OE,Dy=Ys,ky=Zc,xy=vc,My=Cg,Uy=hy,Fy=Ly&&Ly.prototype;Py({target:"Promise",proto:!0,real:!0,forced:!!Ly&&Dy((function(){Fy.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=My(this,ky("Promise")),n=xy(e);return this.then(n?function(n){return Uy(t,e()).then((function(){return n}))}:e,n?function(n){return Uy(t,e()).then((function(){throw n}))}:e)}});var jy=ec,Vy=bu,By=ih,Gy=Vc,Wy=jy("".charAt),Hy=jy("".charCodeAt),qy=jy("".slice),zy=function(e){return function(t,n){var r,i,a=By(Gy(t)),o=Vy(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=Hy(a,o))<55296||r>56319||o+1===s||(i=Hy(a,o+1))<56320||i>57343?e?Wy(a,o):r:e?qy(a,o,o+2):i-56320+(r-55296<<10)+65536}},Ky={codeAt:zy(!1),charAt:zy(!0)},Yy=Ky.charAt,Jy=ih,Xy=Mm,Qy=P_,Zy=L_,$y="String Iterator",eS=Xy.set,tS=Xy.getterFor($y);Qy(String,"String",(function(e){eS(this,{type:$y,string:Jy(e),index:0})}),(function(){var e,t=tS(this),n=t.string,r=t.index;return r>=n.length?Zy(void 0,!0):(e=Yy(n,r),t.index+=e.length,Zy(e,!1))}));var nS=Kc.Promise,rS=rc,iS=th,aS=au,oS=Ef,sS=nd("toStringTag");for(dS in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0})(lS=(cS=rS[dS])&&cS.prototype)&&iS(lS)!==sS&&aS(lS,sS,dS),oS[dS]=oS.Array;var cS,lS,dS,uS=nS,hS=Ks(uS),pS=Vh;function fS(e,t){let n=e&&e.navigator;if(!n.mediaDevices)return;let r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;let r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);let i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let a=e.video.facingMode;a=a&&("object"==typeof a?a:{ideal:a});let o=t.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?t=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let o=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>{var n;return _h(n=e.label.toLowerCase()).call(n,t)}))));return!o&&n.length&&_h(t).call(t,"back")&&(o=n[n.length-1]),o&&(e.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),pS("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return pS("chrome: "+JSON.stringify(e)),i(e)},a=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(a(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){let e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>hS.reject(a(e))))))}}}function mS(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function _S(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};let i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};let i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Uh(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function gS(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{let t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ES(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);let i=function(e){let t={};return e.result().forEach((e=>{let n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},a=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){let r=function(e){n(a(i(e)))};return t.apply(this,[r,e])}return new hS(((e,n)=>{t.apply(this,[function(t){e(a(i(t)))},n])})).then(n,r)}}function vS(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then((t=>qh(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Uh(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then((t=>qh(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,n,r=arguments[0];return this.getSenders().forEach((t=>{t.track===r&&(e?n=!0:e=t)})),this.getReceivers().forEach((e=>(e.track===r&&(t?n=!0:t=e),e.track===r))),n||e&&t?hS.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():hS.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function yS(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));let t=this.getSenders();n.apply(this,arguments);let r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{let n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function SS(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return yS(e);let n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){let n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};let i=e.RTCPeerConnection.prototype.removeStream;function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{let r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let i=this._streams[n.id];if(i)i.addTrack(t),hS.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{let r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){let e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{let n=a(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>a(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));let o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{let r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};let s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=s.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function bS(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function TS(e,t){Uh(e,"negotiationneeded",(e=>{let n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var CS=Object.freeze({__proto__:null,fixNegotiationNeeded:TS,shimAddTrackRemoveTrack:SS,shimAddTrackRemoveTrackWithNative:yS,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{let r=n.video&&n.video.width,i=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:gS,shimGetStats:ES,shimGetUserMedia:fS,shimMediaStream:mS,shimOnTrack:_S,shimPeerConnection:bS,shimSenderReceiverGetStats:vS});function wS(e,t){let n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Bh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){let e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){let t=r.prototype.getSettings;r.prototype.getSettings=function(){let n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){let t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function RS(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function AS(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){let n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));let n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,i,a]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(sa){if("TypeError"!==sa.name)throw sa;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,a)}}function IS(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):hS.resolve(new Map)}}function NS(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Uh(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function OS(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Bh("removeStream","removeTrack"),this.getSenders().forEach((t=>{var n;t.track&&_h(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)}))})}function PS(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function LS(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];let n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));let r=t.apply(this,arguments);if(n){let{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function DS(e){if("object"!=typeof e||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function kS(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?hS.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function xS(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?hS.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var MS=Object.freeze({__proto__:null,shimAddTransceiver:LS,shimCreateAnswer:xS,shimCreateOffer:kS,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,hS.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:DS,shimGetUserMedia:wS,shimOnTrack:RS,shimPeerConnection:AS,shimRTCDataChannel:PS,shimReceiverGetStats:NS,shimRemoveStream:OS,shimSenderGetStats:IS});function US(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),_h(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{var t;this._localStreams?_h(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let n=e.getTracks();this.getSenders().forEach((e=>{_h(n).call(n,e.track)&&this.removeTrack(e)}))})}}function FS(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),_h(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);let n=new Event("addstream");n.stream=e,this.dispatchEvent(n)}))})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function jS(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){let r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),hS.resolve()):i},t.createAnswer=function(e,t){let n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),hS.resolve()):i};let s=function(e,t,n){let r=i.apply(this,[e]);return n?(r.then(t,n),hS.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){let r=a.apply(this,[e]);return n?(r.then(t,n),hS.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){let r=o.apply(this,[e]);return n?(r.then(t,n),hS.resolve()):r},t.addIceCandidate=s}function VS(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(BS(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function BS(e){return e&&void 0!==e.video?Object.assign({},e,{video:Wh(e.video)}):e}function GS(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){let t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Bh("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function WS(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function HS(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function qS(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var zS=Object.freeze({__proto__:null,shimAudioContext:qS,shimCallbacksAPI:jS,shimConstraints:BS,shimCreateOfferLegacy:HS,shimGetUserMedia:VS,shimLocalStreamsAPI:US,shimRTCIceServerUrls:GS,shimRemoteStreamsAPI:FS,shimTrackEventTransceiver:WS}),KS="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",YS=Vc,JS=ih,XS=KS,QS=ec("".replace),ZS=RegExp("^["+XS+"]+"),$S=RegExp("(^|[^"+XS+"])["+XS+"]+$"),eb=function(e){return function(t){var n=JS(YS(t));return 1&e&&(n=QS(n,ZS,"")),2&e&&(n=QS(n,$S,"$1")),n}},tb={start:eb(1),end:eb(2),trim:eb(3)},nb=Gm.PROPER,rb=Ys,ib=KS,ab=tb.trim;gu({target:"String",proto:!0,forced:function(e){return rb((function(){return!!ib[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||nb&&ib[e].name!==e}))}("trim")},{trim:function(){return ab(this)}});var ob=ju("String").trim,sb=tc,cb=ob,lb=String.prototype,db=Ks((function(e){var t=e.trim;return"string"==typeof e||e===lb||sb(lb,e)&&t===lb.trim?cb:t})),ub={exports:{}};!function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){let n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){let n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");let n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){let t=[];t.push(e.foundation);let n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){let t,n={},r=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){let t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){let n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){let r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){let n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let a=3;a<r.length;a++){let i=r[a],o=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){let r=t.parseRtpMap(o),a=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=a.length?t.parseFmtp(a[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));let i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){let n,r=[],i=t.parseRtpParameters(e),a=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),c=s.length>0&&s[0].ssrc,l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===c&&(n=l[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),r.push(t),a&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&c&&r.push({ssrc:c});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=d}))),r},t.parseRtcpParameters=function(e){let n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);let i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;let a=t.matchPrefix(e,"a=rtcp-mux");return n.mux=a.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n,r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};let i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){let n,r=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");i.length>0&&(n=parseInt(i[0].substring(19),10)),isNaN(n)&&(n=65536);let a=t.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:n};let o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){let e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i,a=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){let r=t.splitLines(e);for(let t=0;t<r.length;t++)switch(r[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){let n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){let n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(ub);var hb=ub.exports,pb=Ks(hb),fb=function(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}({__proto__:null,default:pb},[hb]);function mb(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){let n=new t(e),r=pb.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Uh(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function _b(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Uh(e,"icecandidate",(e=>{if(e.candidate){let t=pb.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function gb(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;let t=pb.splitSections(e.sdp);return t.shift(),t.some((e=>{let t=pb.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){let e,n=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;let n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),r=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(n),i=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);let i=pb.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],n);e=0===r&&0===i?Number.POSITIVE_INFINITY:0===r||0===i?Math.max(r,i):Math.min(r,i);let a={};Object.defineProperty(a,"maxMessageSize",{get:()=>e}),this._sctp=a}return n.apply(this,arguments)}}function Eb(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let n=e.send;e.send=function(){let r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}let n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=n.apply(this,arguments);return t(e,this),e},Uh(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function vb(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{let n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function yb(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==db(e).call(e))).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Sb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?hS.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),hS.resolve())})}function bb(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var Tb=Object.freeze({__proto__:null,removeExtmapAllowMixed:yb,shimAddIceCandidateNullOrEmpty:Sb,shimConnectionState:vb,shimMaxMessageSize:gb,shimParameterlessSetLocalDescription:bb,shimRTCIceCandidate:mb,shimRTCIceCandidateRelayProtocol:_b,shimSendThrowTypeError:Eb});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=Vh,r=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;let{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Mh(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Mh(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Mh(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:Tb,extractVersion:Mh,disableLog:Fh,disableWarnings:jh,sdp:fb};switch(r.browser){case"chrome":if(!CS||!bS||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=CS,Sb(e,r),bb(e),fS(e,r),mS(e),bS(e,r),_S(e),SS(e,r),gS(e),ES(e),vS(e),TS(e,r),mb(e),_b(e),vb(e),gb(e,r),Eb(e),yb(e,r);break;case"firefox":if(!MS||!AS||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=MS,Sb(e,r),bb(e),wS(e,r),AS(e,r),RS(e),OS(e),IS(e),NS(e),PS(e),LS(e),DS(e),kS(e),xS(e),mb(e),vb(e),gb(e,r),Eb(e);break;case"safari":if(!zS||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=zS,Sb(e,r),bb(e),GS(e),HS(e),jS(e),US(e),FS(e),WS(e),VS(e),qS(e),mb(e),_b(e),gb(e,r),Eb(e),yb(e,r);break;default:n("Unsupported browser!")}}({window:typeof window>"u"?void 0:window});var Cb=ju("Array").keys,wb=th,Rb=Gl,Ab=tc,Ib=Cb,Nb=Array.prototype,Ob={DOMTokenList:!0,NodeList:!0},Pb=Ks((function(e){var t=e.keys;return e===Nb||Ab(Nb,e)&&t===Nb.keys||Rb(Ob,wb(e))?Ib:t})),Lb=El,Db=TypeError,kb=ud,xb=Vd,Mb=Pc,Ub=function(e,t,n){var r=kb(t);r in e?xb.f(e,r,Mb(0,n)):e[r]=n},Fb=Ru,jb=Pu,Vb=Ub,Bb=Array,Gb=Math.max,Wb=function(e,t,n){for(var r=jb(e),i=Fb(t,r),a=Fb(void 0===n?r:n,r),o=Bb(Gb(a-i,0)),s=0;i<a;i++,s++)Vb(o,s,e[i]);return o.length=s,o},Hb=Wb,qb=Math.floor,zb=function(e,t){var n=e.length,r=qb(n/2);return n<8?Kb(e,t):Yb(e,zb(Hb(e,0,r),t),zb(Hb(e,r),t),t)},Kb=function(e,t){for(var n,r,i=e.length,a=1;a<i;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},Yb=function(e,t,n,r){for(var i=t.length,a=n.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?r(t[o],n[s])<=0?t[o++]:n[s++]:o<i?t[o++]:n[s++];return e},Jb=zb,Xb=$c.match(/firefox\/(\d+)/i),Qb=!!Xb&&+Xb[1],Zb=/MSIE|Trident/.test($c),$b=$c.match(/AppleWebKit\/(\d+)\./),eT=!!$b&&+$b[1],tT=gu,nT=ec,rT=bl,iT=jl,aT=Pu,oT=function(e,t){if(!delete e[t])throw Db("Cannot delete property "+Lb(t)+" of "+Lb(e))},sT=ih,cT=Ys,lT=Jb,dT=wh,uT=Qb,hT=Zb,pT=ol,fT=eT,mT=[],_T=nT(mT.sort),gT=nT(mT.push),ET=cT((function(){mT.sort(void 0)})),vT=cT((function(){mT.sort(null)})),yT=dT("sort"),ST=!cT((function(){if(pT)return pT<70;if(!(uT&&uT>3)){if(hT)return!0;if(fT)return fT<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)mT.push({k:t+r,v:n})}for(mT.sort((function(e,t){return t.v-e.v})),r=0;r<mT.length;r++)t=mT[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));tT({target:"Array",proto:!0,forced:ET||!vT||!yT||!ST},{sort:function(e){void 0!==e&&rT(e);var t=iT(this);if(ST)return void 0===e?_T(t):_T(t,e);var n,r,i=[],a=aT(t);for(r=0;r<a;r++)r in t&&gT(i,t[r]);for(lT(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:sT(t)>sT(n)?1:-1}}(e)),n=aT(i),r=0;r<n;)t[r]=i[r++];for(;r<a;)oT(t,r++);return t}});var bT,TT,CT=ju("Array").sort,wT=tc,RT=CT,AT=Array.prototype,IT=Ks((function(e){var t=e.sort;return e===AT||wT(AT,e)&&t===AT.sort?RT:t})),NT={exports:{}};bT=NT,TT=NT.exports,function(e,t){var n="function",r="undefined",i="object",a="string",o="major",s="model",c="name",l="type",d="vendor",u="version",h="architecture",p="console",f="mobile",m="tablet",_="smarttv",g="wearable",E="embedded",v="Amazon",y="Apple",S="ASUS",b="BlackBerry",T="Browser",C="Chrome",w="Firefox",R="Google",A="Huawei",I="LG",N="Microsoft",O="Motorola",P="Opera",L="Samsung",D="Sharp",k="Sony",x="Xiaomi",M="Zebra",U="Facebook",F="Chromium OS",j="Mac OS",V=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},B=function(e,t){return typeof e===a&&-1!==G(t).indexOf(G(e))},G=function(e){return e.toLowerCase()},W=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,""),typeof t===r?e:e.substring(0,350)},H=function(e,r){for(var a,o,s,c,l,d,u=0;u<r.length&&!l;){var h=r[u],p=r[u+1];for(a=o=0;a<h.length&&!l&&h[a];)if(l=h[a++].exec(e))for(s=0;s<p.length;s++)d=l[++o],typeof(c=p[s])===i&&c.length>0?2===c.length?typeof c[1]==n?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==n||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):t:this[c[0]]=d?c[1].call(this,d,c[2]):t:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):t):this[c]=d||t;u+=2}},q=function(e,n){for(var r in n)if(typeof n[r]===i&&n[r].length>0){for(var a=0;a<n[r].length;a++)if(B(n[r][a],e))return"?"===r?t:r}else if(B(n[r],e))return"?"===r?t:r;return e},z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[u,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[u,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,u],[/opios[\/ ]+([\w\.]+)/i],[u,[c,P+" Mini"]],[/\bopr\/([\w\.]+)/i],[u,[c,P]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c,u],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[u,[c,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[u,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[u,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[u,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[u,[c,"IE"]],[/yabrowser\/([\w\.]+)/i],[u,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+T],u],[/\bfocus\/([\w\.]+)/i],[u,[c,w+" Focus"]],[/\bopt\/([\w\.]+)/i],[u,[c,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[u,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[u,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[u,[c,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[u,[c,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[u,[c,w]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+T]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+T],u],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],u],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,u],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,U],u],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,u],[/\bgsa\/([\w\.]+) .*safari\//i],[u,[c,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[u,[c,C+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,C+" WebView"],u],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[u,[c,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,u],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[u,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[u,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[u,q,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,u],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],u],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[u,[c,w+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,u],[/(cobalt)\/([\w\.]+)/i],[c,[u,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,G]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",G]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,G]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[d,L],[l,m]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[d,L],[l,f]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[d,y],[l,f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[d,y],[l,m]],[/(macintosh);/i],[s,[d,y]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[d,D],[l,f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[d,A],[l,m]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[s,[d,A],[l,f]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[d,x],[l,f]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[d,x],[l,m]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[d,"OPPO"],[l,f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[d,"Vivo"],[l,f]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[d,"Realme"],[l,f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[d,O],[l,f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[d,O],[l,m]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[d,I],[l,m]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[d,I],[l,f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[d,"Lenovo"],[l,m]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[d,"Nokia"],[l,f]],[/(pixel c)\b/i],[s,[d,R],[l,m]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[d,R],[l,f]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[d,k],[l,f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[d,k],[l,m]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[d,"OnePlus"],[l,f]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[d,v],[l,m]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[d,v],[l,f]],[/(playbook);[-\w\),; ]+(rim)/i],[s,d,[l,m]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[d,b],[l,f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[d,S],[l,m]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[d,S],[l,f]],[/(nexus 9)/i],[s,[d,"HTC"],[l,m]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[s,/_/g," "],[l,f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[d,"Acer"],[l,m]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[d,"Meizu"],[l,f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,s,[l,f]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,s,[l,m]],[/(surface duo)/i],[s,[d,N],[l,m]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[d,"Fairphone"],[l,f]],[/(u304aa)/i],[s,[d,"AT&T"],[l,f]],[/\bsie-(\w*)/i],[s,[d,"Siemens"],[l,f]],[/\b(rct\w+) b/i],[s,[d,"RCA"],[l,m]],[/\b(venue[\d ]{2,7}) b/i],[s,[d,"Dell"],[l,m]],[/\b(q(?:mv|ta)\w+) b/i],[s,[d,"Verizon"],[l,m]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[d,"Barnes & Noble"],[l,m]],[/\b(tm\d{3}\w+) b/i],[s,[d,"NuVision"],[l,m]],[/\b(k88) b/i],[s,[d,"ZTE"],[l,m]],[/\b(nx\d{3}j) b/i],[s,[d,"ZTE"],[l,f]],[/\b(gen\d{3}) b.+49h/i],[s,[d,"Swiss"],[l,f]],[/\b(zur\d{3}) b/i],[s,[d,"Swiss"],[l,m]],[/\b((zeki)?tb.*\b) b/i],[s,[d,"Zeki"],[l,m]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],s,[l,m]],[/\b(ns-?\w{0,9}) b/i],[s,[d,"Insignia"],[l,m]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[d,"NextBook"],[l,m]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],s,[l,f]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],s,[l,f]],[/\b(ph-1) /i],[s,[d,"Essential"],[l,f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[d,"Envizen"],[l,m]],[/\b(trio[-\w\. ]+) b/i],[s,[d,"MachSpeed"],[l,m]],[/\btu_(1491) b/i],[s,[d,"Rotor"],[l,m]],[/(shield[\w ]+) b/i],[s,[d,"Nvidia"],[l,m]],[/(sprint) (\w+)/i],[d,s,[l,f]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[d,N],[l,f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[d,M],[l,m]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[d,M],[l,f]],[/smart-tv.+(samsung)/i],[d,[l,_]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[d,L],[l,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,I],[l,_]],[/(apple) ?tv/i],[d,[s,y+" TV"],[l,_]],[/crkey/i],[[s,C+"cast"],[d,R],[l,_]],[/droid.+aft(\w)( bui|\))/i],[s,[d,v],[l,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[s,[d,D],[l,_]],[/(bravia[\w ]+)( bui|\))/i],[s,[d,k],[l,_]],[/(mitv-\w{5}) bui/i],[s,[d,x],[l,_]],[/Hbbtv.*(technisat) (.*);/i],[d,s,[l,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,W],[s,W],[l,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,s,[l,p]],[/droid.+; (shield) bui/i],[s,[d,"Nvidia"],[l,p]],[/(playstation [345portablevi]+)/i],[s,[d,k],[l,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[d,N],[l,p]],[/((pebble))app/i],[d,s,[l,g]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[s,[d,y],[l,g]],[/droid.+; (glass) \d/i],[s,[d,R],[l,g]],[/droid.+; (wt63?0{2,3})\)/i],[s,[d,M],[l,g]],[/(quest( 2| pro)?)/i],[s,[d,U],[l,g]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[l,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[l,f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[l,m]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,m]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,f]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[u,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c,u],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[u,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,u],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[u,q,z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[u,q,z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,j],[u,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[u,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,u],[/\(bb(10);/i],[u,[c,b]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[u,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[u,[c,w+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[u,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[u,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[u,[c,C+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,F],u],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,u],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],u],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c,u]]},Y=function(p,_){if(typeof p===i&&(_=p,p=t),!(this instanceof Y))return new Y(p,_).getResult();var g=typeof e!==r&&e.navigator?e.navigator:t,E=p||(g&&g.userAgent?g.userAgent:""),v=g&&g.userAgentData?g.userAgentData:t,y=_?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(K,_):K;return this.getBrowser=function(){var e,r={};return r[c]=t,r[u]=t,H.call(r,E,y.browser),r[o]=typeof(e=r[u])===a?e.replace(/[^\d\.]/g,"").split(".")[0]:t,g&&g.brave&&typeof g.brave.isBrave==n&&(r[c]="Brave"),r},this.getCPU=function(){var e={};return e[h]=t,H.call(e,E,y.cpu),e},this.getDevice=function(){var e={};return e[d]=t,e[s]=t,e[l]=t,H.call(e,E,y.device),!e[l]&&v&&v.mobile&&(e[l]=f),"Macintosh"==e[s]&&g&&typeof g.standalone!==r&&g.maxTouchPoints&&g.maxTouchPoints>2&&(e[s]="iPad",e[l]=m),e},this.getEngine=function(){var e={};return e[c]=t,e[u]=t,H.call(e,E,y.engine),e},this.getOS=function(){var e={};return e[c]=t,e[u]=t,H.call(e,E,y.os),!e[c]&&v&&"Unknown"!=v.platform&&(e[c]=v.platform.replace(/chrome os/i,F).replace(/macos/i,j)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return E},this.setUA=function(e){return E=typeof e===a&&e.length>350?W(e,350):e,this},this.setUA(E),this};Y.VERSION="0.7.34",Y.BROWSER=V([c,u,o]),Y.CPU=V([h]),Y.DEVICE=V([s,d,l,p,f,_,m,g,E]),Y.ENGINE=Y.OS=V([c,u]),bT.exports&&(TT=bT.exports=Y),TT.UAParser=Y;var J=typeof e!==r&&(e.jQuery||e.Zepto);if(J&&!J.ua){var X=new Y;J.ua=X.getResult(),J.ua.get=function(){return X.getUA()},J.ua.set=function(e){X.setUA(e);var t=X.getResult();for(var n in t)J.ua[n]=t[n]}}}("object"==typeof window?window:zs);var OT=Ks(NT.exports),PT=th,LT=Gl,DT=Uc,kT=Ef,xT=nd("iterator"),MT=Object,UT=Ks((function(e){if(DT(e))return!1;var t=MT(e);return void 0!==t[xT]||"@@iterator"in t||LT(kT,PT(t))})),FT=rc;gu({global:!0,forced:FT.globalThis!==FT},{globalThis:FT});var jT=Ks(rc);function VT(e,t){return function(){return e.apply(t,arguments)}}var BT,{toString:GT}=Object.prototype,{getPrototypeOf:WT}=Object,HT=(BT=Object.create(null),e=>{let t=GT.call(e);return BT[t]||(BT[t]=t.slice(8,-1).toLowerCase())}),qT=e=>(e=e.toLowerCase(),t=>HT(t)===e),zT=e=>t=>typeof t===e,{isArray:KT}=Array,YT=zT("undefined"),JT=qT("ArrayBuffer"),XT=zT("string"),QT=zT("function"),ZT=zT("number"),$T=e=>null!==e&&"object"==typeof e,eC=e=>{if("object"!==HT(e))return!1;let t=WT(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||UT(e))},tC=qT("Date"),nC=qT("File"),rC=qT("Blob"),iC=qT("FileList"),aC=qT("URLSearchParams");function oC(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),KT(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{let r,a=i?Object.getOwnPropertyNames(e):Object.keys(e),o=a.length;for(n=0;n<o;n++)r=a[n],t.call(null,e[r],r,e)}}function sC(e,t){t=t.toLowerCase();let n,r=Object.keys(e),i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}var cC,lC=void 0!==jT?jT:typeof self<"u"?self:typeof window<"u"?window:global,dC=e=>!YT(e)&&e!==lC,uC=(cC=typeof Uint8Array<"u"&&WT(Uint8Array),e=>cC&&e instanceof cC),hC=qT("HTMLFormElement"),pC=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),fC=qT("RegExp"),mC=(e,t)=>{let n=Object.getOwnPropertyDescriptors(e),r={};oC(n,((n,i)=>{let a;!1!==(a=t(n,i,e))&&(r[i]=a||n)})),Object.defineProperties(e,r)},_C="abcdefghijklmnopqrstuvwxyz",gC="0123456789",EC={DIGIT:gC,ALPHA:_C,ALPHA_DIGIT:_C+_C.toUpperCase()+gC},vC=qT("AsyncFunction"),yC={isArray:KT,isArrayBuffer:JT,isBuffer:function(e){return null!==e&&!YT(e)&&null!==e.constructor&&!YT(e.constructor)&&QT(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||QT(e.append)&&("formdata"===(t=HT(e))||"object"===t&&QT(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&JT(e.buffer),t},isString:XT,isNumber:ZT,isBoolean:e=>!0===e||!1===e,isObject:$T,isPlainObject:eC,isUndefined:YT,isDate:tC,isFile:nC,isBlob:rC,isRegExp:fC,isFunction:QT,isStream:e=>$T(e)&&QT(e.pipe),isURLSearchParams:aC,isTypedArray:uC,isFileList:iC,forEach:oC,merge:function e(){let{caseless:t}=dC(this)&&this||{},n={},r=(r,i)=>{let a=t&&sC(n,i)||i;eC(n[a])&&eC(r)?n[a]=e(n[a],r):eC(r)?n[a]=e({},r):KT(r)?n[a]=r.slice():n[a]=r};for(let i=0,a=arguments.length;i<a;i++)arguments[i]&&oC(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return oC(t,((t,r)=>{n&&QT(t)?e[r]=VT(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>db(e)?db(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,a,o,s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],r&&!r(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&WT(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:HT,kindOfTest:qT,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;let r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(KT(e))return e;let t=e.length;if(!ZT(t))return null;let n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{let n,r=(e&&e[Symbol.iterator]).call(e);for(;(n=r.next())&&!n.done;){let r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let n,r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:hC,hasOwnProperty:pC,hasOwnProp:pC,reduceDescriptors:mC,freezeMethods:e=>{mC(e,((t,n)=>{if(QT(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;let r=e[n];QT(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{let n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return KT(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:sC,global:lC,isContextDefined:dC,ALPHABET:EC,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:EC.ALPHA_DIGIT,n="",{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&QT(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),n=(e,r)=>{if($T(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;let i=KT(e)?[]:{};return oC(e,((e,t)=>{let a=n(e,r+1);!YT(a)&&(i[t]=a)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:vC,isThenable:e=>e&&($T(e)||QT(e))&&QT(e.then)&&QT(e.catch)};function SC(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}yC.inherits(SC,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:yC.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var bC=SC.prototype,TC={};function CC(e){return yC.isPlainObject(e)||yC.isArray(e)}function wC(e){return yC.endsWith(e,"[]")?e.slice(0,-2):e}function RC(e,t,n){return e?e.concat(t).map((function(e,t){return e=wC(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{TC[e]={value:e}})),Object.defineProperties(SC,TC),Object.defineProperty(bC,"isAxiosError",{value:!0}),SC.from=(e,t,n,r,i,a)=>{let o=Object.create(bC);return yC.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),SC.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};var AC=yC.toFlatObject(yC,{},null,(function(e){return/^is[A-Z]/.test(e)}));function IC(e,t,n){if(!yC.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let r=(n=yC.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!yC.isUndefined(t[e])}))).metaTokens,i=n.visitor||l,a=n.dots,o=n.indexes,s=(n.Blob||typeof Blob<"u"&&Blob)&&yC.isSpecCompliantForm(t);if(!yC.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(yC.isDate(e))return e.toISOString();if(!s&&yC.isBlob(e))throw new SC("Blob is not supported. Use a Buffer instead.");return yC.isArrayBuffer(e)||yC.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,i){let s=e;if(e&&!i&&"object"==typeof e)if(yC.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(yC.isArray(e)&&function(e){return yC.isArray(e)&&!e.some(CC)}(e)||(yC.isFileList(e)||yC.endsWith(n,"[]"))&&(s=yC.toArray(e)))return n=wC(n),s.forEach((function(e,r){!yC.isUndefined(e)&&null!==e&&t.append(!0===o?RC([n],r,a):null===o?n:n+"[]",c(e))})),!1;return!!CC(e)||(t.append(RC(i,n,a),c(e)),!1)}let d=[],u=Object.assign(AC,{defaultVisitor:l,convertValue:c,isVisitable:CC});if(!yC.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!yC.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),yC.forEach(n,(function(n,a){!0===(!(yC.isUndefined(n)||null===n)&&i.call(t,n,yC.isString(a)?db(a).call(a):a,r,u))&&e(n,r?r.concat(a):[a])})),d.pop()}}(e),t}function NC(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function OC(e,t){this._pairs=[],e&&IC(e,this,t)}var PC=OC.prototype;function LC(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function DC(e,t,n){if(!t)return e;let r,i=n&&n.encode||LC,a=n&&n.serialize;if(r=a?a(t,n):yC.isURLSearchParams(t)?t.toString():new OC(t,n).toString(i),r){let t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}PC.append=function(e,t){this._pairs.push([e,t])},PC.toString=function(e){let t=e?function(t){return e.call(this,t,NC)}:NC;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var kC=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){yC.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},xC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},MC={exports:{}},UC=gu,FC=Sc,jC=Vd.f;UC({target:"Object",stat:!0,forced:Object.defineProperty!==jC,sham:!FC},{defineProperty:jC});var VC=Kc.Object,BC=MC.exports=function(e,t,n){return VC.defineProperty(e,t,n)};VC.defineProperty.sham&&(BC.sham=!0);var GC=Ks(MC.exports),WC=hc,HC=Array.isArray||function(e){return"Array"==WC(e)},qC=TypeError,zC=HC,KC=gg,YC=zc,JC=nd("species"),XC=Array,QC=function(e,t){return new(function(e){var t;return zC(e)&&(t=e.constructor,(KC(t)&&(t===XC||zC(t.prototype))||YC(t)&&null===(t=t[JC]))&&(t=void 0)),void 0===t?XC:t}(e))(0===t?0:t)},ZC=Ys,$C=ol,ew=nd("species"),tw=function(e){return $C>=51||!ZC((function(){var t=[];return(t.constructor={})[ew]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},nw=gu,rw=Ys,iw=HC,aw=zc,ow=jl,sw=Pu,cw=function(e){if(e>9007199254740991)throw qC("Maximum allowed index exceeded");return e},lw=Ub,dw=QC,uw=tw,hw=ol,pw=nd("isConcatSpreadable"),fw=hw>=51||!rw((function(){var e=[];return e[pw]=!1,e.concat()[0]!==e})),mw=function(e){if(!aw(e))return!1;var t=e[pw];return void 0!==t?!!t:iw(e)};nw({target:"Array",proto:!0,arity:1,forced:!fw||!uw("concat")},{concat:function(e){var t,n,r,i,a,o=ow(this),s=dw(o,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(mw(a=-1===t?o:arguments[t]))for(i=sw(a),cw(c+i),n=0;n<i;n++,c++)n in a&&lw(s,c,a[n]);else cw(c+1),lw(s,c++,a);return s.length=c,s}});var _w={},gw=hc,Ew=Wc,vw=up.f,yw=Wb,Sw="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];_w.f=function(e){return Sw&&"Window"==gw(e)?function(e){try{return vw(e)}catch(t){return yw(Sw)}}(e):vw(Ew(e))};var bw={},Tw=nd;bw.f=Tw;var Cw=Kc,ww=Gl,Rw=bw,Aw=Vd.f,Iw=function(e){var t=Cw.Symbol||(Cw.Symbol={});ww(t,e)||Aw(t,e,{value:Rw.f(e)})},Nw=Cc,Ow=Zc,Pw=nd,Lw=Hm,Dw=function(){var e=Ow("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=Pw("toPrimitive");t&&!t[r]&&Lw(t,r,(function(e){return Nw(n,this)}),{arity:1})},kw=jd,xw=Mc,Mw=jl,Uw=Pu,Fw=QC,jw=ec([].push),Vw=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(c,l,d,u){for(var h,p,f=Mw(c),m=xw(f),_=kw(l,d),g=Uw(m),E=0,v=u||Fw,y=t?v(c,g):n||o?v(c,0):void 0;g>E;E++)if((s||E in m)&&(p=_(h=m[E],E,f),e))if(t)y[E]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return E;case 2:jw(y,h)}else switch(e){case 4:return!1;case 7:jw(y,h)}return a?-1:r||i?i:y}},Bw={forEach:Vw(0),map:Vw(1),filter:Vw(2),some:Vw(3),every:Vw(4),find:Vw(5),findIndex:Vw(6),filterReject:Vw(7)},Gw=gu,Ww=rc,Hw=Cc,qw=ec,zw=Sc,Kw=dl,Yw=Ys,Jw=Gl,Xw=tc,Qw=qd,Zw=Wc,$w=ud,eR=ih,tR=Pc,nR=af,rR=Mp,iR=up,aR=_w,oR=bp,sR=yc,cR=Vd,lR=Dp,dR=wc,uR=Hm,hR=G_,pR=Ml,fR=hp,mR=Kl,_R=nd,gR=bw,ER=Iw,vR=Dw,yR=l_,SR=Mm,bR=Bw.forEach,TR=Yh("hidden"),CR="Symbol",wR="prototype",RR=SR.set,AR=SR.getterFor(CR),IR=Object[wR],NR=Ww.Symbol,OR=NR&&NR[wR],PR=Ww.TypeError,LR=Ww.QObject,DR=sR.f,kR=cR.f,xR=aR.f,MR=dR.f,UR=qw([].push),FR=pR("symbols"),jR=pR("op-symbols"),VR=pR("wks"),BR=!LR||!LR[wR]||!LR[wR].findChild,GR=zw&&Yw((function(){return 7!=nR(kR({},"a",{get:function(){return kR(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=DR(IR,t);r&&delete IR[t],kR(e,t,n),r&&e!==IR&&kR(IR,t,r)}:kR,WR=function(e,t){var n=FR[e]=nR(OR);return RR(n,{type:CR,tag:e,description:t}),zw||(n.description=t),n},HR=function(e,t,n){e===IR&&HR(jR,t,n),Qw(e);var r=$w(t);return Qw(n),Jw(FR,r)?(n.enumerable?(Jw(e,TR)&&e[TR][r]&&(e[TR][r]=!1),n=nR(n,{enumerable:tR(0,!1)})):(Jw(e,TR)||kR(e,TR,tR(1,{})),e[TR][r]=!0),GR(e,r,n)):kR(e,r,n)},qR=function(e,t){Qw(e);var n=Zw(t),r=rR(n).concat(JR(n));return bR(r,(function(t){zw&&!Hw(zR,n,t)||HR(e,t,n[t])})),e},zR=function(e){var t=$w(e),n=Hw(MR,this,t);return!(this===IR&&Jw(FR,t)&&!Jw(jR,t))&&(!(n||!Jw(this,t)||!Jw(FR,t)||Jw(this,TR)&&this[TR][t])||n)},KR=function(e,t){var n=Zw(e),r=$w(t);if(n!==IR||!Jw(FR,r)||Jw(jR,r)){var i=DR(n,r);return!i||!Jw(FR,r)||Jw(n,TR)&&n[TR][r]||(i.enumerable=!0),i}},YR=function(e){var t=xR(Zw(e)),n=[];return bR(t,(function(e){Jw(FR,e)||Jw(fR,e)||UR(n,e)})),n},JR=function(e){var t=e===IR,n=xR(t?jR:Zw(e)),r=[];return bR(n,(function(e){!Jw(FR,e)||t&&!Jw(IR,e)||UR(r,FR[e])})),r};Kw||(uR(OR=(NR=function(){if(Xw(OR,this))throw PR("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?eR(arguments[0]):void 0,t=mR(e),n=function(e){this===IR&&Hw(n,jR,e),Jw(this,TR)&&Jw(this[TR],t)&&(this[TR][t]=!1),GR(this,t,tR(1,e))};return zw&&BR&&GR(IR,t,{configurable:!0,set:n}),WR(t,e)})[wR],"toString",(function(){return AR(this).tag})),uR(NR,"withoutSetter",(function(e){return WR(mR(e),e)})),dR.f=zR,cR.f=HR,lR.f=qR,sR.f=KR,iR.f=aR.f=YR,oR.f=JR,gR.f=function(e){return WR(_R(e),e)},zw&&hR(OR,"description",{configurable:!0,get:function(){return AR(this).description}})),Gw({global:!0,constructor:!0,wrap:!0,forced:!Kw,sham:!Kw},{Symbol:NR}),bR(rR(VR),(function(e){ER(e)})),Gw({target:CR,stat:!0,forced:!Kw},{useSetter:function(){BR=!0},useSimple:function(){BR=!1}}),Gw({target:"Object",stat:!0,forced:!Kw,sham:!zw},{create:function(e,t){return void 0===t?nR(e):qR(nR(e),t)},defineProperty:HR,defineProperties:qR,getOwnPropertyDescriptor:KR}),Gw({target:"Object",stat:!0,forced:!Kw},{getOwnPropertyNames:YR}),vR(),yR(NR,CR),fR[TR]=!0;var XR=dl&&!!Symbol.for&&!!Symbol.keyFor,QR=gu,ZR=Zc,$R=Gl,eA=ih,tA=Ml,nA=XR,rA=tA("string-to-symbol-registry"),iA=tA("symbol-to-string-registry");QR({target:"Symbol",stat:!0,forced:!nA},{for:function(e){var t=eA(e);if($R(rA,t))return rA[t];var n=ZR("Symbol")(t);return rA[t]=n,iA[n]=t,n}});var aA=gu,oA=Gl,sA=_l,cA=El,lA=XR,dA=Ml("symbol-to-string-registry");aA({target:"Symbol",stat:!0,forced:!lA},{keyFor:function(e){if(!sA(e))throw TypeError(cA(e)+" is not a symbol");if(oA(dA,e))return dA[e]}});var uA=HC,hA=vc,pA=hc,fA=ih,mA=ec([].push),_A=gu,gA=Zc,EA=cc,vA=Cc,yA=ec,SA=Ys,bA=vc,TA=_l,CA=wg,wA=dl,RA=String,AA=gA("JSON","stringify"),IA=yA(/./.exec),NA=yA("".charAt),OA=yA("".charCodeAt),PA=yA("".replace),LA=yA(1..toString),DA=/[\uD800-\uDFFF]/g,kA=/^[\uD800-\uDBFF]$/,xA=/^[\uDC00-\uDFFF]$/,MA=!wA||SA((function(){var e=gA("Symbol")();return"[null]"!=AA([e])||"{}"!=AA({a:e})||"{}"!=AA(Object(e))})),UA=SA((function(){return'"\\udf06\\ud834"'!==AA("\udf06\ud834")||'"\\udead"'!==AA("\udead")})),FA=function(e,t){var n=CA(arguments),r=function(e){if(hA(e))return e;if(uA(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?mA(n,i):"number"!=typeof i&&"Number"!=pA(i)&&"String"!=pA(i)||mA(n,fA(i))}var a=n.length,o=!0;return function(e,t){if(o)return o=!1,t;if(uA(this))return t;for(var r=0;r<a;r++)if(n[r]===e)return t}}}(t);if(bA(r)||void 0!==e&&!TA(e))return n[1]=function(e,t){if(bA(r)&&(t=vA(r,this,RA(e),t)),!TA(t))return t},EA(AA,null,n)},jA=function(e,t,n){var r=NA(n,t-1),i=NA(n,t+1);return IA(kA,e)&&!IA(xA,i)||IA(xA,e)&&!IA(kA,r)?"\\u"+LA(OA(e,0),16):e};AA&&_A({target:"JSON",stat:!0,arity:3,forced:MA||UA},{stringify:function(e,t,n){var r=CA(arguments),i=EA(MA?FA:AA,null,r);return UA&&"string"==typeof i?PA(i,DA,jA):i}});var VA=bp,BA=jl;gu({target:"Object",stat:!0,forced:!dl||Ys((function(){VA.f(1)}))},{getOwnPropertySymbols:function(e){var t=VA.f;return t?t(BA(e)):[]}}),Iw("asyncIterator"),Iw("hasInstance"),Iw("isConcatSpreadable"),Iw("iterator"),Iw("match"),Iw("matchAll"),Iw("replace"),Iw("search"),Iw("species"),Iw("split");var GA=Dw;Iw("toPrimitive"),GA();var WA=Zc,HA=l_;Iw("toStringTag"),HA(WA("Symbol"),"Symbol"),Iw("unscopables"),l_(rc.JSON,"JSON",!0);var qA=Kc.Symbol,zA=nd,KA=Vd.f,YA=zA("metadata"),JA=Function.prototype;void 0===JA[YA]&&KA(JA,YA,{value:null}),Iw("dispose"),Iw("metadata");var XA=qA;Iw("asyncDispose");var QA=ec,ZA=Zc("Symbol"),$A=ZA.keyFor,eI=QA(ZA.prototype.valueOf),tI=ZA.isRegisteredSymbol||function(e){try{return void 0!==$A(eI(e))}catch(t){return!1}};for(gu({target:"Symbol",stat:!0},{isRegisteredSymbol:tI}),rI=Ml,aI=ec,oI=_l,sI=nd,cI=(iI=Zc)("Symbol"),lI=cI.isWellKnownSymbol,dI=iI("Object","getOwnPropertyNames"),uI=aI(cI.prototype.valueOf),hI=rI("wks"),pI=0,mI=(fI=dI(cI)).length;pI<mI;pI++)try{oI(cI[nI=fI[pI]])&&sI(nI)}catch(v0){}var nI,rI,iI,aI,oI,sI,cI,lI,dI,uI,hI,pI,fI,mI,_I=function(e){if(lI&&lI(e))return!0;try{for(var t=uI(e),n=0,r=dI(hI),i=r.length;n<i;n++)if(hI[r[n]]==t)return!0}catch(a){}return!1};gu({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:_I}),Iw("matcher"),Iw("observable"),gu({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:tI}),gu({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:_I}),Iw("metadataKey"),Iw("patternMatch"),Iw("replaceAll");var gI=Ks(XA),EI=Ks(bw.f("iterator"));function vI(e){return(vI="function"==typeof gI&&"symbol"==typeof EI?function(e){return typeof e}:function(e){return e&&"function"==typeof gI&&e.constructor===gI&&e!==gI.prototype?"symbol":typeof e})(e)}var yI=Ks(bw.f("toPrimitive"));function SI(e,t,n){return(t=function(e){var t=function(e){if("object"!==vI(e)||null===e)return e;var t=e[yI];if(void 0!==t){var n=t.call(e,"string");if("object"!==vI(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===vI(t)?t:String(t)}(t))in e?GC(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var bI=Ys,TI=nd("iterator"),CI=!bI((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[TI]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),wI=Hm,RI=gu,AI=rc,II=Cc,NI=ec,OI=Sc,PI=CI,LI=Hm,DI=G_,kI=l_,xI=__,MI=Mm,UI=J_,FI=vc,jI=Gl,VI=jd,BI=th,GI=qd,WI=zc,HI=ih,qI=af,zI=Pc,KI=xf,YI=If,JI=Ag,XI=Jb,QI=nd("iterator"),ZI="URLSearchParams",$I=ZI+"Iterator",eN=MI.set,tN=MI.getterFor(ZI),nN=MI.getterFor($I),rN=Object.getOwnPropertyDescriptor,iN=function(e){if(!OI)return AI[e];var t=rN(AI,e);return t&&t.value},aN=iN("fetch"),oN=iN("Request"),sN=iN("Headers"),cN=oN&&oN.prototype,lN=sN&&sN.prototype,dN=AI.RegExp,uN=AI.TypeError,hN=AI.decodeURIComponent,pN=AI.encodeURIComponent,fN=NI("".charAt),mN=NI([].join),_N=NI([].push),gN=NI("".replace),EN=NI([].shift),vN=NI([].splice),yN=NI("".split),SN=NI("".slice),bN=/\+/g,TN=Array(4),CN=function(e){return TN[e-1]||(TN[e-1]=dN("((?:%[\\da-f]{2}){"+e+"})","gi"))},wN=function(e){try{return hN(e)}catch(t){return e}},RN=function(e){var t=gN(e,bN," "),n=4;try{return hN(t)}catch(r){for(;n;)t=gN(t,CN(n--),wN);return t}},AN=/[!'()~]|%20/g,IN={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},NN=function(e){return IN[e]},ON=function(e){return gN(pN(e),AN,NN)},PN=xI((function(e,t){eN(this,{type:$I,iterator:KI(tN(e).entries),kind:t})}),"Iterator",(function(){var e=nN(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),LN=function(e){this.entries=[],this.url=null,void 0!==e&&(WI(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===fN(e,0)?SN(e,1):e:HI(e)))};LN.prototype={type:ZI,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,a,o,s,c=YI(e);if(c)for(n=(t=KI(e,c)).next;!(r=II(n,t)).done;){if(a=(i=KI(GI(r.value))).next,(o=II(a,i)).done||(s=II(a,i)).done||!II(a,i).done)throw uN("Expected sequence with length 2");_N(this.entries,{key:HI(o.value),value:HI(s.value)})}else for(var l in e)jI(e,l)&&_N(this.entries,{key:l,value:HI(e[l])})},parseQuery:function(e){if(e)for(var t,n,r=yN(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=yN(t,"="),_N(this.entries,{key:RN(EN(n)),value:RN(mN(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],_N(n,ON(e.key)+"="+ON(e.value));return mN(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var DN=function(){UI(this,kN);var e=eN(this,new LN(arguments.length>0?arguments[0]:void 0));OI||(this.size=e.entries.length)},kN=DN.prototype;(function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:wI(e,r,t[r],n)})(kN,{append:function(e,t){var n=tN(this);JI(arguments.length,2),_N(n.entries,{key:HI(e),value:HI(t)}),OI||this.length++,n.updateURL()},delete:function(e){for(var t=tN(this),n=JI(arguments.length,1),r=t.entries,i=HI(e),a=n<2?void 0:arguments[1],o=void 0===a?a:HI(a),s=0;s<r.length;){var c=r[s];if(c.key!==i||void 0!==o&&c.value!==o)s++;else if(vN(r,s,1),void 0!==o)break}OI||(this.size=r.length),t.updateURL()},get:function(e){var t=tN(this).entries;JI(arguments.length,1);for(var n=HI(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=tN(this).entries;JI(arguments.length,1);for(var n=HI(e),r=[],i=0;i<t.length;i++)t[i].key===n&&_N(r,t[i].value);return r},has:function(e){for(var t=tN(this).entries,n=JI(arguments.length,1),r=HI(e),i=n<2?void 0:arguments[1],a=void 0===i?i:HI(i),o=0;o<t.length;){var s=t[o++];if(s.key===r&&(void 0===a||s.value===a))return!0}return!1},set:function(e,t){var n=tN(this);JI(arguments.length,1);for(var r,i=n.entries,a=!1,o=HI(e),s=HI(t),c=0;c<i.length;c++)(r=i[c]).key===o&&(a?vN(i,c--,1):(a=!0,r.value=s));a||_N(i,{key:o,value:s}),OI||(this.size=i.length),n.updateURL()},sort:function(){var e=tN(this);XI(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=tN(this).entries,r=VI(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new PN(this,"keys")},values:function(){return new PN(this,"values")},entries:function(){return new PN(this,"entries")}},{enumerable:!0}),LI(kN,QI,kN.entries,{name:"entries"}),LI(kN,"toString",(function(){return tN(this).serialize()}),{enumerable:!0}),OI&&DI(kN,"size",{get:function(){return tN(this).entries.length},configurable:!0,enumerable:!0}),kI(DN,ZI),RI({global:!0,constructor:!0,forced:!PI},{URLSearchParams:DN}),!PI&&FI(sN)&&(xN=NI(lN.has),MN=NI(lN.set),UN=function(e){if(WI(e)){var t,n=e.body;if(BI(n)===ZI)return t=e.headers?new sN(e.headers):new sN,xN(t,"content-type")||MN(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),qI(e,{body:zI(0,HI(n)),headers:zI(0,t)})}return e},FI(aN)&&RI({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return aN(e,arguments.length>1?UN(arguments[1]):{})}}),FI(oN)&&(FN=function(e){return UI(this,cN),new oN(e,arguments.length>1?UN(arguments[1]):{})},cN.constructor=FN,FN.prototype=cN,RI({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:FN})));var xN,MN,UN,FN,jN,VN={URLSearchParams:DN,getState:tN},BN=Ks(Kc.URLSearchParams),GN={isBrowser:!0,classes:{URLSearchParams:void 0!==BN?BN:OC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},WN=typeof window<"u"&&typeof document<"u",HN=(jN=typeof navigator<"u"&&navigator.product,WN&&["ReactNative","NativeScript","NS"].indexOf(jN)<0),qN=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;function zN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function KN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zN(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var YN=KN(KN({},Object.freeze({__proto__:null,hasBrowserEnv:WN,hasStandardBrowserEnv:HN,hasStandardBrowserWebWorkerEnv:qN})),GN),JN=qd,XN=Cc,QN=Gl,ZN=tc,$N=function(){var e=JN(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},eO=RegExp.prototype,tO=function(e){var t=e.flags;return void 0!==t||"flags"in eO||QN(e,"flags")||!ZN(eO,e)?t:XN($N,e)},nO=Ky.charAt,rO=Cc,iO=qd,aO=vc,oO=hc,sO=/./.exec,cO=TypeError,lO=gu,dO=Cc,uO=mc,hO=__,pO=L_,fO=Vc,mO=Nu,_O=ih,gO=qd,EO=Uc,vO=hc,yO=Hu,SO=tO,bO=wl,TO=Ys,CO=Cg,wO=Mm,RO=nd("matchAll"),AO="RegExp String",IO=AO+" Iterator",NO=wO.set,OO=wO.getterFor(IO),PO=TypeError,LO=uO("".indexOf),DO=uO("".matchAll),kO=!!DO&&!TO((function(){DO("a",/./)})),xO=hO((function(e,t,n,r){NO(this,{type:IO,regexp:e,string:t,global:n,unicode:r,done:!1})}),AO,(function(){var e=OO(this);if(e.done)return pO(void 0,!0);var t=e.regexp,n=e.string,r=function(e,t){var n=e.exec;if(aO(n)){var r=rO(n,e,t);return null!==r&&iO(r),r}if("RegExp"===oO(e))return rO(sO,e,t);throw cO("RegExp#exec called on incompatible receiver")}(t,n);return null===r?(e.done=!0,pO(void 0,!0)):e.global?(""===_O(r[0])&&(t.lastIndex=function(e,t,n){return t+(n?nO(e,t).length:1)}(n,mO(t.lastIndex),e.unicode)),pO(r,!1)):(e.done=!0,pO(r,!1))})),MO=function(e){var t,n,r,i=gO(this),a=_O(e),o=CO(i,RegExp),s=_O(SO(i));return t=new o(o===RegExp?i.source:i,s),n=!!~LO(s,"g"),r=!!~LO(s,"u"),t.lastIndex=mO(i.lastIndex),new xO(t,a,n,r)};lO({target:"String",proto:!0,forced:kO},{matchAll:function(e){var t,n,r,i,a=fO(this);if(EO(e)){if(kO)return DO(a,e)}else{if(yO(e)&&(t=_O(fO(SO(e))),!~LO(t,"g")))throw PO("`.matchAll` does not allow non-global regexes");if(kO)return DO(a,e);if(void 0===(r=bO(e,RO))&&"RegExp"==vO(e)&&(r=MO),r)return dO(r,e,a)}return n=_O(a),i=new RegExp(e,"g"),dO(MO,i,n)}});var UO=ju("String").matchAll,FO=tc,jO=UO,VO=String.prototype,BO=Ks((function(e){var t=e.matchAll;return"string"==typeof e||e===VO||FO(VO,e)&&t===VO.matchAll?jO:t}));function GO(e){function t(e,n,r,i){let a=e[i++];if("__proto__"===a)return!0;let o=Number.isFinite(+a),s=i>=e.length;return a=!a&&yC.isArray(r)?r.length:a,s?(yC.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!o):(r[a]&&yC.isObject(r[a])||(r[a]=[]),t(e,n,r[a],i)&&yC.isArray(r[a])&&(r[a]=function(e){let t,n,r={},i=Object.keys(e),a=i.length;for(t=0;t<a;t++)n=i[t],r[n]=e[n];return r}(r[a])),!o)}if(yC.isFormData(e)&&yC.isFunction(e.entries)){let n={};return yC.forEachEntry(e,((e,r)=>{t(function(e){return BO(yC).call(yC,/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null}var WO={transitional:xC,adapter:["xhr","http"],transformRequest:[function(e,t){let n,r=t.getContentType()||"",i=r.indexOf("application/json")>-1,a=yC.isObject(e);if(a&&yC.isHTMLForm(e)&&(e=new FormData(e)),yC.isFormData(e))return i?JSON.stringify(GO(e)):e;if(yC.isArrayBuffer(e)||yC.isBuffer(e)||yC.isStream(e)||yC.isFile(e)||yC.isBlob(e))return e;if(yC.isArrayBufferView(e))return e.buffer;if(yC.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return IC(e,new YN.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return YN.isNode&&yC.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((n=yC.isFileList(e))||r.indexOf("multipart/form-data")>-1){let t=this.env&&this.env.FormData;return IC(n?{"files[]":e}:e,t&&new t,this.formSerializer)}}return a||i?(t.setContentType("application/json",!1),function(e){if(yC.isString(e))try{return(0,JSON.parse)(e),db(yC).call(yC,e)}catch(ha){if("SyntaxError"!==ha.name)throw ha}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){let t=this.transitional||WO.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&yC.isString(e)&&(n&&!this.responseType||r)){let n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(aa){if(n)throw"SyntaxError"===aa.name?SC.from(aa,SC.ERR_BAD_RESPONSE,this,null,this.response):aa}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:YN.classes.FormData,Blob:YN.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};yC.forEach(["delete","get","head","post","put","patch"],(e=>{WO.headers[e]={}}));var HO=WO,qO=yC.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),zO=Symbol("internals");function KO(e){var t;return e&&db(t=String(e)).call(t).toLowerCase()}function YO(e){return!1===e||null==e?e:yC.isArray(e)?e.map(YO):String(e)}function JO(e,t,n,r,i){return yC.isFunction(r)?r.call(this,t,n):(i&&(t=n),yC.isString(t)?yC.isString(r)?-1!==t.indexOf(r):yC.isRegExp(r)?r.test(t):void 0:void 0)}var XO=class{constructor(e){e&&this.set(e)}set(e,t,n){let r=this;function i(e,t,n){let i=KO(t);if(!i)throw new Error("header name must be a non-empty string");let a=yC.findKey(r,i);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=YO(e))}let a=(e,t)=>yC.forEach(e,((e,n)=>i(e,n,t)));var o;return yC.isPlainObject(e)||e instanceof this.constructor?a(e,t):yC.isString(e)&&(e=db(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(db(o=e).call(o))?a((e=>{let t,n,r,i={};return e&&e.split("\n").forEach((function(e){var a,o;r=e.indexOf(":"),t=db(a=e.substring(0,r)).call(a).toLowerCase(),n=db(o=e.substring(r+1)).call(o),!t||i[t]&&qO[t]||("set-cookie"===t?i[t]?i[t].push(n):i[t]=[n]:i[t]=i[t]?i[t]+", "+n:n)})),i})(e),t):null!=e&&i(t,e,n),this}get(e,t){if(e=KO(e)){let n=yC.findKey(this,e);if(n){let e=this[n];if(!t)return e;if(!0===t)return function(e){let t,n=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;for(;t=r.exec(e);)n[t[1]]=t[2];return n}(e);if(yC.isFunction(t))return t.call(this,e,n);if(yC.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=KO(e)){let n=yC.findKey(this,e);return!(!n||void 0===this[n]||t&&!JO(0,this[n],n,t))}return!1}delete(e,t){let n=this,r=!1;function i(e){if(e=KO(e)){let i=yC.findKey(n,e);!i||t&&!JO(0,n[i],i,t)||(delete n[i],r=!0)}}return yC.isArray(e)?e.forEach(i):i(e),r}clear(e){let t=Object.keys(this),n=t.length,r=!1;for(;n--;){let i=t[n];e&&!JO(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){let t=this,n={};return yC.forEach(this,((r,i)=>{var a;let o=yC.findKey(n,i);if(o)return t[o]=YO(r),void delete t[i];let s=e?function(e){return db(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):db(a=String(i)).call(a);s!==i&&delete t[i],t[s]=YO(r),n[s]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){let t=Object.create(null);return yC.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&yC.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){let t=(this[zO]=this[zO]={accessors:{}}).accessors,n=this.prototype;function r(e){let r=KO(e);t[r]||(function(e,t){let n=yC.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return yC.isArray(e)?e.forEach(r):r(e),this}};XO.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),yC.reduceDescriptors(XO.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),yC.freezeMethods(XO);var QO=XO;function ZO(e,t){let n=this||HO,r=t||n,i=QO.from(r.headers),a=r.data;return yC.forEach(e,(function(e){a=e.call(n,a,i.normalize(),t?t.status:void 0)})),i.normalize(),a}function $O(e){return!(!e||!e.__CANCEL__)}function eP(e,t,n){SC.call(this,null!==e&&void 0!==e?e:"canceled",SC.ERR_CANCELED,t,n),this.name="CanceledError"}yC.inherits(eP,SC,{__CANCEL__:!0});var tP=YN.hasStandardBrowserEnv?{write(e,t,n,r,i,a){let o=[e+"="+encodeURIComponent(t)];yC.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),yC.isString(r)&&o.push("path="+r),yC.isString(i)&&o.push("domain="+i),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function nP(e,t){return e&&!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var rP=YN.hasStandardBrowserEnv?function(){let e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){let r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){let n=yC.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0};function iP(e,t){let n=0,r=function(e,t){e=e||10;let n,r=new Array(e),i=new Array(e),a=0,o=0;return t=void 0!==t?t:1e3,function(s){let c=Date.now(),l=i[o];n||(n=c),r[a]=s,i[a]=c;let d=o,u=0;for(;d!==a;)u+=r[d++],d%=e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),c-n<t)return;let h=l&&c-l;return h?Math.round(1e3*u/h):void 0}}(50,250);return i=>{let a=i.loaded,o=i.lengthComputable?i.total:void 0,s=a-n,c=r(s);n=a;let l={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:c||void 0,estimated:c&&o&&a<=o?(o-a)/c:void 0,event:i};l[t?"download":"upload"]=!0,e(l)}}var aP=typeof XMLHttpRequest<"u"&&function(e){return new hS((function(t,n){let r,i,a=e.data,o=QO.from(e.headers).normalize(),{responseType:s,withXSRFToken:c}=e;function l(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}if(yC.isFormData(a))if(YN.hasStandardBrowserEnv||YN.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if(!1!==(i=o.getContentType())){let[e,...t]=i?i.split(";").map((e=>db(e).call(e))).filter(Boolean):[];o.setContentType([e||"multipart/form-data",...t].join("; "))}let d=new XMLHttpRequest;if(e.auth){let t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.set("Authorization","Basic "+btoa(t+":"+n))}let u=nP(e.baseURL,e.url);function h(){if(!d)return;let r=QO.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders());(function(e,r,i){let a=i.config.validateStatus;i.status&&a&&!a(i.status)?function(e){n(e),l()}(new SC("Request failed with status code "+i.status,[SC.ERR_BAD_REQUEST,SC.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):function(e){t(e),l()}(i)})(0,0,{data:s&&"text"!==s&&"json"!==s?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:r,config:e,request:d}),d=null}if(d.open(e.method.toUpperCase(),DC(u,e.params,e.paramsSerializer),!0),d.timeout=e.timeout,"onloadend"in d?d.onloadend=h:d.onreadystatechange=function(){d&&4===d.readyState&&(0!==d.status||d.responseURL&&0===d.responseURL.indexOf("file:"))&&setTimeout(h)},d.onabort=function(){d&&(n(new SC("Request aborted",SC.ECONNABORTED,e,d)),d=null)},d.onerror=function(){n(new SC("Network Error",SC.ERR_NETWORK,e,d)),d=null},d.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||xC;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new SC(t,r.clarifyTimeoutError?SC.ETIMEDOUT:SC.ECONNABORTED,e,d)),d=null},YN.hasStandardBrowserEnv&&(c&&yC.isFunction(c)&&(c=c(e)),c||!1!==c&&rP(u))){let t=e.xsrfHeaderName&&e.xsrfCookieName&&tP.read(e.xsrfCookieName);t&&o.set(e.xsrfHeaderName,t)}void 0===a&&o.setContentType(null),"setRequestHeader"in d&&yC.forEach(o.toJSON(),(function(e,t){d.setRequestHeader(t,e)})),yC.isUndefined(e.withCredentials)||(d.withCredentials=!!e.withCredentials),s&&"json"!==s&&(d.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&d.addEventListener("progress",iP(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&d.upload&&d.upload.addEventListener("progress",iP(e.onUploadProgress)),(e.cancelToken||e.signal)&&(r=t=>{d&&(n(!t||t.type?new eP(null,e,d):t),d.abort(),d=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r)));let p=function(e){let t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(u);p&&-1===YN.protocols.indexOf(p)?n(new SC("Unsupported protocol "+p+":",SC.ERR_BAD_REQUEST,e)):d.send(a||null)}))},oP={http:null,xhr:aP};yC.forEach(oP,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(n){}Object.defineProperty(e,"adapterName",{value:t})}}));var sP=e=>"- ".concat(e),cP=e=>yC.isFunction(e)||null===e||!1===e,lP=e=>{e=yC.isArray(e)?e:[e];let t,n,{length:r}=e,i={};for(let a=0;a<r;a++){let r;if(t=e[a],n=t,!cP(t)&&(n=oP[(r=String(t)).toLowerCase()],void 0===n))throw new SC("Unknown adapter '".concat(r,"'"));if(n)break;i[r||"#"+a]=n}if(!n){let e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));throw new SC("There is no suitable adapter to dispatch the request "+(r?e.length>1?"since :\n"+e.map(sP).join("\n"):" "+sP(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n};function dP(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new eP(null,e)}function uP(e){return dP(e),e.headers=QO.from(e.headers),e.data=ZO.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),lP(e.adapter||HO.adapter)(e).then((function(t){return dP(e),t.data=ZO.call(e,e.transformResponse,t),t.headers=QO.from(t.headers),t}),(function(t){return $O(t)||(dP(e),t&&t.response&&(t.response.data=ZO.call(e,e.transformResponse,t.response),t.response.headers=QO.from(t.response.headers))),hS.reject(t)}))}function hP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var pP=e=>e instanceof QO?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hP(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hP(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e):e;function fP(e,t){t=t||{};let n={};function r(e,t,n){return yC.isPlainObject(e)&&yC.isPlainObject(t)?yC.merge.call({caseless:n},e,t):yC.isPlainObject(t)?yC.merge({},t):yC.isArray(t)?t.slice():t}function i(e,t,n){return yC.isUndefined(t)?yC.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function a(e,t){if(!yC.isUndefined(t))return r(void 0,t)}function o(e,t){return yC.isUndefined(t)?yC.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,a){return a in t?r(n,i):a in e?r(void 0,n):void 0}let c={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t)=>i(pP(e),pP(t),!0)};return yC.forEach(Object.keys(Object.assign({},e,t)),(function(r){let a=c[r]||i,o=a(e[r],t[r],r);yC.isUndefined(o)&&a!==s||(n[r]=o)})),n}var mP="1.6.8",_P={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{_P[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var gP={};_P.transitional=function(e,t,n){function r(e,t){return"[Axios v1.6.8] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,a)=>{if(!1===e)throw new SC(r(i," has been removed"+(t?" in "+t:"")),SC.ERR_DEPRECATED);return t&&!gP[i]&&(gP[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,a)}};var EP={assertOptions:function(e,t,n){if("object"!=typeof e)throw new SC("options must be an object",SC.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),i=r.length;for(;i-- >0;){let a=r[i],o=t[a];if(o){let t=e[a],n=void 0===t||o(t,a,e);if(!0!==n)throw new SC("option "+a+" must be "+n,SC.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new SC("Unknown option "+a,SC.ERR_BAD_OPTION)}},validators:_P},vP=EP.validators,yP=class{constructor(e){this.defaults=e,this.interceptors={request:new kC,response:new kC}}async request(e,t){try{return await this._request(e,t)}catch(na){if(na instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=new Error;let n=t.stack?t.stack.replace(/^.+\n/,""):"";na.stack?n&&!String(na.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(na.stack+="\n"+n):na.stack=n}throw na}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=fP(this.defaults,t);let{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&EP.assertOptions(n,{silentJSONParsing:vP.transitional(vP.boolean),forcedJSONParsing:vP.transitional(vP.boolean),clarifyTimeoutError:vP.transitional(vP.boolean)},!1),null!=r&&(yC.isFunction(r)?t.paramsSerializer={serialize:r}:EP.assertOptions(r,{encode:vP.function,serialize:vP.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&yC.merge(i.common,i[t.method]);i&&yC.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=QO.concat(a,i);let o=[],s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));let c,l=[];this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let d,u=0;if(!s){let e=[uP.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,l),d=e.length,c=hS.resolve(t);u<d;)c=c.then(e[u++],e[u++]);return c}d=o.length;let h=t;for(u=0;u<d;){let e=o[u++],t=o[u++];try{h=e(h)}catch(xa){t.call(this,xa);break}}try{c=uP.call(this,h)}catch(pa){return hS.reject(pa)}for(u=0,d=l.length;u<d;)c=c.then(l[u++],l[u++]);return c}getUri(e){return DC(nP((e=fP(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};yC.forEach(["delete","get","head","options"],(function(e){yP.prototype[e]=function(t,n){return this.request(fP(n||{},{method:e,url:t,data:(n||{}).data}))}})),yC.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(fP(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}yP.prototype[e]=t(),yP.prototype[e+"Form"]=t(!0)}));var SP=yP,bP=class e{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new hS((function(e){t=e}));let n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t,r=new hS((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new eP(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let t;return{token:new e((function(e){t=e})),cancel:t}}},TP={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(TP).forEach((e=>{let[t,n]=e;TP[n]=t}));var CP=TP,wP=function e(t){let n=new SP(t),r=VT(SP.prototype.request,n);return yC.extend(r,SP.prototype,n,{allOwnKeys:!0}),yC.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(fP(t,n))},r}(HO);wP.Axios=SP,wP.CanceledError=eP,wP.CancelToken=bP,wP.isCancel=$O,wP.VERSION=mP,wP.toFormData=IC,wP.AxiosError=SC,wP.Cancel=wP.CanceledError,wP.all=function(e){return hS.all(e)},wP.spread=function(e){return function(t){return e.apply(null,t)}},wP.isAxiosError=function(e){return yC.isObject(e)&&!0===e.isAxiosError},wP.mergeConfig=fP,wP.AxiosHeaders=QO,wP.formToJSON=e=>GO(yC.isHTMLForm(e)?new FormData(e):e),wP.getAdapter=lP,wP.HttpStatusCode=CP,wP.default=wP;var RP=wP,AP=()=>{};function IP(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:AP};return e.promise=new hS(((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}var NP=new Map,OP=new Map,PP=new Map,LP=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),DP=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),kP=new OT,xP=kP.getResult(),MP=null;function UP(e){if(!MP){let e=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return DP.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return DP.CHROME;case"Safari":case"Mobile Safari":return DP.SAFARI;case"Edge":return DP.EDGE;case"Firefox":return DP.FIREFOX;case"QQ":case"QQBrowser":return DP.QQ;case"Opera":return DP.OPERA;case"WeChat":return DP.WECHAT;default:return e.browser.name||""}}(xP=kP.getResult()),t=FP(xP),n=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(xP),r=xP.os.version,i=FP(xP,!1),a=xP.device.type;if(!(e&&t&&n&&r))return{name:e,version:t,os:n,osVersion:r,browserVersion:i,deviceType:a};MP={name:e,version:t,os:n,osVersion:r,browserVersion:i,deviceType:a}}return MP}function FP(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function jP(){return UP().os}function VP(){let e=UP();return"".concat(e.os," ").concat(e.osVersion)}function BP(){let e=UP();return!!("WebKit"===xP.engine.name&&e.os===LP.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==DP.SAFARI||zP()&&e.name!==DP.SAFARI)}function GP(){return UP().name===DP.CHROME}function WP(){return UP().name===DP.SAFARI}function HP(){return UP().name===DP.EDGE}function qP(){return UP().name===DP.FIREFOX}function zP(){return UP().os===LP.IOS}function KP(e){let t=UP();return!(t.name!==DP.CHROME||!t.osVersion)&&Number(t.version)>=e}function YP(e){let t=UP();return!(t.name!==DP.CHROME||!t.osVersion)&&Number(t.version)<e}function JP(e){let t=UP();return!(t.name!==DP.EDGE||!t.osVersion)&&Number(t.version)>=e}function XP(e){let t=UP();return!(t.name!==DP.SAFARI||!t.osVersion)&&Number(t.version)>=e}function QP(e,t,n){let r=UP();if(r.os!==LP.IOS||!r.osVersion)return!1;let i=r.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function ZP(e,t,n){let r=UP();if(r.name!==DP.SAFARI||!r.osVersion||!r.browserVersion)return!1;let i=r.browserVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function $P(e){let t=UP();return!(t.name!==DP.OPERA||!t.osVersion)&&Number(t.version)>=e}function eL(){let e=UP();if(e.os!==LP.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function tL(){let e=UP();if(e.os!==LP.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])}function nL(){let e=UP();if(e.os!==LP.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 16===Number(t[0])}function rL(){let e=UP();if(e.os!==LP.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function iL(){return WP()&&navigator.maxTouchPoints>0}function aL(){return UP().name===DP.WECHAT}function oL(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function sL(){let e=jP();return function(){let{deviceType:e}=UP();return"mobile"===e||"tablet"===e}()||e===LP.ANDROID||e===LP.IOS||e===LP.HARMONY_OS}function cL(){let e=UP();return e.name!==DP.EDGE&&e.name!==DP.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function lL(){return jP()===LP.ANDROID}function dL(){let e=UP();return lL()&&(e.name===DP.CHROME||e.name===DP.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function uL(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hL(Object(n),!0).forEach((function(t){uL(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hL(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fL=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),mL=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),uL(this,"code",void 0),uL(this,"message",void 0),uL(this,"data",void 0),uL(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function _L(e,t){if("boolean"!=typeof e)throw new mL(fL.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function gL(e,t,n){if(!_h(n).call(n,e))throw new mL(fL.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function EL(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(i=e)||i%1!=0))throw new mL(fL.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"));var i}function vL(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new mL(fL.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&EL(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&EL(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&EL(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&EL(e.ideal,"".concat(t,".ideal"),1,1/0)}else EL(e,t,1,1/0)}function yL(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new mL(fL.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!TL(e,n,r,i))throw new mL(fL.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function SL(e,t){if(!Array.isArray(e))throw new mL(fL.INVALID_PARAMS,"".concat(t," should be an array"))}function bL(e){return null==e}function TL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){let n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var CL=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(CL||{}),wL=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(wL||{}),RL=new class{constructor(){uL(this,"_clientSize",null),uL(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),uL(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),uL(this,"getStyle",(e=>window.getComputedStyle(e,null))),uL(this,"checkCssVisibleProperty",(e=>{var t;let n=!0,r=this.getStyle(e),{display:i,visibility:a,opacity:o,filter:s}=r;return("none"===i||_h(t=["hidden","collapse"]).call(t,a)||Number(o)<.1)&&(n=!1),!!n&&(s&&s.split(" ").filter((e=>{var t;let n=e.split("(")[0];return _h(t=["brightness","blur","opacity"]).call(t,n)})).map((e=>{let[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{let[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}})),n)})),uL(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0,i=e=>t(e),a=e;for(;a&&r;)i(a)||(n=!1,r=!1),a=a.parentElement,a||(r=!1);return n})),uL(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),uL(this,"getSizeAboutClient",(e=>{let{width:t,height:n,left:r,right:i,top:a,bottom:o}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:a,bottom:o,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}})),uL(this,"checkActualSize",(()=>{let{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),uL(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),uL(this,"checkCoverForAPoint",((e,t,n)=>{let r=this.elementFromPoint(e,t);return null!==r&&r!==n})),uL(this,"getPointPositionList",(()=>{let{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,a=t/6,o=[],s=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){let t=(n*s+(0===c?.1:4===c?(i*c*s-1e5)/s:i*c)*s)/s,l=(r*s+(0===e?.1:4===e?(a*e*s-1e5)/s:a*e)*s)/s;o.push({x:t,y:l})}return[...o]})),uL(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),uL(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),uL(this,"checkSizeOfPartInClient",(()=>{let e,t,n,r,{left:i,right:a,top:o,bottom:s,clientHeight:c,clientWidth:l,clientMin:d}=this._clientSize;if(i<0)e=0;else{if(!(i<l))return!1;e=i}if(a<0)return!1;if(t=a<l?a:l,o<0)n=0;else{if(!(o<c))return!1;n=o}if(s<0)return!1;r=s<c?s:c;let u=t-e,h=r-n;return this.checkSizeIsVisible(u,h,d)})),uL(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),uL(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(CL.COVERED);{let e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(CL.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(CL.SIZE)}}return this.returnHiddenResult(CL.STYLE)}return this.returnHiddenResult(wL.UNMOUNTED)}return this.returnHiddenResult(wL.INVALID_HTML_ELEMENT)})),uL(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function AL(e){return(new TextEncoder).encode(e)}var IL=function(e,t){let n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},NL=async e=>function(e){let t="";return new Uint8Array(e).forEach((e=>{t+=e.toString(16).padStart(2,"0")})),t}(await crypto.subtle.digest("SHA-256",AL(e))),OL=class{constructor(){uL(this,"_events",{}),uL(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let a=0;a<t.length;a+=1){let n=t[a];n.once&&this.off(e,n.listener),n.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(aa){console.error("safeEmit event:".concat(e," error ").concat(null===aa||void 0===aa?void 0:aa.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},PL=null;function LL(){if(PL)return PL;if(window.electron)return PL=window.electron;if(!window.require)return null;try{return PL=window.require("electron")}catch(e){return null}}var DL=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),kL=function(e){return e.TRACER="tracer",e}({});function xL(e){return EL(e.timeout,"config.timeout",0,1e5),EL(e.timeoutFactor,"config.timeoutFactor",0,100,!1),EL(e.maxRetryCount,"config.maxRetryConfig",0,1/0),EL(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}var ML=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),UL=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function FL(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(t){return!1}return!0}function jL(e){return yL(e.turnServerURL,"turnServerURL"),yL(e.username,"username"),yL(e.password,"password"),e.udpport&&EL(e.udpport,"udpport",1,99999,!0),e.forceturn&&_L(e.forceturn,"forceturn"),e.security&&_L(e.security,"security"),e.tcpport&&EL(e.tcpport,"tcpport",1,99999,!0),!0}function VL(e){return void 0!==e.level&&gL(e.level,"level",[1,2,3]),void 0!==e.delay&&EL(e.delay,"delay",0,3e3,!0),!0}var BL=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),GL=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),WL=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),HL=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function qL(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?hS.reject(new mL(fL.UNEXPECTED_ERROR,"can not emit promise")):new hS(((n,i)=>{e.emit(t,...r,n,i)}))}function zL(e,t){if(0===e.getListeners(t).length)return hS.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return qL(e,t,...r)}function KL(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return YL(e,t,...r)}function YL(e,t){let n=null,r=null;for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];if(e.emit(t,...a,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new mL(fL.UNEXPECTED_ERROR,"handler is not sync");return n}var JL=new class extends OL{set networkState(e){this.emit(HL.NETWORK_STATE_CHANGE,e,this._networkState),e===WL.ONLINE?this.emit(HL.ONLINE):e===WL.OFFLINE&&(this.onlineWaiter=new hS((e=>{this.once(HL.ONLINE,(()=>{this.onlineWaiter=void 0,e(WL.ONLINE)}))})),this.emit(HL.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===WL.ONLINE}constructor(){super(),uL(this,"_moduleName","network-indicator"),uL(this,"_networkState",WL.ONLINE),uL(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=WL.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=WL.OFFLINE}))}};function XL(e,t){let n=e.indexOf(t);-1!==n&&e.splice(n,1)}function QL(e){let t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function ZL(e){void 0!==hS?hS.resolve().then(e):setTimeout(e,0)}function $L(e){return JSON.parse(JSON.stringify(e))}function eD(e){try{return $L(e)}catch(t){return e}}var tD={};function nD(e,t){tD[t]||(tD[t]=!0,e())}function rD(e){let t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function iD(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function aD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){let e=new Uint8Array(t);e.set(n),n=e}return n}function oD(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=Dh(t).call(t,((e,t)=>e+t.length),0),i=new Uint8Array(new ArrayBuffer(r)),a=0;return t.forEach((e=>{i.set(e,a),a+=e.length})),i}function sD(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function cD(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?sD(e):e.size})),t+138}function lD(e){let t=new mL(fL.TIMEOUT,"timeout");return new hS(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function dD(e){return new hS((t=>{window.setTimeout(t,e)}))}function uD(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+uD(e-n.length,"")}function hD(){return uD(32,"").toUpperCase()}var pD=()=>{},fD=new class{constructor(){uL(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,a=new Array(i>4?i-4:0),o=4;o<i;o++)a[o-4]=arguments[o];if(this.fnMap.has(t)){let i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);let o=window.setTimeout((()=>{let e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:o,args:a,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,pL(pL({},i),{},{fn:e,args:a,skipFn:r}))}else{let i=window.setTimeout((()=>{let e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:a,skipFn:r})}}},mD=fD.throttleByKey.bind(fD);function _D(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function gD(e,t){if(!_D(e)||!_D(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let n=[...e];for(let r=0;r<t.length;r++)n[r]=gD(e[r],t[r]);return n}{let n=pL({},e);for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=gD(e[r],t[r]):n[r]=t[r]);return n}}function ED(e,t){let n=[0];if(n=new Array(t).fill(0),0===e)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,r!==t););return n}function vD(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function yD(e){let t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){let n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,a,o){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,o)),a),n)}function a(e,t,n,r,a,o,s){return i(t&n|~t&r,e,t,a,o,s)}function o(e,t,n,r,a,o,s){return i(t&r|n&~r,e,t,a,o,s)}function s(e,t,n,r,a,o,s){return i(t^n^r,e,t,a,o,s)}function c(e,t,n,r,a,o,s){return i(n^(t|~r),e,t,a,o,s)}let l,d,u,h,p,f=function(e){let t,n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e),m=1732584193,_=-271733879,g=-1732584194,E=271733878;for(l=0;l<f.length;l+=16)d=m,u=_,h=g,p=E,m=a(m,_,g,E,f[l+0],7,-680876936),E=a(E,m,_,g,f[l+1],12,-389564586),g=a(g,E,m,_,f[l+2],17,606105819),_=a(_,g,E,m,f[l+3],22,-1044525330),m=a(m,_,g,E,f[l+4],7,-176418897),E=a(E,m,_,g,f[l+5],12,1200080426),g=a(g,E,m,_,f[l+6],17,-1473231341),_=a(_,g,E,m,f[l+7],22,-45705983),m=a(m,_,g,E,f[l+8],7,1770035416),E=a(E,m,_,g,f[l+9],12,-1958414417),g=a(g,E,m,_,f[l+10],17,-42063),_=a(_,g,E,m,f[l+11],22,-1990404162),m=a(m,_,g,E,f[l+12],7,1804603682),E=a(E,m,_,g,f[l+13],12,-40341101),g=a(g,E,m,_,f[l+14],17,-1502002290),_=a(_,g,E,m,f[l+15],22,1236535329),m=o(m,_,g,E,f[l+1],5,-165796510),E=o(E,m,_,g,f[l+6],9,-1069501632),g=o(g,E,m,_,f[l+11],14,643717713),_=o(_,g,E,m,f[l+0],20,-373897302),m=o(m,_,g,E,f[l+5],5,-701558691),E=o(E,m,_,g,f[l+10],9,38016083),g=o(g,E,m,_,f[l+15],14,-660478335),_=o(_,g,E,m,f[l+4],20,-405537848),m=o(m,_,g,E,f[l+9],5,568446438),E=o(E,m,_,g,f[l+14],9,-1019803690),g=o(g,E,m,_,f[l+3],14,-187363961),_=o(_,g,E,m,f[l+8],20,1163531501),m=o(m,_,g,E,f[l+13],5,-1444681467),E=o(E,m,_,g,f[l+2],9,-51403784),g=o(g,E,m,_,f[l+7],14,1735328473),_=o(_,g,E,m,f[l+12],20,-1926607734),m=s(m,_,g,E,f[l+5],4,-378558),E=s(E,m,_,g,f[l+8],11,-2022574463),g=s(g,E,m,_,f[l+11],16,1839030562),_=s(_,g,E,m,f[l+14],23,-35309556),m=s(m,_,g,E,f[l+1],4,-1530992060),E=s(E,m,_,g,f[l+4],11,1272893353),g=s(g,E,m,_,f[l+7],16,-155497632),_=s(_,g,E,m,f[l+10],23,-1094730640),m=s(m,_,g,E,f[l+13],4,681279174),E=s(E,m,_,g,f[l+0],11,-358537222),g=s(g,E,m,_,f[l+3],16,-722521979),_=s(_,g,E,m,f[l+6],23,76029189),m=s(m,_,g,E,f[l+9],4,-640364487),E=s(E,m,_,g,f[l+12],11,-421815835),g=s(g,E,m,_,f[l+15],16,530742520),_=s(_,g,E,m,f[l+2],23,-995338651),m=c(m,_,g,E,f[l+0],6,-198630844),E=c(E,m,_,g,f[l+7],10,1126891415),g=c(g,E,m,_,f[l+14],15,-1416354905),_=c(_,g,E,m,f[l+5],21,-57434055),m=c(m,_,g,E,f[l+12],6,1700485571),E=c(E,m,_,g,f[l+3],10,-1894986606),g=c(g,E,m,_,f[l+10],15,-1051523),_=c(_,g,E,m,f[l+1],21,-2054922799),m=c(m,_,g,E,f[l+8],6,1873313359),E=c(E,m,_,g,f[l+15],10,-30611744),g=c(g,E,m,_,f[l+6],15,-1560198380),_=c(_,g,E,m,f[l+13],21,1309151649),m=c(m,_,g,E,f[l+4],6,-145523070),E=c(E,m,_,g,f[l+11],10,-1120210379),g=c(g,E,m,_,f[l+2],15,718787259),_=c(_,g,E,m,f[l+9],21,-343485551),m=r(m,d),_=r(_,u),g=r(g,h),E=r(E,p);return n(m)+n(_)+n(g)+n(E)}var SD=1,bD=console,TD=class{static setLogger(e){bD=e}constructor(e){uL(this,"lockingPromise",hS.resolve()),uL(this,"locks",0),uL(this,"name",""),uL(this,"lockId",void 0),this.lockId=SD++,e&&(this.name=e),bD.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,bD.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));let n=new hS((n=>{t=()=>{this.locks-=1,bD.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:"")),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}};function CD(e,t){return function(n,r,i){let a=i.value;if("function"!=typeof a)throw new Error("Cannot use mutex on object property.");return i.value=async function(){let n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let i=await n.lock("From ".concat(e,".").concat(r));try{for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return await a.apply(this,s)}finally{i()}},i}}var wD={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function RD(e,t){let n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function AD(e,t,n,r){let i=Object.assign({},wD,r),a=i.timeout,o=async()=>{await function(e){return new hS((t=>{window.setTimeout(t,e)}))}(a),a*=i.timeoutFactor,a=Math.min(i.maxRetryTimeout,a)},s=!1,c=new hS((async(r,a)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(s)return a(new mL(fL.OPERATION_ABORTED));try{let n=await e();if(!t(n,c)||c+1===i.maxRetryCount)return r(n);await o()}catch(la){if(!n(la,c)||c+1===i.maxRetryCount)return a(la);await o()}}}));return c.cancel=()=>s=!0,c}var ID,ND=class{constructor(e){uL(this,"input",[]),uL(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:Dh(e=this.input).call(e,((e,t)=>e+t))/this.input.length}};function OD(e,t,n,r){return new hS(((r,i)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),sD(t.data)):n&&(t.data.size?t.data.size:t.data instanceof FormData?cD(t.data):sD(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,RP.request(t).then((e=>{"string"==typeof e.data?sD(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?e.data.byteLength:sD(JSON.stringify(e.data)),r(e.data)})).catch((e=>{RP.isCancel(e)?i(new mL(fL.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?i(new mL(fL.NETWORK_TIMEOUT,e.message)):e.response?i(new mL(fL.NETWORK_RESPONSE_ERROR,e.response.status)):i(new mL(fL.NETWORK_ERROR,e.message))}))}))}async function PD(e,t){let n=new Blob([t.data],{type:"buffer"});return await OD(e,pL(pL({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}var LD=()=>void 0!==window.isSecureContext,DD=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){let e=t[1],n=t[2];return"".concat(e,".").concat(n)}let n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){let e=n[1],t=n[2];return"".concat(e,".").concat(100*(Number(t)+1))}return"4.0.0.999"}("4.22.0"),kD=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}(),xD=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),MD={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},UD="v4.22.0-0-g8569241d-dirty(8/15/2024, 7:04:06 PM)",FD=pL(pL({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:MD,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1});function jD(e,t,n){var r,i,a;_h(r=Object.keys(FD)).call(r,e)&&(!n&&_h(i=Object.keys(BD)).call(i,e)||(FD[e]=t,"ENABLE_VIDEO_SEI"===e&&!0===t&&(FD.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(a=!!t,FD.USE_NEW_NETWORK_CONFIG=a,a&&(FD.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],FD.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],FD.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],FD.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],FD.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",FD.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",FD.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(FD.ENABLE_INSTANT_VIDEO=!0,FD.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(FD.ENABLE_AUT_CC=!0)))}function VD(e){return FD[e]}var BD={},GD=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(GD||{}),WD=class{constructor(e,t,n,r){uL(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:xD.Default}}dispatch(e){this.state=function(e,t){switch(t.type){case GD.SET_SESSION_ID:return pL(pL({},e),{},{sessionId:t.sessionId});case GD.SET_P2P_ID:return pL(pL({},e),{},{p2pId:t.p2pId});case GD.SET_UID:return pL(pL({},e),{},{uid:t.uid});case GD.SET_INT_UID:return pL(pL({},e),{},{intUid:t.intUid});case GD.SET_PUB_ID:return pL(pL({},e),{},{pubId:t.pubId});case GD.KEY_METRIC_CLIENT_CREATED:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{clientCreated:t.metric})});case GD.KEY_METRIC_JOIN_START:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{joinStart:t.metric})});case GD.AVOID_JOIN_START:return pL(pL({},e),{},{avoidJoinStart:t.avoidJoinStart});case GD.KEY_METRIC_JOIN_END:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{joinEnd:t.metric})});case GD.KEY_METRIC_REQUEST_AP_START:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{requestAPStart:t.metric})});case GD.KEY_METRIC_REQUEST_AP_END:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{requestAPEnd:t.metric})});case GD.KEY_METRIC_JOIN_GATEWAY_START:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case GD.KEY_METRIC_JOIN_GATEWAY_END:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case GD.KEY_METRIC_PEER_CONNECTION_START:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case GD.KEY_METRIC_PEER_CONNECTION_END:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case GD.KEY_METRIC_DESCRIPTION_START:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{descriptionStart:t.metric})});case GD.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case GD.KEY_METRIC_ICE_CONNECTION_END:return pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case GD.KEY_METRIC_PUBLISH:{let n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=pL(pL({},n[r]),t.metric),pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{publish:[...n]})})):pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case GD.KEY_METRIC_SUBSCRIBE:{let n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=pL(pL({},n[r]),t.metric),pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{subscribe:[...n]})})):pL(pL({},e),{},{keyMetrics:pL(pL({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case GD.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case GD.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=pL(pL({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case GD.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case GD.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case GD.SET_USE_P2P:return pL(pL({},e),{},{useP2P:t.val});case GD.SET_TRANSPORT_TYPE:return pL(pL({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:GD.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:GD.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:GD.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:GD.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:GD.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:GD.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:GD.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:GD.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:GD.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:GD.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:GD.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:GD.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:GD.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:GD.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:GD.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:GD.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:GD.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:GD.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:GD.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:GD.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:GD.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:GD.KEY_METRIC_PUBLISH,metric:pL(pL({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,a,o){this.dispatch({type:GD.KEY_METRIC_SUBSCRIBE,metric:pL(pL(pL(pL(pL({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),a&&{streamAdded:a}),o&&{firstDecoded:o})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:GD.KEY_METRIC_SUBSCRIBE,metric:pL(pL(pL({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:GD.RECORD_JOIN_CHANNEL_SERVICE,record:pL(pL({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:GD.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(n){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:GD.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:GD.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:GD.AVOID_JOIN_START,avoidJoinStart:e})}},HD=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});var qD=10,zD=0;function KD(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function YD(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JD(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YD(Object(n),!0).forEach((function(t){KD(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YD(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var XD=new class extends OL{constructor(){super(...arguments),KD(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}},QD=class{constructor(e){KD(this,"logger",void 0),KD(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}};function ZD(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function $D(){let e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null===t||void 0===t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var ek,tk={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},nk=Date.now(),rk=e=>{for(let t in tk)if(Object.prototype.hasOwnProperty.call(tk,t)&&tk[t]===e)return t;return"DEFAULT"},ik=new class{constructor(){KD(this,"proxyServerURL",void 0),KD(this,"logLevel",tk.DEBUG),KD(this,"uploadState","collecting"),KD(this,"uploadLogWaitingList",[]),KD(this,"uploadLogUploadingList",[]),KD(this,"uploadErrorCount",0),KD(this,"currentLogID",0),KD(this,"url",void 0),KD(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[tk.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[tk.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[tk.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[tk.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[tk.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){jD("UPLOAD_LOG",!0)}disableLogUpload(){jD("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new QD(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-nk<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-nk);let r=Math.max(0,Math.min(4,t[0]));if(t[0]=ZD()+" Agora-SDK [".concat(rk(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;let i=ZD()+" %cAgora-SDK [".concat(rk(r),"]:"),a=[];if(!VD("USE_NEW_LOG"))switch(r){case tk.DEBUG:a=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case tk.INFO:a=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case tk.WARNING:a=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case tk.ERROR:a=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-nk<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-nk);let r=Math.max(0,Math.min(4,t[0]));t[0]=ZD()+" Agora-SDK [".concat(rk(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!VD("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=$D()+" Agora-SDK [".concat(rk(e),"]:"):n[0]=$D()+" Agora-SDK [".concat(rk(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:DD,process_id:VD("PROCESS_ID"),payload:JSON.stringify(e)};return AD((async()=>{let e=await RP.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(VD("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(VD("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){let t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(t=>{let n={status:-1,message:t.message,errorRange:e.map((e=>e.log_item_id))};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),XD.reportLogUploadError(n),!0}),{timeout:VD("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:VD("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,VD("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),VD("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),VD("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),VD("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};function ak(e){return yL(e.reportId,"params.reportId",0,100,!1),yL(e.category,"params.category",0,100,!1),yL(e.event,"params.event",0,100,!1),yL(e.label,"params.label",0,100,!1),EL(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(ek={}).FREE="free",ek.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});var ok={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},sk=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),ck=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});var lk=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({}),dk=class e{constructor(){KD(this,"baseInfoMap",new Map),KD(this,"proxyServer",void 0),KD(this,"eventUploadTimer",void 0),KD(this,"setSessionIdTimer",void 0),KD(this,"url",void 0),KD(this,"backupUrl",void 0),KD(this,"_appId",void 0),KD(this,"keyEventUploadPendingItems",[]),KD(this,"normalEventUploadPendingItems",[]),KD(this,"apiInvokeUploadPendingItems",[]),KD(this,"apiInvokeCount",0),KD(this,"ltsList",[]),KD(this,"lastSendNormalEventTime",Date.now()),KD(this,"customReportCounterTimer",void 0),KD(this,"customReportCount",0),KD(this,"extApiInvoke",(async e=>{for(let t of e){let e=JD(JD({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:kL.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),VD("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),VD("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void ik.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));let t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,ik.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;let r=Date.now();this.apiInvokeCount+=1;let i=this.apiInvokeCount,a=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),o=!!VD("SHOW_REPORT_INVOKER_LOG");o&&ik.info("".concat(t.name," start"),t.options);let s=!1;dD(t.timeout).then((()=>{s||(this.sendApiInvoke(JD(JD({},a()),{},{error:fL.API_INVOKE_TIMEOUT,success:!1})),ik.debug("".concat(t.name," timeout")))}));let c=new mL(fL.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{let r=()=>{if(s)throw c;return s=!0,this.sendApiInvoke(JD(JD({},a()),{},{success:!0},t.reportResult&&{result:e})),o&&ik.info("".concat(t.name," onSuccess")),e};return n?mD(r,t.name+"Success",n,(()=>s=!0)):r()},onError:e=>{let r=()=>{if(s)throw e;s=!0,this.sendApiInvoke(JD(JD({},a()),{},{success:!1,error:e})),o&&ik.info("".concat(t.name," onFailure"),e.toString())};return n?mD(r,t.name+"Error",n,(()=>s=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;let i=Object.assign({},{willUploadConsoleLog:VD("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:kD?"global":"oversea",areas:VD("AREAS")&&VD("AREAS").join(",")},t.extend),{stringUid:a,channelProfile:o,channelMode:s,isABTestSuccess:c,lsid:l,clientRole:d}=t,u=Date.now(),h=JD(JD({},r),{},{eventType:sk.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:UD,lts:u,elapse:u-n,extend:JSON.stringify(i),mode:t.mode,process:VD("PROCESS_ID"),appType:VD("APP_TYPE"),success:!0,version:DD,stringUid:a,channelProfile:o,channelMode:s,isABTestSuccess:c,lsid:l,clientType:_h(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:d,serviceId:VD("PROCESS_ID"),extensionID:VD("PLUGIN_INFO").join(",")||""});var p;this.send({type:ck.SESSION,data:h},!0)}joinChooseServer(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD({},r),{},{eventType:sk.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:ck.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD({},r),{},{eventType:sk.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:ck.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;let i=Date.now(),{firstSuccess:a,avoidJoinStartTime:o}=t,s=i-(a&&o?o:n.startTime),c=JD(JD({},r),{},{eventType:sk.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:s,eventElapse:i-t.lts,firstSuccess:a,signalChannel:t.signalChannel,preload:t.preload?1:0});t.succ&&(n.lastJoinSuccessTime=i),this.send({type:ck.JOIN_GATEWAY,data:c},!0)}joinChannelTimeout(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=Date.now(),i=JD(JD({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:ck.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD({},r),{},{eventType:sk.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:ck.PUBLISH,data:a},!0)}subscribe(e,t,n){let r=this.baseInfoMap.get(e);if(!r)return;let i=r.info,a=Date.now(),o=JD(JD({},i),{},{eventType:sk.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?o.peerSuid=t.peerid:o.peer=t.peerid,this.send({type:ck.SUBSCRIBE,data:o},!0)}wsCompressorInit(e){var t;let n=[...Pb(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;let a=i.info,o=Date.now(),s=JD(JD({},a),{},{eventType:sk.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-i.startTime,status:e.status?1:2});this.send({type:ck.WS_COMPRESSOR_INIT,data:s},!0)}firstRemoteVideoDecode(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let a=i.info,o=Date.now(),s=JD(JD(JD({},a),r),{},{elapse:o-i.startTime,eventType:t,lts:o,firstDecodeFrame:Math.max((r.firstFrame||o)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}firstRemoteFrame(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let a=i.info,o=Date.now(),s=JD(JD(JD({},a),r),{},{elapse:o-i.startTime,eventType:t,lts:o});this.send({type:n,data:s},!0)}pcStats(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD(JD({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:sk.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:ck.PC_STATS,data:a},!0)}updateRemoteRTPCapabilities(e,t){if(e){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD(JD({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:sk.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:ck.UPDATE_REMOTE_RTPCAPABILITIES,data:a},!0)}}onGatewayStream(e,t,n,r){let i=this.baseInfoMap.get(e);if(!i)return;let a=i.info,o=Date.now(),s=JD(JD(JD({},a),r),{},{eventType:t,lts:o});this.send({type:n,data:s},!0)}streamSwitch(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD({},r),{},{eventType:sk.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:ck.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD({},r),{},{eventType:sk.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ck.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD({},r),{},{eventType:sk.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:ck.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(e){this.proxyServer=e,e?ik.debug("reportProxyServerurl: ".concat(e)):ik.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:ck.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now();(function(e,t){let n=e[t];if(!n||"string"!=typeof n)return[e];e[t]="";let r=sD(JSON.stringify(e)),i=0,a=[],o=0;for(let s=0;s<n.length;s++)o+=n.charCodeAt(s)<=127?1:3,o<=1300-r||(a[a.length]=pL(pL({},e),{},{[t]:n.substring(i,s)}),i=s,o=n.charCodeAt(s)<=127?1:3);return i!==n.length-1&&(a[a.length]=pL(pL({},e),{},{[t]:n.substring(i)})),a})(JD(JD(JD({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload").forEach((e=>this.send({type:ck.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD(JD({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:ck.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD(JD({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:ck.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,i=Date.now(),a=JD(JD(JD({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:ck.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>VD("CUSTOM_REPORT_LIMIT"))throw new mL(fL.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));let n=Date.now(),r=t.map((t=>({type:ck.USER_ANALYTICS,data:JD(JD({sid:e},t),{},{lts:n})})));try{VD("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(aa){throw ik.error("send custom report message failed",aa.toString()),new mL(fL.CUSTOM_REPORT_SEND_FAILED,aa.message)}}sendApiInvoke(e){let t=VD("NOT_REPORT_EVENT");if(e.tag&&_h(t)&&_h(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;let n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;let r,{cname:i,uid:a,cid:o}=n.info;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof mL){let{code:t,message:n}=e.error;r=t||n||e.error.toString()}else r=e.error.toString();let s={invokeId:e.invokeId,sid:e.sid,cname:i,cid:o,uid:a,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?r:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:ck.API_INVOKE,data:s},!1),!0}appendSessionId(){e.__CLIENT_LIST__.forEach((e=>{if(e._sessionId){let t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){let t=this.apiInvokeUploadPendingItems.shift();t&&(t.sid=e._sessionId,this.sendApiInvoke(Object.assign({},t)))}}}))}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>VD("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let n=[],r=[];for(;e.length;){let t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(let a of[...n]){var i;-1!==this.ltsList.indexOf(a.data.lts)?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),IT(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),VD("ENABLE_EVENT_REPORT")&&n.length&&(VD("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{VD("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>VD("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-VD("NORMAL_EVENT_QUEUE_CAPACITY")),ik.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){JL.networkState===WL.OFFLINE&&await hS.race([JL.onlineWaiter,dD(2*wD.maxRetryTimeout)]);let t=e=>{let t=new Uint8Array;return e.forEach((e=>{let n=AL(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(ck).forEach((n=>{let[r,i]=n;i===e.type&&(t=lk[r])})),t})(e),a=new DataView(r);a.setUint16(0,n.byteLength,!0),a.setUint8(2,255&i),a.setUint8(3,i>>>8&255),a.setUint8(4,i>>>16&255),t=IL(t,new Uint8Array(r)),t=IL(t,n)})),t},n="event",r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(VD("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(VD("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(VD("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(VD("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await OD(r,{timeout:1e4,data:t(e),headers:JD(JD({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(oa){if(1===i)throw oa;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:(e=>{let t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0])};JL.networkState===WL.OFFLINE&&await hS.race([JL.onlineWaiter,dD(2*wD.maxRetryTimeout)]);let r=t?"/events/proto-raws":"/events/messages",i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(VD("EVENT_REPORT_DOMAIN"),"&p=").concat(VD("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(VD("EVENT_REPORT_DOMAIN"),":").concat(VD("STATS_COLLECTOR_PORT")).concat(r));for(let a=0;a<2;a+=1){1===a&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(VD("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(VD("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(VD("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(VD("STATS_COLLECTOR_PORT")).concat(r)));try{t?await PD(i,{timeout:1e4,data:n}):await OD(i,{timeout:1e4,data:n})}catch(ia){if(1===a)throw ia;continue}return}}createBaseInfo(e,t){let n=Object.assign({},ok);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){let n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:kL.TRACER}).onSuccess()}};function uk(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){let i=r.value;if("function"==typeof i){let a=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];let s=r;if(e.argsMap)try{s=e.argsMap(this,...r)}catch(ca){ik.warning(ca),s=[]}try{JSON.stringify(s)}catch(l){ik.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),s=[]}let c=(e.report||hk).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(n)),options:s,tag:kL.TRACER,reportResult:e.reportResult},e.throttleTime);try{let t=i.apply(this,r);return t instanceof hS?t.then((t=>(c.onSuccess(e.reportResult&&t),t))).catch((e=>{throw c.onError(e),e})):(c.onSuccess(e.reportResult&&t),t)}catch(ca){throw c.onError(ca),ca}}}return r}}KD(dk,"__CLIENT_LIST__",[]);var hk=new dk;XD.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=JL.networkState,hk.reportApiInvoke(null,{name:"logUploadError",options:e,tag:kL.TRACER}).onSuccess("logUploadError")}));var pk=["CHINA","GLOBAL"],fk=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");let r=n.join(""),i=[];for(let s=0;s<6;s++)i.push("1");let a=i.join(""),o={};return o[e]=r,o[t]=a,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=fk,kD||(FD.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],FD.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],FD.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],FD.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],FD.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],FD.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],FD.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",FD.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",FD.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",FD.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",FD.AREAS=["NORTH_AMERICA","OVERSEA"]);var mk=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],_k=[];function gk(e,t){return!!t&&_k.some((n=>n.uid===e&&n.channelName===t))}dk.__CLIENT_LIST__=_k;var Ek=Bw.forEach,vk=wh("forEach")?[].forEach:function(e){return Ek(this,e,arguments.length>1?arguments[1]:void 0)};gu({target:"Array",proto:!0,forced:[].forEach!=vk},{forEach:vk});var yk=ju("Array").forEach,Sk=th,bk=Gl,Tk=tc,Ck=yk,wk=Array.prototype,Rk={DOMTokenList:!0,NodeList:!0},Ak=Ks((function(e){var t=e.forEach;return e===wk||Tk(wk,e)&&t===wk.forEach||bk(Rk,Sk(e))?Ck:t})),Ik=jl,Nk=Mp;gu({target:"Object",stat:!0,forced:Ys((function(){Nk(1)}))},{keys:function(e){return Nk(Ik(e))}});var Ok=Ks(Kc.Object.keys),Pk=Ks(Lh),Lk=gu,Dk=HC,kk=ec([].reverse),xk=[1,2];Lk({target:"Array",proto:!0,forced:String(xk)===String(xk.reverse())},{reverse:function(){return Dk(this)&&(this.length=this.length),kk(this)}});var Mk=ju("Array").reverse,Uk=tc,Fk=Mk,jk=Array.prototype,Vk=function(e){var t=e.reverse;return e===jk||Uk(jk,e)&&t===jk.reverse?Fk:t},Bk=Ks(Vk),Gk=gu,Wk=HC,Hk=gg,qk=zc,zk=Ru,Kk=Pu,Yk=Wc,Jk=Ub,Xk=nd,Qk=wg,Zk=tw("slice"),$k=Xk("species"),ex=Array,tx=Math.max;Gk({target:"Array",proto:!0,forced:!Zk},{slice:function(e,t){var n,r,i,a=Yk(this),o=Kk(a),s=zk(e,o),c=zk(void 0===t?o:t,o);if(Wk(a)&&(n=a.constructor,(Hk(n)&&(n===ex||Wk(n.prototype))||qk(n)&&null===(n=n[$k]))&&(n=void 0),n===ex||void 0===n))return Qk(a,s,c);for(r=new(void 0===n?ex:n)(tx(c-s,0)),i=0;s<c;s++,i++)s in a&&Jk(r,i,a[s]);return r.length=i,r}});var nx=ju("Array").slice,rx=tc,ix=nx,ax=Array.prototype,ox=Ks((function(e){var t=e.slice;return e===ax||rx(ax,e)&&t===ax.slice?ix:t}));function sx(e,t,n,r,i){var a,o,s,c={};return Ak(a=Ok(r)).call(a,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Pk(o=Bk(s=ox(n).call(n)).call(s)).call(o,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer&&(GC(e,t,c),c=null),c}var cx=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),lx=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),dx=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),ux=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),hx=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),px=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),fx=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),mx=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),_x=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),gx=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Ex=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),vx=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),yx=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Sx=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({}),bx=class extends mL{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),SI(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,ik)}throw(){super.throw(ik)}};function Tx(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw ik.error("Invalid Channel Name ".concat(e)),new bx(fL.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Cx(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295)&&!TL(e,1,255))throw new bx(fL.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&ik.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}var wx=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),Rx={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Ax={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Ix(e,t){yL(e.url,"".concat(t,".url"),1,1e3,!1),bL(e.x)||EL(e.x,"".concat(t,".x"),0,1e4),bL(e.y)||EL(e.y,"".concat(t,".y"),0,1e4),bL(e.width)||EL(e.width,"".concat(t,".width"),0,1e4),bL(e.height)||EL(e.height,"".concat(t,".height"),0,1e4),bL(e.zOrder)||EL(e.zOrder,"".concat(t,".zOrder"),0,255),bL(e.alpha)||EL(e.alpha,"".concat(t,".alpha"),0,1,!1)}var Nx={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Ox=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Px=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Lx=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Dx(e){if(!e.channelName)throw new bx(fL.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new bx(fL.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&yL(e.token,"info.token",1,2047),Cx(e.uid),Tx(e.channelName),!0}var kx=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),xx=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Mx=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Ux=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Fx=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),jx=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),Vx=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Bx=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Gx=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),Wx=[Gx.AFRICA,Gx.ASIA,Gx.CHINA,Gx.EUROPE,Gx.GLOBAL,Gx.INDIA,Gx.JAPAN,Gx.NORTH_AMERICA,Gx.OCEANIA,Gx.OVERSEA,Gx.SOUTH_AMERICA],Hx=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),qx={CHINA:{},ASIA:{CODE:Hx.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Hx.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Hx.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Hx.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Hx.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Hx.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Hx.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Hx.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Hx.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Hx.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Hx.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Hx.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Hx.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};kD&&(qx.CHINA={CODE:Hx.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});var zx=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({}),Kx=class extends OL{constructor(e,t){super(),SI(this,"onICEConnectionStateChange",void 0),SI(this,"onConnectionStateChange",void 0),SI(this,"onDTLSTransportStateChange",void 0),SI(this,"onDTLSTransportError",void 0),SI(this,"onICETransportStateChange",void 0),SI(this,"onFirstAudioReceived",void 0),SI(this,"onFirstVideoReceived",void 0),SI(this,"onFirstAudioDecoded",void 0),SI(this,"onFirstVideoDecoded",void 0),SI(this,"onFirstVideoDecodedTimeout",void 0),SI(this,"onSelectedLocalCandidateChanged",void 0),SI(this,"onSelectedRemoteCandidateChanged",void 0),SI(this,"getLocalVideoStats",void 0)}},Yx=class extends Kx{constructor(e,t){super(e,t),SI(this,"establishPromise",void 0)}},Jx=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Xx=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Qx=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),Zx=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),$x=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),eM=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),tM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),nM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),rM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),iM=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),aM=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),oM=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),sM=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),cM=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),lM=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),dM=function(e){return e.ABORT="abort",e}({}),uM=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),hM=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),pM={[dx.ACCESS_POINT]:{[px.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[px.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[px.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[px.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[px.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[px.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[px.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[px.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[px.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[px.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[px.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[px.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[px.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[px.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[px.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[px.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[px.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[px.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[dx.UNILBS]:{[hx.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[hx.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[hx.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[hx.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[hx.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[hx.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[hx.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[hx.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[hx.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[hx.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[hx.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[hx.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[dx.STRING_UID_ALLOCATOR]:{[ux.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[ux.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[ux.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function fM(e){let t=pM[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===dx.ACCESS_POINT){let t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}var mM={[fx.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[fx.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[fx.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[fx.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[fx.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[fx.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[fx.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[fx.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[fx.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[fx.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[fx.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[fx.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[fx.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[fx.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[fx.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[fx.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[fx.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[fx.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[fx.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[fx.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[fx.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[fx.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[fx.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[fx.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[fx.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[fx.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[fx.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[fx.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[fx.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[fx.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[fx.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[fx.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[fx.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[fx.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[fx.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[fx.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[fx.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[fx.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[fx.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[fx.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[fx.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[fx.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[fx.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[fx.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[fx.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[fx.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[fx.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[fx.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[fx.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[fx.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[fx.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[fx.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[fx.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[fx.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[fx.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[fx.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[fx.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[fx.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[fx.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[fx.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[fx.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[fx.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[fx.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function _M(e){return mM[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function gM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function EM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gM(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vM(e){return e.every((e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))}function yM(e,t){if("string"==typeof e)return e;let{proxy:n,host:r,port:i}=e;if(t){let e=VD("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}var SM=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,bM=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,TM=/wss:\/\/(.+):([0-9]+)\/?/,CM=/wss:\/\/(.[^\/]+)\/?/,wM=0,RM=class{constructor(e,t){SI(this,"id",0),SI(this,"store",void 0),SI(this,"recordIndex",void 0),SI(this,"websockets",[]),SI(this,"try443PortDuration",2e3),SI(this,"forceCloseWSDuration",5e3),SI(this,"try443PortTimeout",null),SI(this,"forceCloseTimeout",null),SI(this,"isTry443PortFailed",!1),SI(this,"isNormalPortFailed",!1),SI(this,"useDoubleDomain",!1),SI(this,"useProxy",!1),SI(this,"startTime",Date.now()),this.id=++wM,this.try443PortDuration=VD("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach((e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;let t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];ik.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});let r=VD("GATEWAY_DOMAINS"),i=Date.now(),a=[],o=r.find((t=>{var n;return _h(n=e.host).call(n,t)}));o||(this.useDoubleDomain=!1);let s=[];if(this.useDoubleDomain)r.forEach((n=>{s.push(yM(EM(EM({},e),{},{host:e.host.replace(o,n)}),t))}));else{let n=EM({},e);if(t&&o){let e=r.find((e=>e!==o));e&&(n.host=n.host.replace(o,e))}s.push(yM(n,t))}try{s.forEach((e=>{let t=new WebSocket(e);t.binaryType="arraybuffer",a.push(t),this.logger("ws is connecting:",t.url)}))}catch(da){if(this.logger("ws create failed"),a.forEach((e=>e.close())),a.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new bx(fL.WS_ERR,"init websocket failed! Error: ".concat(da.toString()))}let c=IP();return this.store&&this.store.recordJoinChannelService({urls:a.map((e=>e.url)),service:"gateway"},this.recordIndex),a.forEach((e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach((t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))})),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState)),t?this.isTry443PortFailed=vM(a):this.isNormalPortFailed=vM(a),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:Vx.A_ROUND_WS_FAILED}))},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))})),this.websockets.push(...a),n||(()=>{let n=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.websockets.forEach((e=>e.readyState!==WebSocket.OPEN&&e.close()))};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{if(this.logger("2s timeout, isWebsocket created: ",c.isResolved),c.isResolved)return n();UP().os===LP.MAC_OS&&qP()&&n(),this.createWebSocket(e,!0,!0).then((e=>c.resolve(e))).catch((e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration)}),this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(SM)||[],t||([,n,r]=e.match(bM)||[]),n&&r||([,n,r]=e.match(TM)||[]),n&&r||([,n]=e.match(CM)||[]),n||ik.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(ik.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((()=>this.clearTimeout()))}};function AM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var IM=class extends OL{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;_h(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Sx.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Sx.CONNECTED):"closed"===this._state?this.emit(Sx.CLOSED):"failed"===this._state&&this.emit(Sx.FAILED))}resetReconnectCount(e){ik.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;super(),SI(this,"connectionID",0),SI(this,"currentURLIndex",0),SI(this,"urls",[]),SI(this,"_reconnectMode","tryNext"),SI(this,"reconnectReason",void 0),SI(this,"_initMutex",new TD("websocket")),SI(this,"name",void 0),SI(this,"_state","closed"),SI(this,"reconnectInterrupter",void 0),SI(this,"websocket",void 0),SI(this,"retryConfig",void 0),SI(this,"reconnectCount",0),SI(this,"forceCloseTimeout",5e3),SI(this,"onlineReconnectListener",void 0),SI(this,"useCompress",void 0),SI(this,"tryDoubleDomain",!1),SI(this,"use443PortOnly",!1),SI(this,"wsInflateLength",0),SI(this,"wsDeflateLength",0),SI(this,"closeEstablishingWs",(()=>{})),SI(this,"store",void 0),SI(this,"joinGatewayRecordIndex",void 0),this.store=a,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AM(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i;let{timeout:o,timeoutFactor:s}=t,c=Math.max(300,Math.floor(3*o/5)),l=Math.max(1.2,Math.floor(8*s)/10);WL.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),JL.on(HL.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===WL.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=o,this.retryConfig.timeoutFactor=s))}))}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{let e=IP(),t=this.urls[this.currentURLIndex];VD("ENABLE_PREALLOC_PC")&&this.emit(iM.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(Sx.CLOSED,(()=>{e.reject(new mL(fL.WS_DISCONNECT))})),this.once(Sx.CONNECTED,e.resolve),await e.promise}catch(r){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void ik.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),ik.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);let n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new mL(fL.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(yi){throw new mL(fL.WS_ERR,"send websocket message error"+yi.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;let n=IP();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),ik.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(ik.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new mL(fL.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");let t=KL(this,Sx.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void ik.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new mL(fL.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},a=e=>{this.emit(Sx.ON_MESSAGE,e)},o=e=>{ik.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),VD("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=VD("GATEWAY_WSS_ADDRESS")),ik.debug("[".concat(this.name,"] start connect, url:"),e);let s=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;let t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=a,this.websocket.onerror=o,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this.joinGatewayRecordIndex=s}catch(da){let t="closed"===this.state,r=da instanceof mL,a=r&&da.code===fL.WS_ABORT,o=r&&da.code===fL.WS_ERR,c=r?da.message:da&&(da.reason||da.toString());ik.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:a?"aborted":"error",errors:[da]},s),t||o?(n.reject(t?new mL(fL.WS_DISCONNECT,"websocket is closed: ".concat(c)):new mL(fL.WS_ERR,"init websocket failed: ".concat(c))),o&&ik.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(da)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||0===this.urls.length||"closed"===this.state)return!1;ik.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||JL.isOnline||!JL.onlineWaiter||(this.onlineReconnectListener=JL.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){let t=RD(this.reconnectCount,this.retryConfig);ik.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await hS.race([dD(t),this.onlineReconnectListener||new hS((()=>{}))])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;let r=async(e,t)=>{this.emit(Sx.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)this.emit(Sx.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);ik.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Sx.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(ik.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Sx.RECONNECT_WAITTING_FINISH,e),this.urls=await qL(this,Sx.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(oa){var i;ik.error("[".concat(this.name,"] reconnect failed ").concat(oa&&oa.toString()));let r=null==oa||null===(i=oa.data)||void 0===i?void 0:i.desc;return Array.isArray(r)&&_h(r).call(r,"dynamic key expired")?(this.emit(Sx.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}},NM=class extends IM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){let n=IP(),r=function(e,t){return new RM(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{ik.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new mL(fL.WS_ABORT,"choose best websocket aborted"))};let i=VD("GATEWAY_DOMAINS");return ik.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally((()=>{this.closeEstablishingWs=void 0}))}},OM=class extends IM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new hS(((n,r)=>{let i=!1,a=[];this.closeEstablishingWs=()=>{ik.debug("[choose-best-ws] close establishing websockets"),a.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),r(new mL(fL.WS_ABORT,"choose best websocket aborted"))};let o,s=VD("GATEWAY_DOMAINS"),c=e.indexOf("?h="),l=s.find((t=>-1!==c?_h(e).call(e,t,c):_h(e).call(e,t)));ik.debug("[choose-best-ws] currentDomain: ",l,", domains: ",s);let d=!this.tryDoubleDomain||!l;if(!d&&l){var u;let h=Date.now();try{s.forEach((t=>{let n=-1===c?e.replace(l,t):e.substr(0,c)+e.substr(c).replace(l,t),r=new WebSocket(n);r.binaryType="arraybuffer",a.push(r),ik.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(p){for(ik.debug("[choose-best-ws] ws create failed, fallback to single url"),a.forEach((e=>e.close()));a.length;)a.pop();d=!0}null===(u=this.store)||void 0===u||u.recordJoinChannelService({urls:a.map((e=>e.url)),service:"gateway"},t),a.forEach((e=>{e.onopen=()=>{if(i)return;let t=Date.now()-h;ik.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),a.filter((t=>t!==e)).forEach((e=>{ik.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),i=!0,n(e)},e.onclose=e=>{o=e,!i&&(a.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(ik.debug("[choose-best-ws] all websocket is closed"),i=!0,r(o)))},e.onmessage=t=>{ik.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),dD(this.forceCloseTimeout).then((()=>{a.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(d){var h;let i;ik.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),a.push(i),i.binaryType="arraybuffer"}catch(xa){let t=new mL(fL.WS_ERR,"init websocket failed! Error: ".concat(xa.toString()));return ik.error("[".concat(this.name,"]").concat(t)),void r(t)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{ik.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},dD(this.forceCloseTimeout).then((()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}},PM=class extends OL{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===mx.CONNECTED?this.emit(_x.WS_CONNECTED):e===mx.RECONNECTING?this.emit(_x.WS_RECONNECTING,this._websocketReconnectReason):e===mx.CLOSED&&this.emit(_x.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),SI(this,"_disconnectedReason",void 0),SI(this,"_websocketReconnectReason",void 0),SI(this,"_connectionState",mx.CLOSED),SI(this,"reconnectToken",void 0),SI(this,"websocket",void 0),SI(this,"openConnectionTime",void 0),SI(this,"clientId",void 0),SI(this,"lastMsgTime",Date.now()),SI(this,"uploadCache",[]),SI(this,"uploadCacheInterval",void 0),SI(this,"rttRolling",new ND(5)),SI(this,"pingpongTimer",void 0),SI(this,"wsInflateDataTimer",void 0),SI(this,"pingpongTimeoutCount",0),SI(this,"joinResponse",void 0),SI(this,"multiIpOption",void 0),SI(this,"initError",void 0),SI(this,"spec",void 0),SI(this,"store",void 0),SI(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(_x.ON_BINARY_DATA,e.data);let t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){let e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===vx.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===vx.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(UL.UID_BANNED);break;case 15:this.close(UL.IP_BANNED);break;case 16:this.close(UL.CHANNEL_BANNED)}if(t._type===vx.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case fx.ERR_LICENSE_MISSING:this.close(UL.LICENSE_MISSING);break;case fx.ERR_LICENSE_EXPIRED:this.close(UL.LICENSE_EXPIRED);break;case fx.ERR_LICENSE_MINUTES_EXCEEDED:this.close(UL.LICENSE_MINUTES_EXCEEDED);break;case fx.ERR_LICENSE_PERIOD_INVALID:this.close(UL.LICENSE_PERIOD_INVALID);break;case fx.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(UL.LICENSE_MULTIPLE_SDK_SERVICE);break;case fx.ERR_LICENSE_ILLEGAL:this.close(UL.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new NM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,VD("JOIN_GATEWAY_USE_DUAL_DOMAIN"),VD("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===mx.CONNECTED&&this.reconnect("retry",GL.OFFLINE)}))}async request(e,t,n,r){let i=uD(6,""),a={_id:i,_type:e,_message:t},o=this.websocket.connectionID,s=()=>new hS(((t,n)=>{if(this.connectionState===mx.CONNECTED)return t();let r=()=>{this.off(_x.WS_CLOSED,i),t()},i=()=>{this.off(_x.WS_CONNECTED,r),n(new bx(fL.WS_ABORT))};this.once(_x.WS_CONNECTED,r),this.once(_x.WS_CLOSED,i),e!==gx.PUBLISH&&e!==gx.PUBLISH_DATASTREAM&&e!==gx.SUBSCRIBE&&e!==gx.SUBSCRIBE_DATASTREAM&&e!==gx.UNSUBSCRIBE&&e!==gx.UNSUBSCRIBE_DATASTREAM&&e!==gx.UNPUBLISH&&e!==gx.UNPUBLISH_DATASTREAM&&e!==gx.CONTROL&&e!==gx.RESTART_ICE||this.once(_x.DISCONNECT_P2P,(()=>{n(new bx(fL.DISCONNECT_P2P))})),e!==gx.PUBLISH&&e!==gx.RESTART_ICE||this.once(_x.ABORT_P2P_EXECUTION,(()=>{n(new bx(fL.DISCONNECT_P2P))}))}));if(this.connectionState!==mx.CONNECTING&&this.connectionState!==mx.RECONNECTING||e===gx.JOIN||e===gx.REJOIN||await s(),this.websocket.sendMessage(a,!0),r)return;let c=new hS(((n,r)=>{let a=!1,s=(r,i)=>{a=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(_x.WS_CLOSED,c),this.off(_x.WS_RECONNECTING,c),this.emit(_x.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);let c=()=>{r(new bx(fL.WS_ABORT,"type: ".concat(e))),this.off(_x.WS_CLOSED,c),this.off(_x.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(_x.WS_CLOSED,c),this.once(_x.WS_RECONNECTING,c),dD(VD("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==o||a||(ik.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(_x.REQUEST_TIMEOUT,e,t))}))})),l=null;try{l=await c}catch(fa){if(this.connectionState===mx.CLOSED||e===gx.LEAVE)throw new bx(fL.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?fa.throw():e===gx.JOIN||e===gx.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;let d=Number(l.message.error_code||l.message.code),u=_M(d),h=new bx(fL.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(ik.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===fx.ERR_TOO_MANY_BROADCASTERS?((e===gx.JOIN||e===gx.REJOIN)&&(this.initError=h,this.close()),h.throw()):"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===fx.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,ik.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",GL.MULTI_IP)):this.reconnect(u.action,GL.SERVER_ERROR),e===gx.JOIN||e===gx.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new hS((n=>{let r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void ik.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ex.WRTC_STATS,t)}upload(e,t){let n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(r){let e=VD("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==mx.CONNECTED)return;let e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),VD("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new hS(((t,n)=>{this.once(_x.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(_x.WS_CLOSED,(()=>n(this.initError||new bx(fL.WS_ABORT)))),this.connectionState=mx.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||UL.LEAVE,this.connectionState=mx.CLOSED,ik.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(_x.ABORT_P2P_EXECUTION);let e=await qL(this,_x.REQUEST_JOIN_INFO),t=await this.request(gx.JOIN,e);if(!t)return this.emit(_x.REPORT_JOIN_GATEWAY,Vx.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(_x.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=mx.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new bx(fL.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=YL(this,_x.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(gx.REJOIN,e);return!!t&&(this.connectionState=mx.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(vx.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(vx.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(vx.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(vx.MUTE_AUDIO,{uid:e.uid}):this.emit(vx.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(vx.MUTE_VIDEO,{uid:e.uid}):this.emit(vx.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(vx.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(vx.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(vx.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(vx.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(vx.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){ik.debug("[".concat(this.clientId,"] receive notification: "),e);let t=_M(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(UL.UID_BANNED),void this.close()):void this.reconnect(t.action,GL.SERVER_ERROR);ik.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=VD("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(ik.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>VD("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",GL.TIMEOUT):this.request(gx.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;let e=Date.now()-t;this.rttRolling.add(e),VD("REPORT_STATS")&&this.send(gx.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(Ex.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Sx.RECONNECT_WAITTING_FINISH,(e=>{this.emit(_x.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(Sx.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(_x.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(Sx.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Sx.CLOSED,(()=>{this.connectionState=mx.CLOSED})),this.websocket.on(Sx.FAILED,(()=>{this._disconnectedReason=UL.NETWORK_ERROR,this.connectionState=mx.CLOSED})),this.websocket.on(Sx.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===mx.CONNECTED?this.connectionState=mx.RECONNECTING:this.connectionState=mx.CONNECTING})),this.websocket.on(Sx.WILL_RECONNECT,((e,t,n)=>{let r=YL(this,_x.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(ik.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=Vx.P2P_DISCONNECTED),i&&(ik.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(_x.REPORT_JOIN_GATEWAY,t||Vx.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(_x.DISCONNECT_P2P)),n(e)})),this.websocket.on(Sx.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{ik.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",GL.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(_x.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof bx){if(e.code===fL.UNEXPECTED_RESPONSE&&e.data.code===fx.ERR_NO_AUTHORIZED)return this.initError=new bx(fL.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),ik.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",GL.SERVER_ERROR);ik.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",GL.SERVER_ERROR):(this.initError=e,this.close())}}))})),this.websocket.on(Sx.REQUEST_NEW_URLS,((e,t)=>{qL(this,_x.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(Sx.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(vx.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(iM.PRE_CONNECT_PC,(()=>{this.emit(_x.PRE_CONNECT_PC)}))}},LM=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function DM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DM(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DM(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xM(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(VD("TURN_DOMAIN")):(ik.info("Unidentified as ip: ".concat(e,", use as host")),e)}function MM(e,t){e.addresses||(e.addresses=[]);let n=function(e,t){if(VD("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map((e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}}));let n=VD("GATEWAY_DOMAINS"),r=n[1]&&_h(t).call(t,n[1])?1:0;return e.map((e=>{let{domain_prefix:t,port:i,ip:a}=e;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};let o=/^[\.\:\d]+$/.test(a),s=o?"".concat(a.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(a,":").concat(i);return o||ik.info("Unidentified as ip: ".concat(a,", use as host")),{ip:a,port:i,address:s}}))}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r){let e=r.split(";");for(let t=0;t<e.length;t++){var i;let r=db(i=e[t]).call(i);n[t]&&r&&(n[t].ip6=r)}}let a,o=e.detail&&e.detail.candidate;if(o){let[e,t]=o.split(":");e&&t&&(a={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:n,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function UM(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function FM(e){let t=e._encoderConfig;if(!t)return{};let n={resolution:t.width&&t.height?"".concat(UM(t.width),"x").concat(UM(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function jM(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function VM(e,t){let n,r,i;switch(t){case LM.CHOOSE_SERVER:r=4096,i="choose server";break;case LM.CLOUD_PROXY:r=1048576,i="proxy";break;case LM.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case LM.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new bx(fL.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>kM(kM({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:kM(kM({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new bx(fL.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function BM(e,t){return await hS.all(e.addresses.map((async e=>({address:xM(e.ip),tcpport:e.port,udpport:e.port,username:t&&VD("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():fk.username,password:t&&VD("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await NL(t.toString()):fk.password}))))}function GM(e,t){let n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(UM(e.height),UM(e.width)),1):(ik.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function WM(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:a,protocol:o}=e;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:o}:{candidateType:t,relayProtocol:n,address:i,port:a,protocol:o}}var HM,qM=Ks(Vk),zM=ju("Array").values,KM=th,YM=Gl,JM=tc,XM=zM,QM=Array.prototype,ZM={DOMTokenList:!0,NodeList:!0},$M=Ks((function(e){var t=e.values;return e===QM||JM(QM,e)&&t===QM.values||YM(ZM,KM(e))?XM:t})),eU=Sc,tU=ec,nU=Cc,rU=Ys,iU=Mp,aU=bp,oU=wc,sU=jl,cU=Mc,lU=Object.assign,dU=Object.defineProperty,uU=tU([].concat),hU=!lU||rU((function(){if(eU&&1!==lU({b:1},lU(dU({},"a",{enumerable:!0,get:function(){dU(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=lU({},e)[n]||iU(lU({},t)).join("")!=r}))?function(e,t){for(var n=sU(e),r=arguments.length,i=1,a=aU.f,o=oU.f;r>i;)for(var s,c=cU(arguments[i++]),l=a?uU(iU(c),a(c)):iU(c),d=l.length,u=0;d>u;)s=l[u++],eU&&!nU(o,c,s)||(n[s]=c[s]);return n}:lU,pU=qd,fU=jf,mU=jd,_U=Cc,gU=jl,EU=function(e,t,n,r){try{return r?t(pU(n)[0],n[1]):t(n)}catch(i){fU(e,"throw",i)}},vU=bf,yU=gg,SU=Pu,bU=Ub,TU=xf,CU=If,wU=Array,RU=ec,AU=2147483647,IU=/[^\0-\u007E]/,NU=/[.\u3002\uFF0E\uFF61]/g,OU="Overflow: input needs wider integers to process",PU=RangeError,LU=RU(NU.exec),DU=Math.floor,kU=String.fromCharCode,xU=RU("".charCodeAt),MU=RU([].join),UU=RU([].push),FU=RU("".replace),jU=RU("".split),VU=RU("".toLowerCase),BU=function(e){return e+22+75*(e<26)},GU=function(e,t,n){var r=0;for(e=n?DU(e/700):e>>1,e+=DU(e/t);e>455;)e=DU(e/35),r+=36;return DU(r+36*e/(e+38))},WU=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=xU(e,n++);if(i>=55296&&i<=56319&&n<r){var a=xU(e,n++);56320==(64512&a)?UU(t,((1023&i)<<10)+(1023&a)+65536):(UU(t,i),n--)}else UU(t,i)}return t}(e);var n,r,i=e.length,a=128,o=0,s=72;for(n=0;n<e.length;n++)(r=e[n])<128&&UU(t,kU(r));var c=t.length,l=c;for(c&&UU(t,"-");l<i;){var d=AU;for(n=0;n<e.length;n++)(r=e[n])>=a&&r<d&&(d=r);var u=l+1;if(d-a>DU((AU-o)/u))throw PU(OU);for(o+=(d-a)*u,a=d,n=0;n<e.length;n++){if((r=e[n])<a&&++o>AU)throw PU(OU);if(r==a){for(var h=o,p=36;;){var f=p<=s?1:p>=s+26?26:p-s;if(h<f)break;var m=h-f,_=36-f;UU(t,kU(BU(f+m%_))),h=DU(m/_),p+=36}UU(t,kU(BU(h))),s=GU(o,u,l==c),o=0,l++}}o++,a++}return MU(t,"")},HU=gu,qU=Sc,zU=CI,KU=rc,YU=jd,JU=ec,XU=Hm,QU=G_,ZU=J_,$U=Gl,eF=hU,tF=function(e){var t=gU(e),n=yU(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=mU(i,r>2?arguments[2]:void 0));var o,s,c,l,d,u,h=CU(t),p=0;if(!h||this===wU&&vU(h))for(o=SU(t),s=n?new this(o):wU(o);o>p;p++)u=a?i(t[p],p):t[p],bU(s,p,u);else for(d=(l=TU(t,h)).next,s=n?new this:[];!(c=_U(d,l)).done;p++)u=a?EU(l,i,[c.value,p],!0):c.value,bU(s,p,u);return s.length=p,s},nF=Wb,rF=Ky.codeAt,iF=ih,aF=l_,oF=Ag,sF=VN,cF=Mm,lF=cF.set,dF=cF.getterFor("URL"),uF=sF.URLSearchParams,hF=sF.getState,pF=KU.URL,fF=KU.TypeError,mF=KU.parseInt,_F=Math.floor,gF=Math.pow,EF=JU("".charAt),vF=JU(/./.exec),yF=JU([].join),SF=JU(1..toString),bF=JU([].pop),TF=JU([].push),CF=JU("".replace),wF=JU([].shift),RF=JU("".split),AF=JU("".slice),IF=JU("".toLowerCase),NF=JU([].unshift),OF="Invalid scheme",PF="Invalid host",LF="Invalid port",DF=/[a-z]/i,kF=/[\d+-.a-z]/i,xF=/\d/,MF=/^0x/i,UF=/^[0-7]+$/,FF=/^\d+$/,jF=/^[\da-f]+$/i,VF=/[\0\t\n\r #%/:<>?@[\\\]^|]/,BF=/[\0\t\n\r #/:<>?@[\\\]^|]/,GF=/^[\u0000-\u0020]+/,WF=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,HF=/[\t\n\r]/g,qF=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)NF(t,e%256),e=_F(e/256);return yF(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=SF(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},zF={},KF=eF({},zF,{" ":1,'"':1,"<":1,">":1,"`":1}),YF=eF({},KF,{"#":1,"?":1,"{":1,"}":1}),JF=eF({},YF,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),XF=function(e,t){var n=rF(e,0);return n>32&&n<127&&!$U(t,e)?e:encodeURIComponent(e)},QF={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ZF=function(e,t){var n;return 2==e.length&&vF(DF,EF(e,0))&&(":"==(n=EF(e,1))||!t&&"|"==n)},$F=function(e){var t;return e.length>1&&ZF(AF(e,0,2))&&(2==e.length||"/"===(t=EF(e,2))||"\\"===t||"?"===t||"#"===t)},ej=function(e){return"."===e||"%2e"===IF(e)},tj={},nj={},rj={},ij={},aj={},oj={},sj={},cj={},lj={},dj={},uj={},hj={},pj={},fj={},mj={},_j={},gj={},Ej={},vj={},yj={},Sj={},bj=function(e,t,n){var r,i,a,o=iF(e);if(t){if(i=this.parse(o))throw fF(i);this.searchParams=null}else{if(void 0!==n&&(r=new bj(n,!0)),i=this.parse(o,null,r))throw fF(i);(a=hF(new uF)).bindURL(this),this.searchParams=a}};bj.prototype={type:"URL",parse:function(e,t,n){var r,i,a,o,s,c=this,l=t||tj,d=0,u="",h=!1,p=!1,f=!1;for(e=iF(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=CF(e,GF,""),e=CF(e,WF,"$1")),e=CF(e,HF,""),r=tF(e);d<=r.length;){switch(i=r[d],l){case tj:if(!i||!vF(DF,i)){if(t)return OF;l=rj;continue}u+=IF(i),l=nj;break;case nj:if(i&&(vF(kF,i)||"+"==i||"-"==i||"."==i))u+=IF(i);else{if(":"!=i){if(t)return OF;u="",l=rj,d=0;continue}if(t&&(c.isSpecial()!=$U(QF,u)||"file"==u&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&QF[c.scheme]==c.port&&(c.port=null));u="","file"==c.scheme?l=fj:c.isSpecial()&&n&&n.scheme==c.scheme?l=ij:c.isSpecial()?l=cj:"/"==r[d+1]?(l=aj,d++):(c.cannotBeABaseURL=!0,TF(c.path,""),l=vj)}break;case rj:if(!n||n.cannotBeABaseURL&&"#"!=i)return OF;if(n.cannotBeABaseURL&&"#"==i){c.scheme=n.scheme,c.path=nF(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,l=Sj;break}l="file"==n.scheme?fj:oj;continue;case ij:if("/"!=i||"/"!=r[d+1]){l=oj;continue}l=lj,d++;break;case aj:if("/"==i){l=dj;break}l=Ej;continue;case oj:if(c.scheme=n.scheme,i==HM)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=nF(n.path),c.query=n.query;else if("/"==i||"\\"==i&&c.isSpecial())l=sj;else if("?"==i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=nF(n.path),c.query="",l=yj;else{if("#"!=i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=nF(n.path),c.path.length--,l=Ej;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=nF(n.path),c.query=n.query,c.fragment="",l=Sj}break;case sj:if(!c.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,l=Ej;continue}l=dj}else l=lj;break;case cj:if(l=lj,"/"!=i||"/"!=EF(u,d+1))continue;d++;break;case lj:if("/"!=i&&"\\"!=i){l=dj;continue}break;case dj:if("@"==i){h&&(u="%40"+u),h=!0,a=tF(u);for(var m=0;m<a.length;m++){var _=a[m];if(":"!=_||f){var g=XF(_,JF);f?c.password+=g:c.username+=g}else f=!0}u=""}else if(i==HM||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(h&&""==u)return"Invalid authority";d-=tF(u).length+1,u="",l=uj}else u+=i;break;case uj:case hj:if(t&&"file"==c.scheme){l=_j;continue}if(":"!=i||p){if(i==HM||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(c.isSpecial()&&""==u)return PF;if(t&&""==u&&(c.includesCredentials()||null!==c.port))return;if(o=c.parseHost(u))return o;if(u="",l=gj,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),u+=i}else{if(""==u)return PF;if(o=c.parseHost(u))return o;if(u="",l=pj,t==hj)return}break;case pj:if(!vF(xF,i)){if(i==HM||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()||t){if(""!=u){var E=mF(u,10);if(E>65535)return LF;c.port=c.isSpecial()&&E===QF[c.scheme]?null:E,u=""}if(t)return;l=gj;continue}return LF}u+=i;break;case fj:if(c.scheme="file","/"==i||"\\"==i)l=mj;else{if(!n||"file"!=n.scheme){l=Ej;continue}if(i==HM)c.host=n.host,c.path=nF(n.path),c.query=n.query;else if("?"==i)c.host=n.host,c.path=nF(n.path),c.query="",l=yj;else{if("#"!=i){$F(yF(nF(r,d),""))||(c.host=n.host,c.path=nF(n.path),c.shortenPath()),l=Ej;continue}c.host=n.host,c.path=nF(n.path),c.query=n.query,c.fragment="",l=Sj}}break;case mj:if("/"==i||"\\"==i){l=_j;break}n&&"file"==n.scheme&&!$F(yF(nF(r,d),""))&&(ZF(n.path[0],!0)?TF(c.path,n.path[0]):c.host=n.host),l=Ej;continue;case _j:if(i==HM||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&ZF(u))l=Ej;else if(""==u){if(c.host="",t)return;l=gj}else{if(o=c.parseHost(u))return o;if("localhost"==c.host&&(c.host=""),t)return;u="",l=gj}continue}u+=i;break;case gj:if(c.isSpecial()){if(l=Ej,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=HM&&(l=Ej,"/"!=i))continue}else c.fragment="",l=Sj;else c.query="",l=yj;break;case Ej:if(i==HM||"/"==i||"\\"==i&&c.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=IF(s=u))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"==i||"\\"==i&&c.isSpecial()||TF(c.path,"")):ej(u)?"/"==i||"\\"==i&&c.isSpecial()||TF(c.path,""):("file"==c.scheme&&!c.path.length&&ZF(u)&&(c.host&&(c.host=""),u=EF(u,0)+":"),TF(c.path,u)),u="","file"==c.scheme&&(i==HM||"?"==i||"#"==i))for(;c.path.length>1&&""===c.path[0];)wF(c.path);"?"==i?(c.query="",l=yj):"#"==i&&(c.fragment="",l=Sj)}else u+=XF(i,YF);break;case vj:"?"==i?(c.query="",l=yj):"#"==i?(c.fragment="",l=Sj):i!=HM&&(c.path[0]+=XF(i,zF));break;case yj:t||"#"!=i?i!=HM&&("'"==i&&c.isSpecial()?c.query+="%27":c.query+="#"==i?"%23":XF(i,zF)):(c.fragment="",l=Sj);break;case Sj:i!=HM&&(c.fragment+=XF(i,KF))}d++}},parseHost:function(e){var t,n,r;if("["==EF(e,0)){if("]"!=EF(e,e.length-1)||(t=function(e){var t,n,r,i,a,o,s,c=[0,0,0,0,0,0,0,0],l=0,d=null,u=0,h=function(){return EF(e,u)};if(":"==h()){if(":"!=EF(e,1))return;u+=2,d=++l}for(;h();){if(8==l)return;if(":"!=h()){for(t=n=0;n<4&&vF(jF,h());)t=16*t+mF(h(),16),u++,n++;if("."==h()){if(0==n||(u-=n,l>6))return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;u++}if(!vF(xF,h()))return;for(;vF(xF,h());){if(a=mF(h(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;u++}c[l]=256*c[l]+i,2!=++r&&4!=r||l++}if(4!=r)return;break}if(":"==h()){if(u++,!h())return}else if(h())return;c[l++]=t}else{if(null!==d)return;u++,d=++l}}if(null!==d)for(o=l-d,l=7;0!=l&&o>0;)s=c[l],c[l--]=c[d+o-1],c[d+--o]=s;else if(8!=l)return;return c}(AF(e,1,-1)),!t))return PF;this.host=t}else if(this.isSpecial()){if(e=function(e){var t,n,r=[],i=jU(FU(VU(e),NU,"."),".");for(t=0;t<i.length;t++)n=i[t],UU(r,LU(IU,n)?"xn--"+WU(n):n);return MU(r,".")}(e),vF(VF,e)||(t=function(e){var t,n,r,i,a,o,s,c=RF(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=c[r]))return e;if(a=10,i.length>1&&"0"==EF(i,0)&&(a=vF(MF,i)?16:8,i=AF(i,8==a?1:2)),""===i)o=0;else{if(!vF(10==a?FF:8==a?UF:jF,i))return e;o=mF(i,a)}TF(n,o)}for(r=0;r<t;r++)if(o=n[r],r==t-1){if(o>=gF(256,5-t))return null}else if(o>255)return null;for(s=bF(n),r=0;r<n.length;r++)s+=n[r]*gF(256,3-r);return s}(e),null===t))return PF;this.host=t}else{if(vF(BF,e))return PF;for(t="",n=tF(e),r=0;r<n.length;r++)t+=XF(n[r],zF);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return $U(QF,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&ZF(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,o=e.path,s=e.query,c=e.fragment,l=t+":";return null!==i?(l+="//",e.includesCredentials()&&(l+=n+(r?":"+r:"")+"@"),l+=qF(i),null!==a&&(l+=":"+a)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?o[0]:o.length?"/"+yF(o,"/"):"",null!==s&&(l+="?"+s),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw fF(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new wj(e.path[0]).origin}catch(n){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+qF(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(iF(e)+":",tj)},getUsername:function(){return this.username},setUsername:function(e){var t=tF(iF(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=XF(t[n],JF)}},getPassword:function(){return this.password},setPassword:function(e){var t=tF(iF(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=XF(t[n],JF)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?qF(e):qF(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,uj)},getHostname:function(){var e=this.host;return null===e?"":qF(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,hj)},getPort:function(){var e=this.port;return null===e?"":iF(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=iF(e))?this.port=null:this.parse(e,pj))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+yF(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,gj))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=iF(e))?this.query=null:("?"==EF(e,0)&&(e=AF(e,1)),this.query="",this.parse(e,yj)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=iF(e))?("#"==EF(e,0)&&(e=AF(e,1)),this.fragment="",this.parse(e,Sj)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Tj,Cj,wj=function(e){var t=ZU(this,Rj),n=oF(arguments.length,1)>1?arguments[1]:void 0,r=lF(t,new bj(e,!1,n));qU||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Rj=wj.prototype,Aj=function(e,t){return{get:function(){return dF(this)[e]()},set:t&&function(e){return dF(this)[t](e)},configurable:!0,enumerable:!0}};qU&&(QU(Rj,"href",Aj("serialize","setHref")),QU(Rj,"origin",Aj("getOrigin")),QU(Rj,"protocol",Aj("getProtocol","setProtocol")),QU(Rj,"username",Aj("getUsername","setUsername")),QU(Rj,"password",Aj("getPassword","setPassword")),QU(Rj,"host",Aj("getHost","setHost")),QU(Rj,"hostname",Aj("getHostname","setHostname")),QU(Rj,"port",Aj("getPort","setPort")),QU(Rj,"pathname",Aj("getPathname","setPathname")),QU(Rj,"search",Aj("getSearch","setSearch")),QU(Rj,"searchParams",Aj("getSearchParams")),QU(Rj,"hash",Aj("getHash","setHash"))),XU(Rj,"toJSON",(function(){return dF(this).serialize()}),{enumerable:!0}),XU(Rj,"toString",(function(){return dF(this).serialize()}),{enumerable:!0}),pF&&(Tj=pF.createObjectURL,Cj=pF.revokeObjectURL,Tj&&XU(wj,"createObjectURL",YU(Tj,pF)),Cj&&XU(wj,"revokeObjectURL",YU(Cj,pF))),aF(wj,"URL"),HU({global:!0,constructor:!0,forced:!zU,sham:!qU},{URL:wj});var Ij=gu,Nj=Ys,Oj=Ag,Pj=ih,Lj=CI,Dj=Zc("URL");Ij({target:"URL",stat:!0,forced:!(Lj&&Nj((function(){Dj.canParse()})))},{canParse:function(e){var t=Oj(arguments.length,1),n=Pj(e),r=t<2||void 0===arguments[1]?void 0:Pj(arguments[1]);try{return!!new Dj(n,r)}catch(i){return!1}}});var kj=Ks(Kc.URL),xj={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Mj(){return xj}function Uj(){return"setSinkId"in HTMLAudioElement.prototype&&(!VD("RESTRICTION_SET_PLAYBACK_DEVICE")||(GP()||HP())&&!sL())}function Fj(){return!xj.supportUnifiedPlan||VD("CHROME_FORCE_PLAN_B")&&cL()}var jj=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Vj(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Bj(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function Gj(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function Wj(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}var Hj={"90p":Bj(160,90),"90p_1":Bj(160,90),"120p":Bj(160,120,15,30,65),"120p_1":Bj(160,120,15,30,65),"120p_3":Bj(120,120,15,30,50),"120p_4":Bj(212,120),"180p":Bj(320,180,15,30,140),"180p_1":Bj(320,180,15,30,140),"180p_3":Bj(180,180,15,30,100),"180p_4":Bj(240,180,15,30,120),"240p":Bj(320,240,15,40,200),"240p_1":Bj(320,240,15,40,200),"240p_3":Bj(240,240,15,40,140),"240p_4":Bj(424,240,15,40,220),"360p":Bj(640,360,15,80,400),"360p_1":Bj(640,360,15,80,400),"360p_3":Bj(360,360,15,80,260),"360p_4":Bj(640,360,30,80,600),"360p_6":Bj(360,360,30,80,400),"360p_7":Bj(480,360,15,80,320),"360p_8":Bj(480,360,30,80,490),"360p_9":Bj(640,360,15,80,800),"360p_10":Bj(640,360,24,80,800),"360p_11":Bj(640,360,24,80,1e3),"480p":Bj(640,480,15,100,500),"480p_1":Bj(640,480,15,100,500),"480p_2":Bj(640,480,30,100,1e3),"480p_3":Bj(480,480,15,100,400),"480p_4":Bj(640,480,30,100,750),"480p_6":Bj(480,480,30,100,600),"480p_8":Bj(848,480,15,100,610),"480p_9":Bj(848,480,30,100,930),"480p_10":Bj(640,480,10,100,400),"720p":Bj(1280,720,15,120,1130),"720p_auto":Bj(1280,720,30,900,3e3),"720p_1":Bj(1280,720,15,120,1130),"720p_2":Bj(1280,720,30,120,2e3),"720p_3":Bj(1280,720,30,120,1710),"720p_5":Bj(960,720,15,120,910),"720p_6":Bj(960,720,30,120,1380),"1080p":Bj(1920,1080,15,120,2080),"1080p_1":Bj(1920,1080,15,120,2080),"1080p_2":Bj(1920,1080,30,120,3e3),"1080p_3":Bj(1920,1080,30,120,3150),"1080p_5":Bj(1920,1080,60,120,4780),"1440p":Bj(2560,1440,30,120,4850),"1440p_1":Bj(2560,1440,30,120,4850),"1440p_2":Bj(2560,1440,60,120,7350),"4k":Bj(3840,2160,30,120,8910),"4k_1":Bj(3840,2160,30,120,8910),"4k_3":Bj(3840,2160,60,120,13500)},qj={"480p":Gj(640,480,5),"480p_1":Gj(640,480,5),"480p_2":Gj(640,480,30),"480p_3":Gj(640,480,15),"720p":Gj(1280,720,5),"720p_auto":Bj(1280,720,30,900,3e3),"720p_1":Gj(1280,720,5),"720p_2":Gj(1280,720,30),"720p_3":Gj(1280,720,15),"1080p":Gj(1920,1080,5),"1080p_1":Gj(1920,1080,5),"1080p_2":Gj(1920,1080,30),"1080p_3":Gj(1920,1080,15)},zj={"1SL1TL":Wj(1,1),"3SL3TL":Wj(3,3),"2SL3TL":Wj(2,3)};function Kj(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},Hj[e]):e}function Yj(e){return"string"==typeof e?Object.assign({},qj[e]):e}function Jj(e){return"string"==typeof e?Object.assign({},zj[e]):e}var Xj={speech_low_quality:Vj(16e3,!1),speech_standard:Vj(32e3,!1,18),music_standard:Vj(48e3,!1),standard_stereo:Vj(48e3,!0,56),high_quality:Vj(48e3,!1,128),high_quality_stereo:Vj(48e3,!0,192)};function Qj(e){return"string"==typeof e?Object.assign({},Xj[e]):e}var Zj=[];function $j(e){return gL(e,"mediaSource",["screen","window","application"]),!0}var eV=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),tV=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),nV=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),rV=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),iV=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),aV=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),oV=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),sV=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),cV=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),lV=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({}),dV={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},uV={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},hV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},pV={uplinkNetworkQuality:0,downlinkNetworkQuality:0},fV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},mV=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),_V=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),gV=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),EV=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),vV=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),yV=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),SV={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},bV=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function TV(e,t,n,r,i){var a,o,s={};return Object.keys(r).forEach((function(e){s[e]=r[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=Dh(a=qM(o=n.slice()).call(o)).call(a,(function(n,r){return r(e,t,n)||n}),s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}function CV(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wV(Object(n),!0).forEach((function(t){CV(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var AV=class extends OL{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(aV.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),CV(this,"trackMediaType",void 0),CV(this,"_ID",void 0),CV(this,"_rtpTransceiver",void 0),CV(this,"_lowRtpTransceiver",void 0),CV(this,"_hints",[]),CV(this,"_isClosed",!1),CV(this,"_originMediaStreamTrack",void 0),CV(this,"mediaStreamTrack",void 0),CV(this,"_external",{}),this._ID=t||uD(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){_h(Zj).call(Zj,e)||Zj.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||nD((()=>{var e;hk.reportApiInvoke(null,{name:DL.GET_MEDIA_STREAM_TRACK,options:[],tag:kL.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===nV.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){let t=Zj.indexOf(e);-1!==t&&Zj.splice(t,1)}(this),this.emit(oV.CLOSED),this.removeAllListeners(aV.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===nV.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(aV.TRANSCEIVER_UPDATED,e,t)}},IV=class extends AV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),CV(this,"_enabled",!0),CV(this,"_muted",!1),CV(this,"_isExternalTrack",!1),CV(this,"_isClosed",!1),CV(this,"_enabledMutex",void 0),CV(this,"processor",void 0),CV(this,"_processorContext",void 0),CV(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new TD("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,ik.debug("[".concat(this.getTrackId(),"] close")),this.emit(eV.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zL(this,eV.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){ik.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oV.TRACK_ENDED)}stateCheck(e,t){if(ik.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),_L(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new mL(fL.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",ik);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new mL(fL.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",ik)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():hS.resolve([])}},NV=window.AudioContext||window.webkitAudioContext,OV=null,PV=new class extends OL{constructor(){super(...arguments),CV(this,"prevState",void 0),CV(this,"curState",void 0),CV(this,"currentTime",void 0),CV(this,"currentTimeStuckAt",void 0),CV(this,"interruptDetectorTrack",void 0),CV(this,"onLocalAudioTrackMute",(()=>{ik.info("ios15-interruption-start"),this.emit(jj.IOS_15_16_INTERRUPTION_START)})),CV(this,"onLocalAudioTrackUnmute",(async()=>{ik.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?ik.info("ios15-interruption-end-canceled"):(OV&&await OV.suspend(),this.emit(jj.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){ik.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){ik.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function LV(){if(!OV){if(function(){if(!NV)return void ik.error("your browser is not support web audio");ik.info("create audio context");let e=RV({},VD("WEBAUDIO_INIT_OPTIONS"));ik.debug("audio context init option:",JSON.stringify(e)),OV=new NV(e),PV.curState=OV.state,OV.onstatechange=()=>{PV.prevState=PV.curState,PV.curState=OV?OV.state:void 0;let{prevState:e,curState:t}=PV,n="running"===t,r="interrupted"===t,i="running"===e,a="suspended"===e,o="interrupted"===e,s=UP().osVersion;(zP()||iL())&&i&&r&&(ik.info("ios".concat(s,"-interruption-start")),PV.emit(jj.IOS_INTERRUPTION_START)),(zP()||iL())&&(a||o)&&n&&(ik.info("ios".concat(s,"-interruption-end")),PV.emit(jj.IOS_INTERRUPTION_END)),e!==t&&PV.emit(jj.STATE_CHANGE,t,e)},setInterval((()=>{var e;let t=null===(e=OV)||void 0===e?void 0:e.currentTime;PV.currentTime!==t?(PV.currentTimeStuckAt&&(ik.debug("AudioContext current time resume at ".concat(t)),PV.currentTimeStuckAt=void 0),PV.currentTime=t):(t!==PV.currentTimeStuckAt&&(hk.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:kL.TRACER}).onSuccess(),ik.warning("AudioContext current time stuck at ".concat(t))),PV.currentTimeStuckAt=t)}),5e3),async function(e){let t,n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r=!1,i=!1,a=!1;function o(t){"running"===e.state?s(!1):zP()||iL()?"suspended"===e.state&&(s(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(s(!0),t&&e.resume().then(c,c))}function s(e){if(r!==e){r=e;for(let t=0,r=n;t<r.length;t+=1){let n=r[t];e?window.addEventListener(n,l,{capture:!0,passive:!0}):window.removeEventListener(n,l,{capture:!0,passive:!0})}}}function c(){o(!1)}function l(){o(!0)}function d(e){if(!a)if(t.paused)if(e){let e;u(!1),a=!0;try{e=t.play(),e?e.then(h,h):(t.addEventListener("playing",h),t.addEventListener("abort",h),t.addEventListener("error",h))}catch(n){h()}}else u(!0);else u(!1)}function u(e){if(i!==e){i=e;for(let t=0,r=n;t<r.length;t++){let n=r[t];e?window.addEventListener(n,p,{capture:!0,passive:!0}):window.removeEventListener(n,p,{capture:!0,passive:!0})}}}function h(){t.removeEventListener("playing",h),t.removeEventListener("abort",h),t.removeEventListener("error",h),a=!1,d(!1)}function p(){d(!0)}if(zP()){let n=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",t=r.children.item(0),t.controls=!1,t.disableRemotePlayback=!0,t.preload="auto",t.srcObject=n.stream,d(!0)}PV.on(jj.STATE_CHANGE,(function(){o(!0)})),o(!1)}(OV)}(),!OV)throw new mL(fL.NOT_SUPPORTED,"can not create audio context");return OV}return OV}function DV(e){if(function(){if(null!==kV)return kV;let e=LV(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(a){i=!0}return t.disconnect(),kV=i,i}())return;let t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var a;return e._inputNodes||(e._inputNodes=[]),_h(a=e._inputNodes).call(a,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,a)=>{n.call(e),r?XL(e._inputNodes,r):e._inputNodes=[];for(let n of e._inputNodes)t.call(e,n)}}var kV=null;function xV(e,t){let n=!1,r=1/t;if(VD("DISABLE_WEBAUDIO")){let t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{let t=LV(),i=t.createGain();i.gain.value=0,i.connect(t.destination);let a=()=>{if(n)return void(i=null);let o=t.createOscillator();o.onended=a,o.connect(i),o.start(0),o.stop(t.currentTime+r),e(t.currentTime)};a()}return()=>{n=!0}}var MV=class{constructor(){CV(this,"context",void 0),CV(this,"analyserNode",void 0),CV(this,"sourceNode",void 0),this.context=LV(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(t){}this.sourceNode=e,null===e||void 0===e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||zP()||iL()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}let t=Dh(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(n){ik.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}},UV=class extends OL{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(r){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),CV(this,"outputNode",void 0),CV(this,"outputTrack",void 0),CV(this,"isPlayed",!1),CV(this,"sourceNode",void 0),CV(this,"context",void 0),CV(this,"audioBufferNode",void 0),CV(this,"destNode",void 0),CV(this,"audioOutputLevel",0),CV(this,"volumeLevelAnalyser",void 0),CV(this,"_processedNode",void 0),CV(this,"playNode",void 0),CV(this,"isDestroyed",!1),CV(this,"onNoAudioInput",void 0),CV(this,"isNoAudioInput",!1),CV(this,"_noAudioInputCount",0),this.context=LV(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),DV(this.outputNode),this.volumeLevelAnalyser=new MV}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(lV.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){let n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Mj().webAudioMediaStreamDest)throw new mL(fL.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&ZL((()=>{PV.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;zP()||iL()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();let t,n=this.volumeLevelAnalyser.getAnalyserNode();n.getFloatTimeDomainData?(t=new Float32Array(n.fftSize),n.getFloatTimeDomainData(t)):(t=new Uint8Array(n.fftSize),n.getByteTimeDomainData(t));let r=!1;for(let i=0;i<t.length;i++)0!==t[i]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await dD(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}},FV=class extends UV{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),CV(this,"sourceNode",void 0),CV(this,"track",void 0),CV(this,"clonedTrack",void 0),CV(this,"audioElement",void 0),CV(this,"isCurrentTrackCloned",!1),CV(this,"isRemoteTrack",!1),CV(this,"originVolumeLevelAnalyser",void 0),CV(this,"rebuildWebAudio",(async()=>{if(ik.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void ik.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>ik.info("resume success"))),ik.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;let t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),DV(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),DV(this.outputNode),this.emit(lV.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new mL(fL.UNEXPECTED_ERROR);this.track=e;let i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),DV(this.sourceNode),n){let e=n.clone();e.enabled=!0,this.clonedTrack=e,ik.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));let t=this.context.createMediaStreamSource(new MediaStream([e]));DV(t),this.originVolumeLevelAnalyser=new MV,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;let a=UP();t&&a.os===LP.IOS&&Number(null===(r=a.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(PV.on(jj.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),DV(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(lV.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),PV.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),ik.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let n=this.context.createMediaStreamSource(new MediaStream([t]));DV(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}};async function jV(e,t,n){let r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function VV(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);let n=LL();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new mL(fL.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(a){r=null}r&&r.then||(r=new hS(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(aa){throw new mL(fL.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,aa.toString())}}var BV=new TD("safari"),GV=!1,WV=!1;async function HV(e,t){let n=0,r=null;for(;n<2;)try{r=await qV(e,t,n>0);break}catch(i){if(i instanceof mL)throw ik.error("[".concat(t,"] ").concat(i.toString())),i;let e=zV(i.name||i.code||i,i.message);if(e.code===fL.MEDIA_OPTION_INVALID){ik.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await dD(500);continue}throw ik.error("[".concat(t,"] ").concat(e.toString())),e}if(!r)throw new mL(fL.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function qV(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new mL(fL.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let r=Mj(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return ik.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(LL())e.screen.sourceId?KV(i,await jV(e.screen.sourceId,e.screen,e.screenAudio)):KV(i,await async function(e,t){let n=await VV(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new hS(((n,r)=>{let i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let a=document.createElement("div");a.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");let s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);let e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let d=t,u=document.createElement("div");if(t){let e=document.createElement("input");e.setAttribute("type","checkbox");let t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=d,e.onchange=()=>{d=e.checked},u.appendChild(e),u.appendChild(t)}c.appendChild(u),c.appendChild(l),a.appendChild(o),a.appendChild(s),a.appendChild(c);let h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(a),document.body.appendChild(h),e.map((e=>{if(e.id){let t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;try{let{width:e}=r.getSize();e>1920&&(r=r.resize({width:1920}))}catch(va){throw va&&va.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),va}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:d})},s.appendChild(t)}}))}))}(n,t);return await jV(r,e,i)}(e.screen,e.screenAudio));else if(GP()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new mL(fL.NOT_SUPPORTED,"This browser does not support screen sharing");ik.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let n=await(o=e.screen.extensionId,s=t,new hS(((e,t)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},(n=>{if(!n||!n.streamId)return ik.error("[".concat(s,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new mL(fL.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(xa){ik.error("[".concat(s,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),xa.toString()),t(new mL(fL.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,KV(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var a;e.screen.mediaSource&&$j(e.screen.mediaSource);let n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(a=e.screen.displaySurface)&&void 0!==a?a:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:o,systemAudio:s}=e.screen,c={selfBrowserSurface:r,surfaceSwitching:o,systemAudio:s};!r&&delete c.selfBrowserSurface,!o&&delete c.surfaceSwitching,!s&&delete c.systemAudio,ik.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:!!e.screenAudio,controls:c})),KV(i,await navigator.mediaDevices.getDisplayMedia(RV({video:n,audio:!!e.screenAudio},c)))}else{if(!qP())throw ik.error("[".concat(t,"] This browser does not support screenSharing")),new mL(fL.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&$j(e.screen.mediaSource);let n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};ik.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),KV(i,await navigator.mediaDevices.getUserMedia(n))}}var o,s;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},l=VD("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=gD(c,l)}catch(h){}ik.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),UP();let d,u=null;(WP()||zP()||BP())&&(u=await BV.lock());try{d=await navigator.mediaDevices.getUserMedia(c)}catch(la){throw u&&u(),la}return c.audio&&(GV=!0),c.video&&(WV=!0),KV(i,d),u&&u(),i}function zV(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new mL(fL.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new mL(fL.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new mL(fL.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new mL(fL.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new mL(fL.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new mL(fL.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return ik.error("getUserMedia unexpected error",e),new mL(fL.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function KV(e,t){let n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(r&&e.removeTrack(r),e.addTrack(a)),i&&(n&&e.removeTrack(n),e.addTrack(i))}var YV=new class extends OL{get state(){return this._state}set state(e){e!==this._state&&(this.emit(EV.STATE_CHANGE,e),this._state=e)}constructor(){super(),CV(this,"_state",gV.IDLE),CV(this,"isAccessMicrophonePermission",!1),CV(this,"isAccessCameraPermission",!1),CV(this,"lastAccessMicrophonePermission",!1),CV(this,"lastAccessCameraPermission",!1),CV(this,"checkdeviceMatched",!1),CV(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(VD("ENUMERATE_DEVICES_INTERVAL")||(lL()||jP()===LP.HARMONY_OS)&&cL())&&this.updateDevicesInfo()}),VD("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>ik.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new mL(fL.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r),a=!this.isAccessMicrophonePermission&&e,o=!this.isAccessCameraPermission&&t;i.audio&&(a=!1),i.video&&(o=!1);let s=null,c=null,l=null;if(!n&&(a||o)){if(BV.isLocked&&(ik.debug("[device manager] wait GUM lock"),(await BV.lock())(),ik.debug("[device manager] GUM unlock")),GV&&(a=!1,this.isAccessMicrophonePermission=!0),WV&&(o=!1,this.isAccessCameraPermission=!0),ik.debug("[device manager] check media device permissions",e,t,a,o),a&&o){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(da){let t=zV(da.name||da.code||da,da.message);if(t.code===fL.PERMISSION_DENIED)throw t;ik.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(da){let t=zV(da.name||da.code||da,da.message);if(t.code===fL.PERMISSION_DENIED)throw t;ik.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(o){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(da){let t=zV(da.name||da.code||da,da.message);if(t.code===fL.PERMISSION_DENIED)throw t;ik.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}ik.debug("[device manager] mic permission",e,"cam permission",t)}try{let e=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),s=null,c=null,l=null,e}catch(da){return s&&s.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),l&&l.getTracks().forEach((e=>e.stop())),s=null,c=null,l=null,new mL(fL.ENUMERATE_DEVICES_FAILED,da.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new mL(fL.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=gV.INITING;try{await this.updateDevicesInfo(),this.state=gV.INITEND}catch(Bo){throw ik.warning("Device Detection functionality cannot start properly.",Bo.toString()),this.state=gV.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new mL(fL.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),Bo}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;let t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?ik.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):ik.warning("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):ik.debug("[device-check] default input or output not found")}let r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;let r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){let r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==gV.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(EV.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(EV.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(EV.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(let i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(let i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}},JV=!1,XV=new class extends OL{constructor(){super(...arguments),CV(this,"onAutoplayFailed",void 0),CV(this,"onAudioAutoplayFailed",void 0)}};function QV(){if(UP(),!JV){let e=t=>{t.preventDefault(),JV=!1,dL()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};JV=!0,dL()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),ik.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),XV.onAutoplayFailed?XV.onAutoplayFailed():XV.onAudioAutoplayFailed?ik.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):ik.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),XV.emit("autoplay-failed")}}function ZV(e,t,n,r){if(!e)return;let i=hk.getBaseInfoBySessionId(e);if(!i)return;let a=i.info,o=Date.now(),s=RV(RV({},a),{},{vid:void 0===a.vid?0:Number(a.vid),lts:o,elapse:o-i.startTime,cbRegistered:XV.onAutoplayFailed||XV.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});hk.send({type:ck.AUTOPLAY_FAILED,data:s},!0)}var $V=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],eB=new class{constructor(){CV(this,"onAutoplayFailed",void 0),CV(this,"elementMap",new Map),CV(this,"elementStateMap",new Map),CV(this,"elementsNeedToResume",[]),CV(this,"sinkIdMap",new Map),CV(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,r]=t,i=this.elementStateMap.get(n),a=r.srcObject.getAudioTracks()[0],o=a&&a.readyState;if(ik.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(e)),"live"===o){if(e)return r.pause(),void r.play();if("running"===PV.curState)return tL()?(r.pause(),void r.play()):void(i&&"paused"===i&&r.play())}}))})),CV(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e,r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(ik.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),PV.on(jj.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),PV.on(jj.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),PV.on(jj.STATE_CHANGE,(()=>{zP()&&"suspended"===PV.prevState&&"running"===PV.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){let n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(yi){throw new mL(fL.PERMISSION_DENIED,"can not set sink id: "+yi.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;let i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,vV.INIT),this.setVolume(t,n);let a=this.sinkIdMap.get(t);if(a)try{i.setSinkId(a).catch((e=>{ik.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(ia){ik.warning("[".concat(t,"] set sink id failed"),ia.toString())}let o=i.play();o&&o.then&&o.catch((e=>{r&&ZV(r,"audio",e.message,t),ik.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(ik.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),ZL((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),QV()})))}))}updateTrack(e,t){let n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){let n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){$V.forEach((n=>{t.addEventListener(n,(n=>{let r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(ik.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){let n=null===t||void 0===t?void 0:t.error;n&&ik.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{ik.debug("Auto resume audio element success")})).catch((e=>{ik.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new hS((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{dL()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function tB(){return function(e,t,n){let r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new mL(fL.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",ik);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let i=r.apply(this,t);return i instanceof hS?new hS(((e,t)=>{i.then(e).catch(t)})):i}),n}}var nB=class extends OL{constructor(e){super(),CV(this,"name","VideoProcessorDestination"),CV(this,"ID","0"),CV(this,"_source",void 0),CV(this,"videoContext",void 0),CV(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new mL(fL.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new mL(fL.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(mV.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(mV.ON_TRACK,void 0)}},rB=class extends OL{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),CV(this,"constraintsMap",new Map),CV(this,"statsRegistry",[]),CV(this,"usageRegistry",[]),CV(this,"trackId",void 0),CV(this,"direction",void 0),CV(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await qL(this,_V.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return ik.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),zL(this,_V.REQUEST_UPDATE_CONSTRAINTS,Array.from($M(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return ik.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),zL(this,_V.REQUEST_UPDATE_CONSTRAINTS,Array.from($M(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){let n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{let a=i();e.push({processorID:t,processorName:n,type:r,stats:a})}catch(oa){ik.error(new mL(fL.UNEXPECTED_ERROR,oa.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let n=t();n instanceof hS&&(n=await n),e.push(RV(RV({},n),{},{direction:this.direction}))}catch(yi){ik.error("gather extension usage error",yi)}return e}getDirection(){return this.direction}},iB=class extends OL{constructor(e){super(),CV(this,"name","AudioProcessorDestination"),CV(this,"ID","0"),CV(this,"inputTrack",void 0),CV(this,"inputNode",void 0),CV(this,"audioProcessorContext",void 0),CV(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new mL(fL.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new mL(fL.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(mV.ON_TRACK,void 0),this.emit(mV.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(mV.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(mV.ON_NODE,this.inputNode))}},aB=class extends OL{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),CV(this,"constraintsMap",new Map),CV(this,"statsRegistry",[]),CV(this,"audioContext",void 0),CV(this,"trackId",void 0),CV(this,"direction",void 0),CV(this,"usageRegistry",[]),CV(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return qL(this,_V.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return ik.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),zL(this,_V.REQUEST_UPDATE_CONSTRAINTS,Array.from($M(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),zL(this,_V.REQUEST_UPDATE_CONSTRAINTS,Array.from($M(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){let n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{let a=i();e.push({processorID:t,processorName:n,type:r,stats:a})}catch(oa){ik.error(new mL(fL.UNEXPECTED_ERROR,oa.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let n=t();n instanceof hS&&(n=await n),e.push(RV(RV({},n),{},{direction:this.direction}))}catch(yi){ik.error("gather extension usage error",yi)}return e}getDirection(){return this.direction}},oB=class extends OL{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),CV(this,"context",void 0),CV(this,"processSourceNode",void 0),CV(this,"outputTrack",void 0),CV(this,"processedNode",void 0),CV(this,"clonedTrack",void 0),CV(this,"outputNode",void 0),this.outputNode=new sB}setVolume(){}createOutputTrack(){throw new mL(fL.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}},sB=class{disconnect(){}connect(){}};function cB(e){return new hS(((t,n)=>{let r=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);let a=zP()?"canplay":"playing";i.addEventListener(a,(()=>{let e=i.videoWidth,n=i.videoHeight;!e&&qP()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(pD),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function lB(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let n=Kj(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!oL()&&n.frameRate&&(t.frameRate=n.frameRate),HP()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),qP()&&(t.frameRate={ideal:30,max:30}),t}function dB(e){let t={};if(oL()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,GP()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){let n=Qj(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),lL()&&(t.sampleRate=void 0),t}var uB,hB,pB,fB,mB,_B,gB,EB,vB,yB,SB,bB,TB,CB,wB,RB,AB,IB,NB,OB,PB,LB,DB,kB,xB,MB,UB,FB,jB,VB,BB,GB,WB,HB,qB,zB,KB,YB,JB,XB,QB,ZB,$B,eG,tG,nG,rG,iG,aG,oG,sG,cG,lG,dG,uG,hG,pG,fG,mG,_G,gG,EG,vG,yG,SG,bG,TG,CG,wG,RG,AG,IG,NG,OG,PG=async(e,t,n)=>await(async(e,t,n)=>{let r=function(e){let t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(yD(""+t+n)).slice(0,16),i=r.slice(0,12),a=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},a,e))})(e.buffer,t,n),LG=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new hS(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){let r=await DG(e);n({buffer:r,width:t.width,height:t.height})}else r(new mL(fL.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},DG=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)},kG=(uB=uk({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),hB=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),pB=tB(),fB=CD("LocalAudioTrack","_enabledMutex"),mB=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),_B=tB(),gB=CD("LocalAudioTrack","_enabledMutex"),EB=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),vB=tB(),yB=tB(),SB=tB(),bB=uk({argsMap:e=>[e.getTrackId()]}),TB=tB(),CB=uk({argsMap:e=>[e.getTrackId()]}),wB=tB(),RB=uk({argsMap:e=>[e.getTrackId()]}),AB=uk({argsMap:(e,t)=>[e.getTrackId(),t.name]}),IB=uk({argsMap:e=>[e.getTrackId()]}),TV((NB=class extends IV{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?eB.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),CV(this,"trackMediaType",cV.AUDIO),CV(this,"_encoderConfig",void 0),CV(this,"_trackSource",void 0),CV(this,"_enabled",!0),CV(this,"_volume",100),CV(this,"_useAudioElement",!0),CV(this,"_bypassWebAudio",!1),CV(this,"processor",void 0),CV(this,"_processorContext",void 0),CV(this,"_processorDestination",void 0),CV(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new oB,VD("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),VD("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),WP()&&!OV?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){EL(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&eB.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void ik.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,zL(this,eV.NEED_REPLACE_TRACK,this).then((()=>{ik.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{ik.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch(t){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!Uj())throw new mL(fL.NOT_SUPPORTED,"your browser does not support setting the audio output device");await eB.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(ik.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await zL(this,eV.NEED_ENABLE_TRACK,this),ik.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(yi){throw n||(this._enabled=!1),ik.error("[".concat(this.getTrackId(),"] setEnabled to true error"),yi.toString()),yi}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await zL(this,eV.NEED_DISABLE_TRACK,this)}catch(yi){throw n||(this._enabled=!0),ik.error("[".concat(this.getTrackId(),"] setEnabled to false error"),yi.toString()),yi}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,ik.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await zL(this,eV.NEED_MUTE_TRACK,this):await zL(this,eV.NEED_UNMUTE_TRACK,this))}getStats(){return nD((()=>{ik.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),KL(this,eV.GET_STATS)||RV({},dV)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(lV.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(lV.ON_AUDIO_BUFFER),this._source.on(lV.ON_AUDIO_BUFFER,(t=>e(t)))}play(){ik.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(ik.debug("[".concat(this.getTrackId(),"] start audio playback in element")),eB.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){ik.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?eB.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];ik.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&eB.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zL(this,eV.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return hS.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new mL(fL.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new mL(fL.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(mV.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await zL(this,eV.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zL(this,eV.NEED_REPLACE_TRACK,this))})),e.on(mV.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(mV.ON_TRACK),e.removeAllListeners(mV.ON_NODE)}bindProcessorContextEvents(e){e.on(_V.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(_V.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof oB&&(this._trackSource=new FV(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new aB(this._source.context,this.getTrackId(),"local"),t=new iB(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(lV.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(eB.stop(this.getTrackId()),this._source.play()),zL(this,eV.NEED_REPLACE_MIXING_TRACK,this).then((()=>{ik.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((e=>{ik.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[uB],Object.getOwnPropertyDescriptor(NB.prototype,"setVolume"),NB.prototype),TV(NB.prototype,"setPlaybackDevice",[hB,pB],Object.getOwnPropertyDescriptor(NB.prototype,"setPlaybackDevice"),NB.prototype),TV(NB.prototype,"setEnabled",[fB,mB,_B],Object.getOwnPropertyDescriptor(NB.prototype,"setEnabled"),NB.prototype),TV(NB.prototype,"setMuted",[gB,EB,vB],Object.getOwnPropertyDescriptor(NB.prototype,"setMuted"),NB.prototype),TV(NB.prototype,"getStats",[yB],Object.getOwnPropertyDescriptor(NB.prototype,"getStats"),NB.prototype),TV(NB.prototype,"setAudioFrameCallback",[SB],Object.getOwnPropertyDescriptor(NB.prototype,"setAudioFrameCallback"),NB.prototype),TV(NB.prototype,"play",[bB,TB],Object.getOwnPropertyDescriptor(NB.prototype,"play"),NB.prototype),TV(NB.prototype,"stop",[CB,wB],Object.getOwnPropertyDescriptor(NB.prototype,"stop"),NB.prototype),TV(NB.prototype,"close",[RB],Object.getOwnPropertyDescriptor(NB.prototype,"close"),NB.prototype),TV(NB.prototype,"pipe",[AB],Object.getOwnPropertyDescriptor(NB.prototype,"pipe"),NB.prototype),TV(NB.prototype,"unpipe",[IB],Object.getOwnPropertyDescriptor(NB.prototype,"unpipe"),NB.prototype),NB),xG=(OB=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),PB=tB(),LB=CD("MicrophoneAudioTrack","_enabledMutex"),DB=uk({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),kB=tB(),xB=uk({argsMap:e=>[e.getTrackId()]}),TV((MB=class extends kG{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Qj(t.encoderConfig):{},r,VD("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),CV(this,"_config",void 0),CV(this,"_deviceName","default"),CV(this,"_constraints",void 0),CV(this,"_originalConstraints",void 0),CV(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(tL()||nL())&&PV.bindInterruptDetectorTrack(this)}async setDevice(e){if(ik.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let n=await YV.getDeviceById(e),r={};r.audio=RV({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await HV(r,this.getTrackId())}catch(t){throw ik.error("[".concat(this.getTrackId(),"] setDevice failed"),t.toString()),i=await HV({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(g0){throw ik.error("[".concat(this.getTrackId(),"] setDevice error"),g0.toString()),g0}else try{let t=await YV.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(g0){throw ik.error("[".concat(this.getTrackId(),"] setDevice error"),g0.toString()),g0}ik.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return ik.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(ik.info("[".concat(this.getTrackId(),"] start setEnabled"),e),VD("AUTO_RESET_AUDIO_ROUTE")&&(zP()||iL())){let t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await zL(this,eV.NEED_DISABLE_TRACK,this)}catch(oa){throw ik.error("[".concat(this.getTrackId(),"] setEnabled false failed"),oa.toString()),oa}return}let i=RV({},this._constraints),a=YV.searchDeviceIdByName(this._deviceName);a&&!i.deviceId&&(i.deviceId=a);try{n||(this._enabled=!0);let e=await HV({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await zL(this,eV.NEED_ENABLE_TRACK,this)}catch(oa){throw n||(this._enabled=!1),ik.error("[".concat(this.getTrackId(),"] setEnabled true failed"),oa.toString()),oa}ik.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(tL()||nL())&&PV.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((zP()||iL())&&this._enabled&&!this._isClosed&&PV.duringInterruption){let e=async()=>{PV.off(jj.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(ik.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};PV.on(jj.IOS_INTERRUPTION_END,e)}else ik.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oV.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,n=YV.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let e=await HV({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(_V.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{let n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(r){n(r)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(_V.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[OB,PB],Object.getOwnPropertyDescriptor(MB.prototype,"setDevice"),MB.prototype),TV(MB.prototype,"setEnabled",[LB,DB,kB],Object.getOwnPropertyDescriptor(MB.prototype,"setEnabled"),MB.prototype),TV(MB.prototype,"close",[xB],Object.getOwnPropertyDescriptor(MB.prototype,"close"),MB.prototype),MB),MG=(UB=uk({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),FB=tB(),jB=uk({argsMap:e=>[e.getTrackId()]}),VB=tB(),BB=uk({argsMap:e=>[e.getTrackId()]}),GB=tB(),WB=uk({argsMap:e=>[e.getTrackId()]}),HB=tB(),qB=uk({argsMap:e=>[e.getTrackId()]}),zB=tB(),KB=uk({argsMap:e=>[e.getTrackId()]}),YB=uk({argsMap:e=>[e.getTrackId()]}),JB=tB(),TV((XB=class extends kG{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),CV(this,"source",void 0),CV(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(lV.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(oV.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(i){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){EL(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[UB,FB],Object.getOwnPropertyDescriptor(XB.prototype,"startProcessAudioBuffer"),XB.prototype),TV(XB.prototype,"pauseProcessAudioBuffer",[jB,VB],Object.getOwnPropertyDescriptor(XB.prototype,"pauseProcessAudioBuffer"),XB.prototype),TV(XB.prototype,"seekAudioBuffer",[BB,GB],Object.getOwnPropertyDescriptor(XB.prototype,"seekAudioBuffer"),XB.prototype),TV(XB.prototype,"resumeProcessAudioBuffer",[WB,HB],Object.getOwnPropertyDescriptor(XB.prototype,"resumeProcessAudioBuffer"),XB.prototype),TV(XB.prototype,"stopProcessAudioBuffer",[qB,zB],Object.getOwnPropertyDescriptor(XB.prototype,"stopProcessAudioBuffer"),XB.prototype),TV(XB.prototype,"close",[KB],Object.getOwnPropertyDescriptor(XB.prototype,"close"),XB.prototype),TV(XB.prototype,"setAudioBufferPlaybackSpeed",[YB,JB],Object.getOwnPropertyDescriptor(XB.prototype,"setAudioBufferPlaybackSpeed"),XB.prototype),XB),UG=class e extends kG{get __className__(){return"MixingAudioTrack"}get isActive(){for(let e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){let e=LV().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,uD(8,"track-mix-")),CV(this,"trackList",void 0),CV(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(t){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(ik.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):ik.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){ik.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(t){}XL(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){let e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach((n=>{n instanceof e?n.emit(aV.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)})))}},FG=class extends UV{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(lV.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),CV(this,"audioBuffer",void 0),CV(this,"sourceNode",void 0),CV(this,"startPlayTime",0),CV(this,"startPlayOffset",0),CV(this,"pausePlayTime",0),CV(this,"options",void 0),CV(this,"currentLoopCount",0),CV(this,"currentPlaybackSpeed",100),CV(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):ik.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}},jG=new Map,VG=class{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(ik.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){CV(this,"trackId",void 0),CV(this,"config",void 0),CV(this,"onFirstVideoFrameDecoded",void 0),CV(this,"onVideoStateChanged",void 0),CV(this,"freezeTimeCounterList",[]),CV(this,"renderFreezeAccTime",0),CV(this,"isKeepLastFrame",!1),CV(this,"timeUpdatedCount",0),CV(this,"freezeTime",0),CV(this,"playbackTime",0),CV(this,"lastTimeUpdatedTime",0),CV(this,"autoplayFailed",!1),CV(this,"videoTrack",void 0),CV(this,"videoElement",void 0),CV(this,"cacheVideoElement",void 0),CV(this,"renderStats",void 0),CV(this,"_videoState",yV.VideoStateStopped),CV(this,"videoElementCheckInterval",void 0),CV(this,"videoElementFreezeTimeout",void 0),CV(this,"_videoElementStatus",vV.NONE),CV(this,"isGettingVideoDimensions",!1),CV(this,"startGetVideoDimensions",(()=>{let e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return ik.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),CV(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===PV.curState&&(ik.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(VP())),rL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),CV(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=vV.PLAYING;break;case"loadeddata":if(this.videoState=yV.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(t){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=vV.CANPLAY;break;case"stalled":this.videoElementStatus=vV.STALLED;break;case"suspend":this.videoElementStatus=vV.SUSPEND;break;case"pause":this.videoElementStatus=vV.PAUSED,zP()||iL()||WP()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(ik.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=vV.WAITING;break;case"abort":this.videoElementStatus=vV.ABORT;break;case"ended":this.videoElementStatus=vV.ENDED;break;case"emptied":this.videoElementStatus=vV.EMPTIED;break;case"error":{let e=this.videoElement.error;e?(this.videoElementStatus=vV.ERROR,ik.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")"))):ik.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);let t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,sW.lastVisibleTime<sW.lastHiddenTime||n<sW.lastHiddenTime||n<sW.lastVisibleTime)return;for(t>VD("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;let e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),CV(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(ik.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(VP())),rL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),PV.on(jj.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),PV.on(jj.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&ZV(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(ik.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):ik.warning("[".concat(this.trackId,"] play warning: "),t)}));let n=UP();if(("Safari"===n.name&&15===Number(n.version)||tL())&&t&&t.then){let e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return ik.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;let r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new hS(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){let t=await DG(e);r({buffer:t,width:n.width,height:n.height})}else i(new mL(fL.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await LG(e)}destroy(){this.renderStats=void 0,PV.off(jj.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),PV.off(jj.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=yV.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=vV.INIT,!this.videoElementCheckInterval&&(BG.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{(function(e){return e!==document.body&&document.body.contains(e)})(this.videoElement)||(this.videoElementStatus=vV.DESTROYED)}),1e3),VD("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n,r=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",r),this.videoElementFreezeTimeout=window.setTimeout(i,VD("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===yV.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=yV.VideoStateFrozen:document.addEventListener("visibilitychange",r))},a=(e,t)=>{if(this.videoElementStatus===vV.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=t.mediaTime):this.renderStats={lastTs:t.mediaTime,curTs:t.mediaTime,lastRenderNum:0,renderNum:0},n){let e=t.presentationTime-n.presentationTime;this.videoState===yV.VideoStateStarting&&(this.videoState=yV.VideoStateDecoding),this.videoState===yV.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,VD("VIDEO_FREEZE_DURATION"))),e<VD("VIDEO_FREEZE_DURATION")&&this.videoState===yV.VideoStateFrozen&&(this.videoState=yV.VideoStateDecoding),e>VD("VIDEO_FREEZE_DURATION")&&sW.lastVisibleTime>=sW.lastHiddenTime&&n.timestamp>sW.lastVisibleTime&&n.timestamp>sW.lastHiddenTime&&(this.renderFreezeAccTime+=e)}n=RV(RV({},t),{},{timestamp:e})}var r,o;VD("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(o=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(o,a))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,a)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),lL()&&!VD("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let n=UP();"Safari"===n.name&&15===Number(n.version)||tL()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qP()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qP()&&this.videoElement.load());let r=this.videoElement.play();void 0!==r&&r.catch((e=>{ik.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){BG.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=vV.NONE}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{ik.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{ik.error(e)})),this.autoplayFailed=!1,dL()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};dL()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),QV()}},BG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],GG=class extends VG{constructor(e){super(e),CV(this,"container",void 0),CV(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await LG(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",VD("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(t){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}},WG=(QB=uk({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),ZB=tB(),$B=uk({argsMap:e=>[e.getTrackId()]}),eG=CD("LocalVideoTrack","_enabledMutex"),tG=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),nG=tB(),rG=CD("LocalVideoTrack","_enabledMutex"),iG=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),aG=tB(),oG=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),sG=tB(),cG=tB(),lG=uk({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),dG=tB(),uG=tB(),hG=tB(),pG=tB(),fG=tB(),mG=tB(),_G=tB(),gG=uk({argsMap:(e,t)=>[e.getTrackId(),t.name]}),EG=uk({argsMap:e=>[e.getTrackId()]}),vG=uk({argsMap:e=>[e.getTrackId()]}),yG=uk({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),SG=class e extends IV{get videoHeight(){if(WP()){let{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(WP()){let{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==vV.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,a){if(super(e,i),CV(this,"trackMediaType",cV.VIDEO),CV(this,"_player",void 0),CV(this,"isUseScaleResolutionDownBy",!1),CV(this,"_videoVisibleTimer",null),CV(this,"_previousVideoVisibleStatus",void 0),CV(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),CV(this,"_encoderConfig",void 0),CV(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),CV(this,"_optimizationMode",void 0),CV(this,"_videoHeight",void 0),CV(this,"_videoWidth",void 0),CV(this,"_forceBitrateLimit",void 0),CV(this,"_enabled",!0),CV(this,"_processorDestination",void 0),CV(this,"_processorContext",void 0),WP()){let{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=n,this._optimizationMode=r,this._hints=a||[],-1===this._hints.indexOf(tV.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(e){let t=UP();return!(t.name!==e||!t.osVersion)&&115===Number(t.version)}(DP.CHROME)&&-1!==jP().indexOf("Windows")){let t=function(e){if("VideoFrame"in window&&"TransformStream"in window&&Mj().supportWebRTCInsertableStream){let t,n,r=new MediaStreamTrackProcessor(e),i=new MediaStreamTrackGenerator({kind:"video"}),a=Date.now(),o=()=>{s&&(clearInterval(s),s=void 0),t&&(t.close(),t=void 0),e.stop(),n=void 0,i.removeEventListener("ended",o)},s=window.setInterval((()=>{if(n&&t&&Date.now()-a>1e3)try{"live"===i.readyState?n.enqueue(t.clone()):o()}catch(e){o()}}),1e3),c=new TransformStream({transform:(e,r)=>{"live"===i.readyState?(n=r,a=Date.now(),void 0===t?(t=e,r.enqueue(e.clone())):(r.enqueue(t),t=e)):e.close()}});return i.addEventListener("ended",o),r.readable.pipeThrough(c).pipeTo(i.writable),i}}(e);t&&(ik.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(tV.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new rB(this.getTrackId(),"local"),this._processorDestination=new nB(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let t=document.getElementById(e);t?e=t:(ik.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}ik.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let n=RV(RV(RV({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new VG(n):this._player=new GG(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{let e=this.getVideoElementVisibleStatus();this.safeEmit(oV.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),VD("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,ik.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(ik.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await zL(this,eV.NEED_DISABLE_TRACK,this)}catch(yi){throw ik.error("[".concat(this.getTrackId(),"] setEnabled to false error"),yi.toString()),yi}return t||(this._enabled=!1),void ik.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await zL(this,eV.NEED_ENABLE_TRACK,this)}catch(yi){throw ik.error("[".concat(this.getTrackId(),"] setEnabled to true error"),yi.toString()),yi}ik.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,ik.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await zL(this,eV.NEED_MUTE_TRACK,this):await zL(this,eV.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new mL(fL.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=Kj(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){let t=lB({encoderConfig:e});(WP()||zP()||iL())&&(t.deviceId=void 0),ik.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(n){let e=new mL(fL.UNEXPECTED_ERROR,n.toString());throw ik.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}}this._encoderConfig=e,-1===this._hints.indexOf(tV.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await zL(this,eV.NEED_UPDATE_VIDEO_ENCODER,this)}catch(yi){return yi.throw(ik)}}getStats(){return nD((()=>{ik.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),KL(this,eV.GET_STATS)||RV({},uV)}async setBeautyEffect(e){ik.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await LG(e)}async setBitrateLimit(e){if(ik.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await zL(this,eV.NEED_UPDATE_VIDEO_ENCODER,this)}catch(na){return na.throw(ik)}}}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void ik.error(fL.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let t=this._optimizationMode;try{this._optimizationMode=e,await zL(this,eV.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(yi){throw this._optimizationMode=t,ik.error("[".concat(this.getTrackId(),"] set optimization mode failed"),yi.toString()),yi}ik.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return ik.error(fL.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,ik.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){cB(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(pD)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new mL(fL.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");ik.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=Kj(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(tV.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await zL(this,eV.NEED_UPDATE_VIDEO_ENCODER,this)}catch(na){return na.throw(ik)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;let{bitrateMax:r,bitrateMin:i}=this._encoderConfig;if(null==i||null==r){let{max:a,min:o}=function(e,t,n,r,i){let a=VD("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===a)return{min:r,max:i};if(void 0===i){var o;let s=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===a?4*s:2*s,r=null!==(o=r)&&void 0!==o?o:s}else{var s;r=null!==(s=r)&&void 0!==s?s:Math.floor(i/10)}return{min:r,max:i}}(e,t,n,i,r);this._encoderConfig.bitrateMin=o,this._encoderConfig.bitrateMax=a,ik.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(a,", brMin: ").concat(o,"]"))}}getVideoElementVisibleStatus(){try{var e,t;let n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null===n||void 0===n?void 0:n.parentElement},{element:i,slot:a}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){let e=RL.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;let e=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(yi){throw new mL(fL.GET_VIDEO_ELEMENT_VISIBLE_ERROR,yi.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new mL(fL.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=RV(RV({},r),Kj(t))),r=eD(r);let i=uD(8,"track-video-cloned-"),a=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,eD(this._scalabilityMode),this._optimizationMode,i,eD(this._hints));return t&&r&&a.setEncoderConfiguration(r),ik.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new mL(fL.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new mL(fL.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(nD((()=>{hk.reportApiInvoke(null,{name:DL.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:kL.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!VD("ENABLE_VIDEO_SEI")||!VD("ENABLE_ENCODED_TRANSFORM"))return void ik.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new mL(fL.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let t=this.getRTCRtpTransceiver();if(!t)return void ik.warning("Video track is not published, SEI can not be send");let n=t.sender.getParameters();if(0===n.codecs.length)return;let r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r?this.safeEmit("sei-to-send",e):ik.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(mV.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await zL(this,eV.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await zL(this,eV.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mV.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(_V.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(_V.REQUEST_CONSTRAINTS)}},TV(SG.prototype,"play",[QB,ZB],Object.getOwnPropertyDescriptor(SG.prototype,"play"),SG.prototype),TV(SG.prototype,"stop",[$B],Object.getOwnPropertyDescriptor(SG.prototype,"stop"),SG.prototype),TV(SG.prototype,"setEnabled",[eG,tG,nG],Object.getOwnPropertyDescriptor(SG.prototype,"setEnabled"),SG.prototype),TV(SG.prototype,"setMuted",[rG,iG,aG],Object.getOwnPropertyDescriptor(SG.prototype,"setMuted"),SG.prototype),TV(SG.prototype,"setEncoderConfiguration",[oG,sG],Object.getOwnPropertyDescriptor(SG.prototype,"setEncoderConfiguration"),SG.prototype),TV(SG.prototype,"getStats",[cG],Object.getOwnPropertyDescriptor(SG.prototype,"getStats"),SG.prototype),TV(SG.prototype,"setBeautyEffect",[lG,dG],Object.getOwnPropertyDescriptor(SG.prototype,"setBeautyEffect"),SG.prototype),TV(SG.prototype,"getCurrentFrameData",[uG],Object.getOwnPropertyDescriptor(SG.prototype,"getCurrentFrameData"),SG.prototype),TV(SG.prototype,"getCurrentFrameImage",[hG],Object.getOwnPropertyDescriptor(SG.prototype,"getCurrentFrameImage"),SG.prototype),TV(SG.prototype,"setBitrateLimit",[pG],Object.getOwnPropertyDescriptor(SG.prototype,"setBitrateLimit"),SG.prototype),TV(SG.prototype,"setOptimizationMode",[fG],Object.getOwnPropertyDescriptor(SG.prototype,"setOptimizationMode"),SG.prototype),TV(SG.prototype,"setScalabiltyMode",[mG],Object.getOwnPropertyDescriptor(SG.prototype,"setScalabiltyMode"),SG.prototype),TV(SG.prototype,"updateMediaStreamTrackResolution",[_G],Object.getOwnPropertyDescriptor(SG.prototype,"updateMediaStreamTrackResolution"),SG.prototype),TV(SG.prototype,"pipe",[gG],Object.getOwnPropertyDescriptor(SG.prototype,"pipe"),SG.prototype),TV(SG.prototype,"unpipe",[EG],Object.getOwnPropertyDescriptor(SG.prototype,"unpipe"),SG.prototype),TV(SG.prototype,"close",[vG],Object.getOwnPropertyDescriptor(SG.prototype,"close"),SG.prototype),TV(SG.prototype,"replaceTrack",[yG],Object.getOwnPropertyDescriptor(SG.prototype,"replaceTrack"),SG.prototype),SG),HG=(bG=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),TG=tB(),CG=CD("CameraVideoTrack","_enabledMutex"),wG=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),RG=tB(),AG=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),IG=tB(),NG=uk({argsMap:e=>[e.getTrackId()]}),OG=class e extends WG{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,a){super(e,Kj(t.encoderConfig),r,i,a),CV(this,"_config",void 0),CV(this,"_originalConstraints",void 0),CV(this,"_constraints",void 0),CV(this,"_enabled",!0),CV(this,"_deviceName","default"),CV(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(tL()||nL())&&!function(){let e=UP();if(e.os!==LP.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&aL()&&this._enabled&&!this._isClosed&&(ik.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=Kj(this._config.encoderConfig),PV.on(jj.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),PV.on(jj.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(ik.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{let t=await YV.getDeviceById(e),n={};n.video=RV({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await HV(n,this.getTrackId())}catch(aa){throw ik.error("[".concat(this.getTrackId(),"] setDevice failed"),aa.toString()),r=await HV({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),aa}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(na){throw ik.error("[".concat(this.getTrackId(),"] setDevice error"),na.toString()),na}else try{let t=await YV.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(na){throw ik.error("[".concat(this.getTrackId(),"] setDevice error"),na.toString()),na}ik.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){ik.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));let t={video:RV(RV({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await HV(t,this.getTrackId())}catch(n){throw ik.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),n.toString()),e=await HV({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),n}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=RV({},t.video),ik.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(ik.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let e=await HV({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await zL(this,eV.NEED_ENABLE_TRACK,this)}catch(yi){throw ik.error("[".concat(this.getTrackId(),"] setEnabled true error"),yi.toString()),yi}this.updateMediaStreamTrackResolution(),ik.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await zL(this,eV.NEED_DISABLE_TRACK,this)}catch(yi){throw ik.error("[".concat(this.getTrackId(),"] setEnabled to false error"),yi.toString()),yi}ik.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new mL(fL.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=Kj(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);let n=$L(this._config);n.encoderConfig=e;let r=lB(n);(WP()||zP()||iL())&&(r.deviceId=void 0),ik.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(aa){let t=new mL(fL.UNEXPECTED_ERROR,aa.toString());throw ik.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(tV.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await zL(this,eV.NEED_UPDATE_VIDEO_ENCODER,this)}catch(aa){return aa.throw(ik)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((zP()||iL())&&this._enabled&&!this._isClosed&&PV.duringInterruption){let e=async()=>{PV.off(jj.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(ik.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};PV.on(jj.IOS_INTERRUPTION_END,e)}else ik.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(oV.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,n=YV.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){let e=await HV({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),PV.off(jj.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),PV.off(jj.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=RV(RV({},r),Kj(t))),r=eD(r);let i=uD(8,"track-cam-cloned-"),a=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,eD(RV(RV({},this._config),{},{encoderConfig:r})),eD(this._constraints),eD(this._scalabilityMode),this._optimizationMode,i);return t&&r&&a.setEncoderConfiguration(r),ik.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),a}bindProcessorContextEvents(){this.processorContext.on(_V.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{let n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(r){n(r)}})),this.processorContext.on(_V.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}},TV(OG.prototype,"setDevice",[bG,TG],Object.getOwnPropertyDescriptor(OG.prototype,"setDevice"),OG.prototype),TV(OG.prototype,"setEnabled",[CG,wG,RG],Object.getOwnPropertyDescriptor(OG.prototype,"setEnabled"),OG.prototype),TV(OG.prototype,"setEncoderConfiguration",[AG,IG],Object.getOwnPropertyDescriptor(OG.prototype,"setEncoderConfiguration"),OG.prototype),TV(OG.prototype,"close",[NG],Object.getOwnPropertyDescriptor(OG.prototype,"close"),OG.prototype),OG);function qG(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=RV(RV({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?ik.debug("[".concat(e,"] set content hint to"),n.optimizationMode):ik.debug("[".concat(e,"] set content hint failed")))):ik.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var zG,KG,YG,JG,XG,QG,ZG,$G,eW,tW,nW,rW,iW=class extends AV{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(uD(5,""))),CV(this,"_userId",void 0),CV(this,"_uintId",void 0),CV(this,"_isDestroyed",!1),CV(this,"store",void 0),CV(this,"processor",void 0),CV(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,ik.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}},aW=(zG=uk({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),KG=uk({argsMap:e=>[e.getTrackId()]}),YG=uk({argsMap:(e,t)=>[e.getTrackId(),t.name]}),JG=uk({argsMap:e=>[e.getTrackId()]}),TV((XG=class extends iW{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==vV.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),CV(this,"_videoVisibleTimer",null),CV(this,"_previousVideoVisibleStatus",void 0),CV(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),CV(this,"trackMediaType",cV.VIDEO),CV(this,"_videoWidth",void 0),CV(this,"_videoHeight",void 0),CV(this,"_player",void 0),CV(this,"processorDestination",void 0),CV(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new rB(this.getTrackId(),"remote"),this.processorDestination=new nB(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return nD((()=>{ik.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),KL(this,eV.GET_STATS)||RV({},fV)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){let t=document.getElementById(e);t?e=t:(ik.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}ik.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let n=RV(RV({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new VG(n):this._player=new GG(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(sV.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=e=>{this.safeEmit(sV.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{let e=this.getVideoElementVisibleStatus();this.safeEmit(sV.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),VD("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,ik.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){cB(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(pD)}_updatePlayerSource(){ik.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null===n||void 0===n?void 0:n.parentElement},{element:i,slot:a}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&a instanceof HTMLElement){let e=RL.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;let e=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(na){throw new mL(fL.GET_VIDEO_ELEMENT_VISIBLE_ERROR,na.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new mL(fL.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(mV.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mV.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(aV.SEI_RECEIVED,e)}}).prototype,"play",[zG],Object.getOwnPropertyDescriptor(XG.prototype,"play"),XG.prototype),TV(XG.prototype,"stop",[KG],Object.getOwnPropertyDescriptor(XG.prototype,"stop"),XG.prototype),TV(XG.prototype,"pipe",[YG],Object.getOwnPropertyDescriptor(XG.prototype,"pipe"),XG.prototype),TV(XG.prototype,"unpipe",[JG],Object.getOwnPropertyDescriptor(XG.prototype,"unpipe"),XG.prototype),XG),oW=(QG=uk({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),ZG=uk({argsMap:(e,t)=>[e.getTrackId(),t]}),$G=uk({argsMap:e=>[e.getTrackId()]}),eW=uk({argsMap:e=>[e.getTrackId()]}),tW=uk({argsMap:(e,t)=>[e.getTrackId(),t.name]}),nW=uk({argsMap:e=>[e.getTrackId()]}),TV((rW=class extends iW{get isPlaying(){return this._useAudioElement?eB.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),CV(this,"trackMediaType",cV.AUDIO),CV(this,"_source",void 0),CV(this,"_useAudioElement",!0),CV(this,"_volume",100),CV(this,"processorContext",void 0),CV(this,"processorDestination",void 0),CV(this,"_played",!1),CV(this,"_bypassWebAudio",!1),VD("DISABLE_WEBAUDIO")?(this._source=new oB,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new FV(e,!0),VD("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(lV.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(sV.FIRST_FRAME_DECODED)})),this.processorContext=new aB(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new iB(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(lV.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(lV.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(lV.ON_AUDIO_BUFFER),this._source.on(lV.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?eB.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!Uj())throw new mL(fL.NOT_SUPPORTED,"your browser does not support setting the audio output device");await eB.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return nD((()=>{ik.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),KL(this,eV.GET_STATS)||RV({},hV)}play(){ik.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(ik.debug("[".concat(this.getTrackId(),"] use audio element to play")),eB.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){ik.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?eB.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];ik.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&eB.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new mL(fL.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new mL(fL.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new mL(fL.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(mV.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(mV.ON_NODE,(e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(mV.ON_TRACK),this.processorDestination.removeAllListeners(mV.ON_NODE)}}).prototype,"setVolume",[QG],Object.getOwnPropertyDescriptor(rW.prototype,"setVolume"),rW.prototype),TV(rW.prototype,"setPlaybackDevice",[ZG],Object.getOwnPropertyDescriptor(rW.prototype,"setPlaybackDevice"),rW.prototype),TV(rW.prototype,"play",[$G],Object.getOwnPropertyDescriptor(rW.prototype,"play"),rW.prototype),TV(rW.prototype,"stop",[eW],Object.getOwnPropertyDescriptor(rW.prototype,"stop"),rW.prototype),TV(rW.prototype,"pipe",[tW],Object.getOwnPropertyDescriptor(rW.prototype,"pipe"),rW.prototype),TV(rW.prototype,"unpipe",[nW],Object.getOwnPropertyDescriptor(rW.prototype,"unpipe"),rW.prototype),rW),sW=new class extends OL{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),CV(this,"_lastHiddenTime",0),CV(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),ik.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}},cW=class extends OL{constructor(e,t){super(),CV(this,"trackMediaType",cV.DATA),CV(this,"_version",1),CV(this,"_type",3),CV(this,"_config",void 0),CV(this,"_originDataChannel",void 0),CV(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),CV(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),CV(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return VD("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new hS(((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();let n=setTimeout((()=>{var e;t(new mL(fL.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new mL(fL.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new mL(fL.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[bV.OPEN,bV.CLOSE,bV.ERROR].forEach((t=>{let n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)}))}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach((t=>{let[n,r]=t;e.removeEventListener(n,r)})),this._datachannelEventMap.clear()}},lW=class extends cW{constructor(e){super(e),CV(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(VD("SHOW_DATASTREAM2_LOG")&&ik.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit(bV.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}},dW=class extends cW{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);let n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}};function uW(){let e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout((()=>kj.revokeObjectURL(e)),0),new Worker(kj.createObjectURL(e))}var hW=new Map,pW=new Map;function fW(e,t,n){let r=new Uint8Array(e,t,n),i=[],a=0;for(;i.length<n;)a+3<n&&0===r[a]&&0===r[a+1]&&3===r[a+2]&&(0===r[a+3]||1===r[a+3]||2===r[a+3]||3===r[a+3])?(i.push(r[a],r[a+1],r[a+3]),a+=4):(i.push(r[a]),a++);return new Uint8Array(i)}var mW=new Map;var _W=new Map;!function(){let e=UP();xj.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),xj.getStreamFromExtension=e.name===DP.CHROME&&Number(e.version)>34,xj.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(n){}return e.close(),t}(),xj.supportMinBitrate=e.name===DP.CHROME||e.name===DP.EDGE,xj.supportSetRtpSenderParameters=function(){let e=UP();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!cL()||!(!WP()&&!BP())||e.name===DP.FIREFOX&&Number(e.version)>=64)}(),e.name===DP.SAFARI&&(Number(e.version)>=14?xj.supportDualStream=!0:xj.supportDualStream=!1),xj.webAudioMediaStreamDest=function(){let e=UP();return!(e.name===DP.SAFARI&&Number(e.version)<12)}(),xj.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,xj.supportWebGL=typeof WebGLRenderingContext<"u",xj.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,cL()||(xj.webAudioWithAEC=!0),xj.supportShareAudio=function(){let e=UP();return(e.os===LP.WIN_10||e.os===LP.WIN_81||e.os===LP.WIN_7||e.os===LP.LINUX||e.os===LP.MAC_OS||e.os===LP.CHROMIUM_OS)&&e.name===DP.CHROME&&Number(e.version)>=74}(),xj.supportDataChannel=!!(KP(76)||function(){let e=UP();return!(e.name!==DP.FIREFOX||!e.osVersion)&&Number(e.version)>=68}()||XP(14)),xj.supportPCSetConfiguration=function(){let e=window.RTCPeerConnection;return!qP()&&!!e&&e.prototype.setConfiguration instanceof Function}(),xj.supportWebRTCEncodedTransform=function(){let e=UP();return"Chrome"===e.name&&Number(e.version)>=86||"Safari"===e.name&&Number(e.version)>=15}(),xj.supportWebRTCInsertableStream=function(){let e=UP();return(e.name===DP.CHROME||e.name===DP.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),xj.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,xj.supportWebCrypto=typeof window<"u"&&void 0!==window.crypto&&void 0!==window.crypto.subtle,ZL((()=>{xj.supportDualStreamEncoding=function(){let e=UP();return!!VD("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&VD("CHROME_DUAL_STREAM_USE_ENCODING"))}(),ik.info("browser compatibility",JSON.stringify(xj),JSON.stringify(e))}))}();var gW=class e extends OL{constructor(e,t){super(),SI(this,"signal",void 0),SI(this,"token",void 0),SI(this,"tokenTimeout",void 0),SI(this,"tokenInterval",void 0),SI(this,"_sequence",0),SI(this,"userMap",new Map),SI(this,"encoder",new TextEncoder),this.signal=e,this.token=t;let n=()=>{this.signal.connectionState===mx.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*VD("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,r,i){var a,o,s;if(0===this.userMap.size)return;let c=Array.from($M(a=this.userMap).call(a))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!==(o=r)&&void 0!==o?o:uD(6,""),i=null!==(s=i)&&void 0!==s?s:this._sequence++;let l={_id:r,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(c)};VD("SHOW_P2P_LOG")&&ik.debug("send message",l,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(l)).forEach((e=>{this.signal.request(gx.DATA_STREAM,{payload:iD(this.encoder.encode(e))})}));let d=new hS(((t,i)=>{let a=window.setTimeout((()=>{this.off("res-@".concat(r,"_ack"),o),this.off("res-@".concat(r),c),this.off(dM.ABORT,s),ik.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),0===this.userMap.size?i(new mL(fL.INVALID_REMOTE_USER)):i(new mL(fL.TIMEOUT))}),VD("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),o=()=>{a&&window.clearTimeout(a),this.off(dM.ABORT,s),n&&t()},s=()=>{a&&window.clearTimeout(a),this.off("res-@".concat(r,"_ack"),o),this.off("res-@".concat(r),c),i(new mL(fL.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(dM.ABORT,s),this.once("res-@".concat(r,"_ack"),o);let c=(n,c)=>{d=!0,a&&window.clearTimeout(a),this.off("res-@".concat(r,"_ack"),o),this.off(dM.ABORT,s),"success"===n?t(c):i(new mL(fL.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))},d=!1;n||(this.once("res-@".concat(r),c),dD(VD("SIGNAL_REQUEST_TIMEOUT")).then((()=>{d||ik.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(l))})))}));try{return await d}catch(la){if(la.code===fL.TIMEOUT)return await this.send(e,t,n,r,i);throw la}}onMessage(e){var t;let n,{_uid:r}=e,i=this.userMap.get(r);if(i)n=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==lM.CHECK)return;let{token:t}=e;n=new Map,i={uid:r,isStart:!0,token:t,splitMessageMap:n,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,i),this.signal.emit(vx.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in e&&"total"in e){var a;let{id:t,total:i}=e,o=null!==(a=n.get(t))&&void 0!==a?a:[];if(o.push(e),n.has(t)||n.set(t,o),o.length!==i)return;{let i=IT(o).call(o,((e,t)=>e.index-t.index)).map((e=>e.payload)).join("");n.delete(t),(e=JSON.parse(i))._uid=r}}let{_type:o,token:s}=e;if(_h(t=[lM.ACK,lM.CHECK]).call(t,o))return o===lM.CHECK&&this.handleCheckToken(i,s),void this.receiveMessage(e);s==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):ik.debug('Receive unexpected message", '.concat(s,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){let e={_id:uD(6,""),token:this.token,_type:lM.CHECK};VD("SHOW_P2P_LOG")&&ik.debug("send message",e),this.signal.request(gx.DATA_STREAM,{payload:iD(this.encoder.encode(JSON.stringify(e)))})}ack(e){let t={_id:e,_type:lM.ACK,token:this.token};VD("SHOW_P2P_LOG")&&ik.debug("send message",t),this.signal.request(gx.DATA_STREAM,{payload:iD(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(lM.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){let t=()=>{this.userMap.forEach((e=>{let{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){let r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}}))};if(!e)return void t();let{_uid:n,_seq:r}=e,i=this.userMap.get(n),{receivedMessagesMap:a,isStart:o,nextExpectedSequenceNumber:s}=i;if(r<s)return this.ack(e._id),void ik.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));a.set(r,e),o&&r===s&&(this.receiveMessage(e),a.delete(s),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){let{_id:t,_type:n,_message:r,_uid:i}=e;if(VD("SHOW_P2P_LOG")&&ik.debug("receive message",e),t){let a;switch(e._type!==lM.ACK&&(r&&(a=JSON.parse(r)),this.ack(e._id)),e._type){case lM.CANDIDATE:case lM.CONTROL:this.signal.emit(n,a,i);break;case lM.PUBLISH:case lM.UNPUBLISH:case lM.RESTART_ICE:case lM.CALL:a.uid=i,qL(this.signal,n,a).then((t=>{this.response(e._id,t)})).catch((()=>{this.response(e._id,void 0,!0)}));break;case lM.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case lM.RESPONSE:{let{success:e,message:n}=a;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(t){if(t.length<e.MAX_MESSAGE_SIZE)return[t];let n=[],{remoteToken:r}=JSON.parse(t),i=uD(6,""),a=0,o=800,s=Math.ceil(t.length/o);for(;t.length>0;){a++;let c={id:i,index:a,total:s,payload:t.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(c).length>e.MAX_MESSAGE_SIZE?o-=50:(n.push(c),t=t.slice(o))}return n.map((e=>JSON.stringify(e)))}handleCheckToken(e,t){return e.token!==t?(ik.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{ik.debug("token timeout, ".concat(t)),this.reset(e.uid)}),VD("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let e=await qL(this.signal,lM.CALL,void 0),t=await this.send(lM.CALL,e);this.signal.emit(_x.P2P_CONNECTION,t,!0)}async reset(e,t){let n=this.userMap.get(e);n&&(this.emit(dM.ABORT),this.signal.emit(vx.ON_USER_OFFLINE,{uid:n.uid,reason:hM.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(ik.debug("change local token from ".concat(t," to ").concat(t)),this.token=uD(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(dM.ABORT)}};SI(gW,"MAX_SIZE",1),SI(gW,"MAX_MESSAGE_SIZE",1024);var EW=class extends OL{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===mx.CONNECTED?this.emit(_x.WS_CONNECTED):e===mx.RECONNECTING?this.emit(_x.WS_RECONNECTING,this._websocketReconnectReason):e===mx.CLOSED&&this.emit(_x.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),SI(this,"_disconnectedReason",void 0),SI(this,"_websocketReconnectReason",void 0),SI(this,"_connectionState",mx.CLOSED),SI(this,"reconnectToken",void 0),SI(this,"p2pToken",void 0),SI(this,"websocket",void 0),SI(this,"openConnectionTime",void 0),SI(this,"clientId",void 0),SI(this,"lastMsgTime",Date.now()),SI(this,"uploadCache",[]),SI(this,"uploadCacheInterval",void 0),SI(this,"rttRolling",new ND(5)),SI(this,"pingpongTimer",void 0),SI(this,"pingpongTimeoutCount",0),SI(this,"joinResponse",void 0),SI(this,"multiIpOption",void 0),SI(this,"initError",void 0),SI(this,"spec",void 0),SI(this,"store",void 0),SI(this,"_external_signal",void 0),SI(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(_x.ON_BINARY_DATA,e.data);let t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){let e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case vx.ON_DATA_STREAM:return void this.handleDataStream(t._message);case vx.MUTE_AUDIO:case vx.MUTE_VIDEO:case vx.ON_P2P_LOST:case vx.ON_USER_ONLINE:return;case vx.ON_USER_OFFLINE:let{uid:e}=t._message;return ik.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===vx.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===vx.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(UL.UID_BANNED);break;case 15:this.close(UL.IP_BANNED);break;case 16:this.close(UL.CHANNEL_BANNED)}if(t._type===vx.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case fx.ERR_LICENSE_MISSING:this.close(UL.LICENSE_MISSING);break;case fx.ERR_LICENSE_EXPIRED:this.close(UL.LICENSE_EXPIRED);break;case fx.ERR_LICENSE_MINUTES_EXCEEDED:this.close(UL.LICENSE_MINUTES_EXCEEDED);break;case fx.ERR_LICENSE_PERIOD_INVALID:this.close(UL.LICENSE_PERIOD_INVALID);break;case fx.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(UL.LICENSE_MULTIPLE_SDK_SERVICE);break;case fx.ERR_LICENSE_ILLEGAL:this.close(UL.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new NM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,VD("JOIN_GATEWAY_USE_DUAL_DOMAIN"),VD("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===mx.CONNECTED&&this.reconnect("retry",GL.OFFLINE)})),this.p2pToken=uD(6,""),this._external_signal=new gW(this,this.p2pToken)}async request(e,t,n,r){let i=uD(6,""),a={_id:i,_type:e,_message:t},o=this.websocket.connectionID,s=()=>new hS(((e,t)=>{if(this.connectionState===mx.CONNECTED)return e();let n=()=>{this.off(_x.WS_CLOSED,r),e()},r=()=>{this.off(_x.WS_CONNECTED,n),t(new mL(fL.WS_ABORT))};this.once(_x.WS_CONNECTED,n),this.once(_x.WS_CLOSED,r)}));if(this.connectionState!==mx.CONNECTING&&this.connectionState!==mx.RECONNECTING||e===gx.JOIN||e===gx.REJOIN||await s(),this.websocket.sendMessage(a,!0),r)return;let c=new hS(((n,r)=>{let a=!1,s=(r,i)=>{a=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(_x.WS_CLOSED,c),this.off(_x.WS_RECONNECTING,c),this.emit(_x.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);let c=()=>{r(new mL(fL.WS_ABORT,"type: ".concat(e))),this.off(_x.WS_CLOSED,c),this.off(_x.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(_x.WS_CLOSED,c),this.once(_x.WS_RECONNECTING,c),dD(VD("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==o||a||(ik.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(_x.REQUEST_TIMEOUT,e,t))}))})),l=null;try{l=await c}catch(fa){if(this.connectionState===mx.CLOSED||e===gx.LEAVE)throw new mL(fL.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?fa.throw():e===gx.JOIN||e===gx.REJOIN?null:(await s(),await this.request(e,t))}if(l.isSuccess)return l.message;let d=Number(l.message.error_code||l.message.code),u=_M(d),h=new mL(fL.UNEXPECTED_RESPONSE,"".concat(u.desc,": ").concat(l.message.error_str),{code:d,data:l.message,desc:u.desc});return"success"===u.action?l.message:(ik.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(d,", message: ").concat(u.desc,", action: ").concat(u.action)),d===fx.ERR_TOO_MANY_BROADCASTERS?((e===gx.JOIN||e===gx.REJOIN)&&(this.initError=h,this.close()),h.throw()):"failed"===u.action?h.throw():"quit"===u.action?(this.initError=h,this.close(),h.throw()):(d===fx.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,ik.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",GL.MULTI_IP)):this.reconnect(u.action,GL.SERVER_ERROR),e===gx.JOIN||e===gx.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new hS((n=>{let r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void ik.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ex.WRTC_STATS,t)}upload(e,t){let n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(r){let e=VD("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==mx.CONNECTED)return;let e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),VD("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new hS(((t,n)=>{this.once(_x.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(_x.WS_CLOSED,(()=>n(this.initError||new mL(fL.WS_ABORT)))),this.connectionState=mx.CONNECTING,this.websocket.init(e).catch(n)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||UL.LEAVE,this.connectionState=mx.CLOSED,ik.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=uD(6,""),this._external_signal.clear(),this._external_signal=new gW(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(_x.ABORT_P2P_EXECUTION);let e=await qL(this,_x.REQUEST_JOIN_INFO),t=await this.request(gx.JOIN,e);if(!t)return this.emit(_x.REPORT_JOIN_GATEWAY,fL.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(_x.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=mx.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;let n=rD(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||_h(t=Object.values(lM)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(vx.ON_DATA_STREAM,e)}catch(n){this.emit(vx.ON_DATA_STREAM,e)}}handleNotification(e){ik.debug("[".concat(this.clientId,"] receive notification: "),e);let t=_M(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(UL.UID_BANNED),void this.close()):void this.reconnect(t.action,GL.SERVER_ERROR);ik.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=VD("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(ik.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>VD("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",GL.TIMEOUT):this.request(gx.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;let e=Date.now()-t;this.rttRolling.add(e),VD("REPORT_STATS")&&this.send(gx.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWebsocketEvents(){this.websocket.on(Sx.RECONNECT_WAITTING_FINISH,(e=>{this.emit(_x.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(Sx.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(_x.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(Sx.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Sx.CLOSED,(()=>{this.connectionState=mx.CLOSED})),this.websocket.on(Sx.FAILED,(()=>{this._disconnectedReason=UL.NETWORK_ERROR,this.connectionState=mx.CLOSED})),this.websocket.on(Sx.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===mx.CONNECTED?this.connectionState=mx.RECONNECTING:this.connectionState=mx.CONNECTING})),this.websocket.on(Sx.WILL_RECONNECT,((e,t,n)=>{"retry"!==e?(ik.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):ik.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)})),this.websocket.on(Sx.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((e=>{if(this.emit(_x.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof mL&&e.code===fL.UNEXPECTED_RESPONSE&&e.data.code===fx.ERR_NO_AUTHORIZED)return ik.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",GL.SERVER_ERROR);ik.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",GL.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(Sx.REQUEST_NEW_URLS,((e,t)=>{qL(this,_x.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(Sx.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(vx.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}},vW={exports:{}};vW.exports=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>b,Printer:()=>A,parse:()=>P,print:()=>L});let r,i="\n",a="".concat("\r").concat(i),o=" ";function s(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function l(e){return c(e)||e>="\x80"&&e<="\xff"}function d(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function u(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function f(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function m(e){return h(e)||s(e)||"+"===e||"/"===e}function _(e){return s(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function g(e){return h(e)||s(e)||"+"===e||"/"===e}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(r||(r={}));class S{consumeText(e,t){let n=t;for(;n<e.length;){let t=e[n];if("\0"===t||"\r"===t||t===i)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,o)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===o)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&s(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");let r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]&&(n+=1,n=this.consumeIP4Address(e,n)),n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(r){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(i){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;s(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,l)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(r){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){let n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3,r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let a=0;a<3;a++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!u(e[t]))throw new Error("Invalid integer.");for(t+=1;s(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!u(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&s(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,d)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(u(e[n])&&(n+=1);s(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,o)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,s),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!u(e[t]))throw new Error("Invalid repeat interval");for(t+=1;s(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,s)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class b extends S{constructor(){super(),y(this,"records",[]),y(this,"currentLine",0)}parse(e){let t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!db(e).call(e))).map(this.parseLine),this.currentLine=0;let n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),a=this.parseInformation(),o=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),d=this.parseBandWidth(),u=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:a,uri:o,emails:s,phones:c,connection:l,bandwidths:d,timeFields:u,key:h,attributes:p,mediaDescriptions:f}}getCurrentRecord(){let e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===i)return"\r"===e[t-1]?a:i;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){let e=new C;for(;this.currentLine<this.records.length;){let t=this.getCurrentRecord();if(t.type!==r.ATTRIBUTE)break;let n={attField:this.extractOneOrMore(t,(e=>d(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,f)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){let t=new w(e);for(;this.currentLine<this.records.length;){let e=this.getCurrentRecord();if(e.type!==r.ATTRIBUTE)break;let n={attField:this.extractOneOrMore(e,(e=>d(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,f)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){let e=this.getCurrentRecord();if(e.type===r.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let e=this.getCurrentRecord();if(e.type===r.ZONE_ADJUSTMENTS){let n=[];for(;;)try{let t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);let i=this.extract(e,this.consumeTypedTime);n.push({time:t,typedTime:i,back:r})}catch(t){break}if(0===n.length)throw new Error("Invalid zone adjustments");return this.currentLine++,n}return[]}parseRepeat(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==r.REPEAT)break;{let n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){let t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(n){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){let e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){let e=[];for(;this.currentLine<this.records.length;){let t=this.getCurrentRecord();if(t.type!==r.BANDWIDTH)break;{let n=this.extractOneOrMore(t,d);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;let r=this.extractOneOrMore(t,s);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){let e=this.getCurrentRecord();if(e.type!==r.VERSION)throw new Error("first sdp record must be version");let t=e.value.slice(0,this.consumeOneOrMore(e.value,0,s));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){let e=this.getCurrentRecord();if(e.type!==r.ORIGIN)throw new Error("second line of sdp must be origin");let t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);let n=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);let i=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);let a=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let o=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:i,nettype:a,addrtype:o,unicastAddress:c}}parseSessionName(){let e=this.getCurrentRecord();if(e.type===r.SESSION_NAME){let t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){let e=this.getCurrentRecord();if(e.type!==r.INFORMATION)return;let t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){let e=this.getCurrentRecord();if(e.type===r.URI)return this.currentLine++,e.value}parseEmail(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==r.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){let e=[];for(;;){let t=this.getCurrentRecord();if(t.type!==r.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){let e=this.getCurrentRecord();if(e.type===r.CONNECTION){let t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let n=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);let r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){let e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);let r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");let i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){let e=[];for(;this.getCurrentRecord().type===r.TIME;){let t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){let e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===r.MEDIA;){let t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),a=this.parseKey(),o=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:a,attributes:o})}return e}parseConnections(){let e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===r.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){let t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(n){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];let a=t.call(this,e.value,e.cur,...r),o=e.value.slice(e.cur,a);return e.cur=a,o}extractOneOrMore(e,t){let n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==o)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class T extends S{constructor(){super(...arguments),y(this,"attributes",void 0),y(this,"digested",!1)}extractOneOrMore(e,t,n){let r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[a,o]=n||[];if("number"==typeof a&&i.length<a)throw new Error("error in length, should be more or equal than ".concat(a," characters."));if("number"==typeof o&&i.length>o)throw new Error("error in length, should be less or equal than ".concat(o," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==o)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];let a=t.call(this,e.attValue,e._cur,...r),o=e.attValue.slice(e._cur,a);return e._cur=a,o}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(Ea){if(this.atEnd(e))break;throw Ea}}this.attributes.iceOptions=t}parseFingerprint(e){let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){let t,n=this.extractOneOrMore(e,s);"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),t=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeTill,o),i=v(v({entry:parseInt(n,10)},t&&{direction:t}),{},{extensionName:r});this.peekChar(e)===o&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class C extends T{constructor(){super(...arguments),y(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(Ia){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),Ia}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){let t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,_)}parseIdentity(e){let t=this.extractOneOrMore(e,g),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;){this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");let r=this.extractOneOrMore(e,(e=>e!==o&&f(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===o&&this.consumeAttributeSpace(e);let t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(n){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{let n=this.extract(e,this.consumeTill,o);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class w extends T{constructor(e){super(),y(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(Ia){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),Ia}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){let t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);let n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);let r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let i=this.extractOneOrMore(e,s,[1,10]);this.consumeAttributeSpace(e);let a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);let l=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);let d={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:a,port:l,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),d.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),d.relPort=this.extract(e,this.consumePort));this.peekChar(e)===o;){this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),d.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(d)}parseRemoteCandidate(e){let t=[];for(;;){let r=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);let i=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);let a=this.extract(e,this.consumePort);t.push({componentId:r,connectionAddress:i,port:a});try{this.consumeAttributeSpace(e)}catch(n){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){let t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);let n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");let r={encodingName:n,clockRate:this.extractOneOrMore(e,s)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));let i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){let t=this.extractOneOrMore(e,s);this.consumeAttributeSpace(e);let n,r=this.extract(e,this.consumeTill,":");":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),n=this.extract(e,this.consumeTill));let i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[r]=n:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[r]:n}})}parseFmtp(e){let t=this.extract(e,this.consumeTill,o);this.consumeAttributeSpace(e);let n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=db(t).call(t);let i="string"==typeof n?db(n).call(n):null;"string"==typeof t&&t.length>0&&(r[t]=i)}));let i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){let t={},n=this.extract(e,this.consumeTill,"=");e._cur++;let r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){let n=this.extract(e,this.consumeTill,"=");e._cur++;let r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,o),this.consumeAttributeSpace(e);let n,r=this.extract(e,this.consumeTill,o);if("trr-int"===r)n={type:r,interval:this.extract(e,this.consumeTill)};else{let t={type:r};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===o&&(t.additional=this.extract(e,this.consumeTill))),n=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(n);else{let e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(n):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[n]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let t={port:this.extract(e,this.consumePort)};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,d),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){let t={id:this.extractOneOrMore(e,d,[1,64])};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,d,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){let t=this.extractOneOrMore(e,(e=>h(e)||s(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);let n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===o){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");let t=[];for(;;){let n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(r){break}}n.payloads=t,this.peekChar(e)===o&&this.extract(e,this.consume,o)}for(;;){let t=this.extract(e,this.consumeToken);switch(t){case"depend":{let r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{let r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(i){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,s,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,s,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){let t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);let t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(r){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class A{constructor(){R(this,"eol",a)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(let n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(let n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(let n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(let n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(let e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(let n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(let n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(let n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new N(this.eol).print(e)}printMediaAttributes(e){return new O(this.eol).print(e)}}class I{constructor(e){R(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(o)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(o).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(o).concat(e.extensionName).concat(e.extensionAttributes?"".concat(o).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class N extends I{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(o).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(o).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(o,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(o).concat(e)))),t+this.eol}}class O extends I{print(e){let t=e.attributes,n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(o).concat(e.componentId).concat(o).concat(e.transport).concat(o).concat(e.priority).concat(o).concat(e.connectionAddress).concat(o).concat(e.port).concat(o,"typ").concat(o).concat(e.type).concat(e.relAddr?"".concat(o,"raddr").concat(o).concat(e.relAddr):"").concat(e.relPort?"".concat(o,"rport").concat(o).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(o).concat(t).concat(o).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(o)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";let t=e.payloads,n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(let r of t)n+=this.printRtpMap(r.payloadType,r.rtpMap),n+=this.printFmtp(r.payloadType,r.fmtp),n+=r.rtcpFeedbacks.map((e=>this.printRTCPFeedback(r.payloadType,e))).join("");return n}printFmtp(e,t){if(!t)return"";let n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(o).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(o).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(o).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(o),r=t;return"trr-int"===r.type?n+="ttr-int".concat(o).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(o).concat(r.parameter),r.additional&&(n+="".concat(o).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(o).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(o).concat(e.netType)),e.addressType&&(t+="".concat(o).concat(e.addressType)),e.address&&(t+="".concat(o).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(o).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(o).concat(e.direction);return e.payloads&&(t+="".concat(o,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(o).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(o).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function P(e){return(new b).parse(e)}function L(e,t){return(new A).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})();var yW=vW.exports;function SW(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VD("SVC_MODE");if(VD("ENABLE_SVC"))return e in cx?e:cx.L1T3}function bW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function TW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bW(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function CW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,{filterRTX:i,filterVideoFec:a,filterAudioFec:o,filterAudioCodec:s,filterVideoCodec:c}=t,{useXR:l}=n,d=[],u=[],h=[],p=[],f=!1,m=!1;if(yW.parse(e).mediaDescriptions.forEach((e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||f||(u=e.attributes.payloads,p=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||m||(d=e.attributes.payloads,h=e.attributes.extmaps,m=!0))})),!p||0===u.length)throw new Error("Cannot get video capabilities from SDP.");if(!h||0===d.length)throw new Error("Cannot get audio capabilities from SDP.");if(u.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),l&&e.rtcpFeedbacks.push({type:"rrtr"})})),d.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),l&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(d=d.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),u=u.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),a&&(u=u.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),o&&(d=d.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(null===s||void 0===s?void 0:s.length)>0&&(d=d.filter((e=>{var t;return _h(s).call(s,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),c&&(null===c||void 0===c?void 0:c.length)>0){let e=u.filter((e=>{var t;return _h(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}));u=e.concat(i?[]:GW(e,u))}let _=VD("UNSUPPORTED_VIDEO_CODEC");return _&&_.length>0&&(u=u.filter((e=>!(e.rtpMap&&_h(_).call(_,e.rtpMap.encodingName.toLowerCase()))))),{audioCodecs:d,videoCodecs:u,audioExtensions:h,videoExtensions:p}}function wW(e){let t,n,r=yW.parse(e);for(let i of r.mediaDescriptions){if(!t){let e=i.attributes.iceUfrag,n=i.attributes.icePwd;if(!e||!n)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:e,icePwd:n}}if(!n){let e=i.attributes.fingerprints;e.length>0&&(n={fingerprints:e})}}if(!n&&r.attributes.fingerprints.length>0&&(n={fingerprints:r.attributes.fingerprints}),!n||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:n}}function RW(e,t){let n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),a=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;let a=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?a:void 0})}));else if(r.length>0){let e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===a.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function AW(e,t,n){let r,{cname:i}=e;t?r=IW(t):(r=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}}))),ik.debug("Using candidates from gateway."));let a,o={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},s={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};switch(e.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}let c=jW(e.rtpCapabilities),l=[];return Array.isArray(n)&&n.length>0&&n.forEach((e=>{l.push({kind:Jx.VIDEO,ssrcId:e.v,rtx:e.v_rtx,mslabel:"".concat(e.v,"_").concat(e.a)},{kind:Jx.AUDIO,ssrcId:e.a,mslabel:"".concat(e.v,"_").concat(e.a)})})),{dtlsParameters:o,iceParameters:s,candidates:r,rtpCapabilities:c,setup:a,cname:i,preSSRCs:l}}function IW(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],ik.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),ik.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function NW(e,t,n){let r=[],i=[];return e.forEach((e=>{let{ssrcId:a,rtx:o}=e,s=uD(8,"track-"),c={ssrcId:a,attributes:TW({label:s,mslabel:n=n||uD(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(c),void 0!==o){let e={ssrcId:o,attributes:TW({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[a,o]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function OW(e,t){t instanceof kG&&e.attributes.payloads.forEach((e=>{var n;let r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";let i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!qP()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}))}function PW(e){let t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function LW(e,t){var n;if(!(t instanceof WG&&t._encoderConfig&&-1===t._hints.indexOf(tV.SCREEN_TRACK)))return;let r=t._encoderConfig;Mj().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((e=>{var t,n;_h(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),Mj().supportMinBitrate&&!_h(n=t._hints).call(n,tV.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((e=>{var t,n;_h(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(VD("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function DW(e){if("video"!==e.media.mediaType)return;let t=UP();if(t.name!==DP.SAFARI&&t.os!==LP.IOS)return;let n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function kW(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){let t=r.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&(e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))}(i,e.attributes.payloads).forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})})))}else if(!1===t.twcc){let t=e.attributes.extmaps.findIndex((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{let t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){let t=r.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));t&&(e.attributes.extmaps.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads).forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})})))}else if(!1===t.remb){let t=e.attributes.extmaps.findIndex((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{let t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function xW(e,t,n){if(qP()||"video"!==e.media.mediaType||!(t instanceof WG)||"vp9"!==n&&"vp8"!==n||"vp8"===n&&!VD("SIMULCAST")||"vp9"===n&&VD("ENABLE_SVC")||void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;let r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let s=1;s<r;s++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+s,attributes:$L(i.attributes)}),o.ssrcIds.push(i.ssrcId+s),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+s,attributes:$L(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+s,a.ssrcIds[1]+s]}));e.attributes.ssrcGroups.unshift(o)}async function MW(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});let r=(await n.createOffer()).sdp,{send:i,recv:a,sendrecv:o}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=CW(n,e,t,"sendonly"),i=CW(n,e,t,"recvonly"),a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(FW(r,i,"videoExtensions",a,o,s),FW(r,i,"videoCodecs",a,o,s),FW(r,i,"audioExtensions",a,o,s),FW(r,i,"audioCodecs",a,o,s),VD("RAISE_H264_BASELINE_PRIORITY")){let e=s.videoCodecs.findIndex((e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])}));if(-1!==e){let t=s.videoCodecs.findIndex((e=>{var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())}));if(t<e){ik.debug("raising H264 baseline profile priority");let n=s.videoCodecs[e];s.videoCodecs.splice(e,1),s.videoCodecs.splice(t,0,n)}-1!==t&&(o.videoCodecs=o.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==t&&VD("FILTER_SEND_H264_BASELINE")&&(a.videoCodecs=a.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))}}return{send:a,recv:o,sendrecv:s}}(e,t,r);try{n.close()}catch(s){}return{send:i,recv:a,sendrecv:o}}function UW(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=CW(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(FW(e,t,"videoExtensions",n,r,i),FW(e,t,"videoCodecs",n,r,i),FW(e,t,"audioExtensions",n,r,i),FW(e,t,"audioCodecs",n,r,i),VD("RAISE_H264_BASELINE_PRIORITY")){let e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){let t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){ik.debug("raising H264 baseline profile priority");let n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(r.videoCodecs=r.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}function FW(e,t,n,r,i,a){if("videoExtensions"===n||"audioExtensions"===n){let o=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return o.push(n),!0}))?a[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===o.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){let o=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return o.push(n),!0}))?a[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===o.indexOf(t)&&i[n].push(e)}))}}function jW(e){let t,n,{send:r,recv:i,sendrecv:a}=e;if(!a){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}return r?(t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},t.audioCodecs=[...r.audioCodecs,...a.audioCodecs],t.videoCodecs=[...r.videoCodecs,...a.videoCodecs],t.audioExtensions=[...r.audioExtensions,...a.audioExtensions],t.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):t=a,i?(n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n.audioCodecs=[...i.audioCodecs,...a.audioCodecs],n.videoCodecs=[...i.videoCodecs,...a.videoCodecs],n.audioExtensions=[...i.audioExtensions,...a.audioExtensions],n.videoExtensions=[...i.videoExtensions,...a.videoExtensions]):n=a,{send:t,recv:n}}function VW(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function BW(e,t,n,r){let i=[];if(e===Jx.VIDEO){if(VD("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter((e=>{var t;return _h(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===VD("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||0===i.length){let e=[],a=[],o=[],s=[];if(n.videoCodecs.forEach((t=>{let n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";_h(n).call(n,r)?e.push(t):_h(n).call(n,"vp9")?a.push(t):_h(n).call(n,"vp8")?o.push(t):_h(n).call(n,"h264")&&s.push(t)})),0===e.length){let t="";0!==a.length?(e=a,t="vp9"):0!==o.length?(e=o,t="vp8"):0!==s.length&&(e=s,t="h264"),ik.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(0===i.length&&(ik.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),VD("USE_PUB_RTX")||VD("USE_SUB_RTX")){let e=GW(i,t.videoCodecs);i=[...i,...e]}}else i=t.audioCodecs.filter((e=>{var t;return _h(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)})),0===i.length&&(ik.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((e=>{var t;return _h(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})));return i}function GW(e,t){let n=e.map((e=>e.payloadType.toString()));return t.filter((e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&_h(n).call(n,e.fmtp&&e.fmtp.parameters.apt)))}async function WW(e,t,n){let r=t.toString(),i=qW(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});let a=await e.createAnswer();if(!a.sdp)throw new Error("cannot get answer sdp");let o=a.sdp;o=HW(o,n||{}),null!==i&&void 0!==i&&i(o||""),await e.setLocalDescription({type:"answer",sdp:o})}function HW(e,t,n){let r=yW.parse(e),{useXR:i}=t;return r.mediaDescriptions.forEach((e=>{var t;e.attributes.mid&&(Array.isArray(n)&&!_h(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&VW(e),i&&_h(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach((e=>{-1===e.rtcpFeedbacks.findIndex((e=>"rrtr"===e.type))&&e.rtcpFeedbacks.push({type:"rrtr"})}))))})),yW.print(r)}function qW(e,t,n,r){if(VD("SDP_LOGGING"))return ik.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{qW(e,"answer","local"===n?"remote":"local",r)}:void 0}function zW(e,t){return typeof VD(e)===t?VD(e):void 0}function KW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function YW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?KW(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):KW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var JW=new Map,XW=class extends OL{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(jx.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(jx.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){ik.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),SI(this,"store",void 0),SI(this,"joinInfo",void 0),SI(this,"key",void 0),SI(this,"ntpOffset",0),SI(this,"signal",void 0),SI(this,"role",void 0),SI(this,"inChannelInfo",{joinAt:null,duration:0}),SI(this,"spec",void 0),SI(this,"_state","DISCONNECTED"),SI(this,"_statsCollector",void 0),SI(this,"_disconnectedReason",void 0),SI(this,"isSignalRecover",!1),SI(this,"hasChangeBGPAddress",!1),SI(this,"trafficStatsInterval",void 0),SI(this,"networkQualityInterval",void 0),SI(this,"_joinGatewayStartTime",0),SI(this,"_signalTimeout",!1),SI(this,"_clientRoleOptions",void 0),SI(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new EW(YW(YW({},t),{},{retryConfig:t.websocketRetryConfig}),e):new PM(YW(YW({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);let r=Date.now(),i=JW.get(e.cname);if(i||(i=new Map,JW.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){let t=new bx(fL.UID_CONFLICT);throw hk.joinGateway(e.sid,{lts:r,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let a=0;this.joinGatewayStartTime=r;let o=e.proxyServer;try{ik.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(a));let t=e.gatewayAddrs.map((t=>{let{address:n}=t,[r,i]=n.split(":"),a={host:r,port:i};return e.proxyServer&&(a.proxy=e.proxyServer),a}));a=(await this.signal.init(t,n)).uid,ik.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(a," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(ha){var s;throw ik.error("[".concat(this.store.clientId,"] User join failed"),ha.toString()),hk.joinGateway(e.sid,{lts:r,succ:!1,ec:(null===(s=ha.data)||void 0===s?void 0:s.desc)||ha.code,errorMsg:ha.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!o,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,i.delete(e.uid),this.signal.close(),ha}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),ik.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{ik.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(jx.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(jx.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(jx.NETWORK_QUALITY,{uplinkNetworkQuality:jM(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:jM(this._statsCollector.trafficStats.B_dnq)}):this.emit(jx.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),a}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==UL.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==mx.CONNECTED||await function(e){return hS.race([e,lD(3e3)])}(this.signal.request(gx.LEAVE,void 0,!0))}catch(yi){ik.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),yi)}this.signal.close(t),t!==UL.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:VD("PUB_EXTEND"),twcc:!!VD("PUBLISH_TWCC"),rtx:!!VD("USE_PUB_RTX")};try{return(await this.signal.request(gx.PUBLISH,r,!0))._message}catch(aa){if(n&&aa.data&&aa.data.code===fx.ERR_PUBLISH_REQUEST_INVALID)return ik.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),aa.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw aa}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(gx.PUBLISH_DATASTREAM,i,!0)}catch(oa){if(n&&oa.data&&oa.data.code===fx.ERR_PUBLISH_REQUEST_INVALID)return ik.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),oa.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw oa}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(gx.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(yi){ik.warning("[".concat(this.store.clientId,"] unpublish warning: "),yi)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await hS.all(e.map((e=>this.signal.request(gx.UNPUBLISH_DATASTREAM,{channel_id:e},!0))))}catch(na){ik.warning("unpublish datachannels warning: ",na)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!VD("SUBSCRIBE_TWCC"),rtx:!!VD("USE_SUB_RTX")||void 0,extend:VD("SUB_EXTEND"),svc:Array.isArray(VD("SVC"))&&0!==VD("SVC").length?VD("SVC"):void 0};try{return await this.signal.request(gx.PRE_SUBSCRIBE,r,!0)}catch(aa){if(n&&aa.data&&aa.data.code===fx.ERR_SUBSCRIBE_REQUEST_INVALID)return ik.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),aa.toString()),this.presubscribe(e,t,!1);throw aa}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!VD("SUBSCRIBE_TWCC"),rtx:!!VD("USE_SUB_RTX"),extend:VD("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(VD("SVC"))&&0!==VD("SVC").length?VD("SVC"):void 0};try{return(await this.signal.request(gx.SUBSCRIBE,r,!0))._message}catch(aa){if(n&&aa.data&&aa.data.code===fx.ERR_SUBSCRIBE_REQUEST_INVALID)return ik.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),aa.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw aa}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(gx.SUBSCRIBE_DATASTREAM,r,!0)}catch(aa){if(n&&aa.data&&aa.data.code===fx.ERR_SUBSCRIBE_REQUEST_INVALID)return ik.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),aa.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw aa}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!VD("USE_SUB_RTX"),twcc:!!VD("SUBSCRIBE_TWCC"),svc:Array.isArray(VD("SVC"))&&0!==VD("SVC").length?VD("SVC"):void 0};try{return await this.signal.request(gx.SUBSCRIBE_STREAMS,n,!0)}catch(r){if(t&&r.data&&r.data.code===fx.ERR_SUBSCRIBE_REQUEST_INVALID)return ik.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){let t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(gx.SET_VIDEO_PROFILE,t);ik.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(gx.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(yi){ik.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),yi)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new bx(fL.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await hS.all(e.map((e=>this.signal.request(gx.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0))))}catch(yi){ik.warning("unsubscribeDataChannel warning: ",yi)}}async massUnsubscribe(e){try{await this.signal.request(gx.UNSUBSCRIBE_STREAMS,e,!0)}catch(na){ik.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),na)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(gx.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(gx.GATEWAY_INFO)}async renewToken(e){await this.signal.request(gx.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(gx.SET_CLIENT_ROLE,{role:e,level:r,delay:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(gx.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(gx.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(gx.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(gx.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(gx.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.signal instanceof EW)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),YW({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(gx.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=JW.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:fk.username,password:fk.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(YW(YW({},fk),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;let e=await this.signal.request(gx.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach((e=>{let t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&ZL((()=>{this.emit(jx.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new bx(fL.UNEXPECTED_ERROR,"can not generate join message, no join info");let t=Object.assign({},this.joinInfo.apResponse),n=VD("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(o){n=void 0}n&&n.length>128&&(n=void 0);let r=!(qP()||YP(87)||Fj())&&"boolean"==typeof VD("ENABLE_PRE_SUB")&&VD("ENABLE_PRE_SUB"),i=!Fj()&&zW("ENABLE_PREALLOC_PC","boolean"),a=YW({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:DD,browser:navigator.userAgent,process_id:VD("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:VD("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:VD("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:VD("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof VD("SUBSCRIBE_AUDIO_FILTER_TOPN")?VD("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof VD("ENABLE_PUBLISH_AUDIO_FILTER")?VD("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof VD("ENABLE_USER_LICENSE_CHECK")?VD("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===VD("USE_PUB_RTX")||!0===VD("USE_SUB_RTX")||void 0,disableFEC:VD("DISABLE_FEC"),enableNTPReport:!!VD("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!VD("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!VD("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:zW("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!VD("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!VD("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:zW("USE_XR","boolean"),enableLossbasedBwe:zW("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!VD("ENABLE_AUT_CC")||void 0,enableCCFallback:zW("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:i,preSubNum:r?zW("PRE_SUB_NUM","number"):void 0,enablePubTWCC:zW("PUBLISH_TWCC","boolean"),enableSubTWCC:zW("SUBSCRIBE_TWCC","boolean"),enablePubRTX:zW("USE_PUB_RTX","boolean"),enableSubRTX:zW("USE_SUB_RTX","boolean"),enableSubSVC:VD("ENABLE_SVC")?VD("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(VD("SVC"))&&0!==VD("SVC").length?VD("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(a.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(a.aes_mode=this.joinInfo.aesmode,VD("ENCRYPT_AES")?(a.aes_secret=this.joinInfo.aespassword,a.aes_encrypt=!0):a.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(a.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(a.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(a.default_video_stream=this.joinInfo.defaultVideoStream),a}getRejoinMessage(){if(!this.joinInfo)throw new bx(fL.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(_x.WS_RECONNECT_WAITTING_FINISH,(e=>{var t;_h(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&hk.adjustSessionStartTime(this.joinInfo.sid)})),this.signal.on(_x.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(_x.WS_RECONNECTING,(e=>{this.joinInfo&&hk.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||GL.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",hk.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(_x.WS_CLOSED,(e=>{let t;switch(e){case UL.LEAVE:t=GL.LEAVE;break;case UL.UID_BANNED:case UL.IP_BANNED:case UL.CHANNEL_BANNED:case UL.SERVER_ERROR:t=GL.SERVER_ERROR;break;case UL.FALLBACK:t=GL.FALLBACK;break;case UL.LICENSE_MISSING:case UL.LICENSE_EXPIRED:case UL.LICENSE_MINUTES_EXCEEDED:case UL.LICENSE_PERIOD_INVALID:case UL.LICENSE_MULTIPLE_SDK_SERVICE:case UL.LICENSE_ILLEGAL:case UL.TOKEN_EXPIRE:t=e;break;default:t=GL.NETWORK_ERROR}ik.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+GL.NETWORK_ERROR)),this.joinInfo&&hk.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===UL.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==UL.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(_x.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(ik.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),hk.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void ik.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));jD("EVENT_REPORT_DOMAIN",e[1]),jD("EVENT_REPORT_BACKUP_DOMAIN",e[1]),jD("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}})),this.signal.on(vx.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(_x.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new bx(fL.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,qL(this,jx.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(_x.REQUEST_JOIN_INFO,(async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await qL(this,jx.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(t=this.joinInfo)||void 0===t?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))})),this.signal.on(_x.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(_x.REPORT_JOIN_GATEWAY,((e,t)=>{if(!this.joinInfo)return;let n,r="";var i;e instanceof bx?(n=(null===(i=e.data)||void 0===i?void 0:i.desc)||e.code,r=e.message):n=e,hk.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:r,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1})),this.signal.on(_x.IS_P2P_DISCONNECTED,(e=>{e(YL(this,jx.IS_P2P_DISCONNECTED))})),this.signal.on(_x.DISCONNECT_P2P,(()=>{this.emit(jx.DISCONNECT_P2P)})),this.signal.on(_x.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(_x.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(_x.JOIN_RESPONSE,(e=>{let t=this.getCurrentGatewayAddress();this.emit(jx.JOIN_RESPONSE,e,t)})),this.signal.on(_x.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let e=this.getCurrentGatewayAddress(),t=VD("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){let n=IW(e);this.emit(jx.PRE_CONNECT_PC,{candidates:n,fingerprint:t})}}}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request(gx.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(yi){throw ik.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),yi),yi}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(gx.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(yi){throw ik.warning("unsubscribe datachannel warning",yi),yi}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(gx.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(yi){throw ik.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),yi),yi}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(gx.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(yi){throw ik.warning("unpublish datastream warning: ",yi),yi}}async tryMassUnsubBeforeResub(e){let t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request(gx.UNSUBSCRIBE_STREAMS,t,!0)}catch(yi){throw ik.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),yi),yi}}async muteLocal(e,t){let n={action:e.find((e=>e.stream_type===Fx.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(gx.CONTROL,n,!0,!0)}catch(r){throw ik.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,t){let n={action:e.find((e=>e.stream_type===Fx.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(gx.CONTROL,n,!0,!0)}catch(r){throw ik.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,t){let n={action:e===Jx.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(gx.CONTROL,n,!0,!0)}catch(r){throw ik.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,t){let n={action:e===Jx.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(gx.CONTROL,n,!0,!0)}catch(r){throw ik.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(gx.RESTART_ICE,t,!0)}catch(yi){throw ik.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),yi),yi}}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,GL.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!VD("GATEWAY_WSS_ADDRESS"))return VD("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(ik.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(gx.SET_PARAMETER,{enablePublishAudioFilter:e})}};function QW(e,t,n,r){return new hS(((i,a)=>{t.timeout=t.timeout||VD("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),sD(t.data)):n&&(t.data.size?t.data.size:t.data instanceof FormData?cD(t.data):sD(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,RP.request(t).then((e=>{"string"==typeof e.data?sD(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?e.data.byteLength:sD(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{RP.isCancel(e)?a(new bx(fL.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?a(new bx(fL.NETWORK_TIMEOUT,e.message)):e.response?a(new bx(fL.NETWORK_RESPONSE_ERROR,e.response.status)):a(new bx(fL.NETWORK_ERROR,e.message))}))}))}!function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof zs&&zs];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=i;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];if(!(o in n))break e;n=n[o]}(t=t(a=n[e=e[e.length-1]]))!=a&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function s(e){var n=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}if(a("Symbol",(function(e){function t(e,t){this.A=e,r(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(r||"")+"_"+i++,r)}})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),a=0;a<n.length;a++){var s=i[n[a]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&r(s.prototype,e,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return e})),"function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var c;e:{var l={};try{l.__proto__={a:!0},c=l.a;break e}catch(D){}c=!1}n=c?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var d=n;function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function p(e,t){return e.h=3,{value:t}}function f(e){this.g=new u,this.G=e}function m(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var a=i.value}catch(Ea){return e.g.j=null,e.g.s(Ea),_(e)}return e.g.j=null,r.call(e.g,a),_(e)}function _(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(za){e.g.v=void 0,e.g.s(za)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function g(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){h(e.g);var n=e.g.j;return n?m(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),_(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function E(e,t){return t=new g(new f(t)),d&&e.prototype&&d(t,e.prototype),t}if(u.prototype.o=function(e){this.v=e},u.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},u.prototype.return=function(e){this.l={return:e},this.h=this.u},f.prototype.o=function(e){return h(this.g),this.g.j?m(this,this.g.j.next,e,this.g.o):(this.g.o(e),_(this))},f.prototype.s=function(e){return h(this.g),this.g.j?m(this,this.g.j.throw,e,this.g.o):(this.g.s(e),_(this))},a("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var v=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},y=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},S=function(e,t,n){return t instanceof Blob?(n=void 0!==n?n+"":"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},b=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},T="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,C=T.FormData,w=T.XMLHttpRequest&&T.XMLHttpRequest.prototype.send,R=T.Request&&T.fetch,A=T.navigator&&T.navigator.sendBeacon,I=T.Element&&T.Element.prototype,N=T.Symbol&&Symbol.toStringTag;N&&(Blob.prototype[N]||(Blob.prototype[N]="Blob"),"File"in T&&!File.prototype[N]&&(File.prototype[N]="File"));try{new File([],"")}catch(k){T.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),N&&Object.defineProperty(e,N,{value:"File"}),e}}var O=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},P=function(e){this.i=[];var t=this;e&&v(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];v(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?v(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?y(e.value):e.value,t.append(e.name,n))}))};if((e=P.prototype).append=function(e,t,n){b(arguments,2),this.i.push(S(e,t,n))},e.delete=function(e){b(arguments,1);var t=[];e=String(e),v(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return E(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=p(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){b(arguments,1);for(var n=s(this),r=n.next();!r.done;r=n.next()){var i=s(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){b(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){b(arguments,1);var t=[];return e=String(e),v(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){b(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return E(e,(function(e){if(1==e.h&&(t=s(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,p(e,s(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){b(arguments,2),e=String(e);var r=[],i=S(e,t,n),a=!0;v(this.i,(function(t){t[0]===e?a&&(a=!r.push(i)):r.push(t)})),a&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,a=this;return E(e,(function(e){if(1==e.h&&(t=s(a),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=s(r)).next(),p(e,i.next().value));n=t.next(),e.h=2}))},P.prototype._asNative=function(){for(var e=new C,t=s(this),n=t.next();!n.done;n=t.next()){var r=s(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},P.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+O(y(r))+'"\r\n\r\n'+y(e)+"\r\n"):t.push(n+O(y(r))+'"; filename="'+O(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},P.prototype[Symbol.iterator]=function(){return this.entries()},P.prototype.toString=function(){return"[object FormData]"},I&&!I.matches&&(I.matches=I.matchesSelector||I.mozMatchesSelector||I.msMatchesSelector||I.oMatchesSelector||I.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),N&&(P.prototype[N]="FormData"),w){var L=T.XMLHttpRequest.prototype.setRequestHeader;T.XMLHttpRequest.prototype.setRequestHeader=function(e,t){L.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},T.XMLHttpRequest.prototype.send=function(e){e instanceof P?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),w.call(this,e)):w.call(this,e)}}R&&(T.fetch=function(e,t){return t&&t.body&&t.body instanceof P&&(t.body=t.body._blob()),R.call(this,e,t)}),A&&(T.navigator.sendBeacon=function(e,t){return t instanceof P&&(t=t._asNative()),A.call(this,e,t)}),T.FormData=P}}();var ZW=()=>{let e=VD("AREAS");return 0===e.length&&e.push(Gx.GLOBAL),Dh(e).call(e,((e,t,n)=>{let r=$W(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},$W=e=>e===Gx.OVERSEA?"".concat(Hx.ASIA,",").concat(Hx.EUROPE,",").concat(Hx.AFRICA,",").concat(Hx.NORTH_AMERICA,",").concat(Hx.SOUTH_AMERICA,",").concat(Hx.OCEANIA):Hx[e],eH={GLOBAL:{ASIA:[Gx.CHINA,Gx.JAPAN,Gx.INDIA,Gx.KOREA,Gx.HKMC],EUROPE:[],NORTH_AMERICA:[Gx.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},tH=Object.keys(eH[Gx.GLOBAL]),nH=[Gx.CHINA,Gx.NORTH_AMERICA,Gx.EUROPE,Gx.ASIA,Gx.JAPAN,Gx.INDIA,Gx.OCEANIA,Gx.SOUTH_AMERICA,Gx.AFRICA,Gx.KOREA,Gx.HKMC,Gx.US];function rH(e){var t,n;if(!e&&_h(t=VD("AREAS")).call(t,Gx.EXTENSIONS))return ik.debug("update area from ap : reset"),void iH(pk,!0);if(!_h(n=VD("AREAS")).call(n,Gx.GLOBAL)||!e)return;let r=qx.EXTENSIONS;r&&(r={CODE:$W(Gx.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},ik.debug("update area from ap success: ".concat(e,",config is "),r),jD("AREAS",[Gx.EXTENSIONS],!0),Object.keys(r).map((e=>{jD(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}function iH(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=hk.reportApiInvoke(null,{name:DL.SET_AREA,options:e,tag:kL.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!_h(Wx).call(Wx,e))throw new bx(fL.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){let{areaCode:t,excludedArea:n}=e;if(!t)throw new bx(fL.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?function(e,t){let n=[];if(_h(e).call(e,Gx.GLOBAL)){let a=[Gx.GLOBAL,Gx.OVERSEA],o=Object.keys(qx);if(t===Gx.GLOBAL)throw new bx(fL.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Gx.CHINA)n=[Gx.OVERSEA];else if(i=t,_h(tH).call(tH,i)){let e=(r=t,eH[Gx.GLOBAL][r]||[]),i=[...a,t,...e];n=o.filter((e=>!_h(i).call(i,e)))}else if(function(e){let t=!1;return tH.forEach((n=>{var r;_h(r=eH[Gx.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){let e=function(e){let t;return tH.forEach((n=>{var r;_h(r=eH[Gx.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),r=[...a,e,t];n=o.filter((e=>!_h(r).call(r,e)))}else n=e;n=function(e){let t=[];return nH.forEach((n=>{_h(e).call(e,n)&&t.push(n)})),t.concat(e.filter((e=>!_h(nH).call(nH,e))))}(n)}else n=e;var r,i;return n}(i,n):i}if(!t){if(BD.AREAS){let e=new bx(fL.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void ik.warning("setArea is prohibited because of config-distribute")}if(_h(r).call(r,Gx.GLOBAL)&&VD("AREAS")===Gx.EXTENSIONS){let e=new bx(fL.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void ik.warning("setArea is prohibited because of ap extensions")}}jD("AREAS",r,t);let i=(e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{let n=qx[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t})(r);Object.keys(i).map((e=>{jD(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),ik.debug("set area success:",r.join(","))}catch(yi){throw n.onError(yi),yi}n.onSuccess()}function aH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oH(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aH(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aH(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var sH=1;var cH=1;function lH(e,t,n,r){let i,{url:a,areaCode:o}=e,{clientId:s,sid:c}=t,l=Date.now(),[d,u]=pH(t,o,[LM.CHOOSE_SERVER]),h=JL.networkState;return AD((async()=>{h&&JL.networkState===WL.OFFLINE&&JL.onlineWaiter&&await hS.race([JL.onlineWaiter,dD(r&&r.maxRetryTimeout||wD.maxRetryTimeout)]),h=JL.networkState;let{data:e,headers:o}=await QW(a,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===o.http3?1:-1,hk.reportResourceTiming(a,c),uH(e,a,t,l,[LM.CHOOSE_SERVER],i);let s=VM(e,LM.CHOOSE_SERVER);return hH(s),MM(s,a)}),(e=>(e&&hk.joinChooseServer(c,{lts:l,succ:!0,csAddr:a,opid:u,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[LM.CHOOSE_SERVER].toString(),isHttp3:i}),!1)),(e=>e.code!==fL.OPERATION_ABORTED&&(e.code===fL.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(hk.joinChooseServer(c,{lts:l,succ:!1,csAddr:a,serverList:null,opid:u,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[LM.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:i}),ik.warning("[".concat(s||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),e),!0))),r)}function dH(e,t,n,r){let i,a,{url:o,areaCode:s,serviceIds:c}=e,l=Date.now(),[d,u]=pH(t,s,c);return AD((async()=>{a&&JL.networkState===WL.OFFLINE&&JL.onlineWaiter&&await hS.race([JL.onlineWaiter,dD(r&&r.maxRetryTimeout||wD.maxRetryTimeout)]),a=JL.networkState;let{data:e,headers:s}=await QW(o,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===s.http3?1:-1,hk.reportResourceTiming(o,t.sid),uH(e,o,t,l,c,i);let u=VM(e,LM.CHOOSE_SERVER),h=VM(e,"proxy5"===t.cloudProxyServer?LM.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?LM.CLOUD_PROXY:LM.CLOUD_PROXY_FALLBACK);return hH(u),{gatewayInfo:MM(u,o),proxyInfo:h,url:o}}),(e=>(e.gatewayInfo&&hk.joinChooseServer(t.sid,{lts:l,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:u,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i}),e.proxyInfo&&hk.joinWebProxyAP(t.sid,{lts:l,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:c.toString()}),!1)),(e=>e.code!==fL.OPERATION_ABORTED&&(e.code===fL.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(hk.joinWebProxyAP(t.sid,{lts:l,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:a})}),ik.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}var uH=(e,t,n,r,i,a)=>{let{sid:o,clientId:s,cloudProxyServer:c}=n,l=[],d=n=>{4096===n.flag?hk.joinChooseServer(o,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:n.error.message,csIp:n.error.data&&n.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:a}):1048576!==n.flag&&4194304!==n.flag&&4194310!==n.flag||hk.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:n.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{let n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)ik.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{let n={error:new bx(fL.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};l.push(n),d(n)}if(0!==n){let r=fM(n),i={error:new bx(fL.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?ik.warning(i.error.toString()):l.push(i),d(i)}})),l.length)throw ik.warning("[".concat(s||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(l.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new bx(fL.CAN_NOT_GET_GATEWAY_SERVER,l.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!l.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(l.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})},hH=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new bx(fL.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(VD("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?rH(e.detail[23].toLowerCase()):rH()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){let t=e.detail[19],n=null===t||void 0===t?void 0:t.split(";");for(let r=0;r<n.length;r++){var a;let t=db(a=n[r]).call(a);e.addresses[r]&&n&&(e.addresses[r].fingerprint=t)}}if(VD("GATEWAY_ADDRESS")&&VD("GATEWAY_ADDRESS").length>0){ik.debug("assign gateway address to",VD("GATEWAY_ADDRESS"));let t=VD("GATEWAY_ADDRESS").map((t=>{var n,r;let i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},pH=(e,t,n)=>{let r=Math.floor(1e12*Math.random()),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:oH({6:e.stringUid,11:t,12:VD("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));let a=new FormData;return a.append("request",JSON.stringify(i)),[a,r]},fH=0;function mH(e){return hS.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}var _H=async e=>{let t,{fragementLength:n,referenceList:r,asyncMapHandler:i,allFailedhandler:a,promisesCollector:o}=e,s=0,c=n,l=0,d=async()=>{let e=(()=>{let e=s*c,t=e+c;return r.slice(e,t).map(i)})();o&&o.push(...e);try{t=await mH(e)}catch(la){if(l+=c,s++,!(l>=r.length))return void await d();a(la)}e.forEach((e=>e.cancel()))};return await d(),t},gH=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e,i=t.length,a=0,o=async()=>{let e=n(t.shift());try{return await e}catch(sa){if(a++,a>=i||null!=r&&r(sa))throw sa;return o()}};return o()};async function EH(e,t,n,r){return{gatewayInfo:await async function(e,t,n,r){let i=null,a=[],o=async()=>{let i=VD("WEBCS_DOMAIN").slice(0,VD("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:ZW()}))),o=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),s=await _H({fragementLength:VD("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(ik.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),lH(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},o),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},o),s},s=async()=>{if(await dD(1e3),null!==i)return i;let o=VD("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:ZW()}))),s=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:o.map((e=>e.url))}),c=await _H({fragementLength:VD("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:r=>(ik.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),lH(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c};try{return i=await mH([o(),s()]),a.length&&a.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(pa){throw pa[0]}}(e,t,n,r)}}async function vH(e,t,n,r,i){let a=e.cloudProxyServer;if("disabled"===a){if(e.useLocalAccessPoint)return await EH(e,t,n,i);if(VD("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:r,proxyInfo:a}=await TH(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:r};let s=a.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||fk.tcpport,udpport:e.udpport||fk.udpport,username:e.username||fk.username,password:e.password||fk.password,forceturn:!1,security:!0})));if(i.useP2P){var o;let t=null!==(o=e.uid)&&void 0!==o?o:r.uid,n="glb:".concat(t.toString()),i=await NL(n),c=a.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||fk.tcpport,udpport:e.udpport||fk.udpport,username:n,password:i,forceturn:!1,security:!0})));s.push(...c)}return e.turnServer={mode:"manual",servers:s},{gatewayInfo:r}}return await EH(e,t,n,i)}let{proxyInfo:s,gatewayInfo:c}=await TH(e,t,n,i),l={gatewayInfo:c},d=s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===a?void 0:e.tcpport?e.tcpport:fk.tcpport,udpport:"proxy4"===a?void 0:e.udpport?e.udpport:fk.udpport,username:e.username||fk.username,password:e.password||fk.password,forceturn:"proxy4"!==a,security:"proxy5"===a})));if(i.useP2P){var u;let t=null!==(u=e.uid)&&void 0!==u?u:c.uid,n="glb:".concat(t.toString()),r=await NL(n),i=s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===a?void 0:e.tcpport||fk.tcpport,udpport:"proxy4"===a?void 0:e.udpport||fk.udpport,username:n,password:r,forceturn:"proxy4"!==a,security:"proxy5"===a})));d.push(...i)}return e.turnServer={mode:"manual",servers:d},ik.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),l}async function yH(e,t,n,r,i){let a=VD("ACCOUNT_REGISTER").slice(0,VD("AJAX_REQUEST_CONCURRENT")),o=[];o=t.proxyServer?a.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):a.map((e=>"https://".concat(e,"/api/v1")));let s=null===i||void 0===i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{let a=await async function(e,t,n,r,i){let a=Date.now(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:t},s=e[0],c=await AD((()=>QW(s+"".concat(-1===s.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw ik.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),hk.reqUserAccount(o.sid,{lts:a,success:!1,serverAddr:s,stringUid:o.string_uid,uid:n.uid,errorCode:fL.INVALID_UINT_UID_FROM_STRING_UID,extend:o}),new bx(fL.INVALID_UINT_UID_FROM_STRING_UID);return hk.reqUserAccount(o.sid,{lts:a,success:!0,serverAddr:s,stringUid:o.string_uid,uid:n.uid,errorCode:null,extend:o}),!1}let i=fM(n.code);return i.retry&&(s=e[(r+1)%e.length]),hk.reqUserAccount(o.sid,{lts:a,success:!1,serverAddr:s,stringUid:o.string_uid,uid:n.uid,errorCode:i.desc,extend:o}),i.retry}),((t,n)=>t.code!==fL.OPERATION_ABORTED&&(hk.reqUserAccount(o.sid,{lts:a,success:!1,serverAddr:s,stringUid:o.string_uid,uid:null,errorCode:t.code,extend:o}),s=e[(n+1)%e.length],!0)),i);if(0!==c.code){let e=fM(c.code);throw new bx(fL.UNEXPECTED_RESPONSE,e.desc)}return c}(o,e,t,n,r);return null!==i&&void 0!==i&&i.recordJoinChannelService({status:"success",endTs:Date.now()},s),a.uid}catch(sa){throw null!==i&&void 0!==i&&i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[sa]},s),sa}}async function SH(e,t,n){let r=VD("ACCOUNT_REGISTER"),i=[];i=t.proxyServer?r.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):r.map((e=>"https://".concat(e,"/api/v1")));try{return await gH({referenceList:i,asyncMapHandler:r=>async function(e,t,n,r){let i=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{let t=await QW(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){let e=fM(t.code);throw new bx(fL.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new bx(fL.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:a,uid:t.uid,elapse:Date.now()-i}}catch(pa){throw pa}}(r,e,t,n),closeFn:e=>e.code===fL.OPERATION_ABORTED||e.code===fL.UNEXPECTED_RESPONSE&&!e.data.retry})}catch(aa){throw aa}}async function bH(e,t){let n=VD("WEBCS_DOMAIN").concat(VD("WEBCS_DOMAIN_BACKUP_LIST")).map((e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:ZW(),serviceIds:[LM.CHOOSE_SERVER,LM.CLOUD_PROXY_FALLBACK]})));try{return await gH({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let r,{url:i,areaCode:a,serviceIds:o}=e,s=Date.now(),[c,l]=pH(t,a,o),d=JL.networkState;try{d&&JL.networkState===WL.OFFLINE&&JL.onlineWaiter&&await hS.race([JL.onlineWaiter,dD(wD.maxRetryTimeout)]),d=JL.networkState;let{data:e,headers:t}=await QW(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===t.http3?1:-1,(e=>{let t=[];if(e.response_body.forEach((n=>{let r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{let r={error:new bx(fL.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(r)}if(0!==r){let i=fM(r),a={error:new bx(fL.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?ik.warning(a.error.toString()):t.push(a)}})),t.length)throw new bx(fL.CAN_NOT_GET_GATEWAY_SERVER,t.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!t.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(t.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})})(e);let a=VM(e,LM.CHOOSE_SERVER),o=VM(e,LM.CLOUD_PROXY_FALLBACK);return hH(a),{gatewayInfo:MM(a,i),proxyInfo:o,opid:l,requestTime:s,url:i,isHttp3:r,elapse:Date.now()-s}}catch(ua){throw ua}}(n,e,t),closeFn:e=>e.code===fL.OPERATION_ABORTED||e.code===fL.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry})}catch(yi){throw yi}}async function TH(e,t,n,r){let i,a,o,s=VD("PROXY_SERVER_TYPE3"),c=(e,t,n)=>{let r=n||s;return Array.isArray(r)&&(r=t%2==0?s[1]:s[0]),"https://".concat(r,"/ap/?url=").concat(e)},l=null,d=[],u=async()=>{let i=VD("WEBCS_DOMAIN").slice(0,VD("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?c("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):c("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:ZW(),serviceIds:[LM.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?LM.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?LM.CLOUD_PROXY:LM.CLOUD_PROXY_FALLBACK]}})),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),o=await _H({fragementLength:VD("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(ik.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),dH(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:d});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),o},h=async()=>{if(await dD(1e3),null!==l)return l;let i=VD("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?c("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):c("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:ZW(),serviceIds:[LM.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?LM.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?LM.CLOUD_PROXY:LM.CLOUD_PROXY_FALLBACK]}})),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),o=await _H({fragementLength:VD("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(ik.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),dH(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:d});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),o};try{({gatewayInfo:i,proxyInfo:a,url:o}=await mH([u(),h()]))}catch(pa){throw pa[0]}if(d.length&&d.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!i||!a)throw new bx(fL.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=o,"disabled"!==e.cloudProxyServer&&Array.isArray(s)&&o){let t=/^https?:\/\/(.+?)(\/.*)?$/.exec(o)[1];_h(s).call(s,t)&&(e.proxyServer=t,ik.setProxyServer(t),hk.setProxyServer(t))}return l={gatewayInfo:i,proxyInfo:await BM(a,i.uid)},l}async function CH(e,t,n){let r=null,i=[],a=async a=>{let o=VD(a?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return a&&(await dD(1e3),null!==r)?r:await _H({fragementLength:VD("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:r=>(ik.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(a?"backup":""," choose_server:"),r),function(e,t,n,r){let[i]=((e,t)=>{let n=Math.floor(1e12*Math.random()),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]})(t,[LM.CHOOSE_SERVER]),a=JL.networkState;return AD((async()=>(a&&JL.networkState===WL.OFFLINE&&JL.onlineWaiter&&await hS.race([JL.onlineWaiter,dD(r&&r.maxRetryTimeout||wD.maxRetryTimeout)]),a=JL.networkState,((e,t)=>{if(e.response_body&&e.response_body.length){let t=e.response_body[0];if(0!==t.buffer.code){let e=fM(t.buffer.code);throw new bx(fL.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw ik.debug("update ticket request received ap response without response body:",t),new bx(fL.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})})(await QW(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0),e))),(()=>!1),(e=>e.code!==fL.OPERATION_ABORTED&&(e.code===fL.UPDATE_TICKET_FAILED?e.data.retry:(ik.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await mH([a(!1),a(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(oa){throw oa[0]}}function wH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function RH(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wH(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wH(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var AH=class extends OL{get isSuccess(){return!!this.configs}constructor(){super(),SI(this,"configs",void 0),SI(this,"joinInfo",void 0),SI(this,"cancelToken",void 0),SI(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),SI(this,"interval",void 0),SI(this,"mutex",new TD("config-distribute")),SI(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),VD("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),VD("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,hk.reportApiInvoke(null,{options:void 0,name:DL.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:kL.TRACER}).onSuccess(JSON.stringify(BD))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void ik.debug("[config-distribute] get config distribute interrupted have no joininfo");let e,t=await this.mutex.lock();try{e=await async function(e,t,n){let r=VD("CDS_AP").slice(0,VD("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))),i=r.map((r=>function(e,t,n,r){let i=UP(),a={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:DD,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return AD((()=>QW(e,{data:a,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==fL.OPERATION_ABORTED),r)}(r,e,t,n))),a=null,o=null,s={};try{a=await mH(i)}catch(sa){if(sa.code===fL.OPERATION_ABORTED)throw sa;o=sa}if(i.forEach((e=>e.cancel())),hk.reportApiInvoke(e.sid,{name:DL.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:a}}).onSuccess(),a&&a.test_tags)try{s=function(e){if(!e.test_tags)return{};let t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;let i=db(n=e.slice(4)).call(n),a=JSON.parse(t[e])[1];r[i]=a})),r}(a)}catch(c){}return s}(this.joinInfo,this.cancelToken,this.retryConfig),ik.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(yi){let t=new bx(fL.NETWORK_RESPONSE_ERROR,yi);ik.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(zx.UPDATE_BITRATE_LIMIT,e):this.emit(zx.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&RH({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;let n=IT(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let i=0;i<n.length;i++)for(let t=n.length-1;t>i;t--){let r=n[t];if("number"==typeof e[r].__priority){let i=e[r].__priority,a=n[t-1];if("number"==typeof e[a].__priority){if(!(i>e[a].__priority))continue;{let e=r;n[t]=n[t-1],n[t-1]=e}}else{let e=r;n[t]=n[t-1],n[t-1]=e}}}let r={};n.forEach((t=>{let n=e[t],i=n.__expires;Object.keys(n).forEach((e=>{"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(r,e)||(r[e]=RH({value:n[e]},i&&{expires:i}))}))}));try{!function(e){try{let t=Date.now();Object.keys(e).forEach((n=>{switch(n){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(FD,n)){let{value:r,expires:i}=e[n];if(i&&i<=t)return;BD[n]=r,FD[n]=r,ik.debug("Update global parameters from config distribute",n,r)}}}))}catch(sa){ik.error("Error update config immediately: ".concat(e),sa.message)}}(r);let e=JSON.stringify(r),t=window.btoa(e);window.localStorage.setItem("websdk_ng_global_parameter",t),ik.debug("Caching global parameters ".concat(e))}catch(aa){ik.error("Error caching global parameters:",aa.message)}}},IH=class extends OL{constructor(){super(...arguments),SI(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){let n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(VD("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i;let n=_h(i=r.result).call(i,!0);r.isPrevNormal&&!n&&this.emit("exception",NH[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",NH[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof UG&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=UM(t._encoderConfig.frameRate));let r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof UG&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}},NH={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},OH=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){let e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){let e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function PH(e,t){this.v=e,this.k=t}function LH(e){return new PH(e,0)}var DH=uS,kH=YE;gu({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=kH.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var xH=YE,MH=NE;gu({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=xH.f(this),n=MH(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var UH=Ks(DH),FH=bw.f("asyncIterator"),jH=Ks(FH);function VH(e){var t,n;function r(t,n){try{var a=e[t](n),o=a.value,s=o instanceof PH;UH.resolve(s?o.v:o).then((function(n){if(s){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}i(a.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(da){i("throw",da)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new UH((function(a,o){var s={key:e,arg:i,resolve:a,reject:o,next:null};n?n=n.next=s:(t=n=s,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function BH(e){return function(){return new VH(e.apply(this,arguments))}}VH.prototype["function"==typeof gI&&jH||"@@asyncIterator"]=function(){return this},VH.prototype.next=function(e){return this._invoke("next",e)},VH.prototype.throw=function(e){return this._invoke("throw",e)},VH.prototype.return=function(e){return this._invoke("return",e)};var GH=Ks(Kc.Object.getOwnPropertySymbols),WH=gu,HH=Mu.indexOf,qH=wh,zH=mc([].indexOf),KH=!!zH&&1/zH([1],1,-0)<0;WH({target:"Array",proto:!0,forced:KH||!qH("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return KH?zH(this,e,t)||0:HH(this,e,t)}});var YH=ju("Array").indexOf,JH=tc,XH=YH,QH=Array.prototype,ZH=Ks((function(e){var t=e.indexOf;return e===QH||JH(QH,e)&&t===QH.indexOf?XH:t}));function $H(e){if(Array.isArray(e))return e.map((e=>e));if(!eq(e))return e;let t={};for(let n in e){let r=e[n];eq(r)||Array.isArray(r)?t[n]=$H(r):t[n]=r}return t}function eq(e){return!("object"!=typeof e||Array.isArray(e)||!e)}var tq=class{constructor(e){SI(this,"input",[]),SI(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},nq={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},rq={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:nq,remoteCandidate:nq}},iq={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},aq={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},oq={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},sq={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function cq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cq(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dq=class{constructor(e,t){SI(this,"onFirstVideoReceived",void 0),SI(this,"onFirstVideoDecoded",void 0),SI(this,"onFirstAudioReceived",void 0),SI(this,"onFirstVideoDecodedTimeout",void 0),SI(this,"onFirstAudioDecoded",void 0),SI(this,"onSelectedLocalCandidateChanged",void 0),SI(this,"onSelectedRemoteCandidateChanged",void 0),SI(this,"videoIsReady",!1),SI(this,"videoIsReady2",{}),SI(this,"pc",void 0),SI(this,"options",void 0),SI(this,"intervalTimer",void 0),SI(this,"stats",$H(rq)),SI(this,"isFirstVideoReceived",{}),SI(this,"isFirstVideoDecoded",{}),SI(this,"isFirstAudioReceived",{}),SI(this,"isFirstAudioDecoded",{}),SI(this,"isFirstVideoDecodedTimeout",{}),SI(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new hS((e=>{e({local:lq({},nq),remote:lq({},nq)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"],r=0,i=0,a=0,o=0;for(let s of n)e[s].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][s][n]||!this.lossRateWindowStats[0][s][n])return;let c=this.lossRateWindowStats[t-1][s][n].packets-this.lossRateWindowStats[0][s][n].packets,l=this.lossRateWindowStats[t-1][s][n].packetsLost-this.lossRateWindowStats[0][s][n].packetsLost;"videoSend"===s||"audioSend"===s?(r+=c,a+=l):(i+=c,o+=l),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||l<=0?0:l/(c+l)}));e.sendPacketLossRate=r<=0||a<=0?0:a/(r+a),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}};function uq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uq(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pq=class extends dq{constructor(){super(...arguments),SI(this,"_stats",rq),SI(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=$H(rq);let n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);let r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{var t;let n=_h(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{let t=$H(aq);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{let t=$H(iq),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){let r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:hq({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{let t=$H(sq);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{let t=$H(oq);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new hS(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){let t=[];return e.result().forEach((e=>{let n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}};function fq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fq(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _q=class extends dq{constructor(){super(...arguments),SI(this,"_stats",rq),SI(this,"report",void 0),SI(this,"lastDecodeVideoReceiverStats",new Map),SI(this,"lastVideoFramesRecv",new Map),SI(this,"lastVideoFramesSent",new Map),SI(this,"lastVideoFramesDecode",new Map),SI(this,"lastVideoFramesOutput",new Map),SI(this,"lastVideoJBDelay",new Map),SI(this,"lastAudioJBDelay",new Map),SI(this,"mediaBytesSent",new Map),SI(this,"mediaBytesRetransmit",new Map),SI(this,"mediaBytesTargetEncode",new Map),SI(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=$H(rq),this.report.forEach((e=>{switch(e.type){case lx.OUTBOUND:case lx.INBOUND:{let t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===lx.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===lx.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case lx.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case lx.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:mq({},nq),remote:mq({},nq)};return e.forEach((n=>{let r;if(n.type===lx.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===lx.CANDIDATE_PAIR&&n.selected&&(r=n),r){let n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){let i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){let i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===lx.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===lx.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===lx.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(mq({},t),mq({},this.stats.selectedCandidatePair.localCandidate)),e.type===lx.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(mq({},t),mq({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=$H(sq),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=$H(iq),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration;let n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),a=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){let r=n.stats,i=a-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&a-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((a-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:a,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&a-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((a-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:a,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:a,rate:0})),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:mq({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=$H(aq),this._stats.videoSend.push(t));let n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{let t=new tq(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){let t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{let t=new tq(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){let t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{let t=new tq(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){let n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){let n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,lx.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=$H(oq),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,lx.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;let r=Array.from($M(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){let n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){let n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,a,o;let s=t?this.report.get(t):void 0,c=null!==(r=null===s||void 0===s?void 0:s.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof c)return;let l=null!==(i=null===s||void 0===s?void 0:s.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(a=null===s||void 0===s?void 0:s.frameHeight)&&void 0!==a?a:e.frameHeight,u=null!==(o=null===s||void 0===s?void 0:s.framesPerSecond)&&void 0!==o?o:e.framesPerSecond;if("number"==typeof l&&"number"==typeof d||(l=0,d=0),null==u){let e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(u=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:u})):t?u=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:l,height:d,frameRate:Math.max(0,u)}}processVideoTrackReceiverStats(e,t,n){var r,i,a,o,s;let c=t?this.report.get(t):void 0,l=null!==(r=null===c||void 0===c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,d=null!==(i=null===c||void 0===c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(a=null===c||void 0===c?void 0:c.frameHeight)&&void 0!==a?a:e.frameHeight,h=null!==(o=null===c||void 0===c?void 0:c.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,p=null!==(s=null===c||void 0===c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof l){let e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=l;let r=0;e&&t-e.lts>=800?(r=Math.round((l-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:t,rate:0}),n.receivedFrame={width:d||0,height:u||0,frameRate:r||0},n.decodedFrame={width:d||0,height:u||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:d||0,height:u||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(h&&p){let e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},t=e.jitterBufferMs,r=p-e.jitterBufferEmittedCount;r>0&&(t=1e3*(h-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,a,o;let s=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null===s||void 0===s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,l=null!==(a=null!==(o=null===s||void 0===s?void 0:s.echoReturnLossEnhancement)&&void 0!==o?o:e.echoReturnLossEnhancement)&&void 0!==a?a:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,t,n){var r,i,a,o,s,c,l;let d=t?this.report.get(t):void 0,u=null!==(r=null===d||void 0===d?void 0:d.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,h=null!==(i=null===d||void 0===d?void 0:d.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,p=null!==(a=null===d||void 0===d?void 0:d.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,f=null!==(o=null===d||void 0===d?void 0:d.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount,m=null!==(s=null===d||void 0===d?void 0:d.audioLevel)&&void 0!==s?s:null===e||void 0===e?void 0:e.audioLevel,_=null!==(c=null===d||void 0===d?void 0:d.totalSamplesDuration)&&void 0!==c?c:null===e||void 0===e?void 0:e.totalSamplesDuration,g=null!==(l=null===d||void 0===d?void 0:d.concealedSamples)&&void 0!==l?l:e.concealedSamples;if(u&&h&&(n.accelerateRate=u/h),p&&f){let e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},t=e.jitterBufferMs,r=f-e.jitterBufferEmittedCount;r>0&&(t=1e3*(p-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:f,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=m;let E=1920;_&&h&&(E=h/_/50,n.receivedFrames=Math.round(h/E)),g&&(n.droppedFrames=Math.round(g/E))}processRemoteInboundStats(e,t){let n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));let r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},gq=class extends dq{updateStats(){return hS.resolve()}};function Eq(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,a=function(){let e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return a?a<76?new pq(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new _q(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;let t=e.getStats();return!!(t instanceof hS||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new _q(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new gq(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}var vq,yq=class{get localCapabilities(){return $L(this._localCapabilities)}get rtpCapabilities(){return $L(this._rtpCapabilities)}get candidates(){return $L(this._candidates)}get iceParameters(){return $L(this._iceParameters)}get dtlsParameters(){return $L(this._dtlsParameters)}constructor(e){SI(this,"sessionDesc",void 0),SI(this,"_localCapabilities",void 0),SI(this,"_rtpCapabilities",void 0),SI(this,"_candidates",void 0),SI(this,"_iceParameters",void 0),SI(this,"_dtlsParameters",void 0),SI(this,"setup",void 0),SI(this,"currentMidIndex",void 0),SI(this,"cname","o/i14u9pJrxRKAsu"),SI(this,"firefoxSsrcMidMap",new Map),e=$L(e);let t,{remoteIceParameters:n,remoteDtlsParameters:r,candidates:i,remoteRTPCapabilities:a,localCapabilities:o,direction:s,setup:c,videoCodec:l,audioCodec:d}=e;this.setup=c,t=s===yx.RECEIVE_ONLY?yW.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):yW.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=a,this._candidates=i,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=o;let u=s===yx.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=s===yx.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=s===yx.RECEIVE_ONLY?a.send.videoCodecs:BW(Jx.VIDEO,u,h,l),f=s===yx.RECEIVE_ONLY?a.send.audioCodecs:BW(Jx.AUDIO,u,h,d);for(let m of t.mediaDescriptions)m.attributes.iceUfrag=n.iceUfrag,m.attributes.icePwd=n.icePwd,m.attributes.fingerprints=r.fingerprints,m.attributes.candidates=i,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType&&(m.media.fmts=p.map((e=>e.payloadType.toString(10))),m.attributes.payloads=p,m.attributes.extmaps=u.videoExtensions),"audio"===m.media.mediaType&&(m.media.fmts=f.map((e=>e.payloadType.toString(10))),m.attributes.payloads=f,m.attributes.extmaps=u.audioExtensions,VW(m));this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}toString(){return yW.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((e=>this.hasMid(e))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,r,i){n=n.replace(/ /g,"-");let{ssrcs:a,ssrcGroups:o}=NW(t,this.cname,VD("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(a);if(s){if(qP()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,s.attributes.mid),i&&(i.twcc||i.remb)){let e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,i),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{let t,n=this.findAvailableMediaIndex(e,a,r);return-1===n?(t=this.createOrRecycleSendMedia(e,a,o,"sendonly",r,i),this.updateBundleMids()):(t=$L(this.sessionDesc.mediaDescriptions[n]),t.attributes.direction="sendonly",t.attributes.ssrcs=a,t.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[n]=this.mungSendMediaDesc(t,i)),qP()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,t.attributes.mid),{needExchangeSDP:!0,mid:t.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{e.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){let r=[];return e.forEach((e=>{let i,a=e._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(a),s=!1;-1===o?(s=!0,i=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(i=$L(this.sessionDesc.mediaDescriptions[o]),i.attributes.direction="recvonly"),r.push({mid:i.attributes.mid,needCreateTransceiver:s})})),r}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:n,address:r,port:i,type:a,relatedAddress:o,relatedPort:s,priority:c}=new RTCIceCandidate(e),l={foundation:null!==t&&void 0!==t?t:"",componentId:"1",transport:null!==n&&void 0!==n?n:"",priority:c?c+"":"",connectionAddress:null!==r&&void 0!==r?r:"",port:i?i+"":"",type:a?a+"":"",relAddr:null!==o&&void 0!==o?o:"",relPort:s?s+"":"",extension:{}};this.candidates.some((e=>e.priority===l.priority&&e.connectionAddress===l.connectionAddress&&e.port===l.port))||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){let a=e._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,s=BW(a,o,this.localCapabilities.send,a===Jx.AUDIO?i:r),c=a===Jx.VIDEO?o.videoExtensions:o.audioExtensions,l="".concat(++this.currentMidIndex),d={media:{mediaType:a,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e);let u=this.findFirstClosedMedia(a);if(u){let e=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>_h(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>_h(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((r=>{let i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(qP()){if(i){let e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{let n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n}))}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=$L(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,r,i,a){let o=this.rtpCapabilities.send,s=e===Jx.VIDEO?o.videoCodecs:o.audioCodecs,c=e===Jx.VIDEO?o.videoExtensions:o.audioExtensions;qP()&&(i="".concat(++this.currentMidIndex));let l={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};l=this.mungSendMediaDesc(l,a);let d=this.findFirstClosedMedia(e);if(d){let e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(e,t,n){let r=$L(e);return PW(r),OW(r,t),LW(r,t),DW(r),kW(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=$L(e);return kW(n,t,this.localCapabilities.recv),VW(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>qP()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}},Sq=["sdp"];function bq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Tq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bq(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Cq=(vq=class e extends Kx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),SI(this,"direction",void 0),SI(this,"name",void 0),SI(this,"store",void 0),SI(this,"spec",void 0),SI(this,"peerConnection",void 0),SI(this,"initialOffer",void 0),SI(this,"transport",void 0),SI(this,"statsFilter",void 0),SI(this,"localCandidateCount",0),SI(this,"_isInRestartIce",!1),SI(this,"mutex",new TD("P2PConnection-mutex")),SI(this,"onLocalCandidate",void 0),SI(this,"remoteSDP",void 0),SI(this,"pendingCandidates",[]),SI(this,"localCapabilities",void 0),SI(this,"isReady",!1),SI(this,"restartCnt",0),SI(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!==r&&void 0!==r?r:yx.SEND_ONLY,this.name=this.direction===yx.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Eq(this.peerConnection,VD("STATS_UPDATE_INTERVAL"),void 0,qP()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{let t=await MW();if(this.localCapabilities=jW(t),e){let{sdp:t}=e,n=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Ok(e);for(r=0;r<a.length;r++)n=a[r],ZH(t).call(t,n)>=0||(i[n]=e[n]);return i}(e,t);if(GH){var a=GH(e);for(r=0;r<a.length;r++)n=a[r],ZH(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,Sq),r=function(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=CW(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(FW(t,e,"videoExtensions",n,r,i),FW(t,e,"videoCodecs",n,r,i),FW(t,e,"audioExtensions",n,r,i),FW(t,e,"audioCodecs",n,r,i),VD("RAISE_H264_BASELINE_PRIORITY")){let e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){let t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){ik.debug("raising H264 baseline profile priority");let n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&VD("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}({},{},t);this.remoteSDP=new yq({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let a=wW(i.sdp);await this.peerConnection.setLocalDescription(i);let o=await UW({},{},i.sdp);this.localCapabilities=jW(o);let s=this.peerConnection.getTransceivers()[0];return null!=s&&s.receiver&&s.receiver.transport&&this.tryBindTransportEvents(s.receiver.transport),Tq(Tq({},a),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=wW(e.sdp);return this.initialOffer=e,Tq(Tq({},t),{},{sdp:e.sdp})}}catch(na){throw new mL(fL.GET_LOCAL_CONNECTION_PARAMS_FAILED,na.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:t,iceParameters:n,dtlsParameters:r}=e,i=await UW({},{},t);this.remoteSDP=new yq({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let a=this.peerConnection.getTransceivers()[0];null!=a&&a.sender&&a.sender.transport&&this.tryBindTransportEvents(a.sender.transport)}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(na.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((e=>{this.peerConnection.addIceCandidate(e)})),this.pendingCandidates=[])}catch(na){throw new mL(fL.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(na.toString()))}}send(e,t,n){var r=this;return BH((function*(){let i=yield LH(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let i=[],a=r.remoteSDP.receive(e,t,n);e.forEach(((e,t)=>{if(a[t].needCreateTransceiver){let t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{let n=r.peerConnection.getTransceivers().find((e=>e.mid===a[t].mid));if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a[t].mid));i.push(n),e._updateRtpTransceiver(n)}})),qP()&&!0===VD("SIMULCAST")&&(yield LH(r.applySimulcastForFirefox(i,e)));let o=a.map((e=>e.mid)),s=yield LH(r.peerConnection.createOffer()),c=r.mungSendOfferSDP(s.sdp,e,o),l=yW.parse(c),d=o.map((e=>{let t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return RW(t,VD("USE_PUB_RTX"))})),u=i.map(((e,t)=>{let n=o[t];return{localSSRC:d[t],id:n}}));yield LH(r.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield u}catch(ua){let t=r.remoteSDP.toString();throw yield LH(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield LH(r.peerConnection.setRemoteDescription({type:"answer",sdp:t})),yield LH(r.stopSending(o,!0)),ua}yield LH(r.applySimulcastEncodings(i,e)),yield LH(r.applySendEncodings(i,e));let h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return null!==p&&void 0!==p&&p(h),yield LH(r.setRemoteDescription({type:"answer",sdp:h})),i.map(((e,t)=>{let n=o[t];return{localSSRC:d[t],id:n}}))}catch(oa){throw oa instanceof mL?oa:new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(oa.toString()))}finally{i()}}))()}async stopSending(e,t){let n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:i,needExchangeSDP:a}=this.remoteSDP.send(e,t,n,r);if(a){let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer(),a=this.mungReceiveAnswerSDP(r.sdp,i,e);null!==n&&void 0!==n&&n(a||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:a}),ik.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else ik.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));let o=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!o||null===o.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,mid:o.mid,transceiver:o}}catch(aa){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(aa.toString()))}}async mockReceive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:i,needExchangeSDP:a}=this.remoteSDP.send(e,t,n,r);if(a){let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer(),a=this.mungReceiveAnswerSDP(r.sdp,i,e);null!==n&&void 0!==n&&n(a||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:a}),ik.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else ik.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(aa){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(aa.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(na.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===xD.Auto&&(this.store.p2pTransport=xD.SdRtn,Mj().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Mj().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:t}=wW(e.sdp);return this.store.descriptionStart(),this.direction===yx.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===yx.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:t}=wW(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(na.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let i=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null!==a&&void 0!==a&&a(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(yi){throw new mL(fL.EXCHANGE_SDP_FAILED,yi.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?qP()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:Tq(Tq({},nq),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:Tq(Tq({},nq),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;_h(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):ik.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={iceServers:[]};var a;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(FL(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,r)),VD("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),_h(a=[xD.Relay,xD.SdRtn]).call(a,n)&&(i.iceTransportPolicy="relay"),VD("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(i.iceTransportPolicy="relay")})))),VD("ENABLE_ENCODED_TRANSFORM")&&Mj().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),ik.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[],i=e.filter((e=>e.tcpport));ik.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));let a=i.length>n?i[n]:i[0];switch(t){case xD.SdRtn:let t=e.filter((e=>{var t;return _h(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL})),i=t.length>n?t[n]:t[0];i&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(xM(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(xM(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case xD.Relay:a&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(xM(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}));break;default:a&&(r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=udp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(xM(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}),r.push({username:a.username,credential:a.password,credentialType:"password",urls:"stun:".concat(a.turnServerURL,":").concat(a.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};let t=e.iceTransport;t&&(t.onstatechange=()=>{let t=null===e||void 0===e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){let{local:e,remote:n}=t.getSelectedCandidatePair();ik.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return ik.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return ik.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Mj().supportSetRtpSenderParameters)return ik.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var a;let{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),_h(a=e._hints).call(a,tV.LOW_STREAM)&&(n&&(i.maxFramerate=UM(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(VD("DSCP_TYPE")&&cL()){var o;let e=VD("DSCP_TYPE");_h(o=["very-low","low","medium","high"]).call(o,e)&&(i.networkPriority=e)}let s=t.getParameters(),c=null===(n=s.encodings)||void 0===n?void 0:n[0];qP()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(s,r),ik.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!Mj().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let r=e[n],i=t[n];i instanceof WG&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(n){ik.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){let r=yW.parse(e);return t.forEach(((e,t)=>{let i=n[t],a=r.mediaDescriptions.find((e=>e.attributes.mid===i));a&&(OW(a,e),xW(a,e,this.store.codec))})),yW.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,a,o;let c=e[s],l=t[s];if(l instanceof WG&&!_h(n=l._hints).call(n,tV.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(a=l._scalabilityMode)&&void 0!==a&&a.numSpatialLayers&&(null===(o=l._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){let e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];let n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!qP()&&e.length===t.length)for(let n=0;n<e.length;n++){let r=t[n];if(r instanceof WG&&this.isVP8Simulcast(r)){let t=e[n],i={},a={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];let o=t.sender.getParameters();await t.sender.setParameters(Object.assign(o,i))}}}isVP8Simulcast(e){var t,n,r,i,a;return!!(e instanceof WG&&VD("SIMULCAST")&&"vp8"===this.store.codec&&!_h(t=e._hints).call(t,tV.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(VD("SDP_LOGGING"))return ik.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(na.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async e=>{e.direction="sendonly"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(na.toString()))}}async getRemoteSSRC(e,t){var n,r;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp){var i;let n=null===(i=yW.parse(t).mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===i?void 0:i.attributes.ssrcs;return null===n||void 0===n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),_h(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){let r=yW.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===Jx.AUDIO&&"audio"===i.media.mediaType&&VW(i),yW.print(r)}},sx(vq.prototype,"establish",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"establish"),vq.prototype),sx(vq.prototype,"connect",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"connect"),vq.prototype),sx(vq.prototype,"receive",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"receive"),vq.prototype),sx(vq.prototype,"mockReceive",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"mockReceive"),vq.prototype),sx(vq.prototype,"stopReceiving",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"stopReceiving"),vq.prototype),sx(vq.prototype,"restartICE",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"restartICE"),vq.prototype),sx(vq.prototype,"close",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"close"),vq.prototype),sx(vq.prototype,"updateEncoderConfig",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"updateEncoderConfig"),vq.prototype),sx(vq.prototype,"updateSendParameters",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"updateSendParameters"),vq.prototype),sx(vq.prototype,"replaceTrack",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"replaceTrack"),vq.prototype),sx(vq.prototype,"muteLocal",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"muteLocal"),vq.prototype),sx(vq.prototype,"unmuteLocal",[wq],Object.getOwnPropertyDescriptor(vq.prototype,"unmuteLocal"),vq.prototype),vq);function wq(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return await r.apply(this,a)}finally{n()}},n}function Rq(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=UM(t.width),r.height=UM(t.height);let i=UM(t.framerate||15);document.body.append(n),document.body.append(r);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();let o=r.getContext("2d");if(!o)throw new bx(fL.UNEXPECTED_ERROR,"can not get canvas context");let s=Mj(),c=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){let e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(ik.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}o.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))},r.stopCapture=xV((()=>r.startCapture&&r.startCapture()),i);let l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),ik.debug("clean low stream renderer")},c}var Aq=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Aq||{}),Iq=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(Iq||{}),Nq=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Nq||{}),Oq=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(Oq||{}),Pq=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Pq||{}),Lq=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(Lq||{}),Dq=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(Dq||{}),kq=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(kq||{}),xq=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(xq||{}),Mq=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Mq||{}),Uq=1e3;function Fq(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function jq(e){let t={[Mq.CONN_TYPE]:0,[Mq.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[Mq.CONN_TYPE]=1),"tcp"===n&&(t[Mq.CONN_TYPE]=3),"tls"===n&&(t[Mq.CONN_TYPE]=4);break}case"srflx":t[Mq.CONN_TYPE]=2}return t}function Vq(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}var Bq,Gq,Wq,Hq,qq,zq,Kq,Yq,Jq,Xq,Qq,Zq,$q=class extends OL{constructor(e){super(),SI(this,"store",void 0),SI(this,"uploadWRTCStatsTimer",void 0),SI(this,"uploadOutboundDenoiserStatsTimer",void 0),SI(this,"uploadExtStatsTimer",void 0),SI(this,"uploadExtUsageStatsTimer",void 0),SI(this,"uploadInboundExtStatsTimer",void 0),SI(this,"requestStats",void 0),SI(this,"requestTransportStats",void 0),SI(this,"requestLocalMedia",void 0),SI(this,"requestRemoteMedia",void 0),SI(this,"requestAllTracks",void 0),SI(this,"requestVideoIsReady",void 0),SI(this,"requestUploadStats",void 0),SI(this,"requestUpload",void 0),SI(this,"uploadOutboundStarted",!1),SI(this,"uploadInboundStarted",!1),SI(this,"uploadTransportStarted",!1),SI(this,"uploadExtensionUsageStarted",!1),SI(this,"lastRecvStats",void 0),SI(this,"lastSendStats",void 0),SI(this,"lastFullRecvStats",void 0),SI(this,"lastFullSendStats",void 0),SI(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,n;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(n=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!n&&this.uploadInboundStarted&&(n=this.requestStats(!0)),t||n){let r={};if(this.uploadTransportStarted&&t){let i=this.getTransportStats(t,n,e);i&&(r.misc=[i])}if(this.uploadOutboundStarted&&t){let n=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);n&&(r.outbound=[n])}if(this.uploadInboundStarted&&n){let t=this.getInboundStats(n,e?this.lastRecvStats:this.lastFullRecvStats,e);t&&(r.inbound=t)}this.requestUploadStats(r)}this.lastRecvStats=n,this.lastSendStats=t,e||(this.lastFullRecvStats=n,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(3!==e),4===++e&&(e=1)}),Uq)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,n){if(!this.requestStats)return;if(n)return null==e.rtt?void 0:{addition:{[Mq.RTT]:e.rtt,[Mq.CONN_TYPE]:void 0}};let r=jq(e);if(this.store.useP2P){if(t){let e=jq(t);r[Mq.CONN_TYPE]+=e[Mq.CONN_TYPE]<<3}r[Mq.CONN_TYPE]+=110}else r[Mq.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,n){if(!this.requestUploadStats||!this.requestLocalMedia)return;let r,i,a,o=this.requestLocalMedia();return o&&0!==o.length?(o.forEach((o=>{let[s,{track:c,ssrcs:l}]=o;switch(s){case Zx.LocalVideoLowTrack:case Zx.LocalVideoTrack:if(s===Zx.LocalVideoTrack){let r=function(e,t,n,r,i){let a=t.videoSend.find((t=>t.ssrc===e));if(!a)return;let o={},{sentFrame:s,inputFrame:c}=a;if(c&&s){let e=c.frameRate,t=s.frameRate;o[Iq.FREEZE]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0}if(Fq(o,Iq.QP_SUM,a.qpSumPerFrame),i)return o;switch(s&&(Fq(o,Iq.HEIGHT,s.height),Fq(o,Iq.WIDTH,s.width),Fq(o,Iq.FRAME_RATE,s.frameRate)),o[Iq.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0,a.adaptionChangeReason){case"none":o[Iq.ADAPTATION]=0;break;case"cpu":o[Iq.ADAPTATION]=1;break;case"bandwidth":o[Iq.ADAPTATION]=2;break;case"other":o[Iq.ADAPTATION]=3}let l=0;a.adaptionChangeReason&&(l+=Vq(a.adaptionChangeReason)),t.qualityLimitationReason&&(l+=Vq(t.qualityLimitationReason)<<3),o[Iq.ADAPTATION]=l,o[Iq.PLAYER_STATUS]=SV[r._player?r._player.videoElementStatus:"uninit"],Fq(o,Iq.NACKS,a.nacksCount),Fq(o,Iq.PLIS,a.plisCount),Fq(o,Iq.FIRS,a.firsCount),Fq(o,Iq.AVG_ENCODE,a.avgEncodeMs);let d=n&&n.videoSend.find((t=>t.ssrc===e));if(d){let e=i?Uq:3e3;d.timestamp&&a.timestamp&&(e=a.timestamp-d.timestamp),null!=d.packets&&null!=a.packets&&Fq(o,Iq.PACKAGE_RATE,1e3*(a.packets-d.packets)/e),null!=a.packetsLost&&null!=d.packetsLost&&Fq(o,Iq.PACKAGE_LOST,a.packetsLost-d.packetsLost),null!=d.bytes&&null!=a.bytes&&Fq(o,Iq.BITRATE,8*(a.bytes-d.bytes)/e)}return o}(l[0].ssrcId,e,t,c,n),a=n?null:function(e,t,n){let r=t.videoSend.find((t=>t.ssrc===e));if(!r)return null;let i={},a=r.inputFrame,o=a&&a.height||n&&n.videoHeight||0,s=a&&a.width||n&&n.videoWidth||0,c=a&&a.frameRate||0;return Fq(i,Aq.HEIGHT,o),Fq(i,Aq.WIDTH,s),Fq(i,Aq.FRAME_RATE,c),i}(l[0].ssrcId,e,c),o=n?null:function(e){let t={};return Fq(t,Iq.RETRANSMIT,e.bitrate.retransmit),Fq(t,Iq.TARGET_ENCODED,e.bitrate.targetEncoded),Fq(t,Iq.ACTUAL_ENCODED,e.bitrate.actualEncoded),Fq(t,Iq.TRANSMIT,e.bitrate.transmit),Fq(t,Iq.BANDWIDTH,e.sendBandwidth),t}(e);i=Object.assign({},r,a,o)}else a=n?void 0:function(e,t,n){let r=t.videoSend.find((t=>t.ssrc===e));if(!r)return;let i={},a=r.sentFrame;if(a&&(Fq(i,Nq.HEIGHT,a.height),Fq(i,Nq.WIDTH,a.width),Fq(i,Nq.FRAME_RATE,a.frameRate)),n){let t=n.videoSend.find((t=>t.ssrc===e));if(t){let e=3e3;t.timestamp&&r.timestamp&&(e=r.timestamp-t.timestamp),null!=t.packets&&null!=r.packets&&Fq(i,Nq.PACKAGE_RATE,1e3*(r.packets-t.packets)/e),null!=r.packetsLost&&null!=t.packetsLost&&Fq(i,Nq.PACKAGE_LOST,r.packetsLost-t.packetsLost),null!=t.bytes&&null!=r.bytes&&Fq(i,Nq.BITRATE,8*(r.bytes-t.bytes)/e)}}return i}(l[0].ssrcId,e,t);break;case Zx.LocalAudioTrack:r=n?void 0:function(e,t,n,r){let i=t.audioSend.find((t=>t.ssrc===e));if(!i)return;let a={};a[Dq.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0;let o=100*r._source.getAccurateVolumeLevel(),s=i.inputLevel;if(null!=s){let e=Math.ceil(50*Math.log10(100*s+1));Fq(a,Dq.LEVEL,e)}Fq(a,Lq.PCM_LEVEL,o),Fq(a,Dq.AEC_RETURN_LOSS,i.aecReturnLoss),Fq(a,Dq.AEC_RETURN_LOSS_ENH,i.aecReturnLossEnhancement),a[Dq.FREEZE]=0;let c=n&&n.audioSend.find((t=>t.ssrc===e));if(c){let e=3e3;c.timestamp&&i.timestamp&&(e=i.timestamp-c.timestamp),null!=c.bytes&&null!=i.bytes&&Fq(a,Dq.BITRATE,8*(i.bytes-c.bytes)/e),null!=c.packets&&null!=i.packets&&Fq(a,Dq.PACKAGE_RATE,1e3*(i.packets-c.packets)/e)}return a}(l[0].ssrcId,e,t,c)}})),{high:i,low:a,audio:r}):void 0}getInboundStats(e,t,n){if(!this.requestRemoteMedia)return;let r=this.requestRemoteMedia()||[],i=[];return r.forEach((r=>{let[a,o]=r,s={peer:a.uid};if(o.has(Jx.VIDEO)&&a.videoTrack){let r=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,i=a.videoTrack?function(e,t,n,r,i,a,o){var s;let c=t.videoRecv.find((t=>t.ssrc===e));if(!c)return;let l={},{receivedFrame:d,outputFrame:u,decodeFrameRate:h}=c,p=n&&n.videoRecv.find((t=>t.ssrc===e));if(l[Oq.FREEZE]=i&&uz.isRemoteVideoFreeze(r,c,p)?1:0,Fq(l,Pq.FRAME_RATE_DECODE,h),Fq(l,Oq.QP_SUM,c.qpSumPerFrame),c.framesRateFirefox&&Fq(l,Oq.FRAME_RATE,c.framesRateFirefox),d&&Fq(l,Oq.FRAME_RATE,d.frameRate),p){let e=t.timestamp-n.timestamp||(o?Uq:3e3);null!=c.packetsLost&&null!=p.packetsLost&&Fq(l,Oq.PACKAGE_LOST,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&Fq(l,Oq.BITRATE,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&Fq(l,Oq.PACKAGE_RATE,1e3*(c.packets-p.packets)/e)}if(o)return l;d?(Fq(l,Oq.HEIGHT,d.height),Fq(l,Oq.WIDTH,d.width)):r&&(Fq(l,Oq.HEIGHT,r._videoHeight||0),Fq(l,Oq.WIDTH,r._videoWidth||0)),u&&Fq(l,Pq.FRAME_RATE_OUTPUT,u.frameRate);let f=null===(s=r._player)||void 0===s?void 0:s.rendFrameRate.toFixed(0);if(f&&Fq(l,Pq.FRAME_RATE_RENDER,+f),Fq(l,Oq.JITTER_BUFFER,c.jitterBufferMs),Fq(l,Oq.CURRENT_DELAY,c.currentDelayMs),Fq(l,Oq.FIRS,c.firsCount),Fq(l,Oq.NACKS,c.nacksCount),Fq(l,Oq.PLIS,c.plisCount),r){l[Oq.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1;let e=r._player;if(e){let{freezeTimeCounterList:t,renderFreezeAccTime:n,videoElementStatus:r}=e;if(t&&t.length>0&&Fq(l,Pq.FREEZE_TIME,t.splice(0,1)[0]),a&&"visible"===sW.visibility&&r===vV.PLAYING&&Mj().supportRequestVideoFrameCallback){let t=Math.min(6e3,n);e.renderFreezeAccTime=Math.max(0,n-t),Fq(l,Pq.FREEZE_TIME_RENDER,t)}if("number"==typeof c.totalFreezesDuration){let e=p&&p.totalFreezesDuration?c.totalFreezesDuration-p.totalFreezesDuration:c.totalFreezesDuration;Fq(l,Pq.FREEZE_DURATION,1e3*e)}}}if(l[Oq.PLAYER_STATUS]=SV[r._player?r._player.videoElementStatus:"uninit"],p&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==p.totalInterFrameDelay&&void 0!==p.totalSquaredInterFrameDelay){let e=c.totalInterFrameDelay-p.totalInterFrameDelay,t=c.totalSquaredInterFrameDelay-p.totalSquaredInterFrameDelay,n=c.framesDecodeCount-p.framesDecodeCount,r=e/n*1e3,i=Math.round(1e3*Math.sqrt((t-Math.pow(e,2)/n)/n));!isNaN(i)&&r+i>Math.max(3*r,r+150)&&(l[Oq.I_FRAME_DELAY]=i)}return l}(a._videoSSRC,e,t,a.videoTrack,!0===r,this.needUploadRenderFreezeTime,n):void 0;i&&(s.video=i)}if(o.has(Jx.AUDIO)&&a.audioTrack){let r=a.audioTrack?function(e,t,n,r,i){let a=t.audioRecv.find((t=>t.ssrc===e));if(!a)return;let o={},s=n&&n.audioRecv.find((t=>t.ssrc===e)),{receivedFrames:c,droppedFrames:l}=a;var d;if(Fq(o,kq.JITTER,a.jitterMs),null!=c&&null!=l&&(o[kq.FREEZE]=0===(d=c)||100*l/d>20?1:0),s){let e=t.timestamp-n.timestamp||(i?Uq:3e3);null!=a.packets&&null!=s.packets&&Fq(o,kq.PACKAGE_RATE,1e3*(a.packets-s.packets)/e),null!=s.bytes&&null!=a.bytes&&Fq(o,kq.BITRATE,8*(a.bytes-s.bytes)/e),null!=a.packetsLost&&null!=s.packetsLost&&Fq(o,kq.PACKAGE_LOST,a.packetsLost-s.packetsLost)}if(i)return o;let u=100*r._source.getAccurateVolumeLevel(),h=a.outputLevel;if(null!=h){let e=Math.ceil(50*Math.log10(100*h+1));Fq(o,xq.LEVEL,e)}if(Fq(o,kq.PCM_LEVEL,u),r&&(o[kq.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1),Fq(o,kq.JITTER_BUFFER,a.jitterBufferMs),Fq(o,kq.CURRENT_DELAY,a.jitterBufferMs),o[kq.PLAYER_STATUS]=SV[eB.getPlayerState(r.getTrackId())],s){let e=a.concealedSamples-s.concealedSamples;e>0&&Fq(o,kq.CONCEALED_SAMPLES,e)}return o}(a._audioSSRC,e,t,a.audioTrack,n):void 0;r&&(s.audio=r)}(s.video||s.audio)&&i.push(s)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,i}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find((e=>e instanceof xG));if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(Ex.DENOISER_STATS,t)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((e=>{e.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((e=>{let[t,n]=e;n.has(Jx.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})),n.has(Jx.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{let t=Date.now(),n={connectionInterval:VD("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t},r=[],i=this.requestAllTracks&&this.requestAllTracks()||[];for(let e of i)!e.muted&&e.enabled&&(r=r.concat(await e.getProcessorUsage()));let a=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[e,c]of a)c.has(Jx.VIDEO)&&e.videoTrack&&(r=r.concat(await e.videoTrack.getProcessorUsage())),c.has(Jx.AUDIO)&&e.audioTrack&&(r=r.concat(await e.audioTrack.getProcessorUsage()));if(0===r.length)return;n.details=function(e,t){let n={};for(let{id:o,value:s,level:c,direction:l}of e){var r;let e=null!==(r=t.get(o))&&void 0!==r?r:0,d=2===s?e+VD("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,a;t.set(o,d),n[o]?(2===s&&(n[o].value=s),c>n[o].level&&(n[o].level=c),"remote"===l&&(n[o].remoteUidCount+=1),n[o].totalTs=null!==(i=t.get(o))&&void 0!==i?i:0):n[o]={value:s,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(a=t.get(o))&&void 0!==a?a:0}}return Object.keys(n).map((e=>{let{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(r,e);let o=Date.now(),s=o>t?o:t+1;this.requestUpload&&this.requestUpload(Ex.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:s})}),VD("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}},ez=class{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){SI(this,"uid",void 0),SI(this,"_uintid",void 0),SI(this,"_trust_in_room_",!0),SI(this,"_trust_audio_enabled_state_",!0),SI(this,"_trust_video_enabled_state_",!0),SI(this,"_trust_audio_mute_state_",!0),SI(this,"_trust_video_mute_state_",!0),SI(this,"_audio_muted_",!1),SI(this,"_video_muted_",!1),SI(this,"_audio_enabled_",!0),SI(this,"_video_enabled_",!0),SI(this,"_audio_added_",!1),SI(this,"_video_added_",!1),SI(this,"_is_pre_created",!1),SI(this,"_video_pre_subscribed",!1),SI(this,"_audio_pre_subscribed",!1),SI(this,"_trust_video_stream_added_state_",!0),SI(this,"_trust_audio_stream_added_state_",!0),SI(this,"_audioTrack",void 0),SI(this,"_videoTrack",void 0),SI(this,"_dataChannels",[]),SI(this,"_audioSSRC",void 0),SI(this,"_videoSSRC",void 0),SI(this,"_audioOrtc",void 0),SI(this,"_videoOrtc",void 0),SI(this,"_cname",void 0),SI(this,"_rtxSsrcId",void 0),SI(this,"_videoMid",void 0),SI(this,"_audioMid",void 0),this.uid=e,this._uintid=t}},tz=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function nz(e,t){var n;let r;switch(t){case Zx.LocalAudioTrack:r=Fx.Audio;break;case Zx.LocalVideoTrack:r=_h(n=e._hints).call(n,tV.SCREEN_TRACK)?Fx.Screen:Fx.High;break;case Zx.LocalVideoLowTrack:r=Fx.Low}return r}function rz(e){let t=Mj();if(e.some((e=>e._bypassWebAudio)))throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function iz(e,t){rz(e);let n=new UG;return e.forEach((e=>n.addAudioTrack(e))),n}function az(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?az(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):az(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var sz=(Bq=cz(tz.SEND_ONLY),Gq=cz(tz.SEND_ONLY),Wq=cz(),Hq=cz(tz.RECEIVE_ONLY),qq=cz(tz.RECEIVE_ONLY),zq=cz(tz.RECEIVE_ONLY),Kq=cz(tz.RECEIVE_ONLY),Yq=cz(tz.RECEIVE_ONLY),Jq=cz(tz.RECEIVE_ONLY),Xq=cz(),Qq=cz(tz.RECEIVE_ONLY),Zq=class extends OL{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(eM.StateChange,t,this._state)}constructor(e,t){super(),SI(this,"isPlanB",!1),SI(this,"store",void 0),SI(this,"statsUploader",void 0),SI(this,"sendConnection",void 0),SI(this,"recvConnection",void 0),SI(this,"localTrackMap",new Map),SI(this,"remoteUserMap",new Map),SI(this,"localDataChannels",[]),SI(this,"pendingLocalTracks",[]),SI(this,"pendingRemoteTracks",[]),SI(this,"statsCollector",void 0),SI(this,"dtlsFailedCount",0),SI(this,"sendMutex",new TD("P2PChannel2-send-mutex")),SI(this,"recvMutex",new TD("P2PChannel2-recv-mutex")),SI(this,"_state",$x.Disconnected),SI(this,"_restartStates",["disconnected","failed"]),SI(this,"reconnectInterval",void 0),SI(this,"uploadUnplinkStarted",!1),SI(this,"uploadDownlinkStarted",!1),SI(this,"uplinkStateUploadInterval",void 0),SI(this,"downlinkStatsUploadInterval",void 0),SI(this,"handleMuteLocalTrack",(async(e,t,n)=>{let r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==$x.Connected)return void n(new mL(fL.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();let o=r.find((e=>"videoLowTrack"===e[0]));o&&o[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let s=!1;var i,a;s="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(Zx.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(a=this.localTrackMap.get(Zx.LocalVideoTrack))||void 0===a?void 0:a.id);let c=this.createMuteMessage(r);await zL(this,eM.RequestMuteLocal,c);let l="video"===e.trackMediaType?uM.MUTE_LOCAL_VIDEO:uM.MUTE_LOCAL_AUDIO;await zL(this,eM.RequestP2PMuteLocal,{action:l,message:c,isMuteAll:s}),t()}catch(sa){n(sa)}finally{r()}})),SI(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{let r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==$x.Connected)return void n(new mL(fL.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();await this.sendConnection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let i=this.createUnmuteMessage(r),a="video"===e.trackMediaType?uM.UNMUTE_LOCAL_VIDEO:uM.UNMUTE_LOCAL_AUDIO;await zL(this,eM.RequestP2PMuteLocal,{action:a,message:i}),t()}catch(oa){n(oa)}finally{r()}})),SI(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{let r=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let n=this.localTrackMap.get(Zx.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==$x.Connected)return void t();let{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(eM.UpdateVideoEncoder,i)),t()}catch(oa){n(oa)}finally{r()}})),SI(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{let r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let n=this.localTrackMap.get(Zx.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==$x.Connected)return void t();let{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(oa){n(oa)}finally{r()}})),SI(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;ik.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a;let n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.sendConnection||!n||void 0===n[1].id||this.state!==$x.Connected)return void t();if(await(null===(a=this.sendConnection)||void 0===a?void 0:a.replaceTrack(e,n[1].id)),n[0]===Zx.LocalVideoTrack&&Mj().supportDualStreamEncoding){let t=this.localTrackMap.get(Zx.LocalVideoLowTrack);if(t){let n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new hS(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(ha){n(ha)}finally{var o;null===(o=i)||void 0===o||o()}})),SI(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),SI(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),SI(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),SI(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new $q(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))}))}),VD("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new mL(fL.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new mL(fL.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(ik.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Cq(e,this.store,yx.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=$x.New,this.sendConnection&&(ik.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Cq(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new mL(fL.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$x.Connected}async addRemoteCandidate(e,t){if(t===yx.RECEIVE_ONLY){if(!this.sendConnection)throw new mL(fL.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new mL(fL.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return BH((function*(){let i=yield LH(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==$x.Connected){r.throwIfTrackTypeNotMatch(e);let t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,OH.markPublishStart(r.store.clientId,r.store.pubId);let i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield LH(r.tryToUnmuteAudio(e)));i.forEach((e=>{let{track:t,type:n}=e,i=Date.now();r.store.publish(t.getTrackId(),n===Zx.LocalAudioTrack?"audio":"video",i)})),r.bindLocalTrackEvents(i);let a=yield LH(r.sendConnection.send(i.map((e=>{let{track:t}=e;return t})),r.store.codec,r.store.audioCodec)),o=(yield LH(a.next())).value,s=r.createGatewayPublishMessage(i,o);try{yield s}catch(ha){throw a.throw(ha),(null===ha||void 0===ha?void 0:ha.code)===fL.WS_ABORT&&i.forEach((e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)})),r.unbindLocalTrackEvents(i),ha}yield LH(a.next()),i.forEach((e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(i,o),i.forEach((e=>{let{track:t,type:n}=e,i=Date.now();r.store.publish(t.getTrackId(),n===Zx.LocalAudioTrack?"audio":"video",void 0,i)})),r.startUploadUplinkState()}finally{i()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==$x.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((t=>!_h(e).call(e,t))));let t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;let n=t.find((e=>"videoLowTrack"===e[0]));n&&n[1].track.close();let r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===$x.Connected)return n&&n[1].track.close(),r;e.forEach((e=>{let t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let e=[],t=[];Array.from(this.localTrackMap.entries()).forEach((n=>{let[r,{track:i,ssrcs:a}]=n,o={stream_type:nz(i,r),ssrcs:a};i._muted||!i._enabled?e.push(o):t.push(o)})),e.length>0&&e.forEach((e=>{zL(this,eM.RequestMuteLocal,[e])})),t.length>0&&t.forEach((e=>{zL(this,eM.RequestUnmuteLocal,[e])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return BH((function*(){throw new mL(fL.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(ik.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await qL(this,eM.RequestRePublish,this.pendingLocalTracks),this.emit(eM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new mL(fL.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new mL(fL.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;let{track:a,mid:o,transceiver:s}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===Jx.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new oW(a,e.uid,e._uintid,this.store),ik.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),s&&e._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new aW(a,e.uid,e._uintid,this.store),ik.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),s&&e._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._videoTrack));let c=this.remoteUserMap.get(e);c?c.set(t,o):this.remoteUserMap.set(e,new Map([[t,o]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let l=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(eM.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new mL(fL.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){let r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.recvConnection||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===Jx.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===Jx.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;let i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach((e=>{let[t,{kind:r}]=e;var i,a;if(r===Jx.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===Jx.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(a=t._videoTrack)||void 0===a||a._destroy(),t._videoTrack=void 0);else if(r===Jx.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),!n&&(null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0)}})),i.forEach((e=>{let[,{kind:t}]=e;zL(this,eM.RequestP2PMuteRemote,t)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach((e=>{let[,t]=e;[Jx.VIDEO,Jx.AUDIO].forEach((e=>{t.has(e)?zL(this,eM.RequestP2PUnmuteRemote,e):zL(this,eM.RequestP2PMuteRemote,e)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new mL(fL.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new mL(fL.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new mL(fL.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new mL(fL.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);if(!n)return void ik.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void ik.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===Jx.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);n?n.get(t)||ik.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):ik.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){let t=this.localTrackMap.get(Zx.LocalAudioTrack);if((null===t||void 0===t?void 0:t.track)instanceof UG){let n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==Zx.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===Zx.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===Zx.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){let n=this.localTrackMap.get(Zx.LocalAudioTrack),a=r?this.localTrackMap.get(Zx.LocalVideoLowTrack):this.localTrackMap.get(Zx.LocalVideoTrack);hk.publish(this.store.sessionId,{eventElapse:OH.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null===n||void 0===n?void 0:n.track.getTrackLabel(),videoName:null===a||void 0===a?void 0:a.track.getTrackLabel(),screenshare:-1!==(null===a||void 0===a?void 0:a.track._hints.indexOf(tV.SCREEN_TRACK)),audio:!!n,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var a;n||(n=[]);let o=n.find((e=>e instanceof kG)),s=r?null===(a=this.localTrackMap.get(Zx.LocalVideoTrack))||void 0===a?void 0:a.track:n.find((e=>e instanceof WG));hk.publish(this.store.sessionId,{eventElapse:OH.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null===o||void 0===o?void 0:o.getTrackLabel(),videoName:null===s||void 0===s?void 0:s.getTrackLabel(),screenshare:-1!==(null===s||void 0===s?void 0:s._hints.indexOf(tV.SCREEN_TRACK)),audio:!!o,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){let i=r===Jx.VIDEO?n._videoSSRC:n._audioSSRC;i&&hk.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Jx.VIDEO,audio:r===Jx.AUDIO,peerid:n.uid,subscribeRequestid:r===Jx.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:OH.measureFromSubscribeStart(this.store.clientId,i)})}reset(){ik.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new TD("P2PChannel2-send-mutex"),this.sendMutex=new TD("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Zx.LocalAudioTrack);if((null===e||void 0===e?void 0:e.track)instanceof UG){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=$x.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Zx.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Zx.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof WG||t&&t.track instanceof kG?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;let n=Array.from(Pb(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(Zx.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=IT(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(ik.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=$x.Reconnecting,VD("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case Zx.LocalVideoTrack:_h(t=r._hints).call(t,tV.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Zx.LocalAudioTrack:r instanceof UG?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Zx.LocalVideoLowTrack:}})),this.emit(eM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Pb(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(eM.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),ik.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:r,kind:i}=n;if((e instanceof ez?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===yx.SEND_ONLY){if(!this.sendConnection)throw new mL(fL.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new mL(fL.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){let e=await r.restartICE(t);return r.isInRestartIce=!1,e}{let e=await r.restartICE();if(e){let t=await qL(this,eM.RequestP2PRestartICE,{direction:yx.RECEIVE_ONLY,iceParameter:e});await r.restartICE(t),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(Zx.LocalVideoTrack),n=this.localTrackMap.get(Zx.LocalAudioTrack),r=e.videoSend.find((e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;let a=KL(this,eM.NeedSignalRTT),o=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=o&&s?(o+s)/2:o||s,l=(c&&a?(c+a)/2:c||a)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null===t||void 0===t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(tV.SCREEN_TRACK)){let t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){let e=(1e3*t-n)/(1e3*t);return mk[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n,i=r._audioSSRC,a=r._videoSSRC,o=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===a));if(!o&&!s)return void(t+=1);let c=KL(this,eM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=o?o.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new hS(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){let r=[],i=Mj(),a=this.getAllTracks();e=QL(e=e.filter((e=>-1===a.indexOf(e))));let o=!1,s=!1;for(let c of e){if(c instanceof WG&&(this.localTrackMap.has(Zx.LocalVideoTrack)||o?new mL(fL.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:Zx.LocalVideoTrack}),o=!0),t)){let e=this.getLowVideoTrack(c,n);r.push({track:e,type:Zx.LocalVideoLowTrack})}if(c instanceof kG){let e=this.localTrackMap.get(Zx.LocalAudioTrack);if(e){if(!(e.track instanceof UG))throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(s){let e=r.find((e=>{let{type:t}=e;return t===Zx.LocalAudioTrack}));if(!(e.track instanceof UG))throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof UG||c._bypassWebAudio)r.push({track:c,type:Zx.LocalAudioTrack});else{let e=new UG;e.addAudioTrack(c),r.push({track:e,type:Zx.LocalAudioTrack})}s=!0}}}return r}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=QL(e=e.filter((e=>-1!==n.indexOf(e))));for(let r of e){if(r instanceof kG){let e=this.localTrackMap.get(Zx.LocalAudioTrack);if(!e)continue;e.track instanceof UG?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([Zx.LocalAudioTrack,e]),e.track.close())):t.push([Zx.LocalAudioTrack,e])}if(r instanceof WG){let e=this.localTrackMap.get(Zx.LocalVideoTrack);if(!e)continue;t.push([Zx.LocalVideoTrack,e]);let n=this.localTrackMap.get(Zx.LocalVideoLowTrack);n&&t.push([Zx.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case Zx.LocalVideoTrack:t.addListener(eV.GET_STATS,this.handleGetLocalVideoStats),t.addListener(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(eV.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(eV.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(eV.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Zx.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case Zx.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof UG?e.trackList.forEach((e=>{e.addListener(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(eV.GET_STATS,this.handleGetLocalAudioStats),e.addListener(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(eV.GET_STATS,this.handleGetLocalAudioStats),e.addListener(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(eV.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case Zx.LocalVideoTrack:t.off(eV.GET_STATS,this.handleGetLocalVideoStats),t.off(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(eV.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(eV.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(eV.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Zx.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case Zx.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof UG?e.trackList.forEach((e=>{e.off(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(eV.GET_STATS,this.handleGetLocalAudioStats),e.off(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(eV.GET_STATS,this.handleGetLocalAudioStats),e.off(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(eV.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof aW&&t.addListener(eV.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof oW&&t.addListener(eV.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(eV.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(Jx.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Jx.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,{track:a,type:o}=e;switch(o){case Zx.LocalAudioTrack:i=Fx.Audio;break;case Zx.LocalVideoTrack:i=_h(r=a._hints).call(r,tV.SCREEN_TRACK)?Fx.Screen:Fx.High;break;case Zx.LocalVideoLowTrack:i=Fx.Low}return{kind:o===Zx.LocalAudioTrack?Jx.AUDIO:Jx.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:a.muted||!a.enabled}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case Zx.LocalVideoTrack:n=_h(t=i._hints).call(t,tV.SCREEN_TRACK)?Fx.Screen:Fx.High;break;case Zx.LocalAudioTrack:n=Fx.Audio;break;case Zx.LocalVideoLowTrack:n=Fx.Low}return{stream_type:n,ssrcs:a,mid:o}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(eM.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),_h(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await dD(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),hk.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:kL.TRACER}).onSuccess(),this.emit(eM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;let n=Array.from(Pb(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(sV.FIRST_FRAME_DECODED),hk.firstRemoteFrame(this.store.sessionId,sk.FIRST_AUDIO_DECODE,ck.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:OH.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;let n=Array.from(Pb(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&hk.firstRemoteFrame(this.store.sessionId,sk.FIRST_AUDIO_RECEIVED,ck.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:OH.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;let n=Array.from(Pb(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&hk.firstRemoteFrame(this.store.sessionId,sk.FIRST_VIDEO_RECEIVED,ck.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:OH.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{let n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(eM.ConnectionTypeChange,n),ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(WM(t))," -> ").concat(JSON.stringify(WM(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(WM(t))," -> ").concat(JSON.stringify(WM(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(eM.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===yx.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,ik.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===yx.SEND_ONLY?this.restartICE(e):qL(this,eM.RequestP2PRestartICE,{direction:yx.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(-1===this.getAllTracks().indexOf(e))return t;let n=this.localTrackMap.get(Zx.LocalAudioTrack);if(e instanceof kG&&(null===n||void 0===n?void 0:n.track)instanceof UG)return n.track.isActive||t.push([Zx.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===Zx.LocalVideoTrack)){let e=this.localTrackMap.get(Zx.LocalVideoLowTrack);e&&t.push([Zx.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(Zx.LocalAudioTrack);if(e instanceof kG&&(null===n||void 0===n?void 0:n.track)instanceof UG)return n.track.isActive&&t.push([Zx.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===Zx.LocalVideoTrack){t.push(r);let e=this.localTrackMap.get(Zx.LocalVideoLowTrack);e&&t.push([Zx.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case Zx.LocalAudioTrack:n=Fx.Audio;break;case Zx.LocalVideoTrack:n=_h(t=i._hints).call(t,tV.SCREEN_TRACK)?Fx.Screen:Fx.High;break;case Zx.LocalVideoLowTrack:n=Fx.Low}return{stream_type:n,ssrcs:a,mid:o}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case Zx.LocalAudioTrack:n=Fx.Audio;break;case Zx.LocalVideoTrack:n=_h(t=i._hints).call(t,tV.SCREEN_TRACK)?Fx.Screen:Fx.High;break;case Zx.LocalVideoLowTrack:n=Fx.Low}return{stream_type:n,ssrcs:a,mid:o}}))}filterTobeUnSubscribedTracks(e,t){let n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){let i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){let t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case Jx.VIDEO:return void(n._videoSSRC&&t.push({stream_type:Jx.VIDEO,ssrcId:n._videoSSRC}));case Jx.AUDIO:return void(n._audioSSRC&&t.push({stream_type:Jx.AUDIO,ssrcId:n._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e,r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){let t=this.localTrackMap.get(Zx.LocalVideoTrack),n=this.localTrackMap.get(Zx.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof kG){let n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;let r=this.createUnmuteMessage(n);return void await zL(this,eM.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(eM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(eM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await dD(RD(this.dtlsFailedCount,wD)),this.emit(eM.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Zx.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof WG))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof WG)).length>1)throw new mL(fL.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof kG)).length>1&&(e.some((e=>e instanceof kG&&e._bypassWebAudio))||!Mj().webAudioMediaStreamDest))throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof WG&&this.pendingLocalTracks.some((e=>e instanceof WG)))throw new mL(fL.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof kG&&this.pendingLocalTracks.some((e=>e instanceof kG))&&(!Mj().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof kG&&e._bypassWebAudio))))throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let n,r=!VD("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mj().supportDualStreamEncoding,i=oz(oz({},{width:160,height:120,framerate:15,bitrate:50}),t);n=r?e._mediaStreamTrack.clone():Rq(e,i);let a=uD(8,"track-low-"),o=new WG(n,oz(oz({},r&&{scaleResolutionDownBy:GM(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return o.on(aV.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,nV.LOW_STREAM)})),o._hints.push(tV.LOW_STREAM),e.addListener(eV.NEED_CLOSE,(()=>{o.close()})),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;let a=Array.from(Pb(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());let i=this.store.keyMetrics,o=i.subscribe.find((e=>e.userId===a.uid&&"video"===e.type));hk.firstRemoteVideoDecode(this.store.sessionId,sk.FIRST_VIDEO_DECODE,ck.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:OH.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null===o||void 0===o?void 0:o.subscribeEnd)||0,subscriberStart:(null===o||void 0===o?void 0:o.subscribeStart)||0,videoAddNotify:(null===o||void 0===o?void 0:o.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let i=r.get(t);if(!i)return!1;let a=await this.recvConnection.getRemoteSSRC(i);return void 0!==a&&a!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new mL(fL.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new mL(fL.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new mL(fL.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new mL(fL.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new mL(fL.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new mL(fL.NOT_SUPPORTED)}async preConnect(e){throw new mL(fL.NOT_SUPPORTED)}getEstablishParams(){throw new mL(fL.NOT_SUPPORTED)}async reSubscribe(e){throw new mL(fL.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new mL(fL.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===Zx.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,nV.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},sx(Zq.prototype,"p2pConnect",[Bq],Object.getOwnPropertyDescriptor(Zq.prototype,"p2pConnect"),Zq.prototype),sx(Zq.prototype,"unpublish",[Gq],Object.getOwnPropertyDescriptor(Zq.prototype,"unpublish"),Zq.prototype),sx(Zq.prototype,"unpublishLowStream",[Wq],Object.getOwnPropertyDescriptor(Zq.prototype,"unpublishLowStream"),Zq.prototype),sx(Zq.prototype,"subscribe",[Hq],Object.getOwnPropertyDescriptor(Zq.prototype,"subscribe"),Zq.prototype),sx(Zq.prototype,"mockSubscribe",[qq],Object.getOwnPropertyDescriptor(Zq.prototype,"mockSubscribe"),Zq.prototype),sx(Zq.prototype,"unsubscribe",[zq],Object.getOwnPropertyDescriptor(Zq.prototype,"unsubscribe"),Zq.prototype),sx(Zq.prototype,"muteRemote",[Kq],Object.getOwnPropertyDescriptor(Zq.prototype,"muteRemote"),Zq.prototype),sx(Zq.prototype,"unmuteRemote",[Yq],Object.getOwnPropertyDescriptor(Zq.prototype,"unmuteRemote"),Zq.prototype),sx(Zq.prototype,"hasRemoteMediaWithLock",[Jq],Object.getOwnPropertyDescriptor(Zq.prototype,"hasRemoteMediaWithLock"),Zq.prototype),sx(Zq.prototype,"disconnectForReconnect",[Xq],Object.getOwnPropertyDescriptor(Zq.prototype,"disconnectForReconnect"),Zq.prototype),sx(Zq.prototype,"remoteMediaSsrcChanged",[Qq],Object.getOwnPropertyDescriptor(Zq.prototype,"remoteMediaSsrcChanged"),Zq.prototype),Zq);function cz(e){return function(t,n,r){let i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];switch(e){case tz.SEND_ONLY:{let e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case tz.RECEIVE_ONLY:{let e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{let e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}function lz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lz(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lz(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var uz=class e{constructor(e){SI(this,"store",void 0),SI(this,"onStatsException",void 0),SI(this,"onUploadPublishDuration",void 0),SI(this,"onStatsChanged",void 0),SI(this,"localStats",new Map),SI(this,"remoteStats",new Map),SI(this,"updateStatsInterval",void 0),SI(this,"trafficStats",void 0),SI(this,"trafficStatsPeerList",[]),SI(this,"uplinkStats",void 0),SI(this,"exceptionMonitor",void 0),SI(this,"p2pChannel",void 0),SI(this,"scalabilityMode",cx.L1T1),SI(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.exceptionMonitor=new IH,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Zx.LocalAudioTrack)||dz({},dV)}getLocalVideoTrackStats(){return this.localStats.get(Zx.LocalVideoTrack)||dz({},uV)}getRemoteAudioTrackStats(e){let t=(e,t)=>{if(!this.trafficStats)return t;let n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;let i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){let t={};if(e){var n;let r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){let t=(e,t)=>{if(!this.trafficStats)return t;let n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;let i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0,i=this.localStats.get(Zx.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);let a=this.localStats.get(Zx.LocalVideoTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate);let o=this.localStats.get(Zx.LocalVideoLowTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;let n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?OH.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?OH.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&ik.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;let r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case Zx.LocalVideoTrack:case Zx.LocalVideoLowTrack:{let t=r,a=dz({},uV),o=e.getStats(),s=e.getLocalMedia(n);if(o){let n=o.videoSend.find((e=>e.ssrc===(null===s||void 0===s?void 0:s.ssrcs[0].ssrcId)));if(n){let r=e.getLocalVideoSize(),i=e.getEncoderConfig(Zx.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(a.codecType=n.codec),a.sendBytes=n.bytes,a.sendBitrate=t?8*Math.max(0,a.sendBytes-t.sendBytes):0,n.inputFrame?(a.captureFrameRate=n.inputFrame.frameRate,a.captureResolutionHeight=n.inputFrame.height,a.captureResolutionWidth=n.inputFrame.width):r&&(a.captureResolutionWidth=r.width,a.captureResolutionHeight=r.height),n.sentFrame?(a.sendFrameRate=n.sentFrame.frameRate,a.sendResolutionHeight=n.sentFrame.height,a.sendResolutionWidth=n.sentFrame.width):r&&(a.sendResolutionWidth=r.width,a.sendResolutionHeight=r.height),n.avgEncodeMs&&(a.encodeDelay=n.avgEncodeMs),i&&i.bitrateMax&&(a.targetSendBitrate=1e3*i.bitrateMax),a.sendPackets=n.packets,a.sendPacketsLost=n.packetsLost,a.sendJitterMs=n.jitterMs,a.sendRttMs=n.rttMs,a.totalDuration=t?t.totalDuration+1:1,a.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(a.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(ik.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var i;this.localStats.set(n,a),((null===t||void 0===t?void 0:t.sendResolutionWidth)!==a.sendResolutionWidth||(null===t||void 0===t?void 0:t.sendResolutionHeight)!==a.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&s&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,s.track,a);break}case Zx.LocalAudioTrack:{let t=r,i=dz({},dV),a=e.getStats(),o=e.getLocalMedia(n);if(a){let n=a.audioSend.find((e=>e.ssrc===(null===o||void 0===o?void 0:o.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{let t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Zx.LocalAudioTrack,i),i&&o&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,o.track,i);break}}}))}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach((n=>{var r,i;let a,[o,{videoStats:s,audioStats:c,videoPcStats:l}]=n,d=c,u=s,h=l,p=dz({},hV),f=dz({},fV),m=dz({},pV),{audioTrack:_,videoTrack:g,audioSSRC:E,videoSSRC:v}=t.getRemoteMedia(o);a=t instanceof sz?t.getStats(!0):t.getStats();let y=null===(r=a)||void 0===r?void 0:r.audioRecv.find((e=>e.ssrc===E)),S=null===(i=a)||void 0===i?void 0:i.videoRecv.find((e=>e.ssrc===v)),b=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===o));if(y&&("opus"!==y.codec&&"aac"!==y.codec&&"PCMU"!==y.codec&&"PCMA"!==y.codec&&"G722"!==y.codec||(p.codecType=y.codec),y.outputLevel?p.receiveLevel=Math.round(32767*y.outputLevel):_&&(p.receiveLevel=Math.round(32767*_.getVolumeLevel())),p.receiveBytes=y.bytes,p.receivePackets=y.packets,p.receivePacketsLost=y.packetsLost,p.receivePacketsDiscarded=y.packetsDiscarded,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.receiveBitrate=d?8*Math.max(0,p.receiveBytes-d.receiveBytes):0,p.totalDuration=d?d.totalDuration+1:1,p.totalFreezeTime=d?d.totalFreezeTime:0,p.freezeRate=p.totalFreezeTime/p.totalDuration,p.receiveDelay=y.jitterBufferMs,p.totalDuration>10&&e.isRemoteAudioFreeze(_)&&(p.totalFreezeTime+=1)),S){"H264"!==S.codec&&"H265"!==S.codec&&"VP8"!==S.codec&&"VP9"!==S.codec&&"AV1X"!==S.codec&&"AV1"!==S.codec||(f.codecType=S.codec),f.receiveBytes=S.bytes,f.receiveBitrate=u?8*Math.max(0,f.receiveBytes-u.receiveBytes):0,f.decodeFrameRate=S.decodeFrameRate<0?0:S.decodeFrameRate,f.renderFrameRate=S.decodeFrameRate<0?0:S.decodeFrameRate,S.outputFrame&&(f.renderFrameRate=S.outputFrame.frameRate),S.receivedFrame?(f.receiveFrameRate=S.receivedFrame.frameRate,f.receiveResolutionHeight=S.receivedFrame.height,f.receiveResolutionWidth=S.receivedFrame.width):g&&(f.receiveResolutionHeight=g._videoHeight||0,f.receiveResolutionWidth=g._videoWidth||0),void 0!==S.framesRateFirefox&&(f.receiveFrameRate=Math.round(S.framesRateFirefox)),f.receivePackets=S.packets,f.receivePacketsLost=S.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.totalDuration=u?u.totalDuration+1:1,f.totalFreezeTime=u?u.totalFreezeTime:0,f.receiveDelay=S.jitterBufferMs||0;let n=!!v&&t.getRemoteVideoIsReady(v);g&&n&&e.isRemoteVideoFreeze(g,S,h)&&(f.totalFreezeTime+=1),f.freezeRate=f.totalFreezeTime/f.totalDuration}b&&(p.end2EndDelay=b.B_ad,f.end2EndDelay=b.B_vd,p.transportDelay=b.B_ed,f.transportDelay=b.B_ed,p.currentPacketLossRate=b.B_ealr4/100,f.currentPacketLossRate=b.B_evlr4/100,m.uplinkNetworkQuality=b.B_punq?b.B_punq:0,m.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(o,{audioStats:p,videoStats:f,videoPcStats:S,networkStats:m}),_&&this.exceptionMonitor.setRemoteAudioStats(_,p),g&&this.exceptionMonitor.setRemoteVideoStats(g,f)}))}},hz=class{constructor(){SI(this,"destChannelMediaInfos",new Map),SI(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Dx(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Dx(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Tx(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}};function pz(e){if(!(e instanceof hz))return new bx(fL.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new bx(fL.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new bx(fL.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}function fz(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new PH(r=new UH((function(n){n(e[t](r))})),1)}}return t[void 0!==gI&&EI||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}var mz,_z=Ks(FH);function gz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ez(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gz(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gz(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vz(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vz(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Sz=(mz=class e extends Yx{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return _h(t=Object.keys(HD)).call(t,e)})))]}constructor(t,n){super(t,n),SI(this,"store",void 0),SI(this,"peerConnection",void 0),SI(this,"remoteSDP",void 0),SI(this,"initialOffer",void 0),SI(this,"statsFilter",void 0),SI(this,"useRTX",!1),SI(this,"localCapabilities",void 0),SI(this,"localCandidateCount",0),SI(this,"allCandidatesReceived",!1),SI(this,"establishPromise",void 0),SI(this,"mutex",new TD("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Eq(this.peerConnection,VD("STATS_UPDATE_INTERVAL"),void 0,qP()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=wW(e.sdp),n=CW(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:VD("FILTER_VIDEO_FEC"),filterAudioFec:VD("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,yz(yz({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(g0){throw new mL(fL.GET_LOCAL_CONNECTION_PARAMS_FAILED,g0.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(e){SI(this,"sessionDesc",void 0),SI(this,"localCapabilities",void 0),SI(this,"rtpCapabilities",void 0),SI(this,"candidates",void 0),SI(this,"iceParameters",void 0),SI(this,"dtlsParameters",void 0),SI(this,"setup",void 0),SI(this,"currentMidIndex",void 0),SI(this,"cname",void 0),e=$L(e);let{iceParameters:t,dtlsParameters:n,candidates:r,rtpCapabilities:i,setup:a,localCapabilities:o,sdkCodec:s,cname:c}=e,l=yW.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this.iceParameters=t,this.dtlsParameters=n,this.setup=a,this.localCapabilities=o,this.cname=c;for(let d=0;d<l.mediaDescriptions.length;d++){let e=l.mediaDescriptions[d];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=a,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10)));let t=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:_h(n=t.encodingName.toLowerCase()).call(n,s)}));0===t.length&&(t=i.videoCodecs),e.attributes.payloads=t,e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),l.mediaDescriptions[d]=this.mungMediaDesc(e)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return yW.print(this.sessionDesc)}send(e,t,n){let{ssrcs:r,ssrcGroups:i}=NW(t,this.cname),a=this.sessionDesc.mediaDescriptions.find((t=>e===Jx.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),o=r[0].attributes.label,s=r[0].attributes.mslabel;return a.attributes.ssrcs=a.attributes.ssrcs.concat(r),a.attributes.ssrcGroups=a.attributes.ssrcGroups.concat(i),{id:o,mslabel:s}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{let n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{_h(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{var t;_h(t=i.map((e=>e.ssrcId))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{let n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){e===Xx.TCP?this.candidates.forEach((e=>{-1===this.candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this.candidates.push(Ez(Ez({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this.candidates=this.candidates.filter((e=>"tcp"!==e.transport));for(let t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=$L(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){let n=$L(e);return OW(n,t),LW(n,t),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){let r=this.sessionDesc.mediaDescriptions.find((t=>e===Jx.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){let e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){let t=$L(e);return PW(t),function(e){let t=e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{let t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(let t of this.sessionDesc.mediaDescriptions)for(let n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}(yz(yz({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(na.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new mL(fL.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return BH((function*(){let r=yield LH(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let r,i=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),a=yield LH(n.peerConnection.createOffer()),o=yW.parse(a.sdp),s=e.map((e=>{let t=e._mediaStreamTrack,r=o.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){let r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){let e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));try{r=yield s}catch(la){throw i.forEach((e=>{WP()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),la}let c=n.mungSendOfferSDP(a.sdp,e);n.remoteSDP.receive(e,t,r);let l=n.remoteSDP.toString();return yield LH(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield LH(n.applySendEncodings(i,e)),yield LH(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map(((e,t)=>{let n=e._mediaStreamTrack.id;return{localSSRC:s[t],id:n}}))}catch(aa){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(aa.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{WP()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(na.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),a=new hS(((t,r)=>{let a=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),o=r=>{let s=UP();if(("Safari"===s.name&&11===Number(s.version)||zP())&&r.track.id!==n&&r.streams[0].id===i){var c;let i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",o),clearTimeout(a),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",o),clearTimeout(a),void t(r.track)};this.peerConnection.addEventListener("track",o)})),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),{track:await a,id:n}}catch(aa){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(aa.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(na.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if(WP()&&e.track)e.track.enabled=!1;else{let t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(na.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if(WP()&&e.track)e.track.enabled=!0;else{let t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(na.toString()))}}restartICE(e){var t=this;return BH((function*(){let n=yield LH(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Mj().supportPCSetConfiguration){let n=t.peerConnection.getConfiguration(),r=e===Xx.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(ik.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===Xx.RELAY)return;e!==Xx.RELAY&&t.remoteSDP.updateCandidates(e);let n=yield LH(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let r=wW(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);let a=t.remoteSDP.toString();yield LH(t.peerConnection.setLocalDescription(n)),yield LH(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(r){ik.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),r)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);let r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(yi){throw new mL(fL.EXCHANGE_SDP_FAILED,yi.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new mL(fL.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new mL(fL.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,ik.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,ik.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),VD("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(FL(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),VD("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){let t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id}))),!t)return ik.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Mj().supportSetRtpSenderParameters)return ik.warn("Browser not support set rtp-sender parameters");let r={},i={};if(e instanceof WG)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(VD("DSCP_TYPE")&&cL()){var a;let e=VD("DSCP_TYPE");_h(a=["very-low","low","medium","high"]).call(a,e)&&(i.networkPriority=e)}let o=t.getParameters(),s=null===(n=o.encodings)||void 0===n?void 0:n[0];s&&Object.assign(s,i),Object.assign(o,r),ik.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(o.encodings))),await t.setParameters(o)}async applySendEncodings(e,t){try{if(!Mj().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch(n){ik.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){let n=yW.parse(e);return t.forEach(((e,t)=>{let r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&OW(i,e)})),yW.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t,{kind:a}=e[n];return new hS(((e,t)=>{let n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),o=t=>{let s=UP();if("Safari"===s.name&&11===Number(s.version)&&t.track.id!==r&&t.streams[0].id===i){var c;let i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(a,r,t.track.id),this.peerConnection.removeEventListener("track",o),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",o),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",o)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await hS.all(t)}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(na.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return null===t||void 0===t?void 0:t[0].ssrcId}setConfiguration(t){if(Mj().supportPCSetConfiguration){let n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},sx(mz.prototype,"connect",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"connect"),mz.prototype),sx(mz.prototype,"stopSending",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"stopSending"),mz.prototype),sx(mz.prototype,"receive",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"receive"),mz.prototype),sx(mz.prototype,"stopReceiving",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"stopReceiving"),mz.prototype),sx(mz.prototype,"muteRemote",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"muteRemote"),mz.prototype),sx(mz.prototype,"unmuteRemote",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"unmuteRemote"),mz.prototype),sx(mz.prototype,"muteLocal",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"muteLocal"),mz.prototype),sx(mz.prototype,"unmuteLocal",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"unmuteLocal"),mz.prototype),sx(mz.prototype,"close",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"close"),mz.prototype),sx(mz.prototype,"updateEncoderConfig",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"updateEncoderConfig"),mz.prototype),sx(mz.prototype,"updateSendParameters",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"updateSendParameters"),mz.prototype),sx(mz.prototype,"replaceTrack",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"replaceTrack"),mz.prototype),sx(mz.prototype,"getRemoteSSRC",[bz],Object.getOwnPropertyDescriptor(mz.prototype,"getRemoteSSRC"),mz.prototype),mz);function bz(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return await r.apply(this,a)}finally{n()}},n}function Tz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tz(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tz(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wz="9",Rz=class{get localCapabilities(){return $L(this._localCapabilities)}get rtpCapabilities(){return $L(this._rtpCapabilities)}get candidates(){return $L(this._candidates)}get iceParameters(){return $L(this._iceParameters)}get dtlsParameters(){return $L(this._dtlsParameters)}constructor(e){SI(this,"sessionDesc",void 0),SI(this,"_localCapabilities",void 0),SI(this,"_rtpCapabilities",void 0),SI(this,"_candidates",void 0),SI(this,"_iceParameters",void 0),SI(this,"_dtlsParameters",void 0),SI(this,"setup",void 0),SI(this,"currentMidIndex",void 0),SI(this,"cname",void 0),SI(this,"firefoxSsrcMidMap",new Map),e=$L(e);let{iceParameters:t,dtlsParameters:n,candidates:r,rtpCapabilities:i,setup:a,localCapabilities:o,cname:s}=e;this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=o,this.setup=a,this.cname=s,this.sessionDesc=this.updateRemoteRTPCapabilities(i),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){let t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send,a=this.sessionDesc.mediaDescriptions.length-1;for(let o=1;o<e;o++){let e=2*o+2e4,s=2*o+4e4,{ssrcs:c,ssrcGroups:l}=NW([{ssrcId:e}],this.cname),{ssrcs:d,ssrcGroups:u}=NW([{ssrcId:s,rtx:VD("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:wz,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++a)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:wz,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++a)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return yW.print(this.sessionDesc)}send(e,t,n,r){let{ssrcs:i,ssrcGroups:a}=NW(t,this.cname,VD("SYNC_GROUP")?n:void 0),o=this.findPreloadMediaDesc(i);if(o){if(qP()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,o.attributes.mid),r&&(r.twcc||r.remb)){let e=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(o,r),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{let t,n=this.findAvailableMediaIndex(e,i);return-1===n||1===n&&(WP()||function(){let e=UP();return!(e.name!==DP.CHROME||!e.osVersion)&&Number(e.version)<=90}())||0===n&&VD("USE_SUB_RTX")||eL()?(t=this.createOrRecycleSendMedia(e,i,a,"sendonly",r),this.updateBundleMids()):(t=$L(this.sessionDesc.mediaDescriptions[n]),t.attributes.direction="sendonly",t.attributes.ssrcs=i,t.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[n]=this.mungSendMediaDesc(t,r)),qP()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,t.attributes.mid),{mid:t.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[],r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||qP()||eL()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>_h(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>_h(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let t=this.sessionDesc||yW.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=e;let n=this.rtpCapabilities.send,r=this.localCapabilities.send;for(let i of t.mediaDescriptions){if(i.attributes.iceUfrag=this._iceParameters.iceUfrag,i.attributes.icePwd=this._iceParameters.icePwd,i.attributes.fingerprints=this._dtlsParameters.fingerprints,i.attributes.candidates=this._candidates,i.attributes.setup=this.setup,"application"===i.media.mediaType&&(i.attributes.sctpPort="5000"),"video"===i.media.mediaType)if(0===n.videoCodecs.length){let e=r.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:_h(n=t.encodingName.toLowerCase()).call(n,"vp8")}))||[r.videoCodecs[0]];i.media.fmts=e.map((e=>e.payloadType.toString(10))),i.attributes.payloads=e,i.attributes.extmaps=[]}else if(i.media.fmts=n.videoCodecs.map((e=>e.payloadType.toString(10))),i.attributes.payloads=n.videoCodecs,i.attributes.extmaps=n.videoExtensions,VD("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:e,ssrcGroups:t}=NW([{ssrcId:4e4,rtx:VD("USE_SUB_RTX")?40001:void 0}],this.cname);i.attributes.ssrcs=e,i.attributes.ssrcGroups=t}if("audio"===i.media.mediaType)if(0===n.audioCodecs.length){let e=r.audioCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:_h(n=t.encodingName.toLowerCase()).call(n,"opus")}))||[r.audioCodecs[0]];i.media.fmts=e.map((e=>e.payloadType.toString(10))),i.attributes.payloads=e,i.attributes.extmaps=[]}else if(i.media.fmts=n.audioCodecs.map((e=>e.payloadType.toString(10))),i.attributes.payloads=n.audioCodecs,i.attributes.extmaps=n.audioExtensions,VW(i),VD("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:e,ssrcGroups:t}=NW([{ssrcId:2e4}],this.cname);i.attributes.ssrcs=e,i.attributes.ssrcGroups=t}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){let t=this._candidates.filter((e=>"udp"===e.transport));if(e===Xx.TCP){if(0===t.length)return;if(VD("TCP_CANDIDATE_ONLY")){let e=this._candidates.filter((e=>"tcp"===e.transport));t.forEach((t=>{-1===e.findIndex((e=>e.connectionAddress===t.connectionAddress))&&e.push(Cz(Cz({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})),this._candidates=e}else{let e=[];t.forEach((t=>{e.push(Cz(Cz({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})),this._candidates=[...t,...e]}}else if(e===Xx.RELAY){if(0!==t.length)return;{let e=this._candidates.filter((e=>"tcp"===e.transport));e.forEach((e=>{t.push(Cz(Cz({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=[...t,...e]}}else 0===t.length?(this._candidates.filter((e=>"tcp"===e.transport)).forEach((e=>{t.push(Cz(Cz({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=t):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(let n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(e){e=$L(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{let r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(qP()){if(r){let e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleDataChannel(){for(let n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:wz,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,a){let o=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=BW(o,s,this.localCapabilities.send,o===Jx.VIDEO?r:i),l=o===Jx.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;let d="".concat(this.currentMidIndex),u={media:{mediaType:o,port:wz,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};u=this.mungRecvMediaDsec(u,e,a);let h=this.findFirstClosedMedia(o);if(h){let e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateRemoteCodec(e,t,n){let r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return _h(t=Object.keys(HD)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return ik.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let a=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return _h(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===a.length)return ik.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;let o,s=[...new Set(a.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];if(ik.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)o=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(o=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&_h(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),o.length!==e.length)return ik.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(VD("USE_PUB_RTX")||VD("USE_SUB_RTX")){let e=GW(a,this.rtpCapabilities.recv.videoCodecs);a.push(...e)}this._rtpCapabilities.recv.videoCodecs=a;let c=this.localCapabilities.send,l=this.rtpCapabilities.recv,d=BW(Jx.VIDEO,l,c,n);return o.forEach((e=>{let t=d.map((e=>e.payloadType.toString(10)));ik.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from ").concat(e.attributes.payloads," to ").concat(d)),e.attributes.payloads=d,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){let a=this.rtpCapabilities.send,o=e===Jx.VIDEO?a.videoCodecs:a.audioCodecs,s=e===Jx.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;let c="".concat(this.currentMidIndex),l={media:{mediaType:e,port:wz,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,i);let d=this.findFirstClosedMedia(e);if(d){let e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){let r=$L(e);return PW(r),OW(r,t),LW(r,t),DW(r),kW(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=$L(e);return kW(n,t,this.localCapabilities.recv),VW(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){let e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>qP()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}};function Az(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Iz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Az(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Az(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nz=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),Oz=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Oz||{}),Pz=new Map;function Lz(e,t,n,r){let{scale:i}=e;if(0===i&&r===Oz.UP||i>=t.length-1&&r===Oz.DOWN)return e;let a=Iz(Iz({},e),{},{scale:r===Oz.DOWN?++i:--i});switch(n){case"maintain-framerate":a=Iz(Iz({},a),t[i].motion);break;case"maintain-resolution":a=Iz(Iz({},a),t[i].detail);break;case"balanced":a=Iz(Iz({},a),t[i].balanced)}return a}function Dz(e,t){if(t){let n={overUse:0,underUse:0,adaptationList:kz(t)};Pz.set(e,n)}else Pz.delete(e)}function kz(e){let t=Iz({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:a}=t,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:f,BALANCE_BITRATE_FACTOR:m,BALANCE_FRAMERATE_FACTOR:_,BALANCE_RESOLUTION_FACTOR:g,MOTION_RESOLUTION_FACTOR:E,MOTION_BITRATE_FACTOR:v,DETAIL_FRAMERATE_FACTOR:y,DETAIL_BITRATE_FACTOR:S}=MD,b=Math.min(t.frameRate,s),T=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*b),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:a}}];for(let C=1;C<=c;C++){let e={bwe_up:Math.round(Math.pow(u,C)*n),bwe_down:Math.round(Math.pow(h,C+1)*n),fps_up:Math.round(Math.pow(f,C)*b),fps_down:Math.round(Math.pow(p,C+1)*b)},t={scaleResolutionDownBy:i/Math.pow(g,C),frameRate:Math.max(Math.round(Math.pow(_,C)*r),o),bitrateMax:Math.max(Math.round(Math.pow(m,C)*n),d),bitrateMin:Math.max(Math.round(Math.pow(m,C)*a),l)},s={scaleResolutionDownBy:i/Math.pow(E,C),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(v,C)*n),d),bitrateMin:Math.max(Math.round(Math.pow(v,C)*a),l)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(y,C)*r),o),bitrateMax:Math.max(Math.round(Math.pow(S,C)*n),d),bitrateMin:Math.max(Math.round(Math.pow(S,C)*a),l)};T.push({scale:C,threshold:e,balanced:t,motion:s,detail:c})}return T}function xz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xz(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xz(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Uz,Fz=new Map;function jz(e,t){let n=Fz.get(e);if(n){let{timer:t}=n;window.clearTimeout(t),Fz.delete(e)}t.qualityLimitationReason=Nz.NONE,Dz(e)}function Vz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vz(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vz(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Gz,Wz=(Uz=class e extends Yx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return _h(t=Object.keys(HD)).call(t,e)})))]}constructor(t,n){super(t,n),SI(this,"store",void 0),SI(this,"peerConnection",void 0),SI(this,"id",uD(5,"connection-")),SI(this,"remoteSDP",void 0),SI(this,"initialOffer",void 0),SI(this,"transportEventReceiver",void 0),SI(this,"statsFilter",void 0),SI(this,"extension",{useXR:VD("USE_XR")}),SI(this,"localCapabilities",void 0),SI(this,"remoteCodecs",void 0),SI(this,"localCandidateCount",0),SI(this,"allCandidatesReceived",!1),SI(this,"isPreallocation",!1),SI(this,"preSSRCMap",new Map),SI(this,"dataStreamChannelMap",new Map),SI(this,"establishPromise",void 0),SI(this,"recoveredDataChannelIds",[]),SI(this,"currentDataChannelId",1),SI(this,"mutex",new TD("P2PConnection-mutex")),SI(this,"qualityLimitationReason",Nz.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Eq(this.peerConnection,VD("STATS_UPDATE_INTERVAL"),void 0,qP()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){let t=this.preSSRCMap.get(e);if(void 0!==t){let e=this.peerConnection.getTransceivers().find((e=>e.mid===t));if(e)return{transceiver:e,track:e.receiver.track,id:t}}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){let e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);let n=this.remoteSDP.toString();null!==t&&void 0!==t&&t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else ik.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else ik.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=wW(e.sdp),n=await MW({filterRTX:!VD("USE_PUB_RTX")&&!VD("USE_SUB_RTX"),filterVideoFec:VD("FILTER_VIDEO_FEC"),filterAudioFec:VD("FILTER_AUDIO_FEC"),filterVideoCodec:VD("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=jW(n),this.initialOffer=e,Bz(Bz({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(g0){throw new mL(fL.GET_LOCAL_CONNECTION_PARAMS_FAILED,g0.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Rz(Bz(Bz({},e),{},{localCapabilities:this.localCapabilities})),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let t=this.remoteSDP.toString(),n=HW(this.initialOffer.sdp,this.extension),r=this.logSDPExchange(n||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),null!==r&&void 0!==r&&r(t),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t});let i=this.peerConnection.getTransceivers()[0];if(null!=i&&i.receiver&&this.tryBindTransportEvents(i.receiver),VD("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(VD("PRELOAD_MEDIA_COUNT"));let e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}let{preSSRCs:a}=e;if(Array.isArray(a)&&a.length>0){let{mids:e}=this.remoteSDP.batchSend(a.map((e=>({kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel}))));e.forEach(((e,t)=>{this.preSSRCMap.set(a[t].ssrcId,e)})),await WW(this.peerConnection,this.remoteSDP,this.extension),ik.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(na.toString()))}}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:t}=e;this.remoteSDP.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:n}=e;if(Array.isArray(n)&&n.length>0){let{mids:e}=this.remoteSDP.batchSend(n.map((e=>Object.assign({},{kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel}))));e.forEach(((e,t)=>{this.preSSRCMap.set(n[t].ssrcId,e)}))}await WW(this.peerConnection,this.remoteSDP,this.extension),ik.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(na.toString()))}}send(e,t,n){var r=this;return BH((function*(){let i=yield LH(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let i=[];e.forEach((e=>{let t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)})),qP()&&!0===VD("SIMULCAST")&&(yield LH(r.applySimulcastForFirefox(i,e)));let a,o=yield LH(r.peerConnection.createOffer()),s=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(o.sdp,e,s),l=yW.parse(c),d=s.map((e=>{let t=l.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return RW(t,VD("USE_PUB_RTX"))}));try{a=yield d}catch(xa){a=[],r.remoteSDP.receive(e,t,n,a);let o=r.remoteSDP.toString();throw yield LH(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield LH(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield LH(r.stopSending(s,!0)),xa}r.remoteSDP.receive(e,t,n,a);let u=r.remoteSDP.toString(),h=r.logSDPExchange(c,"offer","local","send");return yield LH(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield LH(r.applySimulcastEncodings(i,e)),yield LH(r.applySendEncodings(i,e)),null!==h&&void 0!==h&&h(u),yield LH(r.peerConnection.setRemoteDescription({type:"answer",sdp:u})),i.map(((e,t)=>{let n=s[t];return{localSSRC:d[t],id:n,transceiver:e}}))}catch(oa){throw oa instanceof mL?oa:new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(oa.toString()))}finally{i()}}))()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)ik.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:VD("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach((e=>{e._updateOriginDataChannel(n)}));let{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){let e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});let t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),ik.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else ik.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(yi){throw yi instanceof mL?yi:new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(yi.toString()))}}async stopDataChannels(e){try{let t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(na){throw na instanceof mL?na:new mL(fL.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(na.toString()))}}async stopSending(e,t){let n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;jz(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:i,needExchangeSDP:a}=this.remoteSDP.send(e,t,n,r);a&&(await WW(this.peerConnection,this.remoteSDP,this.extension),ik.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));let o=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:i,transceiver:o}}catch(aa){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(aa.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await WW(this.peerConnection,this.remoteSDP,this.extension),ik.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map((e=>{let t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(na.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach((e=>{Array.from(this.preSSRCMap.entries()).some((t=>{let[n,r]=t;if(r===e)return this.preSSRCMap.delete(n),!0}))})),this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(na.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(na.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let r=await this.peerConnection.createAnswer();null!==n&&void 0!==n&&n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(na.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(na.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));let n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);let i=this.remoteSDP.toString();null!==r&&void 0!==r&&r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(na){throw new mL(fL.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(na.toString()))}}restartICE(e){var t=this;return BH((function*(){let n=yield LH(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Mj().supportPCSetConfiguration){let n=t.peerConnection.getConfiguration(),r=e===Xx.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(ik.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===Xx.RELAY)return;t.remoteSDP.updateCandidates(e);let n=yield LH(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let r=wW(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);let a=t.remoteSDP.toString(),o=t.logSDPExchange(n.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield LH(t.peerConnection.setLocalDescription(n)),null!==o&&void 0!==o&&o(a),yield LH(t.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(r){ik.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),r)}finally{n()}}))()}close(){var e;this.peerConnection.getTransceivers().forEach((e=>{jz(this.id+e.mid,this)})),this.preSSRCMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Bz(Bz({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let i=this.remoteSDP.toString(),a=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null!==a&&void 0!==a&&a(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(yi){throw new mL(fL.EXCHANGE_SDP_FAILED,yi.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?qP()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:Bz(Bz({},nq),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:Bz(Bz({},nq),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,ik.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,ik.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),VD("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(FL(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),VD("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),VD("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),VD("ENABLE_ENCODED_TRANSFORM")&&Mj().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){let t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(xM(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!VD("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}tryBindTransportEvents(e){let t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};let n=t.iceTransport;n&&(n.onstatechange=()=>{let e=null===t||void 0===t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:e,remote:t}=n.getSelectedCandidatePair();ik.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,r;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return ik.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return ik.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Mj().supportSetRtpSenderParameters)return ik.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let i={},a={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}let o=function(e,t){return e.getTransceivers().find((e=>e.sender.track===t||e.receiver.track===t))}(this.peerConnection,e._mediaStreamTrack),s=(e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings(),{frameRate:a=n,width:o=r,height:s=i}=t;if(!a||!o||!s)return;o=vD(o),s=vD(s),a=vD(a);let{max:c,min:l}=function(e,t,n){let r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(o,s,a),{bitrateMax:d,bitrateMin:u}=t||{};d||ik.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(d,", brMin: ").concat(u,"]"));let{maxFramerate:h}=VD("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(a=Math.min(a,h)),{frameRate:a,bitrateMax:d||c,bitrateMin:u||l,scaleResolutionDownBy:1,scale:0}})(e);if(function(e){var t;return!!VD("ENABLE_AG_ADAPTATION")&&!!(e instanceof HG||_h(t=e._hints).call(t,tV.CUSTOM_TRACK))&&(!!VD("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(){let e=UP();if(e.os!==LP.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])>=14}()&&QP(17,4)||XP(14)&&ZP(17,4)))}(e)&&o&&t&&s&&this.getLocalVideoStats&&_h(n=["vp8","vp9"]).call(n,this.store.codec)){var c;let n=i.degradationPreference||(_h(c=e._hints).call(c,tV.CUSTOM_TRACK)?VD("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,r,i,a){if(jz(e,n),i(t),"balanced"!==r&&"maintain-framerate"!==r&&"maintain-resolution"!==r)return;let o=-1;Dz(e,t);let s=window.setInterval((()=>{let s=Fz.get(e);if(!VD("ENABLE_AG_ADAPTATION")||!s)return jz(e,n),void i(t);let c=a();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===o)return void(o=Date.now());if(Date.now()-o<1e3)return;let a=c.sendFrameRate,l=c.OutgoingAvailableBandwidth,[d,u]=function(e,t,n,r,i,a){let o=Pz.get(e)||{overUse:0,underUse:0,adaptationList:kz(i)},{adaptationList:s}=o;Pz.set(e,o);let c,l,{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:u}=MD,{scale:h}=r;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return VD("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,h,s,a)&&(o.overUse++,l=Nz.CPU,o.overUse>d)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;let{threshold:{bwe_down:r}}=n[t];return e<r}(n,h,s)&&(o.overUse++,l=Nz.BANDWIDTH,o.overUse>d)?(o.overUse=0,o.underUse=0,c=Lz(r,s,a,Oz.DOWN),[c,l]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return VD("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}(t,h,s,a)&&function(e,t,n){if(0===t)return;let{threshold:{bwe_up:r}}=n[t];return e>r}(n,h,s)&&(o.underUse++,o.underUse>u&&(o.overUse=0,o.underUse=0,c=Lz(r,s,a,Oz.UP),0===c.scale&&(l=Nz.NONE))),[c,l])}(e,a,l,s.adaptationConfig,t,r);u&&(n.qualityLimitationReason=u),d&&s.adaptationConfig.scale!==d.scale&&(ik.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(a,", bwe ").concat(l,", switch from ").concat(s.adaptationConfig.scale," to ").concat(d.scale," ")),s.adaptationConfig=Mz(Mz({},s.adaptationConfig),d),i(d))}}),VD("CHECK_LOCAL_STATS_INTERVAL")),c=Mz({},t);Fz.set(e,{timer:s,adaptationConfig:c,originConfig:t,adaptationFunc:i}),ik.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}(this.id+o.mid,s,this,n,(e=>{t&&this.updateAdaptation(t,e)}),this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;let{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(a.maxBitrate=1e3*t),(_h(l=e._hints).call(l,tV.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(a.maxFramerate=UM(n)),r&&r>=1&&(a.scaleResolutionDownBy=r))}let{maxFramerate:d}=VD("ENCODER_CONFIG_LIMIT");if(d&&"number"==typeof d&&(a.maxFramerate=a.maxFramerate?Math.min(a.maxFramerate,d):d),VD("DSCP_TYPE")&&cL()){var u;let e=VD("DSCP_TYPE");_h(u=["very-low","low","medium","high"]).call(u,e)&&(a.networkPriority=e)}let h=t.getParameters(),p=null===(r=h.encodings)||void 0===r?void 0:r[0];qP()&&!p&&(i.encodings=[a]),p&&Object.assign(p,a),Object.assign(h,i),ik.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h),await async function(e,t,n){try{var r;if(!Mj().supportSetRtpSenderParameters||!function(e){return"vp9"===e}(e)||!VD("ENABLE_SVC"))return;let i={},a={},o=t.getParameters(),s=null===(r=o.encodings)||void 0===r?void 0:r[0];a.scalabilityMode=SW(n),s&&Object.assign(s,a),Object.assign(o,i),await t.setParameters(o),ik.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(o.encodings)))}catch(ba){ik.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ba)}}(this.store.codec,t,VD("SVC_MODE"))}async updateAdaptation(e,t){var n,r;if(!e)return ik.debug("[updateAdaptation] no rtpSender found");if(!Mj().supportSetRtpSenderParameters)return ik.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let i={},{bitrateMax:a,frameRate:o,scaleResolutionDownBy:s}=t;a&&(i.maxBitrate=1e3*a),o&&(i.maxFramerate=UM(o)),s&&s>=1&&_h(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=s);let c=e.getParameters(),l=null===(r=c.encodings)||void 0===r?void 0:r[0];l&&Object.assign(l,i),Object.assign(c,{});try{await e.setParameters(c),ik.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(ca){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?ik.debug("[updateAdaptation] peerConnection not connected}"):ik.debug("[updateAdaptation] updateRtpSenderEncodings failed",ca):ik.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!Mj().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let r=e[n],i=t[n];i instanceof WG&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(n){ik.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){let r=yW.parse(e);return t.forEach(((e,t)=>{let i=n[t],a=r.mediaDescriptions.find((e=>e.attributes.mid===i));a&&(OW(a,e),xW(a,e,this.store.codec))})),yW.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,a,o;let c=e[s],l=t[s];if(l instanceof WG&&!_h(n=l._hints).call(n,tV.LOW_STREAM)&&null!==(r=l._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(a=l._scalabilityMode)&&void 0!==a&&a.numSpatialLayers&&(null===(o=l._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){let e={},t={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];let n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!qP()&&e.length===t.length)for(let n=0;n<e.length;n++){let r=t[n];if(r instanceof WG&&this.isVP8Simulcast(r)){let t=e[n],i={},a={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];let o=t.sender.getParameters();await t.sender.setParameters(Object.assign(o,i))}}}isVP8Simulcast(e){var t,n,r,i,a;return!!(e instanceof WG&&VD("SIMULCAST")&&"vp8"===this.store.codec&&!_h(t=e._hints).call(t,tV.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(a=e._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(VD("SDP_LOGGING"))return ik.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(Mj().supportPCSetConfiguration){let n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},sx(Uz.prototype,"updateRemoteRTPCapabilities",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"updateRemoteRTPCapabilities"),Uz.prototype),sx(Uz.prototype,"connect",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"connect"),Uz.prototype),sx(Uz.prototype,"updateRemoteConnect",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"updateRemoteConnect"),Uz.prototype),sx(Uz.prototype,"createDataChannels",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"createDataChannels"),Uz.prototype),sx(Uz.prototype,"receive",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"receive"),Uz.prototype),sx(Uz.prototype,"batchReceive",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"batchReceive"),Uz.prototype),sx(Uz.prototype,"stopReceiving",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"stopReceiving"),Uz.prototype),sx(Uz.prototype,"muteRemote",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"muteRemote"),Uz.prototype),sx(Uz.prototype,"unmuteRemote",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"unmuteRemote"),Uz.prototype),sx(Uz.prototype,"muteLocal",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"muteLocal"),Uz.prototype),sx(Uz.prototype,"unmuteLocal",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"unmuteLocal"),Uz.prototype),sx(Uz.prototype,"close",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"close"),Uz.prototype),sx(Uz.prototype,"updateEncoderConfig",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"updateEncoderConfig"),Uz.prototype),sx(Uz.prototype,"updateSendParameters",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"updateSendParameters"),Uz.prototype),sx(Uz.prototype,"replaceTrack",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"replaceTrack"),Uz.prototype),sx(Uz.prototype,"updateAdaptation",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"updateAdaptation"),Uz.prototype),sx(Uz.prototype,"getRemoteSSRC",[Hz],Object.getOwnPropertyDescriptor(Uz.prototype,"getRemoteSSRC"),Uz.prototype),Uz);function Hz(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return await r.apply(this,a)}finally{n()}},n}function qz(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zz(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qz(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qz(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Kz(e){var t,n,r,i=2;for(typeof Symbol<"u"&&(n=_z,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new Yz(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Yz(e){function t(e){if(Object(e)!==e)return hS.reject(new TypeError(e+" is not an object."));var t=e.done;return hS.resolve(e.value).then((function(e){return{value:e,done:t}}))}return Yz=function(e){this.s=e,this.n=e.next},Yz.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?hS.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?hS.reject(e):t(n.apply(this.s,arguments))}},new Yz(e)}var Jz=(Gz=class extends OL{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(eM.StateChange,t,this._state)}constructor(e,t){super(),SI(this,"isPlanB",void 0),SI(this,"store",void 0),SI(this,"statsUploader",void 0),SI(this,"connection",void 0),SI(this,"localTrackMap",new Map),SI(this,"remoteUserMap",new Map),SI(this,"localDataChannels",[]),SI(this,"remoteDataChannelMap",new Map),SI(this,"pendingLocalTracks",[]),SI(this,"pendingRemoteTracks",[]),SI(this,"pendingLocalDataChannels",[]),SI(this,"pendingRemoteDataChannels",[]),SI(this,"statsCollector",void 0),SI(this,"shouldForwardP2PCreation",void 0),SI(this,"iceFailedCount",0),SI(this,"dtlsFailedCount",0),SI(this,"mutex",new TD("P2PChannel-mutex")),SI(this,"_state",$x.Disconnected),SI(this,"_pcStatsUploadType",VD("NEW_ICE_RESTART")?Qx.FIRST_CONNECTION:Qx.OLD_FIRST_CONNECTION),SI(this,"_isInRestartIce",!1),SI(this,"_isStartRestartIce",!1),SI(this,"_restartStates",["disconnected","failed"]),SI(this,"_restartTimer",void 0),SI(this,"_isFirstConnected",!0),SI(this,"handleMuteLocalTrack",(async(e,t,n)=>{let r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==$x.Connected)return void n(new mL(fL.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();let i=r.find((e=>"videoLowTrack"===e[0]));i&&i[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let a=this.createMuteMessage(r);await zL(this,eM.RequestMuteLocal,a),t()}catch(oa){n(oa)}finally{r()}})),SI(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{let r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==$x.Connected)return void n(new mL(fL.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();let i=r.find((e=>"videoLowTrack"===e[0]));if(i){let t=i[1];if(t.track._originMediaStreamTrack.stop(),!VD("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mj().supportDualStreamEncoding){let n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{let n=Rq(e,YL(this,eM.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new hS(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}await this.connection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let a=this.createUnmuteMessage(r);await zL(this,eM.RequestUnmuteLocal,a),t()}catch(oa){n(oa)}finally{r()}})),SI(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{let r=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let n=this.localTrackMap.get(Zx.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==$x.Connected)return void t();let{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(eM.UpdateVideoEncoder,i),t()}catch(oa){n(oa)}finally{r()}})),SI(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{let r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let n=this.localTrackMap.get(Zx.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==$x.Connected)return void t();let{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(oa){n(oa)}finally{r()}})),SI(this,"handleReplaceMixingTrack",(async(e,t,n,r)=>{if(!this.connection||this.state!==$x.Connected)return void t();let i,a=iz([e]);ik.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(a.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,a),t()}catch(ha){n(ha)}finally{var o;null===(o=i)||void 0===o||o()}})),SI(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;ik.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a;let n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==$x.Connected)return void t();if(await(null===(a=this.connection)||void 0===a?void 0:a.replaceTrack(e,n[1].id)),this.isPlanB){let t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===Zx.LocalVideoTrack&&!VD("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mj().supportDualStreamEncoding){let t=this.localTrackMap.get(Zx.LocalVideoLowTrack);if(t){let n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new hS(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(ha){n(ha)}finally{var o;null===(o=i)||void 0===o||o()}})),SI(this,"handleGetRTCStats",(e=>{e(this.statsCollector.getRTCStats())})),SI(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),SI(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),SI(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),SI(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new $q(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Mj().supportUnifiedPlan||VD("CHROME_FORCE_PLAN_B")&&cL(),this.shouldForwardP2PCreation=VD("FORWARD_P2P_CREATION")&&Mj().supportPCSetConfiguration&&sL(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Sz({},this.store):new Wz({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=$x.New;let n=this.shouldForwardP2PCreation&&"closed"===(null===(t=this.connection)||void 0===t?void 0:t.peerConnectionState);if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(ik.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new Sz(e,this.store):new Wz(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new mL(fL.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=VD("NEW_ICE_RESTART")?Qx.FIRST_CONNECTION:Qx.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new mL(fL.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");VD("ENABLE_PREALLOC_PC")&&this.state===$x.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$x.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter((e=>{var t;let[n]=e;return _h(t=[Zx.LocalVideoLowTrack,Zx.LocalVideoTrack]).call(t,n)})),n=t.map((e=>{let[,{id:t}]=e;return t})),r=t.map((e=>{let[t]=e;return t}));if(this.connection instanceof Wz){if(hk.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!_h(e).call(e,this.store.codec)){let t=["vp9","vp8","h264"].find((t=>_h(e).call(e,t)));t&&(this.store.codec=t,ik.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof Wz&&"closed"!==this.connection.peerConnectionState&&_h(e=[$x.New,$x.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==$x.Connected){if(this.state===$x.Disconnected)throw new mL(fL.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((e=>{var t;_h(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)})),[]}let t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach((e=>{let t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((e=>{this.localDataChannels.push(e);let t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)})),e.map((e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId}))))}publish(e,t,n){var r=this;return BH((function*(){let i=yield LH(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==$x.Connected){if(r.state===$x.Disconnected)throw new mL(fL.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);let t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,OH.markPublishStart(r.store.clientId,r.store.pubId);let i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield LH(r.tryToUnmuteAudio(e)));yield*fz(Kz(r.doPublish(r.connection,i)))}finally{i()}}))()}doPublish(e,t){var n=this;return BH((function*(){t.forEach((e=>{let{track:t,type:r}=e,i=Date.now();n.store.publish(t.getTrackId(),r===Zx.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);let r,i=t.map((e=>{let{track:t}=e;return t})),a=yield LH(e.send(t.map((e=>{let{track:t}=e;return t})),n.store.codec,n.store.audioCodec)),o=(yield LH(a.next())).value,s=n.createGatewayPublishMessage(t,o);try{r=yield s}catch(ca){throw a.throw(ca),(null===ca||void 0===ca?void 0:ca.code)===fL.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),ca}let c=n.mapPubResToRemoteConfig(s,r),l=(yield LH(a.next(c))).value,d=VD("ENABLE_VIDEO_SEI");i.forEach((async e=>{let t=e.getRTCRtpTransceiver();t&&d&&(e.trackMediaType===Jx.VIDEO?await async function(e,t){if(!Mj().supportWebRTCEncodedTransform)return void ik.warning("browser not support video encoded transform");if(mW.has(e)||!e.track)return;let n={track:e.track};if(GP()){if(!e.createEncodedStreams)return void ik.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(r){return void ik.error("create video-encoded-streams error",r&&r.message)}let o=[];t.on("sei-to-send",(e=>{o.push(e)}));let s=new TransformStream({transform(t,r){n.controller||(n.controller=r),e.track&&e.track.id!==n.track.id&&(ik.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));let a=o.shift();a&&(t.data=function(e,t){let n=function(e){let t=e.length,n=[],r=0;for(;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}(t),r=n.length,i=Math.floor(r/255),a=r%255,o=new Uint8Array(6+i+1+r+e.byteLength);o[0]=0,o[1]=0,o[2]=0,o[3]=1,o[4]=6,o[5]=101;let s=0;for(;s<i;)o[6+s]=255,s++;return o[6+s]=a,s++,o.set(n,6+s),o.set(new Uint8Array(e),6+s+r),o.buffer}(t.data,a)),r.enqueue(t)}});a.readable.pipeThrough(s).pipeTo(a.writable)}else{if(!WP())return;{if(typeof RTCRtpScriptTransform>"u")return void ik.warning("browser not support RTCRtpScriptTransform");let r=uW(),a=new MessageChannel;await new hS((e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)}));let o=new RTCRtpScriptTransform(r,{name:"tx",port:a.port2},[a.port2]);e.transform=o,await new hS((e=>r.onmessage=t=>{"started"===t.data&&e(void 0)})),t.on("sei-to-send",(e=>{a.port1.postMessage({sei:e})})),a.port1.onmessage=t=>{var r;t.data.transformed&&e.track&&(null===(r=e.track)||void 0===r?void 0:r.id)!==n.track.id&&(ik.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}let t=mW.get(e);if(t){mW.delete(e);try{var n,a;null===(n=t.controller)||void 0===n||n.terminate(),null===(a=t.worker)||void 0===a||a.terminate()}catch(r){ik.warning(r&&r.message)}}}mW.set(e,n),e.track.addEventListener("ended",i)}(t.sender,e):e.trackMediaType===Jx.AUDIO&&await async function(e){if(!Mj().supportWebRTCEncodedTransform)return void ik.warning("browser not support audio encoded transform");if(hW.has(e)||!e.track)return;let t={track:e.track};if(GP()){if(!e.createEncodedStreams)return void ik.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(Oa){return void ik.error("create audio-encoded-streams error",Oa&&Oa.message)}let i=new TransformStream({transform(r,i){t.controller||(t.controller=i),e.track&&e.track.id!==t.track.id&&(ik.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n)),i.enqueue(r)}});r.readable.pipeThrough(i).pipeTo(r.writable)}else if(WP()){if(typeof RTCRtpScriptTransform>"u")return void ik.warning("browser not support RTCRtpScriptTransform");let r=uW(),i=new MessageChannel;await new hS((e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)}));let a=new RTCRtpScriptTransform(r,{name:"tx",port:i.port2},[i.port2]);e.transform=a,await new hS((e=>r.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=r=>{var i;r.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==t.track.id&&(ik.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n))},t.worker=r}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}let t=hW.get(e);if(t){hW.delete(e);try{var r,i;null===(r=t.controller)||void 0===r||r.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(ba){ik.warning(ba&&ba.message)}}}hW.set(e,t),e.track.addEventListener("ended",n)}(t.sender))})),t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,l),n.statsUploader.startUploadOutboundStats(),t.forEach((e=>{let{track:t,type:r}=e,i=Date.now();n.store.publish(t.getTrackId(),r===Zx.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}async updateVideoStreamParameter(e,t){let n=this.localTrackMap.get(t);if(!n)return;if(!(n.track instanceof WG))return ik.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Wz||this.connection instanceof Sz))return ik.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:r}=n,i=function(e,t){let n={};return e.height&&e.width&&(n.scaleResolutionDownBy=GM(e,t)),n.maxFramerate=e.framerate?UM(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==Zx.LocalVideoLowTrack||!VD("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mj().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{let t=r._originMediaStreamTrack;if(!t.canvas)return ik.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){let n=e.canvas;t.width&&(n.width=UM(t.width)),t.height&&(n.height=UM(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=xV((()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),UM(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),ik.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return BH((function*(){if(!t.connection||t.state!==$x.Connected)return;let n=yield LH(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let n=t.localTrackMap.get(Zx.LocalVideoTrack);if(!n)throw new mL(fL.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Zx.LocalVideoLowTrack))throw new mL(fL.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let i=[{track:t.getLowVideoTrack(n.track,e),type:Zx.LocalVideoLowTrack}];if(yield*fz(Kz(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;let e=null===(r=t.localTrackMap.get(Zx.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield LH(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(ik.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await qL(this,eM.RequestRePublish,this.pendingLocalTracks),this.emit(eM.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(ik.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await qL(this,eM.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==Jx.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==Jx.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await qL(this,eM.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===Jx.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(eM.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==$x.Connected)return void e.forEach((e=>{let t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));let t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;let n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==$x.Connected)return void e.forEach((e=>{let t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)}));let t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach((e=>{let t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)})),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map((e=>e.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==$x.Connected)return;let e=this.localTrackMap.get(Zx.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[Zx.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==$x.Connected)throw new mL(fL.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let n=t.filter((t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))}));if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach((t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));let r=this.pendingRemoteDataChannels.findIndex((n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id}));-1!==r&&this.pendingRemoteDataChannels.splice(r,1)})),n.map((e=>e.id))}async subscribe(e,t,n,r,i){var a;if(!this.connection||this.state!==$x.Connected)throw new mL(fL.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(a=this.remoteUserMap.get(e))&&void 0!==a&&a.has(t))return;let o,s,c,l=this.connection.getPreMedia(n);if(l)ik.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=l.transceiver,o=l.track,s=l.id;else if(i){let n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new mL(fL.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof Wz&&(c=r.transceiver),o=r.track,s=r.id}else{let i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof Wz&&(c=i.transceiver),o=i.track,s=i.id}t===Jx.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new oW(o,e.uid,e._uintid,this.store),ik.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new aW(o,e.uid,e._uintid,this.store),ik.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),VD("ENABLE_VIDEO_SEI")&&c&&(t==Jx.VIDEO?await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Mj().supportWebRTCEncodedTransform)return void ik.warning("browser not support video encoded transform");if(!e.track)return;if(_W.has(e)){let n=_W.get(e);return void(n&&(n.onSei=t.onSei))}let n={track:e.track,onSei:t.onSei};if(GP()){if(!e.createEncodedStreams)return void ik.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(Oa){return void ik.error("create video-encoded-streams error",Oa&&Oa.message)}let i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(ik.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));let a=function(e){let t=new DataView(e.data),n=0;for(;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){let r=n+6,i=0,a=0;for(;255===(a=t.getUint8(r++));)i+=255;i+=a;let o=fW(e.data,r,i);return new Uint8Array(o)}n++}return null}(t);a&&n.onSei&&n.onSei(a),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if(WP()){if(typeof RTCRtpScriptTransform>"u")return void ik.warning("browser not support RTCRtpScriptTransform");let t=uW(),i=new MessageChannel;await new hS((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));let a=new RTCRtpScriptTransform(t,{name:"rx",port:i.port2},[i.port2]);e.transform=a,await new hS((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(ik.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}!function(e){let t=_W.get(e);if(t){_W.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(ga){ik.warning(ga&&ga.message)}}}(e)}_W.set(e,n),e.track.addEventListener("ended",r)}(c.receiver,{onSei:t=>{var n;null===(n=e._videoTrack)||void 0===n||n._onSei(t)}}):t==Jx.AUDIO&&await async function(e){if(!Mj().supportWebRTCEncodedTransform)return void ik.warning("browser not support audio encoded transform");if(pW.has(e))return;let t={track:e.track};if(GP()){if(!e.createEncodedStreams)return void ik.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(Ca){return void ik.error("create audio-encoded-streams error",Ca&&Ca.message)}let i=new TransformStream({transform(r,i){t.controller||(t.controller=i),e.track&&e.track.id!==t.track.id&&(ik.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n)),i.enqueue(r)}});r.readable.pipeThrough(i).pipeTo(r.writable)}else if(WP()){if(typeof RTCRtpScriptTransform>"u")return void ik.warning("browser not support RTCRtpScriptTransform");let r=uW(),i=new MessageChannel;await new hS((e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)}));let a=new RTCRtpScriptTransform(r,{name:"rx",port:i.port2},[i.port2]);e.transform=a,await new hS((e=>r.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=r=>{var i;r.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==t.track.id&&(ik.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n))},t.worker=r}function n(){e.track.removeEventListener("ended",n),function(e){let t=pW.get(e);if(t){pW.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(ba){ik.warning(ba&&ba.message)}}}(e)}pW.set(e,t),e.track.addEventListener("ended",n)}(c.receiver));let d=this.remoteUserMap.get(e);d?d.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let u=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(eM.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==$x.Connected)throw new mL(fL.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));let t=[],n=new Map;e.forEach((e=>{if(!this.connection)return;let r=this.connection.getPreMedia(e.ssrcId);r?n.set(e.ssrcId,r):t.push(e)}));let r=await this.connection.batchReceive(t.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));t.forEach(((e,t)=>{n.set(e.ssrcId,r[t])})),e.forEach((e=>{let{user:t,mediaType:r,ssrcId:i}=e,a=n.get(i);if(!a)return void ik.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(t.uid," subscribe data,").concat(r,", ").concat(i));let{track:o,id:s,transceiver:c}=a;r===Jx.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(o):(t._audioTrack=new oW(o,t.uid,t._uintid,this.store),ik.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),c&&t._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(o):(t._videoTrack=new aW(o,t.uid,t._uintid,this.store),ik.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),c&&t._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._videoTrack));let l=this.remoteUserMap.get(t);l?l.set(r,s):this.remoteUserMap.set(t,new Map([[r,s]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();let d=this.pendingRemoteTracks.findIndex((e=>{let{user:n,kind:i}=e;return n.uid===t.uid&&r===i}));-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(eM.MediaReconnectEnd,t.uid))}))}async unsubscribe(e,t,n){let r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===$x.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===Jx.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===Jx.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==$x.Connected)return;let i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));let a=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,a;if(r===Jx.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===Jx.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(a=t._videoTrack)||void 0===a||a._destroy(),t._videoTrack=void 0);else if(r===Jx.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),!n&&(null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0)}})),a}async unsubscribeDataChannel(e,t){if(t.forEach((e=>{let t=this.pendingRemoteDataChannels.findIndex((t=>t.id===e.id));-1!==t&&this.pendingRemoteDataChannels.splice(t,1)})),!this.connection)return;let n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach((e=>{e._close()}));let r=this.remoteDataChannelMap.get(e);return n.forEach((e=>{r&&r.delete(e.id)})),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((e=>e.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:i,mediaType:a}of e){let e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:n}=e;return void 0!==a?t.uid===i.uid&&a===n:t.uid===i.uid}));e.forEach((e=>{let t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==$x.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===Jx.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===Jx.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));let n=Dh(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t,i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));let r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===Jx.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===Jx.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===Jx.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0}})),r}isPreSubScribe(e){return!(!this.connection||this.state!==$x.Connected)&&!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let n=this.remoteUserMap.get(e);if(!n)return void ik.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void ik.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===Jx.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let n=this.remoteUserMap.get(e);n?n.get(t)||ik.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):ik.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){let t=this.localTrackMap.get(Zx.LocalAudioTrack);if((null===t||void 0===t?void 0:t.track)instanceof UG){let n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==Zx.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===Zx.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===Zx.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){let n=this.localTrackMap.get(Zx.LocalAudioTrack),a=r?this.localTrackMap.get(Zx.LocalVideoLowTrack):this.localTrackMap.get(Zx.LocalVideoTrack);hk.publish(this.store.sessionId,{eventElapse:OH.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null===n||void 0===n?void 0:n.track.getTrackLabel(),videoName:null===a||void 0===a?void 0:a.track.getTrackLabel(),screenshare:-1!==(null===a||void 0===a?void 0:a.track._hints.indexOf(tV.SCREEN_TRACK)),audio:!!n,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var a;n||(n=[]);let o=n.find((e=>e instanceof kG)),s=r?null===(a=this.localTrackMap.get(Zx.LocalVideoTrack))||void 0===a?void 0:a.track:n.find((e=>e instanceof WG));hk.publish(this.store.sessionId,{eventElapse:OH.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null===o||void 0===o?void 0:o.getTrackLabel(),videoName:null===s||void 0===s?void 0:s.getTrackLabel(),screenshare:-1!==(null===s||void 0===s?void 0:s._hints.indexOf(tV.SCREEN_TRACK)),audio:!!o,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){let i=r===Jx.VIDEO?n._videoSSRC:n._audioSSRC;i&&hk.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Jx.VIDEO,audio:r===Jx.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:OH.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){ik.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new TD("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Sz({},this.store):new Wz({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Zx.LocalAudioTrack);if((null===e||void 0===e?void 0:e.track)instanceof UG){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=$x.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Zx.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Zx.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof WG||t&&t.track instanceof kG?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;let n=Array.from(Pb(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}})),t=this.localTrackMap.get(Zx.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=IT(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(ik.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=$x.Reconnecting,VD("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new Sz({},this.store):new Wz({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case Zx.LocalVideoTrack:_h(t=r._hints).call(t,tV.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Zx.LocalAudioTrack:r instanceof UG?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Zx.LocalVideoLowTrack:}})),this.emit(eM.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Pb(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(eM.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Pb(n).call(n)).forEach((e=>{this.setPendingRemoteDataChannel(t,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),ik.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let n of this.pendingRemoteDataChannels){let{user:r,id:i}=n;if((e instanceof ez?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:r,kind:i}=n;if((e instanceof ez?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return BH((function*(){if(!t.connection||t.state!==$x.Connected)return;let n,r=yield LH(t.mutex.lock("From P2PChannel.restartICE"));try{n=yield LH(t.connection.restartICE(e));let r=yield LH(n.next());if(r.done)return;let i=r.value,a=yield i;switch(t.reportPCDisconnectedOrFailed(e),e){case Xx.TCP:t._pcStatsUploadType=Qx.TCP_RESTART;break;case Xx.RELAY:t._pcStatsUploadType=Qx.RELAY_RESTART;break;default:t._pcStatsUploadType=Qx.OLD_RESTART}t._isInRestartIce=!0,n.next(a)}catch(aa){var i;null===(i=n)||void 0===i||i.throw(aa)}finally{r()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(Zx.LocalVideoTrack),n=this.localTrackMap.get(Zx.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null===t||void 0===t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null===n||void 0===n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;let a=KL(this,eM.NeedSignalRTT),o=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=o&&s?(o+s)/2:o||s,l=(c&&a?(c+a)/2:c||a)||0,d=100*e.sendPacketLossRate*.7/50+.3*l/1500,u=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,h=null===t||void 0===t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(tV.SCREEN_TRACK)){let t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){let e=(1e3*t-n)/(1e3*t);return mk[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n,i=r._audioSSRC,a=r._videoSSRC,o=e.audioRecv.find((e=>e.ssrc===i)),s=e.videoRecv.find((e=>e.ssrc===a));if(!o&&!s)return void(t+=1);let c=KL(this,eM.NeedSignalRTT),l=e.rtt,d=(l&&c?(l+c)/2:l||c)||0,u=o?o.jitterMs:void 0,h=e.recvPacketLossRate,p=.7*h*100/50+.3*d/1500;u&&(p=.6*h*100/50+.2*d/1500+.2*u/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new hS(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(ik.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==$x.Connected)return;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!r)return;let i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){let e=r[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===Zx.LocalVideoTrack&&!VD("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mj().supportDualStreamEncoding){let t=this.localTrackMap.get(Zx.LocalVideoLowTrack);if(t){let n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new hS(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}}filterTobePublishedTracks(e,t,n){let r=[],i=this.getAllTracks();e=QL(e=e.filter((e=>-1===i.indexOf(e))));let a,o=!1,s=this.localTrackMap.get(Zx.LocalAudioTrack);for(let c of e){if(c instanceof WG&&(this.localTrackMap.has(Zx.LocalVideoTrack)||o?new mL(fL.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:Zx.LocalVideoTrack}),o=!0),t)){let e=this.getLowVideoTrack(c,n);r.push({track:e,type:Zx.LocalVideoLowTrack})}if(c instanceof kG)if(s){let e=s.track;if(e instanceof UG)rz([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{let t=iz([e,c]);ik.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else a instanceof UG?(rz([c]),a.addAudioTrack(c)):a=a||!c._useAudioElement&&Mj().webAudioMediaStreamDest&&!c._bypassWebAudio?iz(a?[c,a]:[c]):c}return a&&(ik.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(a.getTrackId(),"]")),r.push({track:a,type:Zx.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=QL(e=e.filter((e=>-1!==n.indexOf(e))));for(let r of e){if(r instanceof kG){let e=this.localTrackMap.get(Zx.LocalAudioTrack);if(!e)continue;e.track instanceof UG?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([Zx.LocalAudioTrack,e]),e.track.close())):t.push([Zx.LocalAudioTrack,e])}if(r instanceof WG){let e=this.localTrackMap.get(Zx.LocalVideoTrack);if(!e)continue;t.push([Zx.LocalVideoTrack,e]);let n=this.localTrackMap.get(Zx.LocalVideoLowTrack);n&&t.push([Zx.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=QL(e)).filter((e=>-1===this.localDataChannels.findIndex((t=>t.id===e.id))))}filterTobeUnpublishedDataChannels(e){return(e=(e=QL(e)).filter((e=>-1!==this.localDataChannels.indexOf(e)))).filter((e=>e._originDataChannel))}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case Zx.LocalVideoTrack:t.addListener(eV.GET_STATS,this.handleGetLocalVideoStats),t.addListener(eV.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(eV.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(eV.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(eV.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Zx.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case Zx.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof UG?e.trackList.forEach((e=>{e.addListener(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(eV.GET_STATS,this.handleGetLocalAudioStats),e.addListener(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(eV.GET_STATS,this.handleGetLocalAudioStats),e.addListener(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(eV.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(eV.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case Zx.LocalVideoTrack:t.off(eV.GET_STATS,this.handleGetLocalVideoStats),t.off(eV.GET_RTC_STATS,this.handleGetRTCStats),t.off(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(eV.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(eV.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(eV.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Zx.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case Zx.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof UG?e.trackList.forEach((e=>{e.off(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(eV.GET_STATS,this.handleGetLocalAudioStats),e.off(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(eV.GET_STATS,this.handleGetLocalAudioStats),e.off(eV.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(eV.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(eV.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(eV.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(eV.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(eV.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof aW&&t.addListener(eV.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof oW&&t.addListener(eV.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(eV.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(Jx.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Jx.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,a,{track:o,type:s}=e;switch(s){case Zx.LocalAudioTrack:i=Fx.Audio,a={dtx:o instanceof xG&&o._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Zx.LocalVideoTrack:i=_h(r=o._hints).call(r,tV.SCREEN_TRACK)?Fx.Screen:Fx.High,a=zz(zz({},FM(o)),{},{codec:this.store.codec,svc_mode:SW()});break;case Zx.LocalVideoLowTrack:i=Fx.Low,a=zz(zz({},FM(o)),{},{codec:this.store.codec,svc_mode:SW()})}return{stream_type:i,attributes:a,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case Zx.LocalVideoTrack:n=_h(t=i._hints).call(t,tV.SCREEN_TRACK)?Fx.Screen:Fx.High;break;case Zx.LocalAudioTrack:n=Fx.Audio;break;case Zx.LocalVideoLowTrack:n=Fx.Low}return{stream_type:n,ssrcs:a,mid:o}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(eM.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),VD("NEW_ICE_RESTART")){var n;if(_h(n=this._restartStates).call(n,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let t=t=>{("disconnected"===e.iceConnectionState||"checking"===e.iceConnectionState||"failed"===e.iceConnectionState)&&(ik.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(t)),"CONNECTED"===KL(this,eM.QueryClientConnectionState)&&this.emit(eM.RequestRestartICE,t))},n=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),ik.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(eM.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())},r=VD("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout((()=>{if(VD("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Mj().supportPCSetConfiguration)t(Xx.RELAY),this._restartTimer=window.setTimeout(n,r);else if(qP())t(Xx.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(t(Xx.TCP),Mj().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout((()=>{t(Xx.RELAY),this._restartTimer=window.setTimeout(n,r)}),r));this._restartTimer=window.setTimeout(n,r)}}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&VD("ICE_RESTART")&&"CONNECTED"===KL(this,eM.QueryClientConnectionState)&&this.emit(eM.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(ik.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout((()=>this.emit(eM.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(ik.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout((()=>this.emit(eM.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),hk.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:kL.TRACER}).onSuccess(),this.emit(eM.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;let n=Array.from(Pb(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(sV.FIRST_FRAME_DECODED),hk.firstRemoteFrame(this.store.sessionId,sk.FIRST_AUDIO_DECODE,ck.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:OH.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;let n=Array.from(Pb(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&hk.firstRemoteFrame(this.store.sessionId,sk.FIRST_AUDIO_RECEIVED,ck.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:OH.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;let n=Array.from(Pb(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&hk.firstRemoteFrame(this.store.sessionId,sk.FIRST_VIDEO_RECEIVED,ck.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:OH.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{let n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(eM.ConnectionTypeChange,n),ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(WM(t))," -> ").concat(JSON.stringify(WM(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{ik.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(WM(t))," -> ").concat(JSON.stringify(WM(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return zz(zz({},e),t)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let t=[];if(-1===this.getAllTracks().indexOf(e))return t;let n=this.localTrackMap.get(Zx.LocalAudioTrack);if(e instanceof kG&&(null===n||void 0===n?void 0:n.track)instanceof UG)return n.track.isActive||t.push([Zx.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===Zx.LocalVideoTrack)){let e=this.localTrackMap.get(Zx.LocalVideoLowTrack);e&&t.push([Zx.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(Zx.LocalAudioTrack);if(e instanceof kG&&(null===n||void 0===n?void 0:n.track)instanceof UG)return n.track.isActive&&t.push([Zx.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===Zx.LocalVideoTrack){t.push(r);let e=this.localTrackMap.get(Zx.LocalVideoLowTrack);e&&t.push([Zx.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case Zx.LocalAudioTrack:n=Fx.Audio;break;case Zx.LocalVideoTrack:n=_h(t=i._hints).call(t,tV.SCREEN_TRACK)?Fx.Screen:Fx.High;break;case Zx.LocalVideoLowTrack:n=Fx.Low}return{stream_type:n,ssrcs:a,mid:o}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:a,id:o}]=e;switch(r){case Zx.LocalAudioTrack:n=Fx.Audio;break;case Zx.LocalVideoTrack:n=_h(t=i._hints).call(t,tV.SCREEN_TRACK)?Fx.Screen:Fx.High;break;case Zx.LocalVideoLowTrack:n=Fx.Low}return{stream_type:n,ssrcs:a,mid:o}}))}filterTobeUnSubscribedTracks(e,t){let n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){let i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}filterTobeUnSubscribedDataChannels(e,t){let n=[];return t.forEach((t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)})),n}createUnsubscribeMessage(e){let t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case Jx.VIDEO:return void(n._videoSSRC&&t.push({stream_type:Jx.VIDEO,ssrcId:n._videoSSRC}));case Jx.AUDIO:return void(n._audioSSRC&&t.push({stream_type:Jx.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===Jx.VIDEO?e|=Bx.Video:e|=Bx.Audio,t.set(n,e)}else r===Jx.VIDEO?t.set(n,Bx.Video):t.set(n,Bx.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e,r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){let t=this.localTrackMap.get(Zx.LocalVideoTrack),n=this.localTrackMap.get(Zx.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t){return e.map(((e,n)=>{var r;let{stream_type:i}=e;return null===(r=t.find((e=>{let{stream_type:t}=e;return i===t})))||void 0===r?void 0:r.attributes}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof kG){var t;let r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));let i=this.createUnmuteMessage(r);return void await zL(this,eM.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(eM.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(eM.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await dD(RD(this.dtlsFailedCount,wD)),this.emit(eM.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await qL(this,eM.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(eM.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Zx.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof WG))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof WG)).length>1)throw new mL(fL.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof kG)).length>1&&(e.some((e=>e instanceof kG&&e._bypassWebAudio))||!Mj().webAudioMediaStreamDest))throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof WG&&this.pendingLocalTracks.some((e=>e instanceof WG)))throw new mL(fL.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof kG&&this.pendingLocalTracks.some((e=>e instanceof kG))&&(!Mj().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof kG&&e._bypassWebAudio))))throw new mL(fL.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let n,r=!VD("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mj().supportDualStreamEncoding,i=zz(zz({},{width:160,height:120,framerate:15,bitrate:50}),t);n=r?e._mediaStreamTrack.clone():Rq(e,i);let a=uD(8,"track-low-"),o=new WG(n,zz(zz({},r&&{scaleResolutionDownBy:GM(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return o.on(aV.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,nV.LOW_STREAM)})),o._hints.push(tV.LOW_STREAM),e.on("sei-to-send",(e=>{o.emit("sei-to-send",e)})),e.addListener(eV.NEED_CLOSE,(()=>{o.close()})),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof Wz){var i,a,o,s;let c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();hk.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:l,dtlsstate:d,connectionstate:u,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:null!==(i=null===h||void 0===h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(a=h.candidateType)&&void 0!==a?a:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(o=p.protocol)&&void 0!==o?o:"",selectedRemoteCandidateType:null!==(s=p.candidateType)&&void 0!==s?s:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;let a=Array.from(Pb(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());let i=this.store.keyMetrics,o=i.subscribe.find((e=>e.userId===a.uid&&"video"===e.type));hk.firstRemoteVideoDecode(this.store.sessionId,sk.FIRST_VIDEO_DECODE,ck.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:OH.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null===o||void 0===o?void 0:o.subscribeEnd)||0,subscriberStart:(null===o||void 0===o?void 0:o.subscribeStart)||0,videoAddNotify:(null===o||void 0===o?void 0:o.streamAdded)||0,state:r?1:0,firstFrame:(null===o||void 0===o?void 0:o.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let i=r.get(t);if(!i)return!1;let a=await this.connection.getRemoteSSRC(i);return void 0!==a&&a!==n}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===Zx.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,nV.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof Wz&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Qx.TCP_RESTART&&e===Xx.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Qx.DISCONNECTED_OR_FAILED)))}},sx(Gz.prototype,"startP2PConnection",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"startP2PConnection"),Gz.prototype),sx(Gz.prototype,"connect",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"connect"),Gz.prototype),sx(Gz.prototype,"updateRemoteRTPCapabilities",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"updateRemoteRTPCapabilities"),Gz.prototype),sx(Gz.prototype,"publishDataChannel",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"publishDataChannel"),Gz.prototype),sx(Gz.prototype,"unpublish",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"unpublish"),Gz.prototype),sx(Gz.prototype,"unpublishDataChannel",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"unpublishDataChannel"),Gz.prototype),sx(Gz.prototype,"unpublishLowStream",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"unpublishLowStream"),Gz.prototype),sx(Gz.prototype,"subscribeDataChannel",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"subscribeDataChannel"),Gz.prototype),sx(Gz.prototype,"subscribe",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"subscribe"),Gz.prototype),sx(Gz.prototype,"massSubscribe",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"massSubscribe"),Gz.prototype),sx(Gz.prototype,"unsubscribe",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"unsubscribe"),Gz.prototype),sx(Gz.prototype,"unsubscribeDataChannel",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"unsubscribeDataChannel"),Gz.prototype),sx(Gz.prototype,"massUnsubscribe",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"massUnsubscribe"),Gz.prototype),sx(Gz.prototype,"muteRemote",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"muteRemote"),Gz.prototype),sx(Gz.prototype,"unmuteRemote",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"unmuteRemote"),Gz.prototype),sx(Gz.prototype,"hasRemoteMediaWithLock",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"hasRemoteMediaWithLock"),Gz.prototype),sx(Gz.prototype,"disconnectForReconnect",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"disconnectForReconnect"),Gz.prototype),sx(Gz.prototype,"updateBitrateLimit",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"updateBitrateLimit"),Gz.prototype),sx(Gz.prototype,"remoteMediaSsrcChanged",[Xz],Object.getOwnPropertyDescriptor(Gz.prototype,"remoteMediaSsrcChanged"),Gz.prototype),Gz);function Xz(e,t,n){let r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){let e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return await r.apply(this,a)}finally{n()}},n}var Qz={};function Zz(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&ik.debug("install service ".concat(e.name)),Qz[e.name]=e}function $z(e){let t=Qz[e];if(!t)throw new mL(fL.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function eK(e,t){return $z("DataStream").create(e,t)}function tK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tK(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rK=Date.now(),iK=new Map,aK=new Map;async function oK(e){let t=iK.get(e),n=Array.isArray(t)&&t[t.length-1],r=aK.get(e);if(!n)return void(r.isSyncing=!1);let i={uid:n.uid,payload:n.payload};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);let a=n.sendTs-r.firstSendTs,o=a-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-a);let s=n.mediaDelay+o;s<=0?(t.pop(),sK(n.context,i),s=0):s=Math.min(s,20),setTimeout((()=>t.length&&oK(e)),s)}function sK(e,t){e.safeEmit(BL.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function cK(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return sK(n,{uid:e.uid,payload:e.payload});let r="".concat(n.id,"-").concat(e.uid),i=iK.get(r)||[],a=i.findIndex((t=>e.sendTs>=t.sendTs)),o=nK(nK({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===a?i.push(o):i.splice(a,0,o),iK.set(r,i);let s=!1;var c;aK.has(r)?s=!(null===(c=aK.get(r))||void 0===c||!c.isSyncing):aK.set(r,{isSyncing:s,firstRecvTs:0,firstSendTs:0}),s||oK(r)}var lK=UP().name;function dK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dK(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var hK="websdk_ng_cache_parameter",pK=VD("MAX_PRELOAD_ASYNC_LENGTH"),fK=new Map,mK=[],_K=null,gK=0,EK=0,vK=new Map,yK=function(e,t){let n=[],r=0,i=async()=>{let e=n.shift();e&&await e(),n.length>0&&r<t?i():r--};return async function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return new hS((async(a,s)=>{n.push((async()=>{try{let t=await e(...o);a(t)}catch(da){s(da)}})),r<t&&(r++,i())}))}}(bK,pK),SK=RP.CancelToken.source();async function bK(e,t,n,r,i,a){try{if(!VD("ENABLE_PRELOAD"))return;if(!Mj().supportWebCrypto)return void nD((()=>{ik.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&null!==n)throw new mL(fL.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&yL(n,"token",1,2047),yL(e,"appid",1,2047),Tx(t),r&&Cx(r);let o=hD();ik.debug("preload channel ".concat(t,", uid is ").concat(r));let s,c,l={appId:e,cname:t,token:n||e,uid:"string"!=typeof r?r:null,sid:o,proxyServer:i};"string"==typeof r?(l.stringUid=r,[c,s]=await hS.all([SH(r,{sid:o,appId:e},SK.token),bH(uK(uK({},l),{},{token:n||e,uid:0}),SK.token)]),l.uid=c.uid,s.gatewayInfo.uid=l.uid,s.gatewayInfo.res.uid=l.uid):(a&&(l.stringUid=a),s=await bH(l,SK.token));let d={sid:o,appId:e,cname:t,token:n||e,uid:l.stringUid||r,intUid:l.uid||s.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:c,ap:s};await async function(e){let t;try{e.uid&&CK({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});let n=OK(e),r=await async function(e,t){try{let n=await window.crypto.subtle.importKey("raw",aD(t),"AES-GCM",!1,["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,rD(window.btoa(JSON.stringify(e))));return iD(new Uint8Array(r))}catch(n){return}}(e,e.token||e.appId);if(!r)return;t=IK(hK);let i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>VD("AP_CACHE_NUM")&&i.shift(),NK(hK,JSON.stringify(i))}catch(pa){ik.warn("Error caching server parameters:",pa.message),NK(hK,"")}}(d),gK++}catch(oa){throw EK++,function(e){_K||(_K=window.setTimeout((()=>{let t="";vK.forEach(((e,n)=>{t+="".concat(n,": ").concat(e," ;")})),hk.reportApiInvoke(null,{name:DL.PRELOAD,options:{success:gK,failed:EK,err:t}}).onError(e),gK=0,EK=0,vK.clear(),_K=null}),1e4));let t=vK.get(e.code)||0;vK.set(e.code,t+1)}(oa),oa}}async function TK(e){try{let t=CK(e);if(!t||"disabled"!==e.cloudProxyServer)return;let n=await async function(e,t){try{let n=await window.crypto.subtle.importKey("raw",aD(t),"AES-GCM",!1,["decrypt"]),r=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,rD(e));return JSON.parse(window.atob(iD(new Uint8Array(r))))}catch(n){return}}(t,e.token||e.appId);if(!n||!function(e,t){return e.cname===t.cname&&e.appId===t.appId&&e.token===t.token&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<VD("AP_CACHE_LIFETIME"))return n}catch(g0){ik.warn("Error get preloadInfo",g0.message)}}function CK(e){let t;try{if(t=IK(hK),!t)return;let n=JSON.parse(t),r=OK(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,(e=>r in e));if(-1===i)return;let a=n.splice(i,1)[0];return NK(hK,JSON.stringify(n)),a[r]}catch(na){ik.warn("Error delete preload info: ".concat(t),na.message),NK(hK,"")}}function wK(e){if(e){let t=fK.get(e);t&&(window.clearTimeout(t),t=null,fK.delete(e)),_h(mK).call(mK,e)||"disabled"!==e.cloudProxyServer||mK.push(e)}if(fK.size<VD("AP_CACHE_NUM")&&mK.length>0){let e=mK.shift();fK.set(e,window.setTimeout((async()=>{let{appId:t,cname:n,token:r,stringUid:i,uid:a,proxyServer:o}=e;try{await yK(t,n,r,a,o,i),fK.has(e)&&wK(e)}catch(sa){ik.warn("update preload failed",sa.message),RK(e)}}),VD("AP_UPDATE_INTERVAL")))}}function RK(e){let t=mK.indexOf(e);-1!==t&&mK.splice(t,1);let n=fK.get(e);n&&(window.clearTimeout(n),n=null,fK.delete(e),wK())}function AK(e,t){let n=e.sua,r=e.ap;t&&n&&hk.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),hk.reportResourceTiming(e.ap.url,e.sid),hk.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((e=>e.ip)).join(","),eventType:"disabled",unilbsServerIds:[LM.CHOOSE_SERVER,LM.CLOUD_PROXY_FALLBACK].toString()}),hk.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[LM.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function IK(e){return window.atob(window.localStorage.getItem(e)||"")}function NK(e,t){window.localStorage.setItem(e,window.btoa(t))}function OK(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),yD(t)}function PK(e,t){switch(t){case 0:for(;128&BK(e););break;case 2:kK(e,WK(e));break;case 5:kK(e,4);break;case 1:kK(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function LK(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var DK=[];function kK(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function xK(e){return e.offset>=e.limit}function MK(e,t){let n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){let t=new Uint8Array(2*a);t.set(n),e.bytes=t}return e.offset=a,a>i&&(e.limit=a),r}function UK(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function FK(e,t){let n=MK(e,t.length);e.bytes.set(t,n)}function jK(e,t){let n=UK(e,t),r=String.fromCharCode,i=e.bytes,a="\ufffd",o="";for(let s=0;s<t;s++){let e,c,l,d,u=i[s+n];128&u?192==(224&u)?s+1>=t?o+=a:(e=i[s+n+1],128!=(192&e)?o+=a:(d=(31&u)<<6|63&e,d<128?o+=a:(o+=r(d),s++))):224==(240&u)?s+2>=t?o+=a:(e=i[s+n+1],c=i[s+n+2],32896!=(49344&(e|c<<8))?o+=a:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?o+=a:(o+=r(d),s+=2))):240==(248&u)?s+3>=t?o+=a:(e=i[s+n+1],c=i[s+n+2],l=i[s+n+3],8421504!=(12632256&(e|c<<8|l<<16))?o+=a:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?o+=a:(d-=65536,o+=r(55296+(d>>10),56320+(1023&d)),s+=3))):o+=a:o+=r(u)}return o}function VK(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let e=t.charCodeAt(o);e>=55296&&e<=56319&&o+1<n&&(e=(e<<10)+t.charCodeAt(++o)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}HK(e,r);let i=MK(e,r),a=e.bytes;for(let o=0;o<n;o++){let e=t.charCodeAt(o);e>=55296&&e<=56319&&o+1<n&&(e=(e<<10)+t.charCodeAt(++o)-56613888),e<128?a[i++]=e:(e<2048?a[i++]=e>>6&31|192:(e<65536?a[i++]=e>>12&15|224:(a[i++]=e>>18&7|240,a[i++]=e>>12&63|128),a[i++]=e>>6&63|128),a[i++]=63&e|128)}}function BK(e){return e.bytes[UK(e,1)]}function GK(e,t){let n=MK(e,1);e.bytes[n]=t}function WK(e){let t,n=0,r=0;do{t=BK(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function HK(e,t){for(t>>>=0;t>=128;)GK(e,127&t|128),t>>>=7;GK(e,t)}function qK(e,t){let n,r=0,i=0,a=0;return n=BK(e),r=127&n,128&n&&(n=BK(e),r|=(127&n)<<7,128&n&&(n=BK(e),r|=(127&n)<<14,128&n&&(n=BK(e),r|=(127&n)<<21,128&n&&(n=BK(e),i=127&n,128&n&&(n=BK(e),i|=(127&n)<<7,128&n&&(n=BK(e),i|=(127&n)<<14,128&n&&(n=BK(e),i|=(127&n)<<21,128&n&&(n=BK(e),a=127&n,128&n&&(n=BK(e),a|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|a<<24,unsigned:t}}function zK(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=MK(e,a),s=e.bytes;switch(a){case 10:s[o+9]=i>>>7&1;case 9:s[o+8]=9!==a?128|i:127&i;case 8:s[o+7]=8!==a?r>>>21|128:r>>>21&127;case 7:s[o+6]=7!==a?r>>>14|128:r>>>14&127;case 6:s[o+5]=6!==a?r>>>7|128:r>>>7&127;case 5:s[o+4]=5!==a?128|r:127&r;case 4:s[o+3]=4!==a?n>>>21|128:n>>>21&127;case 3:s[o+2]=3!==a?n>>>14|128:n>>>14&127;case 2:s[o+1]=2!==a?n>>>7|128:n>>>7&127;case 1:s[o]=1!==a?128|n:127&n}}var KK={},YK={},JK=4294967296,XK=JK*JK/2;eY(0,!0);var QK=eY(0),ZK=tY(0,-2147483648,!1),$K=tY(-1,2147483647,!1);function eY(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=YK[e],r)?r:(n=tY(e,0,!0),i&&(YK[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=KK[e],r)?r:(n=tY(e,e<0?-1:0,!1),i&&(KK[e]=n),n)}function tY(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function nY(e,t){return isNaN(e)?QK:e<=-XK?ZK:e+1>=XK?$K:e<0?QK:tY(e%JK|0,e/JK|0,t)}function rY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var iY=class e extends OL{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(sM.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),SI(this,"name","AgoraRTCImageModeration"),SI(this,"_connectionState",oM.CONNECTING),SI(this,"_sequence",0),SI(this,"_moderationStartTime",void 0),SI(this,"_workerConnection",void 0),SI(this,"_workerMessageLengthLimit",void 0),SI(this,"_qualityRatio",void 0),SI(this,"_connectInfo",void 0),SI(this,"_cancelTokenSource",RP.CancelToken.source()),SI(this,"_retryConfig",void 0),SI(this,"_moderationInterval",void 0),SI(this,"_moderationTimer",null),SI(this,"_moderationMode",1),SI(this,"_quality",1),SI(this,"_qualityTimer",null),SI(this,"_ticket",void 0),SI(this,"_moderationIntervalMinimum",void 0),SI(this,"_uploadFailedNum",0),SI(this,"_uploadNum",0),SI(this,"_uploadTimer",null),SI(this,"_extraInfo",void 0),SI(this,"_vendor",""),SI(this,"_encoder",new TextEncoder),SI(this,"_moderationId",void 0),SI(this,"inspectImage",(()=>{if(this.connectionState!==oM.CONNECTED)throw new bx(fL.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===oM.CONNECTED?this.requestToInspectImage():ik.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=uD(5,"image-moderation-"),this._workerMessageLengthLimit=VD("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=VD("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=VD("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new OM("worker-"+this._moderationId,wD),this.on(sM.STATE_CHANGE,((e,t)=>{ik.debug("[".concat(this._moderationId,"] Moderation operation :").concat(cM[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(sM.STATE_CHANGE,cM.CONNECT_AP),this._connectInfo=e;let n=this._cancelTokenSource.token;return this._retryConfig=t,new hS(((r,i)=>{this.on(sM.CONNECTION_STATE_CHANGE,((e,t)=>{e===oM.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),ik.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===oM.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){let r=VD("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:a,cname:o,sid:s,token:c,uid:l}=t;fH++;let d,u,h="moderation_plugin",p={service_name:h,json_body:JSON.stringify({appId:i,areaCode:a,cname:o,command:"allocateEdge",requestId:fH,seq:fH,sid:s,appToken:c,ts:Date.now(),uid:l+""})},f=e[0];return AD((async()=>{d=Date.now();let e=await QW(f,{data:p,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(u=Date.now()-d,0!==e.code){let t=new bx(fL.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:u});throw ik.error(t.toString()),t}let t=JSON.parse(e.json_body);if(200!==t.code){let e=new bx(fL.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:u});throw ik.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){let e=new bx(fL.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:u});throw ik.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){let e=new bx(fL.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:u});throw ik.error(e.toString()),e}let r=VD("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:u}}),((t,n)=>(hk.apworkerEvent(s,{success:!0,sc:200,serviceName:h,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:u,serverIp:e[n%e.length]}),!1)),((t,n)=>(hk.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:h,responseTime:u,serverIp:e[n%e.length]}),!!(t.code!==fL.OPERATION_ABORTED&&t.code!==fL.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(sM.STATE_CHANGE,cM.AP_CONNECTED);let{addressList:a,ticket:o}=i;return this._ticket=o,a}async connectWorker(e){this.emit(sM.STATE_CHANGE,cM.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Sx.CONNECTED,(async()=>{this.emit(sM.STATE_CHANGE,cM.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=oM.CONNECTED})),this._workerConnection.on(Sx.CLOSED,(()=>{this.connectionState=oM.CLOSED})),this._workerConnection.on(Sx.FAILED,(()=>{this.connectionState=oM.CLOSED})),this._workerConnection.on(Sx.RECONNECTING,(()=>{this.connectionState=this.connectionState===oM.CONNECTED?oM.RECONNECTING:oM.CONNECTING})),this._workerConnection.on(Sx.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){let t=function(e){return function(e){let t={};e:for(;!xK(e);){let n=WK(e);switch(n>>>3){case 0:break e;case 1:t.code=WK(e);break;case 2:t.msg=jK(e,WK(e));break;case 3:t.requestId=jK(e,WK(e));break;case 4:t.timestamp=qK(e,!1);break;default:PK(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}(new Uint8Array(e.data));VD("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&ik.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,ik.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{hk.reportApiInvoke(this._connectInfo.sid||null,{name:DL.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:kL.TRACER}).onError(new bx(fL.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),VD("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else ik.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(Sx.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(Sx.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){let e=KL(this,sM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(VD("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&ik.debug("Only the track being played can be inspected"));this._sequence++;let n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else VD("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&ik.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:i,cid:a,vid:o,sid:s,uid:c}=n,l=Date.now(),d=await t.getCurrentFrameImage("image/jpeg",this.quality),u=await PG(d,r,i),h=this._sequence+"-"+a+"-"+c+"-"+l+"-"+uD(12,""),p={appId:r,cid:a,cname:i,deviceId:"",elapse:e.intToLong(Number(l-this._moderationStartTime)),fileSize:d.buffer.byteLength,height:d.height,width:d.width,jpg:u,networkType:6,osType:7,requestId:h,sdkVersion:"4.22.0",sequence:this._sequence,sid:s,timestamp:nY(l),uid:c,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete p.callbackData;let f=function(e){let t=function(){let e=DK.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(HK(t,10),VK(t,n));let r=e.cid;void 0!==r&&(HK(t,16),HK(t,r));let i=e.cname;void 0!==i&&(HK(t,26),VK(t,i));let a=e.deviceId;void 0!==a&&(HK(t,34),VK(t,a));let o=e.elapse;void 0!==o&&(HK(t,40),zK(t,o));let s=e.fileSize;void 0!==s&&(HK(t,48),zK(t,LK(s)));let c=e.height;void 0!==c&&(HK(t,56),zK(t,LK(c)));let l=e.jpg;void 0!==l&&(HK(t,66),HK(t,l.length),FK(t,l));let d=e.networkType;void 0!==d&&(HK(t,72),zK(t,LK(d)));let u=e.osType;void 0!==u&&(HK(t,80),zK(t,LK(u)));let h=e.requestId;void 0!==h&&(HK(t,90),VK(t,h));let p=e.sdkVersion;void 0!==p&&(HK(t,98),VK(t,p));let f=e.sequence;void 0!==f&&(HK(t,104),zK(t,LK(f)));let m=e.sid;void 0!==m&&(HK(t,114),VK(t,m));let _=e.timestamp;void 0!==_&&(HK(t,120),zK(t,_));let g=e.uid;void 0!==g&&(HK(t,128),HK(t,g));let E=e.vid;void 0!==E&&(HK(t,136),HK(t,E));let v=e.width;void 0!==v&&(HK(t,144),zK(t,LK(v)));let y=e.service;void 0!==y&&(HK(t,152),HK(t,y));let S=e.callbackData;void 0!==S&&(HK(t,162),HK(t,S.length),FK(t,S));let b=e.ticket;void 0!==b&&(HK(t,170),VK(t,b));let T=e.vendorConfigs;void 0!==T&&(HK(t,178),VK(t,T))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}(p);if(f.byteLength<this._workerMessageLengthLimit){if(VD("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rY(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rY(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},p);delete e.jpg,ik.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return f}{let e=this.quality*this._qualityRatio;return this.quality=e,await this.generateRequestData(t,{appId:r,cname:i,cid:a,vid:o,sid:s,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=RP.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=oM.CLOSED,this.emit(sM.STATE_CHANGE,cM.CLOSED)}};function aY(e){if(EL(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new bx(fL.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new bx(fL.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}var oY,sY,cY,lY,dY,uY,hY,pY,fY,mY,_Y,gY,EY,vY,yY,SY,bY,TY,CY,wY,RY,AY,IY,NY,OY,PY,LY,DY,kY,xY,MY,UY,FY,jY,VY,BY,GY,WY,HY,qY,zY,KY={name:"ImageModeration",create:function(e){let{config:t}=e;return aY(t),new iY(t)}};function YY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YY(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YY(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}TD.setLogger(ik);var XY,QY,ZY=(oY=uk(),sY=uk({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof IV))return[t];t=[t]}return t.map((e=>e?Object(e).toString():"null"))}}),cY=uk({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==cV.DATA?(Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId()))):[t.getChannelId()])}),lY=uk({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),dY=uk({argsMap:(e,t,n)=>[t,n]}),uY=uk({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null===t||void 0===t?void 0:t.uid,n]}))}),hY=uk({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),pY=uk({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null===t||void 0===t?void 0:t.uid,mediaType:n}}))}),fY=uk(),mY=uk(),_Y=uk(),gY=uk(),EY=uk(),vY=uk(),yY=uk(),SY=uk(),bY=uk(),TY=uk(),CY=uk(),wY=uk(),RY=uk(),AY=uk(),IY=uk({argsMap:(e,t)=>[t]}),NY=uk(),OY=uk(),PY=uk(),LY=uk(),DY=uk(),kY=uk(),xY=uk(),MY=uk(),UY=uk({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),FY=uk(),jY=uk(),VY=uk(),BY=uk(),GY=uk(),WY=uk(),HY=uk({reportResult:!0}),qY=uk(),zY=class extends OL{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),SI(this,"store",void 0),SI(this,"_uid",void 0),SI(this,"_channelName",void 0),SI(this,"_uintUid",void 0),SI(this,"_users",[]),SI(this,"_config",void 0),SI(this,"_clientId",void 0),SI(this,"_appId",void 0),SI(this,"_sessionId",null),SI(this,"_key",void 0),SI(this,"_rtmConfig",{}),SI(this,"_joinInfo",void 0),SI(this,"_gateway",void 0),SI(this,"_statsCollector",void 0),SI(this,"_configDistribute",void 0),SI(this,"_leaveMutex",new TD("client-leave")),SI(this,"_publishMutex",new TD("client-publish")),SI(this,"_renewTokenMutex",new TD("client-renewtoken")),SI(this,"_subscribeMutex",new TD("client-subscribe")),SI(this,"_encryptionMode","none"),SI(this,"_encryptionSecret",null),SI(this,"_encryptionSalt",null),SI(this,"_encryptDataStream",!1),SI(this,"_encryptDataStreamKey",null),SI(this,"_encryptDataStreamIv",null),SI(this,"_proxyServer",void 0),SI(this,"_turnServer",{servers:[],mode:"auto"}),SI(this,"_cloudProxyServerMode","disabled"),SI(this,"_isDualStreamEnabled",!1),SI(this,"_defaultStreamFallbackType",void 0),SI(this,"_lowStreamParameter",void 0),SI(this,"_streamFallbackTypeCacheMap",new Map),SI(this,"_remoteStreamTypeCacheMap",new Map),SI(this,"_axiosCancelSource",RP.CancelToken.source()),SI(this,"_audioVolumeIndicationInterval",void 0),SI(this,"_networkQualityInterval",void 0),SI(this,"_userOfflineTimeout",void 0),SI(this,"_streamRemovedTimeout",void 0),SI(this,"_liveTranscodeStreamingClient",void 0),SI(this,"_liveRawStreamingClient",void 0),SI(this,"_channelMediaRelayClient",void 0),SI(this,"_networkQualitySensitivity","normal"),SI(this,"_p2pChannel",void 0),SI(this,"_useLocalAccessPoint",!1),SI(this,"_setLocalAPVersion",void 0),SI(this,"_joinAndNotLeaveYet",!1),SI(this,"_numberOfJoinCount",0),SI(this,"_remoteDefaultVideoStreamType",void 0),SI(this,"_inspect",void 0),SI(this,"_moderation",void 0),SI(this,"_license",void 0),SI(this,"_pendingPublishedUsers",[]),SI(this,"ntpAlignErrorCount",0),SI(this,"remoteInboundOffset",0),SI(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),SI(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),SI(this,"_handleUserOnline",(e=>{if(VD("BLOCK_LOCAL_CLIENT")&&gk(e.uid,this.channelName))return void ik.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&ik.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(BL.USER_JOINED,t));else{let t=new ez(e.uid,e.uint_id||e.uid);this._users.push(t),ik.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(BL.USER_JOINED,t)}})),SI(this,"_handleUserOffline",(e=>{if(VD("BLOCK_LOCAL_CLIENT")&&gk(e.uid,this.channelName))return;let t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:XL(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),ik.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(BL.USER_LEAVED,t,e.reason))})),SI(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,a,o)=>{if(VD("BLOCK_LOCAL_CLIENT")&&gk(t,this.channelName))return;let s=this._users.find((e=>e.uid===t));if(!s)return void ik.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));ik.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(s.uid,e,void 0,void 0,void 0,Date.now());let c="audio"===e?s.hasAudio:s.hasVideo;s._uintid||(s._uintid=i||t),"audio"===e?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,"audio"===e?(s._audio_added_=!0,void 0!==n&&(s._audioSSRC=n),void 0!==r&&(s._cname=r),a&&(s._audioOrtc=a)):(s._video_added_=!0,void 0!==n&&(s._videoSSRC=n),void 0!==r&&(s._cname=r),void 0!==o&&(s._rtxSsrcId=o),a&&(s._videoOrtc=a)),("audio"===e?s.hasAudio:s.hasVideo)&&!c&&(ik.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(e)),this.safeEmit(BL.USER_PUBLISHED,s,e)),"video"===e?hk.onGatewayStream(this._sessionId,sk.ON_ADD_VIDEO_STREAM,ck.ON_ADD_VIDEO_STREAM,{peer:i||t,ssrc:s._videoSSRC}):hk.onGatewayStream(this._sessionId,sk.ON_ADD_AUDIO_STREAM,ck.ON_ADD_AUDIO_STREAM,{peer:i||t,ssrc:s._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(s,e,n).then((t=>{if(t&&(ik.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Jz))return this._p2pChannel.unsubscribe(s,e,!0).then((()=>this._subscribe(s,e,!0).catch((e=>{ik.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(s,e)&&(ik.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,e,!0).catch((e=>{ik.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),SI(this,"_handleRemoveStream",(e=>{if(VD("BLOCK_LOCAL_CLIENT")&&gk(e.uid,this.channelName))return;let t=this._users.find((t=>t.uid===e.uid));if(!t)return void ik.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));ik.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{ik.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(BL.USER_UNPUBLISHED,t,"audio"),ik.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(BL.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{ik.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(BL.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{ik.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(BL.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof Jz&&this._p2pChannel.unsubscribe(t).then((e=>{if(e)return this._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),hk.onGatewayStream(this._sessionId,sk.ON_REMOVE_STREAM,ck.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()})),SI(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if(VD("BLOCK_LOCAL_CLIENT")&&gk(t,this.channelName))return;let r=this._users.find((e=>e.uid===t));if(!r)return void ik.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));ik.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));let i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;let e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{let e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";ik.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(BL.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;let e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{let e=r._video_enabled_?"enable-local-video":"disable-local-video";ik.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(BL.USER_INFO_UPDATED,t,e)}}let a="audio"===e?r.hasAudio:r.hasVideo;return i!==a?!i&&a?(ik.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(BL.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),ik.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(BL.USER_UNPUBLISHED,r,e)):void 0})),SI(this,"_handleMuteStream",((e,t,n)=>{if(VD("BLOCK_LOCAL_CLIENT")&&gk(e,this.channelName))return;ik.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);let r=this._users.find((t=>t.uid===e));if(!r)return void ik.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));let i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;let t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{let t=r._audio_muted_?"mute-audio":"unmute-audio";ik.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(BL.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;let t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{let t=r._video_muted_?"mute-video":"unmute-video";ik.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(BL.USER_INFO_UPDATED,e,t)}}let a="audio"===t?r.hasAudio:r.hasVideo;if(i!==a){if(!i&&a)return("audio"===t?r._audioSSRC:r._videoSSRC)?(ik.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(BL.USER_PUBLISHED,r,t)):void ik.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),ik.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(BL.USER_UNPUBLISHED,r,t)}})),SI(this,"_handleP2PLost",(async e=>{ik.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():ik.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),SI(this,"_handleTokenWillExpire",(()=>{ik.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(BL.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),SI(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),ik.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),SI(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(BL.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(BL.NETWORK_QUALITY,e)})),SI(this,"_handleP2PAddAudioOrVideoStream",((e,t,n,r)=>{let i=this._users.find((e=>e.uid===t));if(!i)return void ik.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));ik.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());let a="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==r&&(i._audioMid=r)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==r&&(i._videoMid=r)),("audio"===e?i.hasAudio:i.hasVideo)&&!a&&(ik.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(BL.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(ik.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch((e=>{ik.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),this._config=e,this._clientId=uD(5,"client-"),this.store=new WD(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),ik.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(DD," build: ").concat(UD,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{VL(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(na){ik.warning("[".concat(this._clientId,"] ").concat(na.toString()))}this._statsCollector=new uz(this.store),this._statsCollector.onStatsException=(e,t,n)=>{ik.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(BL.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{let i=this._users.find((t=>t.uid===e));i&&hk.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this.store.useP2P="p2p"===e.mode,this._gateway=new XW(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||wD,httpRetryConfig:e.httpRetryConfig||wD,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new AH,this.store.useP2P?(this._p2pChannel=new sz(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Jz(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];jD("JOIN_GATEWAY_USE_443PORT_ONLY",a),jD("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);let s=this._gateway.signal.websocket;return s instanceof NM&&(s.use443PortOnly=a,s.tryDoubleDomain=o),async function(e,t,n){NP.get(e)||NP.set(e,[]),OP.get(e)||OP.set(e,t),PP.get(e)||PP.set(e,0);let r=NP.get(e),i=OP.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(PP.get(e)===i){let e=IP();r.push(e),await e.promise}PP.set(e,PP.get(e)+1);for(var a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];let c=await n(...o);return PP.set(e,PP.get(e)-1),PP.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===PP.get(e)&&(NP.set(e,[]),OP.set(e,0),PP.set(e,0)),c}("client.join",VD("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){let a=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);let o="HTTPS"===(ID||ID||(ID=(window.location.protocol.split(":")[0]||"").toUpperCase())),s=LD()?window.isSecureContext:"Browser Not Support";(!LD()&&!o||!window.isSecureContext)&&ik.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),ik.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),hk.setAppId(e);try{if(!n&&null!==n)throw new bx(fL.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&yL(n,"token",1,2047),yL(e,"appid",1,2047),Tx(t),r&&Cx(r),i&&yL(i,"optionalInfo",1,2047)}catch(xa){throw hk.reportApiInvoke(hD(),{name:DL.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:s},tag:kL.TRACER}).onError(xa),xa}if(this._leaveMutex.isLocked&&(ik.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),ik.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){let i=new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw hk.reportApiInvoke(hD(),{name:DL.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:s},tag:kL.TRACER}).onError(i),i}this._gateway.state="CONNECTING";let c=await TK({appId:e,cname:t,uid:r,stringUid:"string"==typeof r?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let l=(null===c||void 0===c?void 0:c.sid)||hD();ik.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);let d=hk.reportApiInvoke(l,{name:DL.JOIN,options:[e,t,n,r],states:{isHttps:o,isSecureContext:s},tag:kL.TRACER}),u=JY(JY({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(u.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(u.stringUid=r,this._uintUid?(u.uid=this._uintUid,this._uintUid=void 0):u.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(u.aesmode=this._encryptionMode,u.aespassword=await(async e=>{let t=function(){let e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=AL(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(u.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let e=new TextEncoder,t=VD("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(u.appId+this._encryptionSecret+this._encryptionSecret):e.encode(u.appId+u.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){let r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,a=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:n},r,i+96);return new Uint8Array(a).subarray(i/8)}(this._encryptionMode,t,rD(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){let r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:n},r,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,rD(this._encryptionSalt))}else s?ik.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):ik.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,ik.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:u.stringUid});let h=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&h===this._sessionId&&hk.joinChannelTimeout(this._sessionId,5)}),5e3);try{var p;let r,i=u.cloudProxyServer;if(_h(p=["proxy3","proxy4","proxy5"]).call(p,i)){let e=VD("PROXY_SERVER_TYPE3");Array.isArray(e)?u.proxyServer=e[0]:u.proxyServer=e}if(hk.setProxyServer(u.proxyServer),ik.setProxyServer(u.proxyServer),this.store.requestAPStart(),c){if(ik.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(u.stringUid?", ".concat(u.stringUid," => ").concat(c.intUid):""," ")),u.stringUid&&!u.uid&&(u.uid=c.intUid),r={gatewayInfo:c.ap.gatewayInfo},VD("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===u.turnServer.mode)if(0===c.ap.proxyInfo.addresses.length)ik.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let e=(await BM(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map((e=>({turnServerURL:e.address,tcpport:e.tcpport||fk.tcpport,udpport:e.udpport||fk.udpport,username:e.username||fk.username,password:e.password||fk.password,forceturn:!1,security:!0})));u.turnServer={mode:"manual",servers:e}}AK(c,u.stringUid)}else{if(u.stringUid&&!u.uid){let e;[e,r]=await hS.all([yH(u.stringUid,u,this._axiosCancelSource.token,this._config.httpRetryConfig||wD,this.store),vH(u,this._axiosCancelSource.token,this._config.httpRetryConfig||wD,0,this.store)]),ik.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(u.stringUid," => ").concat(e)),u.uid=e,r.gatewayInfo.uid=e,r.gatewayInfo.res.uid=e}else r=await vH(u,this._axiosCancelSource.token,this._config.httpRetryConfig||wD,0,this.store);if(!this._joinAndNotLeaveYet)throw new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(u,this._axiosCancelSource.token),this._configDistribute.on(zx.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)}))}),0),this._key=n||e;let a=r.gatewayInfo,o=u.uid?u.uid:a.uid;this._joinInfo=JY(JY({},u),{},{cid:a.cid,uid:o,vid:a.vid,apResponse:a.res,apGatewayAddress:a.apGatewayAddress,uni_lbs_ip:a.uni_lbs_ip,gatewayAddrs:a.gatewayAddrs}),this.store.intUid=o;let s=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));d.onSuccess(s),this._appId=e,this._channelName=u.cname,this._uid=s,this.store.uid=s,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(WP()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);let l=u.stringUid?"string uid: ".concat(u.stringUid,",uid: ").concat(u.uid):"uid: ".concat(this._uid);return ik.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(l)),setTimeout((()=>{ik.startUpload()}),5e3),this.store.joinEnd(),_h(_k).call(_k,this)||_k.push(this),"disabled"===this._cloudProxyServerMode&&Mj().supportWebCrypto&&VD("ENABLE_PRELOAD")&&wK(this._joinInfo),s}catch(xa){let t=Array.isArray(xa)?xa[0]:xa;throw t&&t.code===fL.OPERATION_ABORTED?ik.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),t):ik.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),t),t.code!==fL.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),d.onError(t),t}}_joinGateway(){if(!this._joinInfo||!this._key)throw new bx(fL.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!VD("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){ik.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(WP()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){let t=_k.indexOf(e);-1!==t&&_k.splice(t,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return ik.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState),ik.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof IV))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new bx(fL.INVALID_PARAMS,"param list is empty");let n=e;if("audience"===this._gateway.role)throw new bx(fL.INVALID_OPERATION,"audience can not publish stream");for(let a of n){if(!(a instanceof IV))throw new bx(fL.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new bx(fL.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}ik.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))));let r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((e=>{let t=this._configDistribute.getBitrateLimit();e instanceof WG&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(n),ik.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))))}catch(i){throw ik.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(e){EL(e.id,"id",0,65535,!0),_L(e.ordered,"ordered"),yL(e.metadata,"metadata",0,512),ik.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex((t=>t.id===e.id)))throw new bx(fL.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new bx(fL.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&VD("FORCE_TURN")&&!VD("TURN_ENABLE_TCP")&&!VD("TURN_ENABLE_UDP"))throw new bx(fL.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let t=eK(n=e,!1),r=await this._p2pChannel.publishDataChannel([t]);if(r.length>0){if("number"!=typeof t._originDataChannelId)throw ik.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new bx(fL.CREATE_DATACHANNEL_ERROR);try{await hS.all(r.map((e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)))),await t._waitTillOpen()}catch(n){if(n.code!==fL.DISCONNECT_P2P)throw n}}return ik.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(na){throw ik.error("[".concat(this._clientId,"] publish datachannels error"),na.toString()),na}finally{t()}var n}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new bx(fL.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof IV))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);ik.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((e=>"".concat(e.getTrackId()," ")))," "));let n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof sz){let e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(lM.UNPUBLISH,{unpubMsg:e},!0)}else{let e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),ik.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((e=>"".concat(e.getTrackId())))))}}catch(yi){throw ik.error("[".concat(this._clientId,"] unpublish error"),yi.toString()),yi}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),ik.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((e=>"".concat(e.id," ")))," "));let t=await this._publishMutex.lock();try{let t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),ik.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((e=>"".concat(e.id)))))}catch(na){throw ik.error("[".concat(this._clientId,"] unpublish dataChannel error"),na.toString()),na}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof ez)){let t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new bx(fL.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(gL(t,"mediaType",["audio","video"]),this._p2pChannel instanceof sz)throw new bx(fL.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let n=t===Jx.AUDIO,r=t===Jx.VIDEO,i=await this._subscribeMutex.lock();try{let{ssrcId:i,ortc:a,rtxSsrcId:o,cname:s,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new bx(fL.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find((t=>t.uid===e));l||(l=new ez(e,c||e),l._is_pre_created=!0,this._users.push(l)),s&&(l._cname=s),l._uintid||(l._uintid=c||e),n&&(l._audioSSRC=i,l._audio_pre_subscribed=!0,a&&(l._audioOrtc=a)),r&&(l._videoSSRC=i,l._video_pre_subscribed=!0,a&&(l._videoOrtc=a),null!=o&&(l._rtxSsrcId=o)),ik.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(l,t,i,o,a);let d=n?l._audioTrack:l._videoTrack;if(!d)throw new bx(fL.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),r&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),d}catch(aa){throw ik.error("[".concat(this._clientId,"] presub user ").concat(e," error"),aa),aa}finally{i()}}async _subscribeDataChannel(e,t){var n;if(EL(t,"channelId",0,65535,!0),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e)))throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new bx(fL.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new bx(fL.INVALID_REMOTE_USER,"user is not published");let r=null===(n=e._dataChannels)||void 0===n?void 0:n.find((e=>e.id===t));if(!r)throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new bx(fL.REMOTE_USER_IS_NOT_PUBLISHED);let i=await this._subscribeMutex.lock();ik.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let t=await this._p2pChannel.subscribeDataChannel(e,[r]);if(t&&_h(t).call(t,r.id))try{var a;if("number"!=typeof r._originDataChannelId)throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new bx(fL.CREATE_DATACHANNEL_ERROR);let t={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:null!==(a=r.metadata)&&void 0!==a?a:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await r._waitTillOpen()}catch(sa){if((null===sa||void 0===sa?void 0:sa.code)!==fL.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[r]),sa;await this._p2pChannel.unsubscribeDataChannel(e,[r]),this._p2pChannel.setPendingRemoteDataChannel(e,r.id)}return ik.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),r}finally{i()}}async _p2pSubscribe(e,t,n){if(gL(t,"mediaType",["audio","video"]),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e))){let t=new bx(fL.INVALID_REMOTE_USER,"user is not in the channel");throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){let t=new bx(fL.INVALID_REMOTE_USER,"user is not published");throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){let n=new bx(fL.REMOTE_USER_IS_NOT_PUBLISHED);throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let r=await this._subscribeMutex.lock();ik.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let n="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof sz&&await this._p2pChannel.subscribe(e,t,n,r)}catch(oa){throw oa}ik.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{ik.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));let n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new bx(fL.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(aa){throw ik.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),aa),aa}finally{r()}}async _subscribe(e,t,n){if(this._p2pChannel instanceof sz)return this._p2pSubscribe(e,t);if(gL(t,"mediaType",["audio","video"]),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e))){let t=new bx(fL.INVALID_REMOTE_USER,"user is not in the channel");throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){let t=new bx(fL.INVALID_REMOTE_USER,"user is not published");throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){let n=new bx(fL.REMOTE_USER_IS_NOT_PUBLISHED);throw ik.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let r="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?Jx.AUDIO:Jx.VIDEO,ssrcId:r},s=await this._subscribeMutex.lock();ik.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let n="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==n&&n!==r&&(r=n,i="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,o={stream_type:"audio"===t?Jx.AUDIO:Jx.VIDEO,ssrcId:r}),OH.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,a,i);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(e.uid,o,!0)}catch(ca){if((null===ca||void 0===ca?void 0:ca.code)!==fL.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),ca;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(da){throw this._p2pChannel.reportSubscribeEvent(!1,null===da||void 0===da?void 0:da.code,e,t),da}ik.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{ik.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));let n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new bx(fL.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(ha){throw ik.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),ha),ha}finally{s()}}async massSubscribe(e){if(SL(e,"subscribeList"),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();ik.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null===t||void 0===t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));let i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),a=await this._p2pChannel.globalLock();try{var o;for(let t=e.length-1;t>=0;t--){let r=e[t],{user:a,mediaType:o}=r;if(gL(o,"mediaType",["audio","video"]),!a){let e=new bx(fL.INVALID_PARAMS,"user property does not exist in subscribeList item");throw ik.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}if(!this._users.find((e=>e===a))){let n=new bx(fL.INVALID_REMOTE_USER,"user is not in the channel");ik.error("[".concat(this._clientId,"] can not massSubscribe ").concat(a.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===o&&(!a.hasAudio||void 0===a._audioSSRC)||"video"===o&&(!a.hasVideo||void 0===a._videoSSRC)){let n=new bx(fL.REMOTE_USER_IS_NOT_PUBLISHED);ik.error("[".concat(this._clientId,"] can not subscribe ").concat(a.uid," with mediaType ").concat(o,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}let s=Bx.Video|Bx.LwoVideo,c=n.get(a);if(c){if("video"===o?c&s:c&Bx.Audio){e.splice(t,1),ik.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(a.uid,", mediaType:").concat(o," twice"));continue}n.set(a,c|("video"===o?s:Bx.Audio))}else n.set(a,"video"===o?s:Bx.Audio)}for(let t=e.length-1;t>=0;t--){let r=e[t],{user:i,mediaType:a}=r,o=Bx.Video|Bx.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,a)){await this._p2pChannel.unmuteRemoteNoLock(i,a);let r=n.get(i);n.set(i,"video"===a?r^o:r^Bx.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);let r=Dh(o=Array.from(n.entries())).call(o,((e,t)=>{let[n,r]=t;if(0===r)return e;let i={stream_id:n.uid,stream_type:r};return r&Bx.Audio&&(i.audio_ssrc=n._audioSSRC),r&Bx.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===Jx.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===Jx.VIDEO?t._rtxSsrcId:void 0}})));let n=new Map;if(r=r.filter((e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc)),r.length>0){let e=await this._gateway.subscribeAll(r,!0);((null===e||void 0===e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:a}=e;(r||i||a)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:a})}))}if(Array.from(n.entries()).length>0){let e=[];Array.from(n.entries()).forEach((t=>{let[n,r]=t,i=this.remoteUsers.find((e=>e.uid===n));if(i){let t;r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=Jx.VIDEO:r.audio_error_code&&(t=Jx.AUDIO),e.push({user:i,mediaType:t})}})),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(let e of i){let t=n.get(e.user.uid);if(t){let n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){let t=_M(n);ik.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new bx(fL.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;hk.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===Jx.VIDEO,audio:e.mediaType===Jx.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===Jx.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)})),ik.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null===t||void 0===t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(sa){throw await this._p2pChannel.massUnsubscribeNoLock(e),sa}}finally{a(),r()}}async unsubscribe(e,t,n){if(!(e instanceof ez)){let t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new bx(fL.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&gL(t,"mediaType",["audio","video"]),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((t=>t===e))){let t=new bx(fL.INVALID_REMOTE_USER,"user is not in the channel");throw ik.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}ik.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let r=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof sz)await this._p2pChannel.unsubscribe(e,t);else{let n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&XL(this._users,e),ik.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(aa){if(aa.code===fL.DISCONNECT_P2P)return void ik.warning("disconnecting p2p, abort unsubscribe request.");throw ik.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),aa.toString()),aa}finally{r()}}async _unsubscribeDataChannel(e,t){if(t&&EL(t,"id",0,65535,!0),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((t=>t===e))){let t=new bx(fL.INVALID_REMOTE_USER,"user is not in the channel");throw ik.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let n;if("number"==typeof t){let r=e._dataChannels.find((e=>e.id===t));r&&(n=[r])}else n=e._dataChannels;if(void 0===n){let n=new bx(fL.REMOTE_USER_IS_NOT_PUBLISHED);throw ik.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}ik.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n.map((e=>e.id))));try{let t=await this._p2pChannel.unsubscribeDataChannel(e,n);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),ik.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(r){if(r.code===fL.DISCONNECT_P2P)return void ik.warning("disconnecting p2p, abort unsubscribe request.");throw ik.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}}async massUnsubscribe(e){if(SL(e,"unsubscribeList"),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");ik.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null===t||void 0===t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];let t=new Map;for(let n=e.length-1;n>=0;n--){let{user:r,mediaType:i}=e[n];if(!r){let e=new bx(fL.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw ik.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}if(gL(i,"mediaType",["video","audio",void 0]),!this._users.find((e=>e===r))){ik.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}let a=Bx.Video|Bx.LwoVideo;if(t.has(r)){let o,s=t.get(r);switch(i){case"video":o=s&a;break;case"audio":o=s&Bx.Audio;break;default:o=s&(Bx.Audio|a)}if(o){ik.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,s|Bx.Audio):"video"===i&&t.set(r,s|a):t.set(r,s|Bx.Audio|a)}else i?"audio"===i?t.set(r,Bx.Audio):"video"===i&&t.set(r,a):t.set(r,Bx.Audio|a)}try{let t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),ik.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null===t||void 0===t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(na){if(na.code===fL.DISCONNECT_P2P)return void ik.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw ik.error("[".concat(this._clientId,"] massUnsubscribe error"),na.toString()),na}}async setLowStreamParameter(e){(function(e){if(!e)throw new mL(fL.INVALID_PARAMS);bL(e.width)||vL(e.width,"streamParameter.width"),bL(e.height)||vL(e.height,"streamParameter.height"),bL(e.framerate)||vL(e.framerate,"streamParameter.framerate"),bL(e.bitrate)||EL(e.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&ik.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),ik.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Zx.LocalVideoLowTrack)}async enableDualStream(){if(!Mj().supportDualStream)throw hk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new bx(fL.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new bx(fL.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(Bo){throw hk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),Bo}this._isDualStreamEnabled=!0,hk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),ik.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Zx.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(Bo){throw hk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),Bo}this._isDualStreamEnabled=!1,hk.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),ik.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){gL(e,"role",["audience","host"])}(e),t&&VL(t),"rtc"===this.mode||"p2p"===this.mode)throw ik.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new bx(fL.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new bx(fL.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new bx(fL.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,ik.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;let t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(yL(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new bx(fL.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,hk.setProxyServer(this._proxyServer),ik.setProxyServer(this._proxyServer),ik.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new bx(fL.INVALID_OPERATION,"You have already set the proxy")}if(FL(e))return this._turnServer={servers:e,mode:"original-manual"},void ik.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>jL(e))),this._turnServer={servers:e,mode:"manual"},ik.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"you should set license before join channel");if(yL(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new bx(fL.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,ik.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new bx(fL.INVALID_OPERATION,"You have already set the proxy");let t,n=[3,4,5];switch(void 0===e&&(e=3),e){case 1:case 2:throw new bx(fL.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new bx(fL.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,ik.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"Stop proxy server after leave channel");hk.setProxyServer(),ik.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",ik.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new bx(fL.INVALID_PARAMS,"accessPoints is required.");SL(e.accessPoints.serverList,"accessPoints.serverList"),yL(e.accessPoints.domain,"accessPoints.domain");let t=(e,t)=>{EL(e,t,0,65535,!0)},n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new bx(fL.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");VD("CLOSE_AFB_FOR_LOCAL_AP")&&(jD("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),jD("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,a=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),o=a.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,jD("WEBCS_DOMAIN",o),jD("WEBCS_DOMAIN_BACKUP_LIST",o),jD("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(SL(e.report.hostname,"report.hostname"),jD("EVENT_REPORT_DOMAIN",e.report.hostname[0]),jD("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(jD("EVENT_REPORT_DOMAIN",a[0]),jD("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),jD("STATS_COLLECTOR_PORT",s),e.report?jD("ENABLE_EVENT_REPORT",!0):jD("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(SL(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=a[0];let l=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),l=e.log.port),jD("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let d=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(SL(e.cds.hostname,"cds.hostname"),d=e.cds.hostname):d=a;let u=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),u=e.cds.port),jD("CDS_AP",d.map((e=>"".concat(e,":").concat(u)))),e.cds?jD("ENABLE_CONFIG_DISTRIBUTE",!0):jD("ENABLE_CONFIG_DISTRIBUTE",!1),ik.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(SL(e,"serverList"),yL(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new bx(fL.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,jD("WEBCS_DOMAIN",e),jD("WEBCS_DOMAIN_BACKUP_LIST",e),jD("GATEWAY_DOMAINS",[t]),jD("EVENT_REPORT_DOMAIN",e[0]),jD("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),jD("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),ik.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(gL(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(g0){throw ik.error("[".concat(this._clientId,"] set default remote video stream type error"),g0.toString()),g0}else ik.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){gL(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{let t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(na){throw ik.error("[".concat(this._clientId,"] set remote video stream type error"),na.toString()),na}ik.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){gL(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(na){throw ik.error("[".concat(this._clientId,"] set stream fallback option"),na.toString()),na}ik.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){(function(e){gL(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),yL(t,"secret");let i=["aes-128-gcm2","aes-256-gcm2"];if(_h(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new bx(fL.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new bx(fL.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(_L(r,"encryptDataStream"),!_h(i).call(i,e))throw new bx(fL.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||ik.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=iD(n))}async renewToken(e){if(yL(e,"token",1,2047),!this._key||!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let n=await this._renewTokenMutex.lock();try{if(VD("USE_NEW_TOKEN")){ik.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let t=await CH(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wD);ik.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else ik.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});ik.debug("[".concat(this._clientId,"] renewToken success"))}catch(yi){throw this._key=t,this._joinInfo.token=t,ik.error("[".concat(this._clientId,"] renewToken failed"),yi.toString()),yi}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?ik.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(BL.VOLUME_INDICATOR,e)}),VD("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new bx(fL.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new bx(fL.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new bx(fL.LIVE_STREAMING_TASK_CONFLICT);let n=t?wx.TRANSCODE:wx.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(wx.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new bx(fL.INVALID_PARAMS,"can not find live streaming url to stop");await hS.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){pz(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){pz(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){let t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&_h(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(e,t,n){var r;let i=Dh(r=Array.from(n)).call(r,((e,t)=>e+t),0),a={serverTs:0,seq:zD++,length:n.length,checkSum:i},o=new Uint8Array(ED(i,2)),s=new ArrayBuffer(qD),c=new DataView(s);c.setUint32(0,a.serverTs),c.setUint16(4,a.seq),c.setUint16(6,a.length),c.setUint16(8,a.checkSum);let l=16-n.length%16;n=oD(n,new Uint8Array(l));let d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:128,additionalData:o},t,n);return oD(new Uint8Array(s),new Uint8Array(d))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new bx(fL.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(gx.DATA_STREAM,{payload:iD(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-rK},!n)}sendMetadata(e){if(!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new bx(fL.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(gx.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:iD(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(ak),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"can not send custom report, not joined");await hk.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){gL(t.spatialLayer,"spatialLayer",[0,1,2,3]),gL(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(na){throw ik.error("[".concat(this._clientId,"] pick SVC layer failed"),na.toString()),na}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:n}=e;if(_L(t,"apRTM"),EL(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,ik.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(ik.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=RP.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&RK(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((e=>e._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new TD("client-publish"),this._subscribeMutex=new TD("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(t){}}_startSession(e,t){var n;let r=e||hD();e?ik.debug("[".concat(this._clientId,"] new Session ").concat(r)):ik.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));let i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;let a={lts:(new Date).getTime(),mode:this.mode,buildFormat:2,stringUid:(null===t||void 0===t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};hk.sessionInit(this._sessionId,JY({cname:t.channel,appid:t.appId},a)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new bx(fL.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&VD("FORCE_TURN")&&!VD("TURN_ENABLE_TCP")&&!VD("TURN_ENABLE_UDP"))throw new bx(fL.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");ik.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof sz){let e=(await r.next()).value;if(e){try{await this._gateway.sendExtensionMessage(lM.PUBLISH,e,!0)}catch(n){throw r.throw(n),n}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let n=(await r.next()).value;if(n){var t;let e;try{e=await this._gateway.publish(this._uid,n,!0)}catch(aa){if(aa.code!==fL.DISCONNECT_P2P)throw r.throw(aa),aa}await r.next((null===(t=e)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let t of e)t instanceof WG&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(na){if(this._p2pChannel.reportPublishEvent(!1,null===na||void 0===na?void 0:na.code,e),(null===na||void 0===na?void 0:na.code)===fL.WS_ABORT)return;throw na}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new bx(fL.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));ik.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(aa){if(aa.code!==fL.DISCONNECT_P2P)throw e.throw(aa),aa}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(na){if(this._p2pChannel.reportPublishEvent(!1,null===na||void 0===na?void 0:na.code,void 0,!0),(null===na||void 0===na?void 0:na.code)===fL.WS_ABORT)return;throw na}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new bx(fL.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},$z("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{hk.reportApiInvoke(this._sessionId,{name:DL.ON_LIVE_STREAM_ERROR,options:[e,t],tag:kL.TRACER}).onSuccess(),this.safeEmit(BL.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{hk.reportApiInvoke(this._sessionId,{name:DL.ON_LIVE_STREAM_WARNING,options:[e,t],tag:kL.TRACER}).onSuccess(),this.safeEmit(BL.LIVE_STREAMING_WARNING,e,t)},e.on(Px.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new bx(fL.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,n,r){let i=VD("UAP_AP").slice(0,VD("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await function(e,t,n,r,i){sH+=1;let a,o,s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:sH,requestId:sH,version:DD,cname:n.cname},c={service_name:t,json_body:JSON.stringify(s)},l=e[0];return AD((async()=>{a=Date.now();let e=await QW(l,{data:c,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(o=Date.now()-a,0!==e.code){let t=new bx(fL.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:o});throw ik.error(t.toString()),t}let n=JSON.parse(e.json_body);if(200!==n.code){let e=new bx(fL.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:o});throw ik.error(e.toString()),e}if(!n.servers||0===n.servers.length){let e=new bx(fL.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:o});throw ik.error(e.toString()),e}let i=function(e,t){return{addressList:e.servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(VD("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t)))),workerToken:e.workerToken,vid:e.vid}}(n,t);return VD("LIVE_STREAMING_ADDRESS")&&(i.addressList=VD("LIVE_STREAMING_ADDRESS")instanceof Array?VD("LIVE_STREAMING_ADDRESS"):[VD("LIVE_STREAMING_ADDRESS")]),oH(oH({},i),{},{responseTime:o})}),((r,i)=>(hk.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:o,serverIp:e[i%e.length]}),!1)),((r,i)=>(hk.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:o,serverIp:e[i%e.length]}),!!(r.code!==fL.OPERATION_ABORTED&&r.code!==fL.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(l=e[(i+1)%e.length],!0))),i)}(i,e,t,n,r)})(e,this._joinInfo,this._axiosCancelSource.token,wD).then(t).catch(n)})),e};return e===wx.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new bx(fL.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},$z("ChannelMediaRelay").create(e));r.on("state",(e=>{e===Mx.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(BL.CHANNEL_MEDIA_RELAY_STATE,e)})),r.on("event",(e=>{this.safeEmit(BL.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:n,deleted:r}=e,i=[];if(t){let e=[];this._users.forEach((t=>{t._dataChannels.forEach((r=>{n.every((e=>e.uid!==t._uintid||e.stream_id!==r.id))&&e.push({uid:t._uintid,stream_id:r.id,ordered:r.ordered,max_retrans_times:r.maxRetransmits,metadata:r.metadata})}))})),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(n)&&n.length>0&&n.forEach((e=>{let{uid:n,stream_id:r,ordered:a,max_retrans_times:o,metadata:s}=e,c=this._users.find((e=>e._uintid===n));if(c){if(ik.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),_h(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex((t=>t.id===e.stream_id))){let e={id:r,ordered:!!a,maxRetransmits:o,metadata:s},n=function(e){return eK(e,!0)}(e);c._dataChannels.push(n),ik.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(BL.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(ik.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch((e=>{ik.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())})))}else ik.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(BL.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((e=>{let{uid:t,stream_id:n}=e,r=this._users.find((e=>e._uintid===t));if(!r)return void ik.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let i=r._dataChannels.find((t=>t.id===e.stream_id));i&&(ik.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(r,[i]).then((e=>{if(r._dataChannels=r._dataChannels.filter((e=>e!==i)),e)return this._gateway.unsubscribeDataChannel(e,r.uid)})),ik.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(BL.USER_UNPUBLISHED,r,"datachannel",i._config))}))}_handleRemoveDataChannels(e){let t=this._users.find((t=>t.uid===e.uid));if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){ik.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let n=()=>{ik.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((e=>{this.safeEmit(BL.USER_UNPUBLISHED,t,"datachannel",e._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)})),n()}}else ik.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(jx.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(jx.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===UL.FALLBACK)return;let i=()=>{this.safeEmit(BL.CONNECTION_STATE_CHANGE,e,t,n)};if(hk.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:DL.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:kL.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),ik.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var a;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{ik.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{ik.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(a=this._joinInfo)||void 0===a?void 0:a.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{ik.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{ik.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{ik.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(ik.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,Jx.AUDIO,!1)),e._trust_video_mute_state_||(ik.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,Jx.VIDEO,!1)),e._trust_audio_enabled_state_||(ik.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(ik.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(ik.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(ik.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(ik.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3))}i()})),this._gateway.on(jx.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new bx(fL.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t,n=await TK(JY(JY({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,AK(n),this._joinInfo.preload=!0):(t=await EH(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wD,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);let r=[];t.gatewayInfo.gatewayAddrs.forEach((e=>{let{address:t}=e,[n,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:n,port:i}):r.push({host:n,port:i})})),e(r)}catch(na){t(na)}})),this._gateway.on(jx.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(BL.NETWORK_QUALITY,e)})),this._gateway.on(jx.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(BL.STREAM_TYPE_CHANGED,e,t),hk.reportApiInvoke(this._sessionId,{name:DL.STREAM_TYPE_CHANGE,options:[e,t],tag:kL.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.on(jx.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(jx.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{let n=await this._p2pChannel.getEstablishParams();VD("ENABLE_PREALLOC_PC")&&n||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(yi){n(yi)}})),this._gateway.on(jx.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let n=AW(e.ortc,t,e.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(n)})),this._gateway.on(jx.PRE_CONNECT_PC,(async e=>{let{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:e,cid:i}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(i,"_").concat(e),icePwd:"".concat(i,"_").concat(e)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(r=VD("FINGERPRINT"))&&void 0!==r?r:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(vx.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(vx.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(vx.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc))),this._gateway.signal.on(vx.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(vx.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(vx.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(vx.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(vx.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(vx.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Jx.AUDIO,!0))),this._gateway.signal.on(vx.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,Jx.AUDIO,!1))),this._gateway.signal.on(vx.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Jx.VIDEO,!0))),this._gateway.signal.on(vx.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,Jx.VIDEO,!1))),this._gateway.signal.on(vx.RECEIVE_METADATA,(e=>{let t=rD(e.metadata);this.safeEmit(BL.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(vx.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=rD(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&_h(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<qD)throw new bx(fL.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(qD));n=await async function(e,t,n){let r=n.subarray(0,qD),i=r.slice(8,qD),a=(i[0]<<8)+i[1],o=(r[6]<<8)+r[7],s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:128,additionalData:new Uint8Array(ED(a,2))},t,n.subarray(qD));return new Uint8Array(s).subarray(0,o)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){let t=this._p2pChannel.getStats(),n=this.remoteUsers.find((t=>t.uid===e.uid)),i=null===t||void 0===t?void 0:t.audioRecv.find((e=>e.ssrc===(null===n||void 0===n?void 0:n._audioSSRC)));r=null===i||void 0===i?void 0:i.jitterBufferMs}null==r&&(r=0),cK(JY(JY({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(vx.ON_CRYPT_ERROR,(()=>{nD((()=>{ik.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(BL.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(vx.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(vx.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{ik.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,UL.TOKEN_EXPIRE),this.safeEmit(BL.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(vx.ON_STREAM_FALLBACK_UPDATE,(e=>{ik.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(BL.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(vx.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),ik.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(vx.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(vx.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(_x.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case gx.PUBLISH:{if(!t)return;let e=t.ortc;if(e){var n,r;let i=e.some((e=>{let{stream_type:t}=e;return t===Fx.Audio})),a=e.some((e=>{let{stream_type:t}=e;return t!==Fx.Audio})),o=e.some((e=>{let{stream_type:t}=e;return t===Fx.Screen||t===Fx.ScreenLow}));"offer"===t.state&&hk.publish(this._joinInfo.sid,{eventElapse:OH.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:fL.TIMEOUT,audio:i,video:a,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:o,audioName:i?null===(n=e.find((e=>{let{stream_type:t}=e;return t===Fx.Audio})))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:a?null===(r=e.find((e=>{let{stream_type:t}=e;return t!==Fx.Audio})))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case gx.SUBSCRIBE:t&&hk.subscribe(this._joinInfo.sid,{succ:!1,ec:fL.TIMEOUT,audio:t.stream_type===Jx.AUDIO,video:t.stream_type===Jx.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:OH.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(vx.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(vx.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;VD("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!gk(e.string_id||e.stream_id,this.channelName))));let t=[],n=[];for(let r of e.users){let e=this._users.find((e=>e._uintid===r.stream_id));e?e._trust_in_room_=!0:(e=new ez(r.string_id||r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(BL.PUBLISHED_USER_LIST).length&&(ik.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(BL.USER_JOINED,e)));let i=Bx.Audio&r.stream_type,a=(Bx.Video|Bx.LwoVideo)&r.stream_type,o=0!=(65280&r.stream_type),s=i&&e.hasAudio,c=a&&e.hasVideo;a&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!s&&0===this.getListeners(BL.PUBLISHED_USER_LIST).length&&(ik.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(BL.USER_PUBLISHED,e,"audio")),a&&!c&&0===this.getListeners(BL.PUBLISHED_USER_LIST).length&&(ik.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(BL.USER_PUBLISHED,e,"video")),(i&&!s||a&&!c||o)&&t.push(e),a&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(ik.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{ik.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(BL.PUBLISHED_USER_LIST).length>0?VD("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(ik.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(BL.PUBLISHED_USER_LIST,t)):ik.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))})),this._gateway.signal.on(vx.ON_RTP_CAPABILITY_CHANGE,(e=>{let{video_codec:t}=e;this._p2pChannel instanceof Jz&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((e=>e.toLowerCase())).filter((e=>{var t;return _h(t=Object.keys(HD)).call(t,e)})))}))}_handleP2PEvents(){this._gateway.signal.on(vx.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(lM.PUBLISH,((e,t,n)=>{let{uid:r}=e;e.forEach((e=>{let{kind:i,ssrcs:a,mid:o,isMuted:s}=e;this._handleP2PAddAudioOrVideoStream(i,r,a[0].ssrcId,o);let c=this._users.find((e=>e.uid===r));return c&&this._p2pChannel instanceof sz?this._p2pChannel.mockSubscribe(c,i,a[0].ssrcId,o).then((()=>{t()})).catch(n):t(),this._handleMuteStream(r,i,!!s)}))})),this._gateway.signal.on(lM.CALL,(async(e,t,n)=>{if(this._p2pChannel instanceof sz)try{var r;t(await this._p2pChannel.startP2P({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},e))}catch(i){n(i)}})),this._gateway.signal.on(_x.P2P_CONNECTION,(async e=>{this._p2pChannel instanceof sz&&await this._p2pChannel.p2pConnect(e)})),this._gateway.signal.on(lM.UNPUBLISH,(async(e,t,n)=>{if(this._p2pChannel instanceof sz){let{unpubMsg:r,uid:i}=e,a=this._users.find((e=>e.uid===i));if(!a)return ik.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach((async e=>{let{stream_type:t}=e,n=t===Fx.Audio?Jx.AUDIO:Jx.VIDEO;await this._p2pChannel.unsubscribe(a,n),this._handleMuteStream(i,n,!0)})),t()}catch(oa){n(oa)}}})),this._gateway.signal.on(lM.CONTROL,(async(e,t)=>{let{action:n}=e;switch(n){case uM.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,Jx.VIDEO,!0);break;case uM.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,Jx.AUDIO,!0);break;case uM.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,Jx.VIDEO,!1);break;case uM.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,Jx.AUDIO,!1)}})),this._gateway.signal.on(lM.RESTART_ICE,(async(e,t,n)=>{if(this._p2pChannel instanceof sz)try{let{direction:n,iceParameter:r}=e;n!==yx.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(yi){n(yi)}})),this._gateway.signal.on(lM.CANDIDATE,(e=>{if(this._p2pChannel instanceof sz){let{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(eM.RequestP2PRestartICE,(async(e,t,n)=>{try{let{direction:n}=e;t(await this._gateway.sendExtensionMessage(lM.RESTART_ICE,e,n===yx.SEND_ONLY))}catch(yi){n(yi)}})),this._p2pChannel.on(eM.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(lM.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(eM.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(lM.CONTROL,e,!0),t()}catch(yi){n(yi)}})),this._p2pChannel.on(eM.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(yi){yi.code===fL.DISCONNECT_P2P?t():n(yi)}else t()})),this._p2pChannel.on(eM.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(yi){yi.code===fL.DISCONNECT_P2P?t():n(yi)}else t()})),this._p2pChannel.on(eM.StateChange,((e,t)=>{t===$x.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(eM.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(yi){yi.code===fL.DISCONNECT_P2P?t():n(yi)}else t()})),this._p2pChannel.on(eM.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(yi){yi.code===fL.DISCONNECT_P2P?t():n(yi)}else t()})),this._p2pChannel.on(eM.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(eM.RequestRePublishDataChannel,((e,t,n)=>{hS.all(e.map((async e=>{let t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach((e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)}))}catch(aa){if(aa.code!==fL.DISCONNECT_P2P)throw aa}}))).then(t).catch(n)})),this._p2pChannel.on(eM.RequestReSubscribe,(async(e,t,n)=>{try{for(let{user:t,kind:n}of e)n===Jx.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(yi){n(yi)}})),this._p2pChannel.on(eM.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(eM.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(eM.MediaReconnectStart,(e=>{this.safeEmit(BL.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(eM.MediaReconnectEnd,(e=>{this.safeEmit(BL.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(eM.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(eM.RequestRestartICE,(async e=>{if(this._p2pChannel instanceof sz)return;let t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;let r,i=n.value;try{r=await this._gateway.restartICE({iceParameters:i})}catch(oa){return void t.throw(oa)}let{iceParameters:a}=function(e){let t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(r);await t.next({remoteIceParameters:a})})),this._p2pChannel.on(eM.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(eM.RequestReconnectPC,(async()=>{var e;let{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),o=AW(i,a);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(eM.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(eM.P2PLost,(()=>{this.safeEmit(BL.P2P_LOST,this.store.uid)})),this._p2pChannel.on(eM.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(eM.ConnectionTypeChange,(e=>{this.safeEmit(BL.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(eM.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(eM.QueryClientConnectionState,(e=>{e(this.connectionState)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let n=(t={config:e},$z("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);let{appId:r,cname:i,sid:a,token:o,uid:s,cid:c,vid:l}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:a,token:o,uid:s,cid:c,vid:l?Number(l):0},wD)}catch(na){throw Array.isArray(na)?na[0]:na}var t}handleVideoInspectEvents(e){e.on(rM.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(BL.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===tM.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(BL.CONTENT_INSPECT_ERROR,new bx(fL.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(rM.INSPECT_RESULT,((e,t)=>{var n;if((null===t||void 0===t?void 0:t.code)===fL.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return ik.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(BL.CONTENT_INSPECT_RESULT,e,t)})),e.on(rM.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}async disableContentInspect(){if(!this._inspect)throw new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(Bo){throw Array.isArray(Bo)?Bo[0]:Bo}}async setImageModeration(e,t){if(_L(e,"enabled"),e){if(!t)throw new bx(fL.INVALID_PARAMS,"config is required");if(aY(t),!this._joinInfo)throw new bx(fL.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let e=(n={config:t},$z("ImageModeration").create(n));this._moderation=e,this.handleImageModerationEvents(e);let{appId:r,cname:i,sid:a,token:o,uid:s,cid:c,vid:l}=this._joinInfo;await e.init({appId:r,areaCode:"",cname:i,sid:a,token:o,uid:s,cid:c,vid:l?Number(l):0},wD)}}catch(yi){throw Array.isArray(yi)?yi[0]:yi}}else{var n;if(!this._moderation)throw new bx(fL.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(yi){throw Array.isArray(yi)?yi[0]:yi}}}handleImageModerationEvents(e){e.on(sM.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(BL.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===oM.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new bx(fL.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(sM.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}setP2PTransport(e){if(gL(e,"transport",["default","auto","relay","sd-rtn"]),"p2p"!==this.mode)throw new bx(fL.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,ik.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return ik.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){_L(e,"enabled"),jD("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},sx(zY.prototype,"leave",[oY],Object.getOwnPropertyDescriptor(zY.prototype,"leave"),zY.prototype),sx(zY.prototype,"publish",[sY],Object.getOwnPropertyDescriptor(zY.prototype,"publish"),zY.prototype),sx(zY.prototype,"unpublish",[cY],Object.getOwnPropertyDescriptor(zY.prototype,"unpublish"),zY.prototype),sx(zY.prototype,"subscribe",[lY],Object.getOwnPropertyDescriptor(zY.prototype,"subscribe"),zY.prototype),sx(zY.prototype,"presubscribe",[dY],Object.getOwnPropertyDescriptor(zY.prototype,"presubscribe"),zY.prototype),sx(zY.prototype,"massSubscribe",[uY],Object.getOwnPropertyDescriptor(zY.prototype,"massSubscribe"),zY.prototype),sx(zY.prototype,"unsubscribe",[hY],Object.getOwnPropertyDescriptor(zY.prototype,"unsubscribe"),zY.prototype),sx(zY.prototype,"massUnsubscribe",[pY],Object.getOwnPropertyDescriptor(zY.prototype,"massUnsubscribe"),zY.prototype),sx(zY.prototype,"setLowStreamParameter",[fY],Object.getOwnPropertyDescriptor(zY.prototype,"setLowStreamParameter"),zY.prototype),sx(zY.prototype,"enableDualStream",[mY],Object.getOwnPropertyDescriptor(zY.prototype,"enableDualStream"),zY.prototype),sx(zY.prototype,"disableDualStream",[_Y],Object.getOwnPropertyDescriptor(zY.prototype,"disableDualStream"),zY.prototype),sx(zY.prototype,"setClientRole",[gY],Object.getOwnPropertyDescriptor(zY.prototype,"setClientRole"),zY.prototype),sx(zY.prototype,"setProxyServer",[EY],Object.getOwnPropertyDescriptor(zY.prototype,"setProxyServer"),zY.prototype),sx(zY.prototype,"setTurnServer",[vY],Object.getOwnPropertyDescriptor(zY.prototype,"setTurnServer"),zY.prototype),sx(zY.prototype,"setLicense",[yY],Object.getOwnPropertyDescriptor(zY.prototype,"setLicense"),zY.prototype),sx(zY.prototype,"startProxyServer",[SY],Object.getOwnPropertyDescriptor(zY.prototype,"startProxyServer"),zY.prototype),sx(zY.prototype,"stopProxyServer",[bY],Object.getOwnPropertyDescriptor(zY.prototype,"stopProxyServer"),zY.prototype),sx(zY.prototype,"setLocalAccessPointsV2",[TY],Object.getOwnPropertyDescriptor(zY.prototype,"setLocalAccessPointsV2"),zY.prototype),sx(zY.prototype,"setLocalAccessPoints",[CY],Object.getOwnPropertyDescriptor(zY.prototype,"setLocalAccessPoints"),zY.prototype),sx(zY.prototype,"setRemoteDefaultVideoStreamType",[wY],Object.getOwnPropertyDescriptor(zY.prototype,"setRemoteDefaultVideoStreamType"),zY.prototype),sx(zY.prototype,"setRemoteVideoStreamType",[RY],Object.getOwnPropertyDescriptor(zY.prototype,"setRemoteVideoStreamType"),zY.prototype),sx(zY.prototype,"setStreamFallbackOption",[AY],Object.getOwnPropertyDescriptor(zY.prototype,"setStreamFallbackOption"),zY.prototype),sx(zY.prototype,"setEncryptionConfig",[IY],Object.getOwnPropertyDescriptor(zY.prototype,"setEncryptionConfig"),zY.prototype),sx(zY.prototype,"renewToken",[NY],Object.getOwnPropertyDescriptor(zY.prototype,"renewToken"),zY.prototype),sx(zY.prototype,"enableAudioVolumeIndicator",[OY],Object.getOwnPropertyDescriptor(zY.prototype,"enableAudioVolumeIndicator"),zY.prototype),sx(zY.prototype,"startLiveStreaming",[PY],Object.getOwnPropertyDescriptor(zY.prototype,"startLiveStreaming"),zY.prototype),sx(zY.prototype,"setLiveTranscoding",[LY],Object.getOwnPropertyDescriptor(zY.prototype,"setLiveTranscoding"),zY.prototype),sx(zY.prototype,"stopLiveStreaming",[DY],Object.getOwnPropertyDescriptor(zY.prototype,"stopLiveStreaming"),zY.prototype),sx(zY.prototype,"startChannelMediaRelay",[kY],Object.getOwnPropertyDescriptor(zY.prototype,"startChannelMediaRelay"),zY.prototype),sx(zY.prototype,"updateChannelMediaRelay",[xY],Object.getOwnPropertyDescriptor(zY.prototype,"updateChannelMediaRelay"),zY.prototype),sx(zY.prototype,"stopChannelMediaRelay",[MY],Object.getOwnPropertyDescriptor(zY.prototype,"stopChannelMediaRelay"),zY.prototype),sx(zY.prototype,"sendCustomReportMessage",[UY],Object.getOwnPropertyDescriptor(zY.prototype,"sendCustomReportMessage"),zY.prototype),sx(zY.prototype,"pickSVCLayer",[FY],Object.getOwnPropertyDescriptor(zY.prototype,"pickSVCLayer"),zY.prototype),sx(zY.prototype,"setRTMConfig",[jY],Object.getOwnPropertyDescriptor(zY.prototype,"setRTMConfig"),zY.prototype),sx(zY.prototype,"enableContentInspect",[VY],Object.getOwnPropertyDescriptor(zY.prototype,"enableContentInspect"),zY.prototype),sx(zY.prototype,"disableContentInspect",[BY],Object.getOwnPropertyDescriptor(zY.prototype,"disableContentInspect"),zY.prototype),sx(zY.prototype,"setImageModeration",[GY],Object.getOwnPropertyDescriptor(zY.prototype,"setImageModeration"),zY.prototype),sx(zY.prototype,"setP2PTransport",[WY],Object.getOwnPropertyDescriptor(zY.prototype,"setP2PTransport"),zY.prototype),sx(zY.prototype,"getJoinChannelServiceRecords",[HY],Object.getOwnPropertyDescriptor(zY.prototype,"getJoinChannelServiceRecords"),zY.prototype),sx(zY.prototype,"setPublishAudioFilterEnabled",[qY],Object.getOwnPropertyDescriptor(zY.prototype,"setPublishAudioFilterEnabled"),zY.prototype),zY),$Y=class e{constructor(t,n){SI(this,"id",0),SI(this,"element",void 0),SI(this,"peerPair",void 0),SI(this,"context",void 0),SI(this,"audioPlayerElement",void 0),SI(this,"audioTrack",void 0),e.count+=1,this.id=e.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{let t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;let e=async(e,t)=>{let n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new hS((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{let n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);let r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(yi){throw new bx(fL.LOCAL_AEC_ERROR,yi.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(r){throw new bx(fL.LOCAL_AEC_ERROR,r.toString()).print()}if(!t)throw new bx(fL.LOCAL_AEC_ERROR,"no dest node when local aec").print();let n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){ik.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}};SI($Y,"count",0);var eJ=window.AudioContext||window.webkitAudioContext,tJ=new(XY=uk({report:hk}),sx((QY=class{constructor(){SI(this,"units",[]),SI(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return ik.debug("the system does not need to process local aec"),-1;this.context||(this.context=new eJ);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new $Y(e,this.context),this.units.push(t)),t.startEchoCancellation(),ik.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return UP().name!==DP.SAFARI}}).prototype,"processExternalMediaAEC",[XY],Object.getOwnPropertyDescriptor(QY.prototype,"processExternalMediaAEC"),QY.prototype),QY);function nJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rJ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nJ(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nJ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var iJ=window||document;function aJ(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!iJ)return;let n=S$._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);let r=e=>{if(!(e&&e.blockedURI&&(S$.onSecurityPolicyViolation||S$.getListeners(aM.SECURITY_POLICY_VIOLATION).length>0)))return;let t=e.blockedURI;VD("CSP_DETECTED_HOSTNAME_LIST").some((e=>_h(t).call(t,e)))&&(S$.onSecurityPolicyViolation&&"function"==typeof S$.onSecurityPolicyViolation&&S$.onSecurityPolicyViolation(e),S$.getListeners(aM.SECURITY_POLICY_VIOLATION).length>0&&S$.safeEmit(aM.SECURITY_POLICY_VIOLATION,e))};n&&iJ.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||S$.getListeners(aM.SECURITY_POLICY_VIOLATION).length>0)&&iJ.addEventListener("securitypolicyviolation",r),S$._cspEventHandlerPointer=r}var oJ=tc,sJ=tO,cJ=RegExp.prototype,lJ=Ks((function(e){return e===cJ||oJ(cJ,e)?sJ(e):e.flags}));function dJ(e){let t=e.length;for(;--t>=0;)e[t]=0}var uJ=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),hJ=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),pJ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),fJ=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mJ=new Array(576);dJ(mJ);var _J=new Array(60);dJ(_J);var gJ=new Array(512);dJ(gJ);var EJ=new Array(256);dJ(EJ);var vJ=new Array(29);dJ(vJ);var yJ,SJ,bJ,TJ=new Array(30);function CJ(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function wJ(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}dJ(TJ);var RJ=e=>e<256?gJ[e]:gJ[256+(e>>>7)],AJ=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},IJ=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,AJ(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},NJ=(e,t,n)=>{IJ(e,n[2*t],n[2*t+1])},OJ=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},PJ=(e,t,n)=>{let r,i,a=new Array(16),o=0;for(r=1;r<=15;r++)o=o+n[r-1]<<1,a[r]=o;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=OJ(a[t]++,t))}},LJ=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},DJ=e=>{e.bi_valid>8?AJ(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},kJ=(e,t,n,r)=>{let i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},xJ=(e,t,n)=>{let r=e.heap[n],i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&kJ(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!kJ(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},MJ=(e,t,n)=>{let r,i,a,o,s=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+s++],r+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],0===r?NJ(e,i,t):(a=EJ[i],NJ(e,a+256+1,t),o=uJ[a],0!==o&&(i-=vJ[a],IJ(e,i,o)),r--,a=RJ(r),NJ(e,a,n),o=hJ[a],0!==o&&(r-=TJ[a],IJ(e,r,o)))}while(s<e.sym_next);NJ(e,256,t)},UJ=(e,t)=>{let n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==a[2*n]?(e.heap[++e.heap_len]=l=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)i=e.heap[++e.heap_len]=l<2?++l:0,a[2*i]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=l,n=e.heap_len>>1;n>=1;n--)xJ(e,a,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],xJ(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,xJ(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{let n,r,i,a,o,s,c=t.dyn_tree,l=t.max_code,d=t.stat_desc.static_tree,u=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(a=0;a<=15;a++)e.bl_count[a]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)r=e.heap[n],a=c[2*c[2*r+1]+1]+1,a>f&&(a=f,m++),c[2*r+1]=a,r>l||(e.bl_count[a]++,o=0,r>=p&&(o=h[r-p]),s=c[2*r],e.opt_len+=s*(a+o),u&&(e.static_len+=s*(d[2*r+1]+o)));if(0!==m){do{for(a=f-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(a=f;0!==a;a--)for(r=e.bl_count[a];0!==r;)i=e.heap[--n],i>l||(c[2*i+1]!==a&&(e.opt_len+=(a-c[2*i+1])*c[2*i],c[2*i+1]=a),r--)}})(e,t),PJ(a,l,e.bl_count)},FJ=(e,t,n)=>{let r,i,a=-1,o=t[1],s=0,c=7,l=4;for(0===o&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<c&&i===o||(s<l?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,a=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4))},jJ=(e,t,n)=>{let r,i,a=-1,o=t[1],s=0,c=7,l=4;for(0===o&&(c=138,l=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<c&&i===o)){if(s<l)do{NJ(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(NJ(e,i,e.bl_tree),s--),NJ(e,16,e.bl_tree),IJ(e,s-3,2)):s<=10?(NJ(e,17,e.bl_tree),IJ(e,s-3,3)):(NJ(e,18,e.bl_tree),IJ(e,s-11,7));s=0,a=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4)}},VJ=!1,BJ=(e,t,n,r)=>{IJ(e,0+(r?1:0),3),DJ(e),AJ(e,n),AJ(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},GJ={_tr_init:e=>{VJ||((()=>{let e,t,n,r,i,a=new Array(16);for(n=0,r=0;r<28;r++)for(vJ[r]=n,e=0;e<1<<uJ[r];e++)EJ[n++]=r;for(EJ[n-1]=r,i=0,r=0;r<16;r++)for(TJ[r]=i,e=0;e<1<<hJ[r];e++)gJ[i++]=r;for(i>>=7;r<30;r++)for(TJ[r]=i<<7,e=0;e<1<<hJ[r]-7;e++)gJ[256+i++]=r;for(t=0;t<=15;t++)a[t]=0;for(e=0;e<=143;)mJ[2*e+1]=8,e++,a[8]++;for(;e<=255;)mJ[2*e+1]=9,e++,a[9]++;for(;e<=279;)mJ[2*e+1]=7,e++,a[7]++;for(;e<=287;)mJ[2*e+1]=8,e++,a[8]++;for(PJ(mJ,287,a),e=0;e<30;e++)_J[2*e+1]=5,_J[2*e]=OJ(e,5);yJ=new CJ(mJ,uJ,257,286,15),SJ=new CJ(_J,hJ,0,30,15),bJ=new CJ(new Array(0),pJ,0,19,7)})(),VJ=!0),e.l_desc=new wJ(e.dyn_ltree,yJ),e.d_desc=new wJ(e.dyn_dtree,SJ),e.bl_desc=new wJ(e.bl_tree,bJ),e.bi_buf=0,e.bi_valid=0,LJ(e)},_tr_stored_block:BJ,_tr_flush_block:(e,t,n,r)=>{let i,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),UJ(e,e.l_desc),UJ(e,e.d_desc),o=(e=>{let t;for(FJ(e,e.dyn_ltree,e.l_desc.max_code),FJ(e,e.dyn_dtree,e.d_desc.max_code),UJ(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*fJ[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?BJ(e,t,n,r):4===e.strategy||a===i?(IJ(e,2+(r?1:0),3),MJ(e,mJ,_J)):(IJ(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(IJ(e,t-257,5),IJ(e,n-1,5),IJ(e,r-4,4),i=0;i<r;i++)IJ(e,e.bl_tree[2*fJ[i]+1],3);jJ(e,e.dyn_ltree,t-1),jJ(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),MJ(e,e.dyn_ltree,e.dyn_dtree)),LJ(e),r&&DJ(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(EJ[n]+256+1)]++,e.dyn_dtree[2*RJ(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{var t;IJ(e,2,3),NJ(e,256,mJ),16===(t=e).bi_valid?(AJ(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},WJ=(e,t,n,r)=>{let i=65535&e,a=e>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{i=i+t[r++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16},HJ=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})()),qJ=(e,t,n,r)=>{let i=HJ,a=r+n;e^=-1;for(let o=r;o<a;o++)e=e>>>8^i[255&(e^t[o])];return~e},zJ={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},KJ={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:YJ,_tr_stored_block:JJ,_tr_flush_block:XJ,_tr_tally:QJ,_tr_align:ZJ}=GJ,{Z_NO_FLUSH:$J,Z_PARTIAL_FLUSH:eX,Z_FULL_FLUSH:tX,Z_FINISH:nX,Z_BLOCK:rX,Z_OK:iX,Z_STREAM_END:aX,Z_STREAM_ERROR:oX,Z_DATA_ERROR:sX,Z_BUF_ERROR:cX,Z_DEFAULT_COMPRESSION:lX,Z_FILTERED:dX,Z_HUFFMAN_ONLY:uX,Z_RLE:hX,Z_FIXED:pX,Z_DEFAULT_STRATEGY:fX,Z_UNKNOWN:mX,Z_DEFLATED:_X}=KJ,gX=258,EX=262,vX=42,yX=113,SX=666,bX=(e,t)=>(e.msg=zJ[t],t),TX=e=>2*e-(e>4?9:0),CX=e=>{let t=e.length;for(;--t>=0;)e[t]=0},wX=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)},RX=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,AX=e=>{let t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},IX=(e,t)=>{XJ(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,AX(e.strm)},NX=(e,t)=>{e.pending_buf[e.pending++]=t},OX=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},PX=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=WJ(e.adler,t,i,n):2===e.state.wrap&&(e.adler=qJ(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},LX=(e,t)=>{let n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-EX?e.strstart-(e.w_size-EX):0,l=e.window,d=e.w_mask,u=e.prev,h=e.strstart+gX,p=l[a+o-1],f=l[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(n=t,l[n+o]===f&&l[n+o-1]===p&&l[n]===l[a]&&l[++n]===l[a+1]){a+=2,n++;do{}while(l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&l[++a]===l[++n]&&a<h);if(r=gX-(h-a),a=h-gX,r>o){if(e.match_start=t,o=r,r>=s)break;p=l[a+o-1],f=l[a+o]}}}while((t=u[t&d])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead},DX=e=>{let t,n,r,i=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-EX)&&(e.window.set(e.window.subarray(i,i+i-n),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),wX(e),n+=i),0===e.strm.avail_in)break;if(t=PX(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=RX(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=RX(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<EX&&0!==e.strm.avail_in)},kX=(e,t)=>{let n,r,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==nX||t===$J||n!==r+e.strm.avail_in)))break;o=t===nX&&n===r+e.strm.avail_in?1:0,JJ(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,AX(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(PX(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==$J&&t!==nX&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(PX(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=a||(r||t===nX)&&t!==$J&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,o=t===nX&&0===e.strm.avail_in&&n===r?1:0,JJ(e,e.block_start,n,o),e.block_start+=n,AX(e.strm)),o?3:1)},xX=(e,t)=>{let n,r;for(;;){if(e.lookahead<EX){if(DX(e),e.lookahead<EX&&t===$J)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=RX(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-EX&&(e.match_length=LX(e,n)),e.match_length>=3)if(r=QJ(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=RX(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=RX(e,e.ins_h,e.window[e.strstart+1]);else r=QJ(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(IX(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===nX?(IX(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(IX(e,!1),0===e.strm.avail_out)?1:2},MX=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<EX){if(DX(e),e.lookahead<EX&&t===$J)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=RX(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-EX&&(e.match_length=LX(e,n),e.match_length<=5&&(e.strategy===dX||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=QJ(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=RX(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(IX(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=QJ(e,0,e.window[e.strstart-1]),r&&IX(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=QJ(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===nX?(IX(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(IX(e,!1),0===e.strm.avail_out)?1:2};function UX(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var FX=[new UX(0,0,0,0,kX),new UX(4,4,8,4,xX),new UX(4,5,16,8,xX),new UX(4,6,32,32,xX),new UX(4,4,16,16,MX),new UX(8,16,32,32,MX),new UX(8,16,128,128,MX),new UX(8,32,128,256,MX),new UX(32,128,258,1024,MX),new UX(32,258,258,4096,MX)];function jX(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_X,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),CX(this.dyn_ltree),CX(this.dyn_dtree),CX(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),CX(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),CX(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var VX=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==vX&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==yX&&t.status!==SX?1:0},BX=e=>{if(VX(e))return bX(e,oX);e.total_in=e.total_out=0,e.data_type=mX;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?vX:yX,e.adler=2===t.wrap?0:1,t.last_flush=-2,YJ(t),iX},GX=e=>{let t=BX(e);return t===iX&&(e=>{e.window_size=2*e.w_size,CX(e.head),e.max_lazy_match=FX[e.level].max_lazy,e.good_match=FX[e.level].good_length,e.nice_match=FX[e.level].nice_length,e.max_chain_length=FX[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},WX=(e,t,n,r,i,a)=>{if(!e)return oX;let o=1;if(t===lX&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==_X||r<8||r>15||t<0||t>9||a<0||a>pX||8===r&&1!==o)return bX(e,oX);8===r&&(r=9);let s=new jX;return e.state=s,s.strm=e,s.status=vX,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=a,s.method=n,GX(e)},HX=WX,qX=(e,t)=>VX(e)||2!==e.state.wrap?oX:(e.state.gzhead=t,iX),zX=(e,t)=>{if(VX(e)||t>rX||t<0)return e?bX(e,oX):oX;let n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===SX&&t!==nX)return bX(e,0===e.avail_out?cX:oX);let r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(AX(e),0===e.avail_out)return n.last_flush=-1,iX}else if(0===e.avail_in&&TX(t)<=TX(r)&&t!==nX)return bX(e,cX);if(n.status===SX&&0!==e.avail_in)return bX(e,cX);if(n.status===vX&&0===n.wrap&&(n.status=yX),n.status===vX){let t=_X+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=uX||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,OX(n,t),0!==n.strstart&&(OX(n,e.adler>>>16),OX(n,65535&e.adler)),e.adler=1,n.status=yX,AX(e),0!==n.pending)return n.last_flush=-1,iX}if(57===n.status)if(e.adler=0,NX(n,31),NX(n,139),NX(n,8),n.gzhead)NX(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),NX(n,255&n.gzhead.time),NX(n,n.gzhead.time>>8&255),NX(n,n.gzhead.time>>16&255),NX(n,n.gzhead.time>>24&255),NX(n,9===n.level?2:n.strategy>=uX||n.level<2?4:0),NX(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(NX(n,255&n.gzhead.extra.length),NX(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=qJ(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(NX(n,0),NX(n,0),NX(n,0),NX(n,0),NX(n,0),NX(n,9===n.level?2:n.strategy>=uX||n.level<2?4:0),NX(n,3),n.status=yX,AX(e),0!==n.pending)return n.last_flush=-1,iX;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=qJ(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,AX(e),0!==n.pending)return n.last_flush=-1,iX;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=qJ(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=qJ(e.adler,n.pending_buf,n.pending-r,r)),AX(e),0!==n.pending)return n.last_flush=-1,iX;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,NX(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=qJ(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=qJ(e.adler,n.pending_buf,n.pending-r,r)),AX(e),0!==n.pending)return n.last_flush=-1,iX;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,NX(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=qJ(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(AX(e),0!==n.pending))return n.last_flush=-1,iX;NX(n,255&e.adler),NX(n,e.adler>>8&255),e.adler=0}if(n.status=yX,AX(e),0!==n.pending)return n.last_flush=-1,iX}if(0!==e.avail_in||0!==n.lookahead||t!==$J&&n.status!==SX){let r=0===n.level?kX(n,t):n.strategy===uX?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(DX(e),0===e.lookahead)){if(t===$J)return 1;break}if(e.match_length=0,n=QJ(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(IX(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===nX?(IX(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(IX(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===hX?((e,t)=>{let n,r,i,a,o=e.window;for(;;){if(e.lookahead<=gX){if(DX(e),e.lookahead<=gX&&t===$J)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){a=e.strstart+gX;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=gX-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=QJ(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=QJ(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(IX(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===nX?(IX(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(IX(e,!1),0===e.strm.avail_out)?1:2})(n,t):FX[n.level].func(n,t);if(3!==r&&4!==r||(n.status=SX),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),iX;if(2===r&&(t===eX?ZJ(n):t!==rX&&(JJ(n,0,0,!1),t===tX&&(CX(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),AX(e),0===e.avail_out))return n.last_flush=-1,iX}return t!==nX?iX:n.wrap<=0?aX:(2===n.wrap?(NX(n,255&e.adler),NX(n,e.adler>>8&255),NX(n,e.adler>>16&255),NX(n,e.adler>>24&255),NX(n,255&e.total_in),NX(n,e.total_in>>8&255),NX(n,e.total_in>>16&255),NX(n,e.total_in>>24&255)):(OX(n,e.adler>>>16),OX(n,65535&e.adler)),AX(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?iX:aX)},KX=e=>{if(VX(e))return oX;let t=e.state.status;return e.state=null,t===yX?bX(e,sX):iX},YX=(e,t)=>{let n=t.length;if(VX(e))return oX;let r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==vX||r.lookahead)return oX;if(1===i&&(e.adler=WJ(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(CX(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}let a=e.avail_in,o=e.next_in,s=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,DX(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=RX(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,DX(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=s,e.avail_in=a,r.wrap=i,iX},JX=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),XX=function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(let t in n)JX(n,t)&&(e[t]=n[t])}}return e},QX=e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;let n=new Uint8Array(t);for(let r=0,i=0,a=e.length;r<a;r++){let t=e[r];n.set(t,i),i+=t.length}return n},ZX=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(y0){ZX=!1}var $X=new Uint8Array(256);for(let S0=0;S0<256;S0++)$X[S0]=S0>=252?6:S0>=248?5:S0>=240?4:S0>=224?3:S0>=192?2:1;$X[254]=$X[254]=1;var eQ=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<o&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<o&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},tQ=(e,t)=>{let n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i,a=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){a[i++]=t;continue}let o=$X[t];if(o>4)a[i++]=65533,r+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&r<n;)t=t<<6|63&e[r++],o--;o>1?a[i++]=65533:t<65536?a[i++]=t:(t-=65536,a[i++]=55296|t>>10&1023,a[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&ZX)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(a,i)},nQ=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+$X[e[n]]>t?n:t},rQ=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},iQ=Object.prototype.toString,{Z_NO_FLUSH:aQ,Z_SYNC_FLUSH:oQ,Z_FULL_FLUSH:sQ,Z_FINISH:cQ,Z_OK:lQ,Z_STREAM_END:dQ,Z_DEFAULT_COMPRESSION:uQ,Z_DEFAULT_STRATEGY:hQ,Z_DEFLATED:pQ}=KJ;function fQ(e){this.options=XX({level:uQ,method:pQ,chunkSize:16384,windowBits:15,memLevel:8,strategy:hQ},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rQ,this.strm.avail_out=0;let n=HX(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==lQ)throw new Error(zJ[n]);if(t.header&&qX(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?eQ(t.dictionary):"[object ArrayBuffer]"===iQ.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=YX(this.strm,e),n!==lQ)throw new Error(zJ[n]);this._dict_set=!0}}function mQ(e,t){let n=new fQ(t);if(n.push(e,!0),n.err)throw n.msg||zJ[n.err];return n.result}fQ.prototype.push=function(e,t){let n,r,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?cQ:aQ,"string"==typeof e?i.input=eQ(e):"[object ArrayBuffer]"===iQ.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(r===oQ||r===sQ)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(n=zX(i,r),n===dQ)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=KX(this.strm),this.onEnd(n),this.ended=!0,n===lQ;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},fQ.prototype.onData=function(e){this.chunks.push(e)},fQ.prototype.onEnd=function(e){e===lQ&&(this.result=QX(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var _Q={Deflate:fQ,deflate:mQ,deflateRaw:function(e,t){return(t=t||{}).raw=!0,mQ(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,mQ(e,t)},constants:KJ},gQ=16209,EQ=function(e,t){let n,r,i,a,o,s,c,l,d,u,h,p,f,m,_,g,E,v,y,S,b,T,C,w,R=e.state;n=e.next_in,C=e.input,r=n+(e.avail_in-5),i=e.next_out,w=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),s=R.dmax,c=R.wsize,l=R.whave,d=R.wnext,u=R.window,h=R.hold,p=R.bits,f=R.lencode,m=R.distcode,_=(1<<R.lenbits)-1,g=(1<<R.distbits)-1;e:do{p<15&&(h+=C[n++]<<p,p+=8,h+=C[n++]<<p,p+=8),E=f[h&_];t:for(;;){if(v=E>>>24,h>>>=v,p-=v,v=E>>>16&255,0===v)w[i++]=65535&E;else{if(!(16&v)){if(!(64&v)){E=f[(65535&E)+(h&(1<<v)-1)];continue t}if(32&v){R.mode=16191;break e}e.msg="invalid literal/length code",R.mode=gQ;break e}y=65535&E,v&=15,v&&(p<v&&(h+=C[n++]<<p,p+=8),y+=h&(1<<v)-1,h>>>=v,p-=v),p<15&&(h+=C[n++]<<p,p+=8,h+=C[n++]<<p,p+=8),E=m[h&g];n:for(;;){if(v=E>>>24,h>>>=v,p-=v,v=E>>>16&255,!(16&v)){if(!(64&v)){E=m[(65535&E)+(h&(1<<v)-1)];continue n}e.msg="invalid distance code",R.mode=gQ;break e}if(S=65535&E,v&=15,p<v&&(h+=C[n++]<<p,p+=8,p<v&&(h+=C[n++]<<p,p+=8)),S+=h&(1<<v)-1,S>s){e.msg="invalid distance too far back",R.mode=gQ;break e}if(h>>>=v,p-=v,v=i-a,S>v){if(v=S-v,v>l&&R.sane){e.msg="invalid distance too far back",R.mode=gQ;break e}if(b=0,T=u,0===d){if(b+=c-v,v<y){y-=v;do{w[i++]=u[b++]}while(--v);b=i-S,T=w}}else if(d<v){if(b+=c+d-v,v-=d,v<y){y-=v;do{w[i++]=u[b++]}while(--v);if(b=0,d<y){v=d,y-=v;do{w[i++]=u[b++]}while(--v);b=i-S,T=w}}}else if(b+=d-v,v<y){y-=v;do{w[i++]=u[b++]}while(--v);b=i-S,T=w}for(;y>2;)w[i++]=T[b++],w[i++]=T[b++],w[i++]=T[b++],y-=3;y&&(w[i++]=T[b++],y>1&&(w[i++]=T[b++]))}else{b=i-S;do{w[i++]=w[b++],w[i++]=w[b++],w[i++]=w[b++],y-=3}while(y>2);y&&(w[i++]=w[b++],y>1&&(w[i++]=w[b++]))}break}}break}}while(n<r&&i<o);y=p>>3,n-=y,p-=y<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<o?o-i+257:257-(i-o),R.hold=h,R.bits=p},vQ=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),yQ=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),SQ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bQ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),TQ=(e,t,n,r,i,a,o,s)=>{let c,l,d,u,h,p,f,m,_,g=s.bits,E=0,v=0,y=0,S=0,b=0,T=0,C=0,w=0,R=0,A=0,I=null,N=new Uint16Array(16),O=new Uint16Array(16),P=null;for(E=0;E<=15;E++)N[E]=0;for(v=0;v<r;v++)N[t[n+v]]++;for(b=g,S=15;S>=1&&0===N[S];S--);if(b>S&&(b=S),0===S)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(y=1;y<S&&0===N[y];y++);for(b<y&&(b=y),w=1,E=1;E<=15;E++)if(w<<=1,w-=N[E],w<0)return-1;if(w>0&&(0===e||1!==S))return-1;for(O[1]=0,E=1;E<15;E++)O[E+1]=O[E]+N[E];for(v=0;v<r;v++)0!==t[n+v]&&(o[O[t[n+v]]++]=v);if(0===e?(I=P=o,p=20):1===e?(I=vQ,P=yQ,p=257):(I=SQ,P=bQ,p=0),A=0,v=0,E=y,h=a,T=b,C=0,d=-1,R=1<<b,u=R-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){f=E-C,o[v]+1<p?(m=0,_=o[v]):o[v]>=p?(m=P[o[v]-p],_=I[o[v]-p]):(m=96,_=0),c=1<<E-C,l=1<<T,y=l;do{l-=c,i[h+(A>>C)+l]=f<<24|m<<16|_}while(0!==l);for(c=1<<E-1;A&c;)c>>=1;if(0!==c?(A&=c-1,A+=c):A=0,v++,0==--N[E]){if(E===S)break;E=t[n+o[v]]}if(E>b&&(A&u)!==d){for(0===C&&(C=b),h+=y,T=E-C,w=1<<T;T+C<S&&(w-=N[T+C],!(w<=0));)T++,w<<=1;if(R+=1<<T,1===e&&R>852||2===e&&R>592)return 1;d=A&u,i[d]=b<<24|T<<16|h-a}}return 0!==A&&(i[h+A]=E-C<<24|64<<16),s.bits=b,0},{Z_FINISH:CQ,Z_BLOCK:wQ,Z_TREES:RQ,Z_OK:AQ,Z_STREAM_END:IQ,Z_NEED_DICT:NQ,Z_STREAM_ERROR:OQ,Z_DATA_ERROR:PQ,Z_MEM_ERROR:LQ,Z_BUF_ERROR:DQ,Z_DEFLATED:kQ}=KJ,xQ=16180,MQ=16190,UQ=16191,FQ=16192,jQ=16194,VQ=16199,BQ=16200,GQ=16206,WQ=16209,HQ=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function qQ(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var zQ,KQ,YQ=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<xQ||t.mode>16211?1:0},JQ=e=>{if(YQ(e))return OQ;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=xQ,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,AQ},XQ=e=>{if(YQ(e))return OQ;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,JQ(e)},QQ=(e,t)=>{let n;if(YQ(e))return OQ;let r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?OQ:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,XQ(e))},ZQ=(e,t)=>{if(!e)return OQ;let n=new qQ;e.state=n,n.strm=e,n.window=null,n.mode=xQ;let r=QQ(e,t);return r!==AQ&&(e.state=null),r},$Q=!0,eZ=e=>{if($Q){zQ=new Int32Array(512),KQ=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(TQ(1,e.lens,0,288,zQ,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;TQ(2,e.lens,0,32,KQ,0,e.work,{bits:5}),$Q=!1}e.lencode=zQ,e.lenbits=9,e.distcode=KQ,e.distbits=5},tZ=(e,t,n,r)=>{let i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),(r-=i)?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},nZ=XQ,rZ=ZQ,iZ=(e,t)=>{let n,r,i,a,o,s,c,l,d,u,h,p,f,m,_,g,E,v,y,S,b,T,C,w,R=0,A=new Uint8Array(4),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(YQ(e)||!e.output||!e.input&&0!==e.avail_in)return OQ;n=e.state,n.mode===UQ&&(n.mode=FQ),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,l=n.hold,d=n.bits,u=s,h=c,T=AQ;e:for(;;)switch(n.mode){case xQ:if(0===n.wrap){n.mode=FQ;break}for(;d<16;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,A[0]=255&l,A[1]=l>>>8&255,n.check=qJ(n.check,A,2,0),l=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=WQ;break}if((15&l)!==kQ){e.msg="unknown compression method",n.mode=WQ;break}if(l>>>=4,d-=4,b=8+(15&l),0===n.wbits&&(n.wbits=b),b>15||b>n.wbits){e.msg="invalid window size",n.mode=WQ;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?16189:UQ,l=0,d=0;break;case 16181:for(;d<16;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(n.flags=l,(255&lJ(n))!==kQ){e.msg="unknown compression method",n.mode=WQ;break}if(57344&lJ(n)){e.msg="unknown header flags set",n.mode=WQ;break}n.head&&(n.head.text=l>>8&1),512&lJ(n)&&4&n.wrap&&(A[0]=255&l,A[1]=l>>>8&255,n.check=qJ(n.check,A,2,0)),l=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}n.head&&(n.head.time=l),512&lJ(n)&&4&n.wrap&&(A[0]=255&l,A[1]=l>>>8&255,A[2]=l>>>16&255,A[3]=l>>>24&255,n.check=qJ(n.check,A,4,0)),l=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&lJ(n)&&4&n.wrap&&(A[0]=255&l,A[1]=l>>>8&255,n.check=qJ(n.check,A,2,0)),l=0,d=0,n.mode=16184;case 16184:if(1024&lJ(n)){for(;d<16;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}n.length=l,n.head&&(n.head.extra_len=l),512&lJ(n)&&4&n.wrap&&(A[0]=255&l,A[1]=l>>>8&255,n.check=qJ(n.check,A,2,0)),l=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&lJ(n)&&(p=n.length,p>s&&(p=s),p&&(n.head&&(b=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+p),b)),512&lJ(n)&&4&n.wrap&&(n.check=qJ(n.check,r,p,a)),s-=p,a+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&lJ(n)){if(0===s)break e;p=0;do{b=r[a+p++],n.head&&b&&n.length<65536&&(n.head.name+=String.fromCharCode(b))}while(b&&p<s);if(512&lJ(n)&&4&n.wrap&&(n.check=qJ(n.check,r,p,a)),s-=p,a+=p,b)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&lJ(n)){if(0===s)break e;p=0;do{b=r[a+p++],n.head&&b&&n.length<65536&&(n.head.comment+=String.fromCharCode(b))}while(b&&p<s);if(512&lJ(n)&&4&n.wrap&&(n.check=qJ(n.check,r,p,a)),s-=p,a+=p,b)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&lJ(n)){for(;d<16;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=WQ;break}l=0,d=0}n.head&&(n.head.hcrc=lJ(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=UQ;break;case 16189:for(;d<32;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}e.adler=n.check=HQ(l),l=0,d=0,n.mode=MQ;case MQ:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=d,NQ;e.adler=n.check=1,n.mode=UQ;case UQ:if(t===wQ||t===RQ)break e;case FQ:if(n.last){l>>>=7&d,d-=7&d,n.mode=GQ;break}for(;d<3;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}switch(n.last=1&l,l>>>=1,d-=1,3&l){case 0:n.mode=16193;break;case 1:if(eZ(n),n.mode=VQ,t===RQ){l>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=WQ}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=WQ;break}if(n.length=65535&l,l=0,d=0,n.mode=jQ,t===RQ)break e;case jQ:n.mode=16195;case 16195:if(p=n.length,p){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;i.set(r.subarray(a,a+p),o),s-=p,a+=p,c-=p,o+=p,n.length-=p;break}n.mode=UQ;break;case 16196:for(;d<14;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(n.nlen=257+(31&l),l>>>=5,d-=5,n.ndist=1+(31&l),l>>>=5,d-=5,n.ncode=4+(15&l),l>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=WQ;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}n.lens[I[n.have++]]=7&l,l>>>=3,d-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},T=TQ(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,T){e.msg="invalid code lengths set",n.mode=WQ;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;R=n.lencode[l&(1<<n.lenbits)-1],_=R>>>24,g=R>>>16&255,E=65535&R,!(_<=d);){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(E<16)l>>>=_,d-=_,n.lens[n.have++]=E;else{if(16===E){for(w=_+2;d<w;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(l>>>=_,d-=_,0===n.have){e.msg="invalid bit length repeat",n.mode=WQ;break}b=n.lens[n.have-1],p=3+(3&l),l>>>=2,d-=2}else if(17===E){for(w=_+3;d<w;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}l>>>=_,d-=_,b=0,p=3+(7&l),l>>>=3,d-=3}else{for(w=_+7;d<w;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}l>>>=_,d-=_,b=0,p=11+(127&l),l>>>=7,d-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=WQ;break}for(;p--;)n.lens[n.have++]=b}}if(n.mode===WQ)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=WQ;break}if(n.lenbits=9,C={bits:n.lenbits},T=TQ(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,T){e.msg="invalid literal/lengths set",n.mode=WQ;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},T=TQ(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,T){e.msg="invalid distances set",n.mode=WQ;break}if(n.mode=VQ,t===RQ)break e;case VQ:n.mode=BQ;case BQ:if(s>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=d,EQ(e,h),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,l=n.hold,d=n.bits,n.mode===UQ&&(n.back=-1);break}for(n.back=0;R=n.lencode[l&(1<<n.lenbits)-1],_=R>>>24,g=R>>>16&255,E=65535&R,!(_<=d);){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(g&&!(240&g)){for(v=_,y=g,S=E;R=n.lencode[S+((l&(1<<v+y)-1)>>v)],_=R>>>24,g=R>>>16&255,E=65535&R,!(v+_<=d);){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}l>>>=v,d-=v,n.back+=v}if(l>>>=_,d-=_,n.back+=_,n.length=E,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=UQ;break}if(64&g){e.msg="invalid literal/length code",n.mode=WQ;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(w=n.extra;d<w;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;R=n.distcode[l&(1<<n.distbits)-1],_=R>>>24,g=R>>>16&255,E=65535&R,!(_<=d);){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(!(240&g)){for(v=_,y=g,S=E;R=n.distcode[S+((l&(1<<v+y)-1)>>v)],_=R>>>24,g=R>>>16&255,E=65535&R,!(v+_<=d);){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}l>>>=v,d-=v,n.back+=v}if(l>>>=_,d-=_,n.back+=_,64&g){e.msg="invalid distance code",n.mode=WQ;break}n.offset=E,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(w=n.extra;d<w;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=WQ;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=WQ;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=i,f=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[o++]=m[f++]}while(--p);0===n.length&&(n.mode=BQ);break;case 16205:if(0===c)break e;i[o++]=n.length,c--,n.mode=BQ;break;case GQ:if(n.wrap){for(;d<32;){if(0===s)break e;s--,l|=r[a++]<<d,d+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=lJ(n)?qJ(n.check,i,h,o-h):WJ(n.check,i,h,o-h)),h=c,4&n.wrap&&(lJ(n)?l:HQ(l))!==n.check){e.msg="incorrect data check",n.mode=WQ;break}l=0,d=0}n.mode=16207;case 16207:if(n.wrap&&lJ(n)){for(;d<32;){if(0===s)break e;s--,l+=r[a++]<<d,d+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=WQ;break}l=0,d=0}n.mode=16208;case 16208:T=IQ;break e;case WQ:T=PQ;break e;case 16210:return LQ;default:return OQ}return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=d,(n.wsize||h!==e.avail_out&&n.mode<WQ&&(n.mode<GQ||t!==CQ))&&tZ(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=lJ(n)?qJ(n.check,i,h,e.next_out-h):WJ(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===UQ?128:0)+(n.mode===VQ||n.mode===jQ?256:0),(0===u&&0===h||t===CQ)&&T===AQ&&(T=DQ),T},aZ=e=>{if(YQ(e))return OQ;let t=e.state;return t.window&&(t.window=null),e.state=null,AQ},oZ=(e,t)=>{if(YQ(e))return OQ;let n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,AQ):OQ},sZ=(e,t)=>{let n,r,i,a=t.length;return YQ(e)?OQ:(n=e.state,0!==n.wrap&&n.mode!==MQ?OQ:n.mode===MQ&&(r=1,r=WJ(r,t,a,0),r!==n.check)?PQ:(i=tZ(e,t,a,a),i?(n.mode=16210,LQ):(n.havedict=1,AQ)))},cZ=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},lZ=Object.prototype.toString,{Z_NO_FLUSH:dZ,Z_FINISH:uZ,Z_OK:hZ,Z_STREAM_END:pZ,Z_NEED_DICT:fZ,Z_STREAM_ERROR:mZ,Z_DATA_ERROR:_Z,Z_MEM_ERROR:gZ}=KJ;function EZ(e){this.options=XX({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new rQ,this.strm.avail_out=0;let n=rZ(this.strm,t.windowBits);if(n!==hZ)throw new Error(zJ[n]);if(this.header=new cZ,oZ(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=eQ(t.dictionary):"[object ArrayBuffer]"===lZ.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=sZ(this.strm,t.dictionary),n!==hZ)))throw new Error(zJ[n])}function vZ(e,t){let n=new EZ(t);if(n.push(e),n.err)throw n.msg||zJ[n.err];return n.result}EZ.prototype.push=function(e,t){let n,r,i,a=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?uZ:dZ,"[object ArrayBuffer]"===lZ.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(o),a.next_out=0,a.avail_out=o),n=iZ(a,r),n===fZ&&s&&(n=sZ(a,s),n===hZ?n=iZ(a,r):n===_Z&&(n=fZ));a.avail_in>0&&n===pZ&&a.state.wrap>0&&0!==e[a.next_in];)nZ(a),n=iZ(a,r);switch(n){case mZ:case _Z:case fZ:case gZ:return this.onEnd(n),this.ended=!0,!1}if(i=a.avail_out,a.next_out&&(0===a.avail_out||n===pZ))if("string"===this.options.to){let e=nQ(a.output,a.next_out),t=a.next_out-e,n=tQ(a.output,e);a.next_out=t,a.avail_out=o-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(n)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==hZ||0!==i){if(n===pZ)return n=aZ(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},EZ.prototype.onData=function(e){this.chunks.push(e)},EZ.prototype.onEnd=function(e){e===hZ&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=QX(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var yZ={Inflate:EZ,inflate:vZ,inflateRaw:function(e,t){return(t=t||{}).raw=!0,vZ(e,t)},ungzip:vZ,constants:KJ},{Deflate:SZ,deflate:bZ,deflateRaw:TZ,gzip:CZ}=_Q,{Inflate:wZ,inflate:RZ,inflateRaw:AZ,ungzip:IZ}=yZ,NZ=bZ,OZ=RZ,PZ=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(PZ||{}),LZ=class{constructor(){SI(this,"_sequence",0),SI(this,"_startTime",Date.now()),SI(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){let t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let n=new Uint8Array(4);n.set([1,0,0,0]);let r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;VD("SHOW_DATASTREAM2_LOG")&&ik.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));let n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n),a=0;if(i.setUint16(a,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),a+=2,i.setUint32(a,t.commonPacketHeader.sequence,!0),a+=4,i.setUint16(a,t.commonStreamHeader,!0),a+=2,t.extension){let e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),a),a+=e.byteLength}if(r.set(new Uint8Array(t.payload),a),a+=t.payload.byteLength,a!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);let t=new DataView(e),n=0,r=t.getUint16(n,!0);n+=2;let i,a,o={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};if(n+=4,VD("SHOW_DATASTREAM2_LOG")&&ik.debug("receive data header: ".concat(JSON.stringify(o))),t.getUint16(n,!0),n+=2,o.extension){a=this.deserializeExtension(e.slice(n)),n+=2+a.length,i=e.slice(n);let t=!1;if(a.datas.length>0){let e=a.datas.find((e=>0===e.id));e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}i=t?this.decompress(i):i}else i=e.slice(8);return i}serializeExtension(e){let{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),a=new Uint8Array(i),o=new DataView(i),s=0;if(o.setUint8(s++,t),o.setUint8(s++,n),r.forEach((e=>{t?(o.setUint8(s++,e.id),o.setUint8(s++,e.length),a.set(new Uint8Array(e.data),s),s+=e.data.byteLength):(o.setUint8(s++,e.id|e.length<<4),a.set(new Uint8Array(e.data),s),s+=e.data.byteLength)})),s!==n+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(n+2));return i}deserializeExtension(e){let t=new DataView(e),n=0,r=t.getUint8(n);n++;let i=t.getUint8(n);n++;let a=r===PZ.TWO_BYTE,o=[],s=new DataView(e,2),c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);a?(e=s.getUint8(c),c++,t=s.getUint8(c),c++):(e=15&s.getUint8(c),t=s.getUint8(c)>>4,c++),t>0&&(n=s.buffer.slice(c+2,c+2+t),c+=n.byteLength),o.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:o}}decompress(e){return OZ(new Uint8Array(e))}compress(e){return NZ(new Uint8Array(e))}},DZ={name:"DataStream",create:(e,t)=>{let n=t?new lW(e):new dW(e);return n.useDataStream(new LZ),n}},kZ=class extends OL{constructor(e,t,n){super(),SI(this,"ws",void 0),SI(this,"requestId",1),SI(this,"heartBeatTimer",void 0),SI(this,"joinInfo",void 0),SI(this,"clientId",void 0),SI(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),SI(this,"onClose",(e=>{this.emit("close"),this.dispose()})),SI(this,"onMessage",(e=>{let t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new OM("cross-channel-".concat(this.clientId),n),this.ws.on(Sx.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(Sx.CONNECTED,this.onOpen),this.ws.on(Sx.ON_MESSAGE,this.onMessage),this.ws.on(Sx.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new hS(((t,n)=>{let r=window.setTimeout((()=>{n(new bx(fL.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new bx(fL.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new bx(fL.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new bx(fL.WS_DISCONNECT);"connected"!==this.ws.state&&await(()=>new hS(((e,t)=>{this.ws.once(Sx.CLOSED,(()=>t(new bx(fL.WS_ABORT)))),this.ws.once(Sx.CONNECTED,e)})))();let t=this.sendMessage(e),n=new hS(((e,n)=>{let r=()=>{n(new bx(fL.WS_ABORT))};this.ws.once(Sx.RECONNECTING,r),this.ws.once(Sx.CLOSED,r),this.once("req_".concat(t),e),dD(3e3).then((()=>{this.removeAllListeners("req_".concat(t)),this.ws.off(Sx.RECONNECTING,r),this.ws.off(Sx.CLOSED,r),n(new bx(fL.TIMEOUT,"cross channel ws request timeout"))}))})),r=await n;if(!r||200!==r.code)throw new bx(fL.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(r)));return r}async connect(e){this.ws.removeAllListeners(Sx.REQUEST_NEW_URLS),this.ws.on(Sx.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}},xZ=class extends OL{set state(e){e!==this._state&&(e!==Mx.RELAY_STATE_FAILURE&&(this.errorCode=Ux.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),SI(this,"joinInfo",void 0),SI(this,"sid",void 0),SI(this,"clientId",void 0),SI(this,"cancelToken",RP.CancelToken.source()),SI(this,"workerToken",void 0),SI(this,"requestId",0),SI(this,"signal",void 0),SI(this,"prevChannelMediaConfig",void 0),SI(this,"httpRetryConfig",void 0),SI(this,"_resolution",void 0),SI(this,"_state",Mx.RELAY_STATE_IDLE),SI(this,"errorCode",Ux.RELAY_OK),SI(this,"onStatus",(e=>{ik.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",xx.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",xx.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=Ux.SRC_TOKEN_EXPIRED,this.state=Mx.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=Ux.DEST_TOKEN_EXPIRED,this.state=Mx.RELAY_STATE_FAILURE))})),SI(this,"onReconnect",(async()=>{ik.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",xx.NETWORK_DISCONNECTED),this.state=Mx.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==Mx.RELAY_STATE_IDLE&&(ik.error("auto restart channel media relay failed",e.toString()),this.errorCode=Ux.SERVER_CONNECTION_LOST,this.state=Mx.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=hD(),this.signal=new kZ(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==Mx.RELAY_STATE_IDLE)throw new bx(fL.INVALID_OPERATION);this.state=Mx.RELAY_STATE_CONNECTING,await this.connect(),ik.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(na){throw na.data&&na.data.serverResponse&&"SetSourceChannel"===na.data.serverResponse.command?new bx(fL.CROSS_CHANNEL_FAILED_JOIN_SRC):na.data&&na.data.serverResponse&&"SetDestChannelStatus"===na.serverResponse.command?new bx(fL.CROSS_CHANNEL_FAILED_JOIN_DEST):na.data&&na.data.serverResponse&&"StartPacketTransfer"===na.serverResponse.command?new bx(fL.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):na}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Mx.RELAY_STATE_RUNNING)throw new bx(fL.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Mx.RELAY_STATE_RUNNING)throw new bx(fL.INVALID_OPERATION);let t=this.genMessage(kx.SetVideoProfile);await this.signal.request(t),ik.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),ik.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Mx.RELAY_STATE_IDLE,this.dispose()}dispose(){ik.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=RP.CancelToken.source(),this.state=Mx.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await async function(e,t,n){let r=VD("UAP_AP").slice(0,VD("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))),i=r.map((r=>function(e,t,n,r){let i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:DD,cname:t.cname,uid:t.uid.toString(),requestId:cH,seq:cH};cH+=1;let a={service_name:"tele_channel",json_body:JSON.stringify(i)};return AD((async()=>{let t=await QW(e,{data:a,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){let e=new bx(fL.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw ik.error(e.toString()),e}let r=JSON.parse(t.json_body);if(200!==r.code){let e=new bx(fL.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw ik.error(e.toString()),e}if(!r.servers||0===r.servers.length){let e=new bx(fL.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw ik.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(VD("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(VD("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==fL.OPERATION_ABORTED&&e.code!==fL.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{let e=await mH(i);return i.forEach((e=>e.cancel())),e}catch(aa){throw aa[0]}}(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",xx.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let t=this.genMessage(kx.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),ik.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let n=this.genMessage(kx.SetSdkProfile,e);await this.signal.request(n),ik.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let r=this.genMessage(kx.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",xx.PACKET_JOINED_SRC_CHANNEL),ik.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let i=this.genMessage(kx.SetSourceUserId,e);await this.signal.request(i),ik.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let a=this.genMessage(kx.SetDestChannel,e);await this.signal.request(a),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",xx.PACKET_JOINED_DEST_CHANNEL),ik.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let o=this.genMessage(kx.StartPacketTransfer,e);await this.signal.request(o),this.emit("event",xx.PACKET_SENT_TO_DEST_CHANNEL),this.state=Mx.RELAY_STATE_RUNNING,ik.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let t=this.genMessage(kx.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",xx.PACKET_UPDATE_DEST_CHANNEL),ik.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(kx.StopPacketTransfer);await this.signal.request(e),ik.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let n=[],r=[],i=[];this.requestId+=1;let a={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:DD,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.22.0"===a.sdkVersion&&(a.sdkVersion="0.0.1");let o=null,s=null;switch(e){case kx.SetSdkProfile:return a.clientRequest={command:"SetSdkProfile",type:"multi_channel"},a;case kx.SetSourceChannel:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new bx(fL.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},a;case kx.SetSourceUserId:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new bx(fL.UNEXPECTED_ERROR,"can not find source config");return a.clientRequest={command:"SetSourceUserId",uid:s.uid+""},a;case kx.SetDestChannel:if(o=t&&t.getDestChannelMediaInfo(),!o)throw new bx(fL.UNEXPECTED_ERROR,"can not find dest config");return o.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),a.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},a;case kx.StartPacketTransfer:return a.clientRequest={command:"StartPacketTransfer"},a;case kx.Reconnect:return a.clientRequest={command:"Reconnect"},a;case kx.StopPacketTransfer:return a.clientRequest={command:"StopPacketTransfer"},a;case kx.UpdateDestChannel:if(o=t&&t.getDestChannelMediaInfo(),!o)throw new bx(fL.UNEXPECTED_ERROR,"can not find dest config");return o.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),a.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},a;case kx.SetVideoProfile:a.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return a}},MZ={name:"ChannelMediaRelay",create:function(e){return new xZ(e.joinInfo,e.clientId,e.websocketRetryConfig||wD,e.httpRetryConfig||wD,e.resolution)}};function UZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function FZ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?UZ(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UZ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var jZ=class extends OL{constructor(e,t,n,r){super(),SI(this,"spec",void 0),SI(this,"token",void 0),SI(this,"websocket",void 0),SI(this,"pingpongTimer",void 0),SI(this,"reconnectMode","retry"),SI(this,"serviceMode",void 0),SI(this,"reqId",0),SI(this,"commandReqId",0),SI(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),SI(this,"handleWebSocketMessage",(e=>{if(!e.data)return;let t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(hk.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===wx.TRANSCODE?1:2}),this.emit(Ox.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new OM("live-streaming",n),this.websocket.on(Sx.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Sx.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Sx.REQUEST_NEW_URLS,((e,t)=>{qL(this,Ox.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(Sx.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);let i=this.commandReqId,a=this.reqId;if(!a||!this.websocket)throw new bx(fL.UNEXPECTED_ERROR);let o=FZ({command:e,sdkVersion:"4.22.0"===DD?"0.0.1":DD,seq:a,requestId:a,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new bx(fL.WS_DISCONNECT);let s=()=>new hS(((e,t)=>{this.websocket.once(Sx.CLOSED,(()=>t(new bx(fL.WS_ABORT)))),this.websocket.once(Sx.CONNECTED,e)}));"connected"!==this.websocket.state&&await s(),o.clientRequest&&(o.clientRequest.workerToken=this.token);let c=new hS(((e,t)=>{let n=()=>{t(new bx(fL.WS_ABORT))};this.websocket.once(Sx.RECONNECTING,n),this.websocket.once(Sx.CLOSED,n),this.once("@".concat(a,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&hk.workerEvent(this.spec.sid,FZ(FZ({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));let l=Date.now();this.websocket.sendMessage(o);let d=null;try{d=await c}catch(la){if("closed"===this.websocket.state)throw la;return await s(),await this.request(e,t,n)}return r&&hk.workerEvent(this.spec.sid,FZ(FZ({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(d.serverResponse),serverCode:d.code,success:200===d.code,responseTime:Date.now()-l})),200!==d.code&&this.handleResponseError(d),d}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e="4.22.0"===DD?"0.0.1":DD;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Lx.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void ik.warning("live stream response already exists stream");case Lx.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Lx.LIVE_STREAM_RESPONSE_BAD_STREAM:case Lx.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new bx(fL.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Lx.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new bx(fL.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Lx.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new bx(fL.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Lx.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t=new bx(fL.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ox.WARNING,t,e.serverResponse.url)}case Lx.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t=new bx(fL.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ox.WARNING,t,e.serverResponse.url)}case Lx.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new bx(fL.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Lx.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new bx(fL.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Lx.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t=new bx(fL.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ox.WARNING,t,e.serverResponse.url)}case Lx.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new bx(fL.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Lx.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new bx(fL.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Lx.LIVE_STREAM_RESPONSE_WORKER_LOST:case Lx.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new bx(fL.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Lx.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new bx(fL.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new bx(fL.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Lx.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Lx.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Lx.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Lx.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new bx(fL.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(pD)}),6e3)}};function VZ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function BZ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VZ(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VZ(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var GZ=class extends OL{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wD,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:wD;super(),SI(this,"onLiveStreamWarning",void 0),SI(this,"onLiveStreamError",void 0),SI(this,"spec",void 0),SI(this,"retryTimeout",1e4),SI(this,"connection",void 0),SI(this,"httpRetryConfig",void 0),SI(this,"wsRetryConfig",void 0),SI(this,"streamingTasks",new Map),SI(this,"isStartingStreamingTask",!1),SI(this,"taskMutex",new TD("live-streaming")),SI(this,"cancelToken",RP.CancelToken.source()),SI(this,"transcodingConfig",void 0),SI(this,"uapResponse",void 0),SI(this,"lastTaskId",1),SI(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){let t=BZ(BZ({},Nx),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(ik.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>BZ(BZ(BZ({},Rx),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),function(e){bL(e.width)||EL(e.width,"config.width",0,1e4),bL(e.height)||EL(e.height,"config.height",0,1e4),bL(e.videoBitrate)||EL(e.videoBitrate,"config.videoBitrate",1,1e6),bL(e.videoFrameRate)||EL(e.videoFrameRate,"config.videoFrameRate"),bL(e.lowLatency)||_L(e.lowLatency,"config.lowLatency"),bL(e.audioSampleRate)||gL(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),bL(e.audioBitrate)||EL(e.audioBitrate,"config.audioBitrate",1,128),bL(e.audioChannels)||gL(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),bL(e.videoGop)||EL(e.videoGop,"config.videoGop"),bL(e.videoCodecProfile)||gL(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),bL(e.userCount)||EL(e.userCount,"config.userCount",0,17),bL(e.backgroundColor)||EL(e.backgroundColor,"config.backgroundColor",0,16777215),bL(e.userConfigExtraInfo)||yL(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!bL(e.transcodingUsers)&&(SL(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach(((e,t)=>{Cx(e.uid),bL(e.x)||EL(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),bL(e.y)||EL(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),bL(e.width)||EL(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),bL(e.height)||EL(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),bL(e.zOrder)||EL(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),bL(e.alpha)||EL(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),bL(e.watermark)||Ix(e.watermark,"watermark"),bL(e.backgroundImage)||Ix(e.backgroundImage,"backgroundImage"),e.images&&!bL(e.images)&&(SL(e.images,"config.images"),e.images.forEach(((e,t)=>{Ix(e,"images[".concat(t,"]"))})))}(t);let n=[];t.images&&n.push(...t.images.map((e=>BZ(BZ(BZ({},Ax),e),{},{zOrder:255})))),t.backgroundImage&&(n.push(BZ(BZ(BZ({},Ax),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(BZ(BZ(BZ({},Ax),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>BZ({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);let r=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?hS.resolve(e.uid):yH(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await hS.all(r)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var i;let e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from($M(i=this.streamingTasks).call(i)).map((e=>e.taskId)).join("#")});ik.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(oa){if(!oa.data||!oa.data.retry)throw oa;oa.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((t=>{ik.warning("[".concat(this.spec.clientId,"] live streaming receive error"),oa.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,oa).then((()=>{ik.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((e=>{ik.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}))}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===wx.TRANSCODE)throw new bx(fL.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};ik.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));let i=await this.taskMutex.lock();if(!this.connection&&n)return void i();if(this.streamingTasks.get(e)&&!n)return i(),new bx(fL.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(ia){throw i(),ia}if(t===wx.TRANSCODE)r.transcodingConfig=BZ({},this.transcodingConfig);this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let a=this.lastTaskId++;try{let o=new hS(((t,r)=>{dD(this.retryTimeout).then((()=>{if(n)return r(n);let t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),s=await hS.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===wx.TRANSCODE?1:2,requestByUser:!n,tid:a.toString()}),o]);this.isStartingStreamingTask=!1,ik.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:a}),i()}catch(ia){if(i(),this.isStartingStreamingTask=!1,!ia.data||!ia.data.retry||n)throw ia;return ia.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,ia)):await this.startLiveStreamingTask(e,t,ia)}}stopLiveStreamingTask(e){return new hS(((t,n)=>{let r=this.streamingTasks.get(e);if(!r||!this.connection)return new bx(fL.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let i=r.mode;r.abortTask=()=>{ik.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===wx.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{ik.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()})).catch(n)}))}resetAllTask(){var e;let t=Array.from($M(e=this.streamingTasks).call(e));this.terminate();for(let n of t)this.startLiveStreamingTask(n.url,n.mode).catch((e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=RP.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new bx(fL.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await qL(this,Px.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new jZ(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Ox.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on(Ox.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on(Ox.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new bx(fL.UNEXPECTED_ERROR,"can not get new live streaming address list"));qL(this,Px.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){let t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case Lx.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Lx.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Lx.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Lx.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let r=new bx(fL.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return ik.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case Lx.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let e=new bx(fL.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case Lx.LIVE_STREAM_RESPONSE_WORKER_LOST:case Lx.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();let t=Array.from($M(i=this.streamingTasks).call(i));for(let n of t)n.abortTask?n.abortTask():(ik.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new bx(fL.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{ik.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{ik.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}hasUrl(e){return this.streamingTasks.has(e)}},WZ={name:"LiveStreaming",create:function(e){return new GZ(e.joinInfo,e.websocketRetryConfig||wD,e.httpRetryConfig||wD)}};function HZ(e){let t={};e:for(;!n$(e);){let n=h$(e);switch(n>>>3){case 0:break e;case 1:t.requestId=a$(e,h$(e));break;case 2:t.requestType=h$(e)>>>0;break;case 3:t.scorePorn=d$(e);break;case 4:t.scoreSexy=d$(e);break;case 5:t.scoreNeutral=d$(e);break;case 6:t.requestScene=h$(e)>>>0;break;case 7:t.scene=h$(e)>>>0;break;default:KZ(e,7&n)}}return t}function qZ(e,t){let n=e.service;void 0!==n&&(p$(t,8),p$(t,n));let r=e.vendor;void 0!==r&&(p$(t,16),p$(t,r));let i=e.token;void 0!==i&&(p$(t,26),o$(t,i));let a=e.callbackUrl;void 0!==a&&(p$(t,34),o$(t,a))}function zZ(e){let t=h$(e),n=e.limit;return e.limit=e.offset+t,n}function KZ(e,t){switch(t){case 0:for(;128&c$(e););break;case 2:t$(e,h$(e));break;case 5:t$(e,4);break;case 1:t$(e,8);break;default:throw new Error("Unimplemented type: "+t)}}var YZ=new Float32Array(1);new Uint8Array(YZ.buffer);var JZ=new Float64Array(1),XZ=new Uint8Array(JZ.buffer);function QZ(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var ZZ=[];function $Z(){let e=ZZ.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function e$(e){ZZ.push(e)}function t$(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function n$(e){return e.offset>=e.limit}function r$(e,t){let n=e.bytes,r=e.offset,i=e.limit,a=r+t;if(a>n.length){let t=new Uint8Array(2*a);t.set(n),e.bytes=t}return e.offset=a,a>i&&(e.limit=a),r}function i$(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function a$(e,t){let n=i$(e,t),r=String.fromCharCode,i=e.bytes,a="\ufffd",o="";for(let s=0;s<t;s++){let e,c,l,d,u=i[s+n];128&u?192==(224&u)?s+1>=t?o+=a:(e=i[s+n+1],128!=(192&e)?o+=a:(d=(31&u)<<6|63&e,d<128?o+=a:(o+=r(d),s++))):224==(240&u)?s+2>=t?o+=a:(e=i[s+n+1],c=i[s+n+2],32896!=(49344&(e|c<<8))?o+=a:(d=(15&u)<<12|(63&e)<<6|63&c,d<2048||d>=55296&&d<=57343?o+=a:(o+=r(d),s+=2))):240==(248&u)?s+3>=t?o+=a:(e=i[s+n+1],c=i[s+n+2],l=i[s+n+3],8421504!=(12632256&(e|c<<8|l<<16))?o+=a:(d=(7&u)<<18|(63&e)<<12|(63&c)<<6|63&l,d<65536||d>1114111?o+=a:(d-=65536,o+=r(55296+(d>>10),56320+(1023&d)),s+=3))):o+=a:o+=r(u)}return o}function o$(e,t){let n=t.length,r=0;for(let o=0;o<n;o++){let e=t.charCodeAt(o);e>=55296&&e<=56319&&o+1<n&&(e=(e<<10)+t.charCodeAt(++o)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}p$(e,r);let i=r$(e,r),a=e.bytes;for(let o=0;o<n;o++){let e=t.charCodeAt(o);e>=55296&&e<=56319&&o+1<n&&(e=(e<<10)+t.charCodeAt(++o)-56613888),e<128?a[i++]=e:(e<2048?a[i++]=e>>6&31|192:(e<65536?a[i++]=e>>12&15|224:(a[i++]=e>>18&7|240,a[i++]=e>>12&63|128),a[i++]=e>>6&63|128),a[i++]=63&e|128)}}function s$(e,t){let n=r$(e,t.limit),r=e.bytes,i=t.bytes;for(let a=0,o=t.limit;a<o;a++)r[a+n]=i[a]}function c$(e){return e.bytes[i$(e,1)]}function l$(e,t){let n=r$(e,1);e.bytes[n]=t}function d$(e){let t=i$(e,8),n=e.bytes;return XZ[0]=n[t++],XZ[1]=n[t++],XZ[2]=n[t++],XZ[3]=n[t++],XZ[4]=n[t++],XZ[5]=n[t++],XZ[6]=n[t++],XZ[7]=n[t++],JZ[0]}function u$(e,t){let n=r$(e,8),r=e.bytes;JZ[0]=t,r[n++]=XZ[0],r[n++]=XZ[1],r[n++]=XZ[2],r[n++]=XZ[3],r[n++]=XZ[4],r[n++]=XZ[5],r[n++]=XZ[6],r[n++]=XZ[7]}function h$(e){let t,n=0,r=0;do{t=c$(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function p$(e,t){for(t>>>=0;t>=128;)l$(e,127&t|128),t>>>=7;l$(e,t)}function f$(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,a=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=r$(e,a),s=e.bytes;switch(a){case 10:s[o+9]=i>>>7&1;case 9:s[o+8]=9!==a?128|i:127&i;case 8:s[o+7]=8!==a?r>>>21|128:r>>>21&127;case 7:s[o+6]=7!==a?r>>>14|128:r>>>14&127;case 6:s[o+5]=6!==a?r>>>7|128:r>>>7&127;case 5:s[o+4]=5!==a?128|r:127&r;case 4:s[o+3]=4!==a?n>>>21|128:n>>>21&127;case 3:s[o+2]=3!==a?n>>>14|128:n>>>14&127;case 2:s[o+1]=2!==a?n>>>7|128:n>>>7&127;case 1:s[o]=1!==a?128|n:127&n}}function m$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var _$=new Map([["moderation",1],["supervise",2]]);function g$(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var E$=class extends OL{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(rM.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Dh(t=e.map((e=>_$.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),SI(this,"name","AgoraRTCVideoContentInspect"),SI(this,"_connectionState",tM.CONNECTING),SI(this,"_innerConnectionState",void 0),SI(this,"sequence",0),SI(this,"inspectStartTime",void 0),SI(this,"workerManagerConnection",void 0),SI(this,"workerConnection",void 0),SI(this,"workerMessageLengthLimit",void 0),SI(this,"inspectIntervalMinimum",void 0),SI(this,"qualityRatio",void 0),SI(this,"_connectInfo",void 0),SI(this,"_cancelTokenSource",RP.CancelToken.source()),SI(this,"_retryConfig",void 0),SI(this,"wmSequence",0),SI(this,"inspectInterval",void 0),SI(this,"inspectTimer",null),SI(this,"ossFilePrefix",void 0),SI(this,"extraInfo",void 0),SI(this,"_inspectType",void 0),SI(this,"_inspectMode",void 0),SI(this,"_quality",1),SI(this,"qualityTimer",null),SI(this,"_inspectId",void 0),SI(this,"_needWorkUrlOnly",!1),SI(this,"inspectImage",(()=>{if(this.connectionState!==tM.CONNECTED)throw new bx(fL.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===tM.CONNECTED?this.requestToInspectImage():ik.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=uD(5,"inspect-"),this.workerMessageLengthLimit=VD("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=VD("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=VD("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new OM("worker-manager-"+this._inspectId,wD),this.on(rM.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,ik.debug("[".concat(this._inspectId,"] Inspect operation :").concat(nM[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new OM("worker-"+this._inspectId,wD),this.handleWorkerEvents()}async init(e,t){this.emit(rM.STATE_CHANGE,nM.CONNECT_AP),this._connectInfo=e;let n=this._cancelTokenSource.token;return this._retryConfig=t,new hS(((r,i)=>{this.on(rM.CONNECTION_STATE_CHANGE,((e,t)=>{t===tM.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){let r=VD("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:a,cname:o,sid:s,token:c,uid:l}=t;fH++;let d,u,h="image_moderation_api",p={service_name:h,json_body:JSON.stringify({appId:i,areaCode:a,cname:o,command:"allocateEdge",requestId:fH,seq:fH,sid:s,token:c,ts:Date.now(),uid:l+""})},f=e[0];return AD((async()=>{d=Date.now();let e=await QW(f,{data:p,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(u=Date.now()-d,0!==e.code){let t=new bx(fL.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:u});throw ik.error(t.toString()),t}let t=JSON.parse(e.json_body);if(200!==t.code){let e=new bx(fL.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:u});throw ik.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){let e=new bx(fL.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:u});throw ik.error(e.toString()),e}let r=VD("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=VD("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:u}}),((t,n)=>(hk.apworkerEvent(s,{success:!0,sc:200,serviceName:h,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:u,serverIp:e[n%e.length]}),!1)),((t,n)=>(hk.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:h,responseTime:u,serverIp:e[n%e.length]}),!!(t.code!==fL.OPERATION_ABORTED&&t.code!==fL.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(rM.STATE_CHANGE,nM.AP_CONNECTED);let{addressList:a}=i;return this.wmSequence++,a}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(rM.STATE_CHANGE,nM.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Sx.CONNECTED,(async()=>{this.emit(rM.STATE_CHANGE,nM.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Sx.CLOSED,(()=>{this._innerConnectionState<nM.GET_WORKER_MANAGER_RESPONSE&&ik.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(Sx.FAILED,(()=>{this._innerConnectionState<nM.GET_WORKER_MANAGER_RESPONSE&&ik.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(Sx.RECONNECTING,(()=>{this._innerConnectionState<nM.GET_WORKER_MANAGER_RESPONSE&&ik.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(Sx.ON_MESSAGE,(async e=>{this.emit(rM.STATE_CHANGE,nM.GET_WORKER_MANAGER_RESPONSE);let t=this.workerManagerConnection.url;this.workerManagerConnection.close();let n=JSON.parse(e.data);if(200!==n.code)throw ik.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new bx(fL.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw ik.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new bx(fL.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{let e=VD("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(rM.STATE_CHANGE,nM.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(rM.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(Sx.WILL_RECONNECT,((e,t,n)=>{n(e)})),this.workerManagerConnection.on(Sx.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(Sx.CONNECTED,(async()=>{this.emit(rM.STATE_CHANGE,nM.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=tM.CONNECTED})),this.workerConnection.on(Sx.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){let n=function(e){return function(e){let t={};e:for(;!n$(e);){let n=h$(e);switch(n>>>3){case 0:break e;case 1:t.code=h$(e);break;case 2:t.msg=a$(e,h$(e));break;case 3:{let n=zZ(e);t.data=HZ(e),e.limit=n;break}default:KZ(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}(new Uint8Array(e.data));if(VD("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&ik.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(rM.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;let e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=Dh(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(rM.INSPECT_RESULT,i)}else this.emit(rM.INSPECT_RESULT,void 0,new bx(fL.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(rM.INSPECT_RESULT,void 0,new bx(fL.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else ik.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(rM.INSPECT_RESULT,void 0,new bx(fL.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(Sx.CLOSED,(()=>{this.connectionState=tM.CLOSED})),this.workerConnection.on(Sx.FAILED,(()=>{this.connectionState=tM.CLOSED})),this.workerConnection.on(Sx.RECONNECTING,(()=>{this.connectionState=this.connectionState===tM.CONNECTED?tM.RECONNECTING:tM.CONNECTING})),this.workerConnection.on(Sx.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(Sx.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(rM.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}async requestToInspectImage(){this.sequence++;let e=KL(this,rM.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(rM.INSPECT_RESULT,void 0,new bx(fL.INVALID_OPERATION,"Only the track being played can be inspected"));let n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(rM.INSPECT_RESULT,void 0,new bx(fL.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:a,sid:o,uid:s}=t,c=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),d=await PG(l,n,r),u=this.sequence+"-"+i+"-"+s+"-"+c+"-"+uD(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:g$(Number(c-this.inspectStartTime)),fileSize:d.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:d,networkType:6,osType:7,requestId:u,sdkVersion:"4.22.0",sequence:this.sequence,sid:o,timestamp:g$(c),uid:s,vid:a,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;let p=function(e){let t=$Z();return function(e,t){let n=e.appId;void 0!==n&&(p$(t,10),o$(t,n));let r=e.cid;void 0!==r&&(p$(t,16),p$(t,r));let i=e.cname;void 0!==i&&(p$(t,26),o$(t,i));let a=e.deviceId;void 0!==a&&(p$(t,34),o$(t,a));let o=e.elapse;void 0!==o&&(p$(t,40),f$(t,o));let s=e.fileSize;void 0!==s&&(p$(t,48),f$(t,QZ(s)));let c=e.height;void 0!==c&&(p$(t,56),f$(t,QZ(c)));let l=e.jpg;void 0!==l&&(p$(t,66),p$(t,l.length),function(e,t){let n=r$(e,t.length);e.bytes.set(t,n)}(t,l));let d=e.networkType;void 0!==d&&(p$(t,72),f$(t,QZ(d)));let u=e.osType;void 0!==u&&(p$(t,80),f$(t,QZ(u)));let h=e.requestId;void 0!==h&&(p$(t,90),o$(t,h));let p=e.sdkVersion;void 0!==p&&(p$(t,98),o$(t,p));let f=e.sequence;void 0!==f&&(p$(t,104),f$(t,QZ(f)));let m=e.sid;void 0!==m&&(p$(t,114),o$(t,m));let _=e.timestamp;void 0!==_&&(p$(t,120),f$(t,_));let g=e.uid;void 0!==g&&(p$(t,128),p$(t,g));let E=e.vid;void 0!==E&&(p$(t,136),p$(t,E));let v=e.width;void 0!==v&&(p$(t,144),f$(t,QZ(v)));let y=e.service;void 0!==y&&(p$(t,152),p$(t,y));let S=e.callbackData;void 0!==S&&(p$(t,162),o$(t,S));let b=e.jpgEncryption;void 0!==b&&(p$(t,168),p$(t,b));let T=e.requestType;void 0!==T&&(p$(t,176),p$(t,T));let C=e.scorePorn;void 0!==C&&(p$(t,185),u$(t,C));let w=e.scoreSexy;void 0!==w&&(p$(t,193),u$(t,w));let R=e.scoreNeutral;void 0!==R&&(p$(t,201),u$(t,R));let A=e.scene;void 0!==A&&(p$(t,208),p$(t,A));let I=e.ossFilePrefix;void 0!==I&&(p$(t,218),o$(t,I));let N=e.serviceVendor;if(void 0!==N)for(let O of N){p$(t,226);let e=$Z();qZ(O,e),p$(t,e.limit),s$(t,e),e$(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}(h);if(p.byteLength<this.workerMessageLengthLimit){if(VD("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m$(Object(n),!0).forEach((function(t){SI(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,ik.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return p}{let t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:a,sid:o,uid:s})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=RP.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=tM.CLOSED,this.emit(rM.STATE_CHANGE,nM.CLOSED)}},v$={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new bx(fL.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new bx(fL.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let t=[...new Set(e.inspectType)];t.forEach((e=>{var t;if(!_h(t=["supervise","moderation"]).call(t,e))throw new bx(fL.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new bx(fL.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new E$(t)}};jD("PROCESS_ID","process-".concat(uD(8,""),"-").concat(uD(4,""),"-").concat(uD(4,""),"-").concat(uD(4,""),"-").concat(uD(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(g0){return void ik.error("Error loading sdk config",g0.message)}if(e)try{let t=JSON.parse(window.atob(e)),n=Date.now();ik.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(FD,e)){let{value:r,expires:i}=t[e];if(i&&i<=n)return;BD[e]=r,FD[e]=r}}))}catch(g0){ik.error("Error loading mutableParamsCache: ".concat(e),g0.message)}}(),Array.isArray(BD.AREAS)&&BD.AREAS.length>0&&iH(BD.AREAS,!0);var y$=(e,t,n)=>{ik.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),jD(e,t,n)};Zz(MZ,!1),Zz(WZ,!1),Zz(KY,!1),Zz(v$,!1),Zz(DZ,!1);var S$=function(e){let t=new OL,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===aM.SECURITY_POLICY_VIOLATION&&aJ(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return rJ(rJ({},n),r)}({__TRACK_LIST__:Zj,VERSION:DD,BUILD:UD,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:y$,getParameter:VD,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,n=await async function(e){let t;return Mj().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){let t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(g0){throw new bx(fL.CREATE_OFFER_FAILED,g0.toString&&g0.toString()).print()}return e},checkSystemRequirements:function(){let e=hk.reportApiInvoke(null,{name:DL.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:kL.TRACER}),t=!1;try{let e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r),t&&sL()&&YP(75)&&(new e).close()}catch(aa){return ik.error("check system requirement failed: ",aa),!1}let n=!1,r=UP();r.name===DP.CHROME&&Number(r.version)>=58&&("WebKit"!==xP.engine.name||function(){let e=UP();if(BP()){if(e.os===LP.MAC_OS)return!0;if(e.os===LP.IOS){let e=xP.os.version&&xP.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3||e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(r.name===DP.FIREFOX&&Number(r.version)>=56||r.name===DP.OPERA&&Number(r.version)>=45||r.name===DP.SAFARI&&Number(r.version)>=11||"WebKit"===r.name&&(zP()||iL())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||aL()||UP().name===DP.QQ)&&(n=!0),ik.debug("checkSystemRequirements, api:",t,"browser",n);let i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return YV.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return YV.getRecordingDevices(e)},getCameras:function(e){return YV.getCamerasDevices(e)},getElectronScreenSources:VV,getPlaybackDevices:function(e){return YV.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},n=hk.reportApiInvoke(null,{name:DL.CREATE_CLIENT,options:[t],tag:kL.TRACER});try{!function(e){gL(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),gL(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&gL(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&yL(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&jL(e.turnServer),void 0!==e.httpRetryConfig&&xL(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&xL(e.websocketRetryConfig)}(t)}catch(yi){throw n.onError(yi),yi}return(QP(16,0)||ZP(16,0))&&("vp9"===t.codec&&(t.codec="vp8",ik.debug("browser not support vp9, force use vp8")),jD("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),n.onSuccess(),new ZY(JY(JY({forceWaitGatewayResponse:!0},t),{},{role:_h(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=VD("CAMERA_CAPTURE_CONFIG"),n=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CREATE_CAM_VIDEO_TRACK,options:[RV({},e),t]});t&&(e.encoderConfig=t);let r=lB(e),i=uD(8,"track-cam-"),a=null;ik.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{a=(await HV({video:r},i)).getVideoTracks()[0]||null}catch(ia){throw n.onError(ia),ia}if(!a){let e=new mL(fL.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(ik)}e.optimizationMode&&qG(i,a,e,Kj(e.encoderConfig));let o=new HG(a,e,r,e.scalabiltyMode?Jj(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return n.onSuccess(o.getTrackId()),ik.info("create camera video success, trackId:",i),o},createCustomVideoTrack:function(e){let t=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new WG(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Jj(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,uD(8,"track-cus-"),[tV.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),ik.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable",n=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CREATE_SCREEN_VIDEO_TRACK,options:[RV({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let r=function(e){let t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&GP()&&(t.extensionId=e.extensionId);let{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:a}=e;(KP(107)||JP(107)||$P(93))&&(n&&(gL(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(gL(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(gL(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(KP(105)||JP(105)||$P(91))&&a&&(gL(a,"systemAudio",["exclude","include"]),t.systemAudio=a),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);let o=e.encoderConfig?Yj(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:o?o.width:void 0,maxHeight:o?o.height:void 0},o&&(o.frameRate&&("number"==typeof o.frameRate?(t.mandatory.maxFrameRate=o.frameRate,t.mandatory.minFrameRate=o.frameRate):(t.mandatory.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||void 0,t.mandatory.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||void 0),t.frameRate=o.frameRate),o.width&&(t.width=o.width),o.height&&(t.height=o.height)),t}(e),i=uD(8,"track-scr-v-"),a=null,o=null,s=Mj();if(!s.supportShareAudio&&"enable"===t){let e=new mL(fL.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(e),e.throw(ik)}ik.info("start create screen video track with config",e,"withAudio",t,"trackId",i);try{let e=await HV({screen:r,screenAudio:"auto"===t?s.supportShareAudio:"enable"===t},i);a=e.getVideoTracks()[0]||null,o=e.getAudioTracks()[0]||null}catch(da){throw n.onError(da),da}if(!a){let e=new mL(fL.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(ik)}if(!o&&"enable"===t){a&&a.stop();let e=new mL(fL.SHARE_AUDIO_NOT_ALLOWED);return n.onError(e),e.throw(ik)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(qG(i,a,e,e.encoderConfig&&Yj(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let c=new WG(a,e.encoderConfig?Yj(e.encoderConfig):{},e.scalabiltyMode?Jj(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[tV.SCREEN_TRACK]);if(!o)return n.onSuccess(c.getTrackId()),ik.info("create screen video track success","video:",c.getTrackId()),c;let l=new kG(o,void 0,uD(8,"track-scr-a-"),!1);return n.onSuccess([c.getTrackId(),l.getTrackId()]),ik.info("create screen video track success","video:",c.getTrackId(),"audio:",l.getTrackId()),[c,l]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=VD("CAMERA_CAPTURE_CONFIG"),r=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);let i=lB(t),a=dB(e),o=uD(8,"track-mic-"),s=uD(8,"track-cam-"),c=null,l=null;ik.info("start create camera video track(".concat(s,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let e=await HV({audio:a,video:i},"".concat(o,"-").concat(s));c=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(la){throw r.onError(la),la}if(!c||!l){let e=new mL(fL.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(e),e.throw(ik)}t.optimizationMode&&qG(s,l,t,Kj(t.encoderConfig));let d=new xG(c,e,a,o),u=new HG(l,t,i,t.scalabiltyMode?Jj(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return r.onSuccess([d.getTrackId(),u.getTrackId()]),ik.info("create camera video track(".concat(s,") and microphone audio track(").concat(o,") success")),[d,u]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=dB(e),r=uD(8,"track-mic-"),i=null;ik.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await HV({audio:n},r)).getAudioTracks()[0]||null}catch(oa){throw t.onError(oa),oa}if(!i){let e=new mL(fL.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw(ik)}let a=new xG(i,e,n,r);return t.onSuccess(a.getTrackId()),ik.info("create microphone audio track success, trackId:",r),a},createCustomAudioTrack:function(e){let t=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new kG(e.mediaStreamTrack,e.encoderConfig?Qj(e.encoderConfig):{},uD(8,"track-cus-"),!1);return ik.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:n,encoderConfig:r}=e,{source:i}=e,a={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},o=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CREATE_BUFFER_AUDIO_TRACK,options:[a]});if(VD("DISABLE_WEBAUDIO"))throw new mL(fL.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let s=uD(8,"track-buf-");ik.info("start create buffer source audio track with config",JSON.stringify(a),"trackId",s);let c=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){let t=jG.get(e);if(t)return ik.debug("use cached audio resource: ",e),t;try{n=(await AD((()=>RP.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(ua){throw new mL(fL.FETCH_AUDIO_FILE_FAILED,ua.toString())}}else n=await new hS(((t,n)=>{let r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new mL(fL.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new mL(fL.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));let r=await function(e){let t=LV();return new hS(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new mL(fL.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&jG.set(e,r),r}(i,n)}catch(ca){return o.onError(ca),ca.throw(ik)}let l=new FG(i),d=new MG(c,l,r?Qj(r):{},s);return ik.info("create buffer source audio track success, trackId:",s),o.onSuccess(d.getTrackId()),d},setAppType:function(e){if(ik.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw ik.debug("Invalid appType"),new bx(fL.INVALID_PARAMS,"invalid app type",e);jD("APP_TYPE",Math.floor(e))},setLogLevel:function(e){ik.setLogLevel(e)},enableLogUpload:function(){VD("USE_NEW_LOG")?jD("UPLOAD_LOG",!0):ik.enableLogUpload()},disableLogUpload:function(){VD("USE_NEW_LOG")?jD("UPLOAD_LOG",!1):ik.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new hz},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof kG||e instanceof oW)){let e=new bx(fL.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof kG?e.getTrackLabel():"remote_track",i=e.getVolumeLevel(),a=i,o=i,s=Date.now();return new hS((i=>{let c=setInterval((()=>{let l=e.getVolumeLevel();a=l>a?l:a,o=l<o?l:o;let d=a-o>1e-4,u=Date.now()-s;if(d||u>t){clearInterval(c);let t=d,o={duration:u,deviceLabel:r,maxVolumeLevel:a,result:t};ik.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(o))),n.onSuccess(o),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=hk.reportApiInvoke(null,{tag:kL.TRACER,name:DL.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof WG||e instanceof aW)){let e=new bx(fL.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);let r=e instanceof WG?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),a=document.createElement("video");a.style.width="1px",a.style.height="1px",a.setAttribute("muted",""),a.muted=!0,a.setAttribute("playsinline",""),a.controls=!1,(WP()||BP())&&(a.style.opacity="0.01",a.style.position="fixed",a.style.left="0",a.style.top="0",document.body.appendChild(a)),a.srcObject=new MediaStream([i]),a.play();let o=document.createElement("canvas");o.width=160,o.height=120;let s=0,c=0;try{let e=Date.now();s=await function(e,t,n){let r,i=0,a=null;return new hS(((o,s)=>{setTimeout((()=>{r&&(r(),o(i))}),t),r=xV((()=>{!function(){i>4&&r&&(r(),o(i));let t=n.getContext("2d");if(!t){let e=new bx(fL.UNEXPECTED_ERROR,"can not get canvas 2d context.");return ik.error(e.toString()),void s(e)}t.drawImage(e,0,0,160,120);let c=t.getImageData(0,0,n.width,n.height),l=Math.floor(c.data.length/3);if(a){for(let e=0;e<l;e+=3)if(c.data[e]!==a[e])return i+=1,void(a=c.data);a=c.data}else a=c.data}()}),30)}))}(a,t,o),c=Date.now()-e}catch(ca){throw n.onError(ca),ca}lK===DP.SAFARI&&(a.pause(),a.remove()),a.srcObject=null;let l=s>4,d={duration:c,changedPicNum:s,deviceLabel:r,result:l};return ik.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),n.onSuccess(d),l},setArea:iH,audioElementPlayCenter:eB,resumeAudioContext:function(){eB.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){tJ.processExternalMediaAEC(e)},registerExtensions:function(e){let t=VD("PLUGIN_INFO")||[];e.forEach((e=>{"name"in e&&!_h(t).call(t,e.name)&&t.push(e.name);let n=e;n.__registered__=!0,n.logger.hookLog=ik.extLog,n.reporter.hookApiInvoke=hk.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach((e=>{n.parameters[e]=VD(e)}))})),y$("PLUGIN_INFO",t)},ChannelMediaRelayError:Ux,ChannelMediaRelayEvent:xx,ChannelMediaRelayState:Mx,RemoteStreamFallbackType:iV,RemoteStreamType:rV,ConnectionDisconnectedReason:UL,AudienceLatencyLevelType:ML,AREAS:Gx,preload:async function(e,t,n,r){return bK(e,t,n,r)}});function b$(e,t,n){return e.on(t,n),()=>e.off(t,n)}function T$(e){try{return e()}catch(g0){console.error(g0)}}function C$(e){return()=>e.forEach(T$)}function w$(e,t){let n=setTimeout(e,t);return()=>clearTimeout(n)}function R$(){let e,t,n;function r(){if(t){let e=t;t=void 0,e()}}async function i(){if(n){let e=n;n=void 0;try{await e()}catch(da){console.error(da)}}}async function a(t){e=!0,await i();try{n=await t()}catch(da){console.error(da)}e=!1,r()}async function o(){e=!0,await i(),e=!1,r()}return{run:function(n){e?t=()=>a(n):a(n)},dispose:function(){e?t=o:o()}}}Object.defineProperties(S$,{onAudioAutoplayFailed:{get:()=>XV.onAudioAutoplayFailed,set:e=>{XV.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>XV.onAutoplayFailed,set:e=>{XV.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>S$._onSecurityPolicyViolation,set(e){S$._onSecurityPolicyViolation=e,aJ(e)}},__CLIENT_LIST__:{get:()=>VD("SHOW_GLOBAL_CLIENT_LIST")?_k:[]}}),YV.on(EV.CAMERA_DEVICE_CHANGED,(e=>{ik.info("camera device changed",JSON.stringify(e)),S$.onCameraChanged&&S$.onCameraChanged(e),S$.safeEmit(aM.CAMERA_CHANGED,e)})),YV.on(EV.RECORDING_DEVICE_CHANGED,(e=>{ik.info("microphone device changed",JSON.stringify(e)),S$.onMicrophoneChanged&&S$.onMicrophoneChanged(e),S$.safeEmit(aM.MICROPHONE_CHANGED,e)})),YV.on(EV.PLAYOUT_DEVICE_CHANGED,(e=>{ik.debug("playout device changed",JSON.stringify(e)),S$.onPlaybackDeviceChanged&&S$.onPlaybackDeviceChanged(e),S$.safeEmit(aM.PLAYBACK_DEVICE_CHANGED,e)})),eB.onAutoplayFailed=()=>{ik.info("detect audio element autoplay failed"),XV.onAudioAutoplayFailed&&XV.onAudioAutoplayFailed()},PV.on("autoplay-failed",(()=>{ik.info("detect webaudio autoplay failed"),XV.onAudioAutoplayFailed&&XV.onAudioAutoplayFailed(),S$.safeEmit(aM.AUTOPLAY_FAILED)})),PV.on(jj.STATE_CHANGE,((e,t)=>{ik.info("audio context state changed: ".concat(t," => ").concat(e)),S$.onAudioContextStateChanged&&S$.onAudioContextStateChanged(e,t),S$.safeEmit(aM.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),JL.on(HL.NETWORK_STATE_CHANGE,((e,t)=>{ik.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=S$);var A$=typeof document<"u"?i.useLayoutEffect:i.useEffect;function I$(){let e=(0,i.useRef)(!1);return(0,i.useEffect)((()=>(e.current=!1,()=>{e.current=!0})),[]),e}function N$(e){let t=function(){let e=I$();return(0,i.useCallback)((function(t,n){return new Promise((async(r,i)=>{try{let n=await t;e.current||r(n)}catch(oa){e.current?n&&n(oa):i(oa)}}))}),[e])}(),[n,r]=(0,i.useState)();return A$((()=>{!function(e){return null!=e&&"function"==typeof e.then}(e)?r(e):t(e).then(r)}),[e,t]),n}function O$(e,t){let n=(0,i.useRef)();(0,i.useEffect)((()=>{let{run:t,dispose:r}=n.current||(n.current=R$());return t(e),r}),t)}var P$=(0,i.createContext)(null);function L$(e){let{client:t,children:n}=e;return(0,Re.jsx)(P$.Provider,{value:t,children:n})}function D$(e){let t=function(e){let t=(0,i.useContext)(P$);return e||t}(e);if(!t)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return t}(0,i.createContext)(null);function k$(e){let t=D$(e),[n,r]=(0,i.useState)(!!t&&"CONNECTED"===t.connectionState);return(0,i.useEffect)((()=>{if(t){let e;return r("CONNECTED"===t.connectionState),C$([b$(t,"connection-state-change",(t=>{var n;null!==(n=e)&&void 0!==n&&n(),e=w$((()=>r("CONNECTED"===t)),0)})),()=>{var t;return null===(t=e)||void 0===t?void 0:t()}])}r(!1)}),[t]),n}var x$=class extends Error{constructor(e,t){"string"==typeof t?(super(t),(0,Bs.A)(this,"rtcMethod",void 0),(0,Bs.A)(this,"rtcError",void 0),(0,Bs.A)(this,"name","AgoraRTCReactException")):(super(t.message),(0,Bs.A)(this,"rtcMethod",void 0),(0,Bs.A)(this,"rtcError",void 0),(0,Bs.A)(this,"name","AgoraRTCReactException")),this.rtcMethod=e,this.rtcError=t}log(e){console[e](this)}};function M$(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=D$(n),a=k$(n),o=(0,i.useRef)([]),[s,c]=(0,i.useState)(!1),[l,d]=(0,i.useState)(null),u=I$();return O$((async()=>{if(u.current||(c(!1),d(null)),!r||!a||!t)return;let n=e.filter(Boolean),i=e=>{let t=function(e,t){let n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length);for(let a=0;a<i;a++){let e=parseInt(n[a]||"0"),t=parseInt(r[a]||"0");if(e>t)return 1;if(e<t)return-1}return 0}(S$.VERSION,"4.18.2")>=0;return t||new x$("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),!t||("live"!==r.mode||"audience"!==r.role)},s=e=>i()&&e.enabled&&t&&!(e=>o.current.some((t=>t&&t.getTrackId()===e.getTrackId())))(e);for(let e=0;e<n.length;e++){let t=n[e];if(t&&s(t)){await r.unpublish(o.current.filter((e=>(null===e||void 0===e?void 0:e.trackMediaType)===t.trackMediaType)));try{u.current||c(!0),await r.publish(t)}catch(Ca){console.error(Ca),u.current||d(new x$("IAgoraRTCClient.publish",Ca))}u.current||c(!1)}}o.current=n}),[a,t,r,e]),{isLoading:s,error:l}}function U$(e,t,n){let r=D$(n),a="audio"===t?"audioTrack":"videoTrack",[o,s]=(0,i.useState)(e&&e[a]),c=k$(),l=(0,i.useRef)(),[d,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null);return(0,i.useEffect)((()=>{if(!e||!c)return;let n=!1;n||p(null);let i="audio"===t?"hasAudio":"hasVideo",o=e.uid,d=async(e,t)=>{try{!e[a]&&r.remoteUsers.some((t=>{let{uid:n}=t;return e.uid===n}))&&(n||u(!0),await r.subscribe(e,t)),n||s(e[a])}catch(va){n||p(new x$("IAgoraRTCClient.subscribe",va)),console.error(va)}n||u(!1)},h=l.current||(l.current=R$());return!e[a]&&e[i]?h.run((()=>d(e,t))):s(e[a]),C$([()=>{n=!0,h.dispose()},b$(r,"user-published",((e,n)=>{e.uid===o&&n===t&&h.run((()=>d(e,t)))})),b$(r,"user-unpublished",((e,i)=>{e.uid===o&&i===t&&h.run((()=>(async(e,t)=>{if(e[a]&&r.remoteUsers.some((t=>{let{uid:n}=t;return e.uid===n})))try{n||u(!0),await r.unsubscribe(e,t)}catch(va){n||p(new x$("IAgoraRTCClient.unsubscribe",va)),console.error(va)}n||(s(void 0),u(!1))})(e,t)))}))])}),[c,r,e,t,a]),{track:o,isLoading:d,error:h}}var F$=(0,i.createContext)(void 0);function j$(e,t,n,r){let a=(0,i.useContext)(F$);(0,i.useEffect)((()=>{if(e)return r&&t?e.play(r,n||void 0):e.stop(),a?(a.onMount(e),()=>a.onUnmount(e)):()=>{e.isPlaying&&e.stop()}}),[e,r,t,a,n])}function V$(e,t){let n=(0,i.useContext)(F$);A$((()=>{if(e)return t?e.play():e.stop(),n?(n.onMount(e),()=>n.onUnmount(e)):()=>{e.isPlaying&&e.stop()}}),[e,t,n])}function B$(e){let{track:t,play:n=!1,volume:r,disabled:a,muted:o,children:s}=e,c=N$(t);return V$(c,n),(0,i.useEffect)((()=>{c&&null!=r&&c.setVolume(r)}),[c,r]),(0,i.useEffect)((()=>{c&&null!=a&&c.setEnabled(!a).catch(console.warn)}),[a,c]),(0,i.useEffect)((()=>{c&&null!=o&&c.setMuted(o).catch(console.warn)}),[o,c]),s?(0,Re.jsx)(Re.Fragment,{children:s}):null}var G$={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},W$={width:"100%",height:"100%"},H$={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},q$=(e,t)=>(0,i.useMemo)((()=>(0,A.A)((0,A.A)({},e),t)),[e,t]);function z$(e){let{track:t,play:n,disabled:r,muted:a,style:o,videoPlayerConfig:s}=e,c=Vs(e,Gs),l=q$(W$,o),[d,u]=(0,i.useState)(null),h=N$(t);return j$(h,n,s,d),(0,i.useEffect)((()=>{h&&null!=r&&h.setEnabled(!r).catch(console.warn)}),[r,h]),(0,i.useEffect)((()=>{h&&null!=a&&h.setMuted(a).catch(console.warn)}),[a,h]),(0,Re.jsx)("div",(0,A.A)((0,A.A)({},c),{},{ref:u,style:l}))}var K$={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},Y$={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function J$(e){let{cover:t}=e;return(0,Re.jsx)("div",{style:H$,children:"string"==typeof t?(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)("div",{style:(0,A.A)((0,A.A)({},K$),{},{backgroundImage:"url(".concat(t,")")})}),(0,Re.jsx)("img",{src:t,style:Y$})]}):t()})}function X$(e){var t,n;let{micOn:r,cameraOn:i,audioTrack:a,videoTrack:o,playAudio:s,playVideo:c,volume:l,cover:d,children:u,style:h}=e,p=Vs(e,Ws),f=q$(G$,h);return c=null!==(t=c)&&void 0!==t?t:!!i,s=null!==(n=s)&&void 0!==n?n:!!r,(0,Re.jsxs)("div",(0,A.A)((0,A.A)({},p),{},{style:f,children:[(0,Re.jsx)(z$,{disabled:!i,play:c,track:o}),(0,Re.jsx)(B$,{disabled:!r,play:s,track:a,volume:l}),d&&!i&&(0,Re.jsx)(J$,{cover:d}),(0,Re.jsx)("div",{style:H$,children:u})]}))}function Q$(e){let{track:t,play:n=!1,playbackDeviceId:r,volume:a,children:o}=e;return V$(t,n),(0,i.useEffect)((()=>{t&&null!=r&&t.setPlaybackDevice(r).catch(console.warn)}),[t,r]),(0,i.useEffect)((()=>{t&&null!=a&&t.setVolume(a)}),[t,a]),o?(0,Re.jsx)(Re.Fragment,{children:o}):null}function Z$(e){let{track:t,play:n,style:r,videoPlayerConfig:a}=e,o=Vs(e,Hs),s=q$(W$,r),[c,l]=(0,i.useState)(null);return j$(t,n,a,c),(0,Re.jsx)("div",(0,A.A)((0,A.A)({},o),{},{ref:l,style:s}))}function $$(e){var t,n;let{user:r,playVideo:i,playAudio:a,playbackDeviceId:o,volume:s,cover:c,style:l,children:d,videoPlayerConfig:u}=e,h=Vs(e,qs),p=q$(G$,l),{track:f}=U$(r,"video"),{track:m}=U$(r,"audio");return i=null!==(t=i)&&void 0!==t?t:null===r||void 0===r?void 0:r.hasVideo,a=null!==(n=a)&&void 0!==n?n:null===r||void 0===r?void 0:r.hasAudio,(0,Re.jsxs)("div",(0,A.A)((0,A.A)({},h),{},{style:p,children:[(0,Re.jsx)(Z$,{play:i,track:f,videoPlayerConfig:u}),(0,Re.jsx)(Q$,{play:a,playbackDeviceId:o,track:m,volume:s}),c&&!i&&(0,Re.jsx)(J$,{cover:c}),(0,Re.jsx)("div",{style:H$,children:d})]}))}new class{constructor(){(0,Bs.A)(this,"appType",1001),S$.setAppType(this.appType)}};var e0=S$;const t0=()=>{const{appointmentNumber:e,patientName:t}=R((e=>e.data)),{micOn:n,cameraOn:r,token:a}=R((e=>e.video));!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=D$(n),a=k$(n),o=(0,i.useRef)(),[s,c]=(0,i.useState)(!1),[l,d]=(0,i.useState)(0),[u,h]=(0,i.useState)(null),p=I$();O$((async()=>{if(p.current||(h(null),d(0),c(!1)),t&&r){try{p.current||c(!0);let{appid:t,channel:n,token:i,uid:a}="function"==typeof e?await e():e,o=await r.join(t,n,i,a);p.current||d(o)}catch(fa){console.error(fa),p.current||h(new x$("IAgoraRTCClient.join",fa))}p.current||c(!1);let t=o.current||(o.current=R$());return C$([()=>{t.dispose()},()=>{t.run((()=>r.unpublish(r.localTracks)))},()=>{for(let e of r.localTracks)e.isPlaying&&e.stop(),e.close();t.run((()=>r.leave()))}])}}),[t,n])}({token:a,appid:"4a186723661348bbb917bf41c12e1ed1",channel:e},!0);const{localMicrophoneTrack:o}=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ANS:!0,AEC:!0},n=k$(arguments.length>2?arguments[2]:void 0),[r,a]=(0,i.useState)(null),[o,s]=(0,i.useState)(!1),[c,l]=(0,i.useState)(null),d=I$();return O$((async()=>{if(d.current||(s(!1),l(null)),n&&e&&!r){try{d.current||s(!0);let e=await S$.createMicrophoneAudioTrack(t);d.current||a(e)}catch(ca){console.error(ca),d.current||l(new x$("IAgoraRTC.createMicrophoneAudioTrack",ca))}d.current||s(!1)}!n&&!d.current&&a(null)}),[n,e]),{localMicrophoneTrack:r,isLoading:o,error:c}}(n),{localCameraTrack:s}=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=k$(arguments.length>2?arguments[2]:void 0),[r,a]=(0,i.useState)(null),[o,s]=(0,i.useState)(!1),[c,l]=(0,i.useState)(null),d=I$();return O$((async()=>{if(d.current||(s(!1),l(null)),n&&e&&!r){try{d.current||s(!0);let e=await S$.createCameraVideoTrack(t);d.current||a(e)}catch(ca){console.error(ca),d.current||l(new x$("IAgoraRTC.createCameraVideoTrack",ca))}d.current||s(!1)}!n&&!d.current&&a(null)}),[n,e]),{localCameraTrack:r,isLoading:o,error:c}}(r),c=(0,i.useRef)(null);M$([o,s]);const l=function(e){let t=D$(e),[n,r]=(0,i.useState)(t?t.remoteUsers:[]);return(0,i.useEffect)((()=>{if(t){let e=()=>r(t.remoteUsers.slice());return C$([b$(t,"user-joined",e),b$(t,"user-left",e),b$(t,"user-published",e),b$(t,"user-unpublished",e)])}}),[t]),n}();(0,i.useEffect)((()=>{const e=l.map((e=>(e.audioTrack,null)));return()=>{e.forEach((e=>{e&&e()}))}}),[l]);const d=l.length+1;return(0,Re.jsxs)("div",{className:"qpeVideoCallScreenContainer",children:[(0,Re.jsxs)("div",{className:"qpeVideoContainer",children:[(0,Re.jsx)("div",{className:"video-container",ref:c}),(0,Re.jsx)(X$,{cameraOn:r,micOn:n,videoTrack:s,audioTrack:o,playAudio:!1,cover:()=>(0,Re.jsxs)("div",{className:"local-user-placeholder",children:[(0,Re.jsx)(Fs,{main:!1,size:"medium"}),(0,Re.jsxs)("div",{className:"iconContainer",children:[n?(0,Re.jsx)(Ue,{color:"var(--primary)"}):(0,Re.jsx)(Ve,{color:"var(--primary)"}),r?(0,Re.jsx)(Ge,{color:"var(--primary)"}):(0,Re.jsx)(Ge,{color:"var(--primary)",isDisabled:!0})]})]}),style:{position:"absolute",zIndex:2,top:"10px",right:"10px",width:"220px",borderRadius:"10px",height:"120px",background:"var(--white)"}}),l.map(((e,n)=>(0,Re.jsx)("div",{style:{position:"absolute",width:"100%",height:"100%",transform:"translate(".concat(100*n,"px, 0)")},children:(0,Re.jsx)($$,{user:e,playAudio:!0,cover:()=>(0,Re.jsx)("div",{className:"remote-user-placeholder",children:(0,Re.jsxs)("div",{className:"remote-place-holder-sub",children:[(0,Re.jsx)("div",{className:"qpeTimerContainer",children:(0,Re.jsx)("p",{children:t||"N/A"})}),(0,Re.jsx)("div",{className:"qpeProfile",children:(0,Re.jsx)("p",{children:ni(t)||"N/A"})}),(0,Re.jsxs)("div",{className:"iconContainer",children:[l[0].hasAudio?(0,Re.jsx)(Ue,{color:"var(--primary)"}):(0,Re.jsx)(Ve,{color:"var(--primary)"}),l[0].hasVideo?(0,Re.jsx)(Ge,{color:"var(--primary)"}):(0,Re.jsx)(Ge,{color:"var(--primary)",isDisabled:!0})]})]})}),style:{position:"absolute",width:"100%",height:"100%"}})},e.uid)))]}),(0,Re.jsxs)("div",{className:"qpeElevatedDiv",children:[(0,Re.jsx)(ii,{type:M.NAME}),(0,Re.jsx)(Os,{totalUsers:d,selectedTab:k.VIRTUAL_APPOINTMENT,videoTrack:s,micTrack:o,videoContainerRef:c})]})]})},n0=e=>{let{selectedTab:t,timer:n,phoneNumber:r}=e;const{appointmentNumber:a,demoGraphicId:o,linkType:s}=R((e=>e.data)),{isAppointmentQuestionnaireLoaded:c,isNewPatientQuestionnaireLoaded:l}=R((e=>e.questionnaire)),{isCallMuted:d}=R((e=>e.twilio)),{isVideoCallActive:u}=R((e=>e.video)),h=T(),p={setDeviceReady:e=>h({type:X,payload:e}),setIsCallMuted:e=>h(Ls(e)),setIsCallRinging:e=>h(Ds(e)),setIsCallActive:e=>h(ks(e)),setTranscript:e=>h(mt(e)),setIsCallAlreadyConnected:e=>h(xs(e)),setIsCallDisconnected:e=>h(Ms(e))};Us({demoGraphicId:o,appointmentNumber:a,isNewPatientQuestionnaireLoaded:l,isAppointmentQuestionnaireLoaded:c,dispatch:h,fetchQuestionnaireApi:ei,setFirstApiQuestions:Yr,setSecondApiQuestions:Jr,setIsNewPatientQuestionnaireLoaded:Qr,setIsAppointmentQuestionnaireLoaded:Xr});const f=(0,i.useRef)(null);return f.current||(f.current=e0.createClient({mode:"rtc",codec:"vp8"})),(0,Re.jsx)("div",{className:"qpeSessionData",children:s===x.VIDEO_CALL&&u?(0,Re.jsx)(L$,{client:f.current,children:(0,Re.jsx)(t0,{})}):(0,Re.jsx)(js,{actions:p,selectedTab:t,timer:n,phoneNumber:r,isCallMuted:d})})},r0=e=>{let{item:t}=e;const{type:n,answer:r}=t;if(null===r||void 0===r)return(0,Re.jsx)("span",{className:"qpeQuestionnaireAnswer",children:"Not provided"});switch(n){case"jsonlist":var i;return Array.isArray(r.value)?(0,Re.jsx)("ul",{className:"qpeQuestionnaireAnswer qpeQuestionnaireList",children:r.value.length>0?null===(i=r.value)||void 0===i?void 0:i.map(((e,t)=>(0,Re.jsx)("li",{className:"qpeQuestionnaireListItem",children:(0,Re.jsx)("span",{children:e.itemName||"Not provided"})},t))):(0,Re.jsx)("span",{children:"Not provided"})}):"object"===typeof r.value&&null!==r.value?(0,Re.jsx)("span",{className:"qpeQuestionnaireAnswer",children:r.value.itemName||"No data available"}):(0,Re.jsx)("span",{className:"qpeQuestionnaireAnswer",children:"Invalid data format"});case"number":case"phoneNumber":case"select":return(0,Re.jsx)("span",{className:"qpeQuestionnaireAnswer",children:null===r||""===r?"Not provided":r});case"switch":return(0,Re.jsx)("span",{className:"qpeQuestionnaireAnswer",children:r?"Yes":"No"});case"textfield":case"date-drop-down":case"textarea":return(0,Re.jsx)("span",{className:"qpeQuestionnaireAnswer",children:null===r?"Not provided":r});case"datagrid":{let e=r;if("string"===typeof r)try{e=JSON.parse(r)}catch(s){return(0,Le.O)("error","Error parsing datagrid answer : ".concat(s),!1),(0,Re.jsx)("span",{className:"qpeQuestionnaireAnswer",children:"Invalid data format"})}var a,o;if("vaccineGrid"===t.key)return(0,Re.jsx)("ul",{className:"qpeQuestionnaireAnswer qpeQuestionnaireList",children:e[0]&&(null===(a=Object.keys(e[0]))||void 0===a?void 0:a.map(((t,n)=>{var r;const i=e[0][t],a=(null===i||void 0===i||null===(r=i[Object.keys(i)[0]])||void 0===r?void 0:r.value)||[],o=(null===i||void 0===i?void 0:i[Object.keys(i)[0]+"_value"])||"Not provided";return a.length&&a[0].itemName?(0,Re.jsxs)("li",{className:"qpeQuestionnaireListItem",children:[(0,Re.jsx)("span",{children:a[0].itemName}),(0,Re.jsxs)("span",{children:[" - ",o]})]},n):null})))});if("takeGrid"===t.key)return(0,Re.jsx)("ul",{className:"qpeQuestionnaireAnswer qpeQuestionnaireList",children:e[0]&&(null===(o=Object.keys(e[0]))||void 0===o?void 0:o.map(((t,n)=>{const r=e[0][t],i=(null===r||void 0===r?void 0:r.value)||[],a=e[0]["".concat(t,"_value")]||"Not provided";return i.length&&i[0].itemName?(0,Re.jsxs)("li",{className:"qpeQuestionnaireListItem",children:[(0,Re.jsx)("span",{children:i[0].itemName}),(0,Re.jsxs)("span",{children:[" ",a]})]},n):null})))});if(Array.isArray(r))return(0,Re.jsx)("ul",{className:"qpeQuestionnaireAnswer qpeQuestionnaireList",children:r.length>0?r.map(((e,t)=>{var n;return(0,Re.jsx)("li",{className:"qpeQuestionnaireListItem",children:null===(n=Object.entries(e))||void 0===n?void 0:n.map((e=>{let[t,n]=e;return(0,Re.jsxs)("div",{children:[(0,Re.jsxs)("strong",{children:[t," - "]}),(0,Re.jsx)("span",{children:"object"===typeof n?JSON.stringify(n):n||"Not provided"})]},t)}))},t)})):(0,Re.jsx)("span",{children:"Not provided"})});break}default:return(0,Re.jsxs)("span",{className:"qpeQuestionnaireAnswer",children:["Unsupported type: ",n]})}},i0=e=>{let{questions:t}=e;return t&&0!==t.length?t.filter((e=>e.label&&""!==e.label.trim())).map(((e,t)=>(0,Re.jsxs)("div",{className:"qpeQuestionnaireItem",children:[(0,Re.jsx)("label",{className:"qpeQuestionnaireLabel",children:e.label}),(0,Re.jsx)(r0,{item:e})]},t))):(0,Re.jsx)("span",{className:"qpeQuestionnaireItem qpeQuestionnaireLabel",children:"No questionnaire is available."})},a0=e=>{let{data:t,index:n,toggleAccordion:r,activeIndex:i}=e;const a=i===n;return(0,Re.jsxs)("div",{className:"qpeAccordionItem",children:[(0,Re.jsxs)("div",{className:"qpeAccordionHeader ".concat(a?"Hactive":""),onClick:()=>r(n),children:[(0,Re.jsx)("p",{children:t.title}),(0,Re.jsx)("span",{className:"qpeAccordionIcon",children:a?(0,Re.jsx)(We,{}):(0,Re.jsx)(We,{isOpen:!0})})]}),(0,Re.jsx)("div",{className:"qpeAccordionContent custom-scrollbar over ".concat(a?"active":""),children:t.renderContent(t.questions)})]})};const o0=function(){var e;const t=T(),{firstApiQuestions:n,secondApiQuestions:r}=R((e=>e.questionnaire)),[a,o]=(0,i.useState)(""),[s,c]=(0,i.useState)([]),[l,d]=(0,i.useState)(null),u=e=>null===e?(0,Re.jsx)("div",{className:"qpeQuestionContainer",children:"No questionnaire is available."}):(0,Re.jsx)(i0,{questions:e}),h=[{title:"New Patient Questionnaire",questions:n,type:"demographicNo",renderContent:u},{title:"Appointment Questionnaire",questions:r,type:"oscarAppointmentId",renderContent:u}];(0,i.useEffect)((()=>{h&&t(Zr(h))}),[t,n,r]);const p=e=>{d(l===e?null:e)};return(0,Re.jsx)("div",{className:"qpeInnerContainer",children:(0,Re.jsxs)("div",{className:"qpeMajorTextContainer custom-scrollbar",children:[(0,Re.jsxs)("div",{className:"qpeSearchContainerMain",children:[(0,Re.jsx)("p",{children:"Appointment Questionnaire"}),(0,Re.jsxs)("div",{className:"qpeQuestionnaireSearchContainer",children:[(0,Re.jsx)(Be,{}),(0,Re.jsx)("input",{type:"text",className:"qpeQuestionnaireSearchInput",placeholder:"Search",value:a,onChange:e=>{var t,n;const r=null===(t=e.target)||void 0===t||null===(n=t.value)||void 0===n?void 0:n.toLowerCase();o(r);const i=null===h||void 0===h?void 0:h.map((e=>(0,A.A)((0,A.A)({},e),{},{questions:e.questions?e.questions.filter((e=>{var t,n;return(null===e||void 0===e||null===(t=e.label)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(n=JSON.stringify(null===e||void 0===e?void 0:e.answer))||void 0===n?void 0:n.toLowerCase().includes(r))})):[]})));c(i)}})]})]}),(0,Re.jsx)("div",{className:"qpeAccordionContainer",children:null===(e=s.length>0?s:h)||void 0===e?void 0:e.map(((e,t)=>(0,Re.jsx)(a0,{data:e,index:t,toggleAccordion:p,activeIndex:l},t)))})]})})},s0=e=>{let{selectedTab:t,timer:n,patientName:r,loading:i,hasSoapNoteData:a,dispatch:o,phoneNumber:s,setTimer:c}=e;const l=t!==k.VIRTUAL_APPOINTMENT&&t!==k.CLINIC&&t!==k.PHONE_APPOINTMENT?"hidden":"";return(0,Re.jsxs)("div",{className:"qpeInnerContainer",children:[(0,Re.jsx)("div",{className:l&&l,children:(0,Re.jsx)(n0,{timer:n,selectedTab:t,patientName:r,dispatch:o,phoneNumber:s,setTimer:c})}),(()=>{if(t===k.AI_SUMMARY&&i)return(0,Re.jsx)(Ae,{parent:"summary"});switch(t){case k.QUESTIONNAIRE:return(0,Re.jsx)(o0,{});case k.DICTATION:return(0,Re.jsx)(xe,{});case k.AI_SUMMARY:return(0,Re.jsx)(Ps,{hasSoapNoteData:a});default:return null}})()]})},c0=e=>{let{selectedTab:t,setSelectedTab:n}=e;const r=T(),{isRecording:a,isPaused:o,transcriptText:s,soapNote:c,responseCount:l}=R((e=>e.scribe)),{patientName:d,phoneNumber:u,linkType:h,appointmentNumber:p}=R((e=>e.data)),{secondApiQuestions:f}=R((e=>e.questionnaire)),{isCallActive:m}=R((e=>e.twilio)),[_,g]=(0,i.useState)(0),[E,v]=(0,i.useState)(!1),[y,S]=(0,i.useState)(!1),[b,C]=(0,i.useState)(),w=(0,i.useRef)(s),A=(0,i.useRef)(null);(0,i.useEffect)((()=>(!a&&!m||o||(A.current=setInterval((()=>g((e=>e+1))),1e3)),()=>clearInterval(A.current))),[a,o,m]),(0,i.useEffect)((()=>{y&&!a&&S(!1)}),[a,y]);(0,i.useEffect)((()=>{if(f){const n={appointment:(e=f,t=["key","type"],null===e||void 0===e?void 0:e.map((e=>Object.fromEntries(Object.entries(e).filter((e=>{let[n]=e;return!t.includes(n)}))))))};C(n),r({type:ge,payload:n})}var e,t}),[r,a,t]),(0,i.useEffect)((()=>{a||t!==k.AI_SUMMARY||s===w.current||(w.current=s,v(!0),De(s,b,p).then((e=>{e&&e.soapnote?(r(_t(e.soapnote)),r(Et(l+1))):r(_t({}))})).catch((e=>{console.error("Error fetching SOAP note:",e),r(_t({}))})).finally((()=>v(!1))))}),[a,t,s,r,l]);const I=c&&["subjective","objective","assessment","plan"].some((e=>{var t;return(null===(t=c[e])||void 0===t?void 0:t.length)>0}));(0,i.useEffect)((()=>{h===x.CLINIC?n(k.CLINIC):h===x.PHONE_CALL?n(k.PHONE_APPOINTMENT):h===x.VIDEO_CALL&&n(k.VIRTUAL_APPOINTMENT)}),[h,n]);return(0,Re.jsx)("div",{className:"qpeIndexMainContainer",children:(0,Re.jsxs)("div",{className:"qpeSub-container",children:[(0,Re.jsx)("div",{className:"qpeTop-container",children:(0,Re.jsx)(ke,{selectedTab:t,setSelectedTab:n})}),(0,Re.jsx)("div",{className:"qpeOuterContainer",children:(0,Re.jsx)("div",{className:"qpeContextContainer",children:(0,Re.jsx)(s0,{selectedTab:t,timer:_,patientName:d,soapNote:c,loading:E,hasSoapNoteData:I,dispatch:r,phoneNumber:u,setTimer:g,questionnaire:b})})})]})})},l0=()=>{const[e,t]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{try{sessionStorage.getItem("JSessionID")?(t(!0),(0,Le.O)("success","User is authenticated.","",!1)):(t(!1),(0,Le.O)("error","No user session found. User is not authenticated.",!1))}catch(e){(0,Le.O)("error","Error accessing session storage for authentication.",e),t(!1)}}),[]),e},d0="https://api-dev.quipohealth.com/integration/service-integrations-api/extension";const u0=function(e){let{authenticated:t}=e;const n=T(),[r,a]=(0,i.useState)(""),[o,s]=(0,i.useState)(""),[c,l]=(0,i.useState)(""),[d,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(!1);return(0,Re.jsx)("div",{className:"qpeIndexMainContainer",children:(0,Re.jsxs)("form",{className:"authForm",onSubmit:async e=>{e.preventDefault(),u(!0),(0,Le.O)("","Form Submitted",!1);try{const e=await(async e=>{try{var t,n,r;const i=await Kr.post("".concat(d0,"/sign-in"),e,{headers:{"Content-Type":"application/json"}});if((null===(t=i.data)||void 0===t?void 0:t.statusCode)>=400||null!==(n=i.data)&&void 0!==n&&null!==(r=n.message)&&void 0!==r&&r.toLowerCase().includes("unable to get"))throw new Error(i.data.message||"Server responded with an error");return i}catch(c){var i,a;if(c.response)throw(0,Le.O)("error",{status:c.response.status,data:c.response.data},!1),new Error((null===(i=c.response)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.message)||"Something went wrong on the server");throw c.request?((0,Le.O)("error",c.request,!1),new Error("No response received from server")):((0,Le.O)("error",{message:c.message},!1),new Error(c.message))}})({username:r,password:o});n((s=e.data.data,{type:ce,payload:s})),sessionStorage.setItem("JSessionID",e.data.data),t()}catch(c){var i,a;const t=(null===(i=c.response)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.message)||"Login failed. Please try again.";l(t),(0,Le.O)("error","Login attempt failed",!1)}finally{u(!1)}var s},children:[(0,Re.jsx)("h1",{className:"authTitle",children:"Sign In"}),(0,Re.jsxs)("div",{className:"formGroup",children:[(0,Re.jsx)("label",{htmlFor:"username",className:"label",children:"Email"}),(0,Re.jsx)("input",{type:"text",id:"username",className:"input",value:r,onChange:e=>a(e.target.value),placeholder:"Enter your email",required:!0})]}),(0,Re.jsxs)("div",{className:"formGroup",children:[(0,Re.jsx)("label",{htmlFor:"password",className:"label",children:"Password"}),(0,Re.jsxs)("div",{className:"passwordField",children:[(0,Re.jsx)("input",{type:h?"text":"password",id:"password",className:"input",value:o,onChange:e=>s(e.target.value),placeholder:"Password",required:!0,autoComplete:"true"}),(0,Re.jsx)("button",{type:"button",className:"togglePassword",onClick:()=>{p((e=>!e))},children:(0,Re.jsx)(je,{isVissible:h})})]})]}),c&&(0,Re.jsx)("p",{className:"error",children:c}),(0,Re.jsx)("a",{href:"/reset-password",className:"forgotPassword",children:"Forget password?"}),(0,Re.jsx)("button",{className:"submitButton",id:"loginBtn",type:"submit",disabled:d,children:d?"Signing in...":"Sign In"}),(0,Re.jsx)("p",{className:"signUpPrompt",children:"Don\u2019t have an account? Sign Up"})]})})},h0=e=>{let{controller:t}=e;const[n,r]=(0,i.useState)(!0),[a,o]=(0,i.useState)(!1),[s,c]=(0,i.useState)(!1),[l,d]=(0,i.useState)(""),[u,h]=(0,i.useState)(null),[p,f]=(0,i.useState)(!1),{linkType:m,inProgress:_}=R((e=>e.data)),g=T(),E=(0,i.useRef)(),v=(0,i.useRef)(!1),y=l0(),S=window.location.href,b={setIsCallMuted:e=>g(Ls(e)),setIsCallDisconnected:e=>g(Ms(e)),setIsCallActive:e=>g(ks(e)),setIsCallRinging:e=>g(Ds(e)),setIsCallAlreadyConnected:e=>g(xs(e))};(0,i.useEffect)((()=>{o(y)}),[y]);const C=()=>{g({type:Ie.CLEAR_STATES}),g({type:"CLEAR_STATES"}),g({type:ne})},w=(0,i.useCallback)((()=>{g(Yr(null)),g(Jr(null)),g(Qr(!1)),g(Xr(!1)),g(Zr([]))}),[g]);E.current=e=>{if(e.source===window)if("UPDATE_DEMOGRAPHIC_INFO"===e.data.type){const{demographicId:t,appointmentNumber:n}=e.data;t&&!_?(C(),h({demographicId:t,appointmentNumber:n}),c(!1)):(0,Le.O)({type:"info",message:"A session is in progress."})}else"DISCONNECTED_CALL"===e.data.type&&((0,Le.O)("","==========[ CLOSING WEBSOCKET ]==========",!1),nt(b,g),g({type:Ie.SET_IN_PROGRESS}))},(0,i.useEffect)((()=>{const e=setTimeout((()=>{r(!1)}),2e3),n=e=>E.current(e);return window.addEventListener("message",n,{signal:t.signal}),()=>{window.removeEventListener("message",n),clearTimeout(e)}}),[t.signal]),(0,i.useEffect)((()=>{if(a&&u&&!s&&!_){const{demographicId:e,appointmentNumber:t}=u;v.current=!1;const n=async()=>{f(!0);try{(0,Le.O)("info","Fetching patient info...",!1),g((r=e,{type:Ie.SET_DEMOGRAPHIC_ID,payload:r}));const i=await(async(e,t)=>{try{var n,r,i;const a={demographicNo:e,oscarAppointmentId:t};if(!a)throw(0,Le.O)("error","Invalid request payload for patient info"),new Error("Invalid request payload for patient info");const o=await Kr.post("".concat($r,"/patient-info"),a,{headers:{"Content-Type":"application/json"}});if(200!==(null===(n=o.data)||void 0===n?void 0:n.statusCode))throw(0,Le.O)("error","API call failed with status code ".concat(o.data.statusCode)),new Error("API call failed with status code ".concat(o.data.statusCode));return null!==(r=o.data)&&void 0!==r&&r.data?(0,Le.O)("info",o.data.data,!1):(0,Le.O)("error","Failed to fetch patient info"),(null===(i=o.data)||void 0===i?void 0:i.data)||null}catch(a){throw(0,Le.O)("error",a),a}})(e,t);if(i){const{patientDetails:e,appointmentDetails:r}=i;if(w(),e){const t={name:e.name||"N/A",email:e.email||"N/A",phn:e.phn||"N/A",dob:e.dob||"N/A"};g((e=>({type:Ie.SET_PATIENT_NAME,payload:e}))(t.name)),g((e=>({type:Ie.SET_EMAIL,payload:e}))(t.email)),g((e=>({type:Ie.SET_PHN,payload:e}))(t.phn)),g((e=>({type:Ie.SET_DOB,payload:e}))(t.dob))}if(r){const e={appointmentType:r.appointmentType||"N/A",providerName:r.providerName||"N/A",appointmentPhoneNumber:r.appointmentPhoneNumber||"N/A"};g(Ne(e.appointmentType)),g((n=e.providerName,{type:Ie.SET_DOCTOR,payload:n})),g((e=>({type:Ie.SET_PHONE_NUMBER,payload:e}))(e.appointmentPhoneNumber)),g((e=>({type:Ie.SET_APPOINTMENT_NUMBER,payload:e}))(t||"N/A"));const i=async e=>e.map((e=>{const{subjective:t,objective:n,assessment:r,plan:i}=e.soapnote||{};return{subjective:Array.isArray(t)?t:[],objective:Array.isArray(n)?n:[],assessment:Array.isArray(r)?r:[],plan:Array.isArray(i)?i:[]}})).filter((e=>Array.isArray(e.subjective)&&Array.isArray(e.objective)&&Array.isArray(e.assessment)&&Array.isArray(e.plan)));v.current?g(Oe(null)):(v.current=!0,(async e=>{const t="".concat("https://api.aiscribe.quipohealth.com/api","/details/").concat(e);try{const e=await Kr.get(t,{headers:{"Content-Type":"application/json"}});return null===e||void 0===e?void 0:e.data}catch(i){var n,r;if(null!==i&&void 0!==i&&null!==(n=i.response)&&void 0!==n&&null!==(r=n.data)&&void 0!==r&&r.detail)return(0,Le.O)("warning","".concat(i.response.data.detail),!1),null;throw(0,Le.O)("error","Fetching Previous Data failed: ".concat(i.message),!1),i}})(t).then((async e=>{if(e){if(g(Oe(e)),e.transcript&&g(mt(e.transcript)),e.soapnotes){const t=await i(e.soapnotes);g(_t(t)),g(Et(null===t||void 0===t?void 0:t.length)),(0,Le.O)("info","SOAP notes successfully fetched.",!1)}}else g(Oe(null))})).catch((e=>{(0,Le.O)("error","Error fetching previous data: ".concat(e),!1),g(Oe(null))})))}}}catch(i){(0,Le.O)("error","Error fetching patient info : ".concat(i),!1)}finally{(0,Le.O)("info","Patient info fetched",!1),c(!0),f(!1)}var n,r};n()}}),[a,u,s,_,g,w]),(0,i.useEffect)((()=>{"Phone call"===m?d("Phone"):"Video call"===m?d("Virtual Appointment"):"Clinic"===m&&d("Clinic")}),[m]);const A=n||p;return(0,Re.jsx)(Re.Fragment,{children:A?(0,Re.jsx)(Ae,{}):a?S.includes("https://oscaremr.quipohealth.com/oscar/provider")?"Clinic"===m||"Phone call"===m||"Video call"===m?(0,Re.jsx)(c0,{selectedTab:l,setSelectedTab:d},"Scribe"):(0,Re.jsx)(Pe,{},"Index"):S.includes("https://oscaremr.quipohealth.com/oscar/casemgmt")?(0,Re.jsx)(o0,{},"Questionnaire"):(0,Re.jsx)(Pe,{},"IndexFallback"):(0,Re.jsx)(u0,{authenticated:()=>o(!0)})})};var p0=n(2339);const f0=function(e){let{controller:t}=e;const n=T(),{isRecording:r}=R((e=>e.scribe)),a=l0(),[o,s]=(0,i.useState)(!1),{patientName:c}=R((e=>e.data)),{isCallActive:l,isCallRinging:d}=R((e=>e.twilio)),u=()=>{s(!o)};return(0,Re.jsxs)("div",{className:"qpeHeader",children:[(0,Re.jsxs)("div",{className:"qpeSubHeader",children:[(0,Re.jsx)("div",{className:"qpeHeaderLeft",children:(0,Re.jsx)(He,{})}),(0,Re.jsx)(p0.l$,{toastOptions:{duration:3e3}}),(0,Re.jsxs)("div",{className:"qpeHeaderRight",children:[c&&(0,Re.jsx)("div",{"aria-label":"Open Patient Profile",style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:u,children:a&&(0,Re.jsx)(Fs,{main:!1,size:"small"})}),(0,Re.jsx)("button",{className:"qpeCloseButton",onClick:()=>{if(t.abort(),l||d)return(0,Le.O)("info","The call is active, can't close the window");if(r)return(0,Le.O)("info","The Recording is active, can't close the window");const e=e=>{const t=document.getElementById(e);null!==t&&void 0!==t&&t.parentNode&&t.parentNode.removeChild(t),window.location.reload()};r&&n(ht()),e("react-chrome-extension"),e("react-app-script")},children:(0,Re.jsx)(Me,{})})]})]}),o&&(0,Re.jsx)(Is,{onClose:u})]})};const m0=function(){const e=new AbortController;return(0,Re.jsx)(g,{store:we,children:(0,Re.jsxs)("div",{className:"react-ext-container custom-scrollbar",children:[(0,Re.jsx)(f0,{controller:e}),(0,Re.jsx)("div",{className:"mainContainer",children:(0,Re.jsx)(h0,{controller:e})})]})})};delete Array.prototype.toJSON,delete HTMLElement.prototype.remove;const _0=e=>{const t=document.getElementById(e);if(t){return(0,a.H)(t).render((0,Re.jsx)(m0,{})),console.log("React app rendered in ".concat(e)),!0}return!1};_0("react-chrome-extension")||_0("root")||console.error("No div found to render the React app in either root elements")})();
//# sourceMappingURL=main.js.map